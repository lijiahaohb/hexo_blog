{"meta":{"version":1,"warehouse":"4.0.1"},"models":{"Asset":[{"_id":"themes/landscape/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/anime.min.js","path":"lib/anime.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/all.min.css","path":"lib/font-awesome/css/all.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","path":"lib/font-awesome/webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","path":"lib/font-awesome/webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","path":"lib/font-awesome/webfonts/fa-solid-900.woff2","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1653965439540},{"_id":"themes/landscape/.npmignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1653965439524},{"_id":"themes/landscape/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1653965439524},{"_id":"themes/landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1653965439524},{"_id":"themes/landscape/README.md","hash":"37fae88639ef60d63bd0de22314d7cc4c5d94b07","modified":1653965439524},{"_id":"themes/landscape/_config.yml","hash":"79ac6b9ed6a4de5a21ea53fc3f5a3de92e2475ff","modified":1653965439528},{"_id":"themes/landscape/package.json","hash":"544f21a0b2c7034998b36ae94dba6e3e0f39f228","modified":1653965439528},{"_id":"themes/landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1653965439528},{"_id":"themes/landscape/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1653965439540},{"_id":"themes/landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1653965439540},{"_id":"themes/landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1653965439540},{"_id":"themes/landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1653965439544},{"_id":"themes/landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1653965439544},{"_id":"themes/landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1653965439544},{"_id":"themes/landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1653965439544},{"_id":"themes/landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1653965439548},{"_id":"themes/landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1653965439548},{"_id":"themes/landscape/languages/zh-CN.yml","hash":"ca40697097ab0b3672a80b455d3f4081292d1eed","modified":1653965439548},{"_id":"themes/landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1653965439552},{"_id":"themes/landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1653965439536},{"_id":"themes/landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1653965439552},{"_id":"themes/landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1653965439552},{"_id":"themes/landscape/layout/layout.ejs","hash":"f155824ca6130080bb057fa3e868a743c69c4cf5","modified":1653965439552},{"_id":"themes/landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1653965439556},{"_id":"themes/landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1653965439556},{"_id":"themes/landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1653965439556},{"_id":"themes/landscape/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1653965439556},{"_id":"themes/landscape/layout/_partial/after-footer.ejs","hash":"d0d753d39038284d52b10e5075979cc97db9cd20","modified":1653965439560},{"_id":"themes/landscape/layout/_partial/archive.ejs","hash":"950ddd91db8718153b329b96dc14439ab8463ba5","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/article.ejs","hash":"c4c835615d96a950d51fa2c3b5d64d0596534fed","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/footer.ejs","hash":"93518893cf91287e797ebac543c560e2a63b8d0e","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/gauges-analytics.ejs","hash":"aad6312ac197d6c5aaf2104ac863d7eba46b772a","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/header.ejs","hash":"7e749050be126eadbc42decfbea75124ae430413","modified":1653965439572},{"_id":"themes/landscape/layout/_partial/head.ejs","hash":"5abf77aec957d9445fc71a8310252f0013c84578","modified":1653965439568},{"_id":"themes/landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1653965439572},{"_id":"themes/landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1653965439572},{"_id":"themes/landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1653965439564},{"_id":"themes/landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1653965439572},{"_id":"themes/landscape/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":1653965439572},{"_id":"themes/landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1653965439572},{"_id":"themes/landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1653965439572},{"_id":"themes/landscape/source/css/_variables.styl","hash":"628e307579ea46b5928424313993f17b8d729e92","modified":1653965439580},{"_id":"themes/landscape/source/css/style.styl","hash":"a70d9c44dac348d742702f6ba87e5bb3084d65db","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1653965439580},{"_id":"themes/landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1653965439576},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1653965439576},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1653965439580},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1653965439580},{"_id":"themes/landscape/source/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1653965439576},{"_id":"themes/landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1653965439576},{"_id":"themes/landscape/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1653965439576},{"_id":"themes/landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1653965439576},{"_id":"themes/landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1653965439576},{"_id":"themes/landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1653965439576},{"_id":"themes/landscape/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1653965439576},{"_id":"themes/landscape/source/css/_partial/article.styl","hash":"10685f8787a79f79c9a26c2f943253450c498e3e","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1653965439580},{"_id":"themes/landscape/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/highlight.styl","hash":"bf4e7be1968dad495b04e83c95eac14c4d0ad7c0","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1653965439584},{"_id":"themes/landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1653965439584},{"_id":"themes/landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1653965439580},{"_id":"themes/landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1653965439588},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1653965439580},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1653965439584},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1653965439588},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1653965439576},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1653965439588},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1653965439588},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1653965439588},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1653965439588},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1653965439588},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1653965439588},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1653965439588},{"_id":"themes/landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1653965439584},{"_id":"source/_posts/config.md","hash":"0d0b2143a05e851eb1c556ef3623630765e1dba8","modified":1653279155461},{"_id":"source/_posts/go_debug.md","hash":"95187a106f3e8dec9a4145c03df2af3d895217e8","modified":1652837606051},{"_id":"source/_posts/go_chat.md","hash":"45453564ed083d78f95eb92c6fa309595884e4b3","modified":1652278084640},{"_id":"source/_posts/docker_learning.md","hash":"0a77ae1f4cdcf98f7f6d5b3bc641168eed7c2449","modified":1651669153148},{"_id":"source/_posts/go_gorm.md","hash":"cb0882b56c5b0d02a94b7503e5902b1d254a39a8","modified":1652841460246},{"_id":"source/_posts/go_gin.md","hash":"c75f0b95ddb7f86eb46052d82f339c9cc8589b75","modified":1651049501642},{"_id":"source/_posts/go_im.md","hash":"28cb0d9f843ae09f06ae011b9fead709a18dd9ca","modified":1651730228934},{"_id":"source/_posts/go_kafka.md","hash":"0848c7a593beb1fee0fed2e8aac123792aa46398","modified":1651052547202},{"_id":"source/_posts/go_live.md","hash":"6ada53f66e0d57a0fb66819a3d262786891ac958","modified":1652447443285},{"_id":"source/_posts/go_redis.md","hash":"c3300d1002678f18648758009a22e3099e710ec8","modified":1651033844758},{"_id":"source/_posts/kafka.md","hash":"ccd2d231481f5cf52c4f71d2f03bd2d9e59ba284","modified":1651051772468},{"_id":"source/_posts/go_rpc.md","hash":"1312a8023ecccd8b4992dfd1467bf60ac8cd9132","modified":1651194219196},{"_id":"source/_posts/go_test.md","hash":"f1f36ad5c9d6567f7d1a1b81c5291f7c68213f6b","modified":1652104131825},{"_id":"source/_posts/redis_basic.md","hash":"3a70c41a151759ac6156e81c550d161c7c6a1a99","modified":1651032462761},{"_id":"source/_posts/redis_cluster.md","hash":"7bfc41a2d1e9eb130f4ec9e5b92df0c89e69bcd5","modified":1651032504938},{"_id":"source/_posts/go/config.md","hash":"8987e3e4854b0f8e22cee903276cb24b2ddb1a29","modified":1653990737945},{"_id":"source/_posts/go/docker_learning.md","hash":"55735db43f2d2e59bb165f695e9a6ba0007a0078","modified":1653990688595},{"_id":"source/_posts/go/go_chat.md","hash":"38b6343aa36721765ed556bf815657f35540e099","modified":1653992804590},{"_id":"source/_posts/go/go_debug.md","hash":"9d4f512d6da868496f64feddc5c992507464cd91","modified":1653990688595},{"_id":"source/_posts/go/go_gin.md","hash":"3120d10d3c41da632193e0965ba246854abff5e2","modified":1653990688595},{"_id":"source/_posts/go/go_gorm.md","hash":"7069a108fe91ecb7d08514802cb906011922f59f","modified":1653990688595},{"_id":"source/_posts/go/go_im.md","hash":"9025d8cf4406179b6ed80b6ca0fcd76c7e6aaca8","modified":1653990688595},{"_id":"source/_posts/go/go_kafka.md","hash":"c4f4dbc6cca401086243fbc4881ea7c5aae8acae","modified":1653990688595},{"_id":"source/_posts/go/go_live.md","hash":"6e8ef9cb6dc9dc3fdd7483b3bf161d5b49b66508","modified":1653990688595},{"_id":"source/_posts/go/go_redis.md","hash":"0e5ba28b37e43e9641d42fe8b9c2722968b9fcb8","modified":1656815448106},{"_id":"source/_posts/go/go_rpc.md","hash":"4766410050c4ab56213334c486cd68a5b8bd60a6","modified":1653990688595},{"_id":"source/_posts/go/go_test.md","hash":"e290aa94a7811ec3cffe40816604953f2c990990","modified":1653990688595},{"_id":"source/_posts/go/kafka.md","hash":"4cd095306d32b87780c254c61f6b9699acbc0bef","modified":1653990688595},{"_id":"source/_posts/go/redis_basic.md","hash":"5c497e775a2022d75a98434fd23d8bdad7460197","modified":1653990688595},{"_id":"source/_posts/go/redis_cluster.md","hash":"854fa8dc47fce45c63d8e9eb52041890b0c4f1a7","modified":1653990688595},{"_id":"source/_posts/themes/butterfly/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1653966494297},{"_id":"source/_posts/themes/butterfly/.git/config","hash":"2798b391a5b9d31ffbb1a38ec4ff216c84f96e28","modified":1653966625606},{"_id":"source/_posts/themes/butterfly/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/fsmonitor-watchman.sample","hash":"55a762007dd48d229ef89fe8d0882256dcbee41a","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/pre-commit.sample","hash":"33729ad4ce51acda35094e581e4088f3167a0af8","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/pre-merge-commit.sample","hash":"04c64e58bc25c149482ed45dbd79e40effb89eb7","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1653966494293},{"_id":"source/_posts/themes/butterfly/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1653966494293},{"_id":"node_modules/hexo-theme-butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/README.md","hash":"66b4889591d0f36696c4d363412c753b6fe25519","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/README_CN.md","hash":"08afd014fd27019909f341a2ad6162665958c6d6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/_config.yml","hash":"390288cffa0aa1338c02e7f240bafa6eef1d4f4c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/package.json","hash":"5e39dec92b224cd27b1833626875b4f7a2a94e4f","modified":1653969160087},{"_id":"node_modules/hexo-theme-butterfly/.github/stale.yml","hash":"5e8ea535424e8112439135d21afc5262c0bc0b39","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/default.yml","hash":"1e37a3695d50e3e61d7c36e58a6dac872a4a56cd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/en.yml","hash":"d1bb560698eb8b0079495b7b18b44facb610f9fd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-CN.yml","hash":"28b6f0c39155651d747eb595e0a283bc97be2e09","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-TW.yml","hash":"947f794e862bb2813e36887f777bdb760f70a322","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/archive.pug","hash":"bd62286afb64a51c97e800c5945620d51605d5fa","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"67e4f5a66d4b8cabadbaad0410628364ee75e0ae","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/additional-js.pug","hash":"594a977ebe8d97e60fa3d7cb40fc260ded4d8a58","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head.pug","hash":"54511ed299a3bcf4ecbb62e3078f6b0611ccbd2c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/layout.pug","hash":"da27c20f0e672103b984e135eb2fe7770ca7fcce","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/pagination.pug","hash":"0b80f04950bd0fe5e6c4e7b7559adf4d0ce28436","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/sidebar.pug","hash":"8d39473ed112d113674a0f689f63fae06c72abd2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/config.js","hash":"a12b9f11d7d3f52de5b2090d2805d7303e0187a5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/init.js","hash":"b4940a5c73d3a5cd8bb5883e3041ecdd905a74e0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/inject_head_js.js","hash":"b4cd617c619d1a0df93603721a6fa1317526174b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/page.js","hash":"c6611d97087c51845cb1ab4821696a62fa33daeb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/related_post.js","hash":"d368a8830e506c8b5eb6512b709ec8db354d5ea1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/note.js","hash":"c16c6eb058af2b36bcd583b2591076c7ebdd51ad","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","hash":"4890a40366d6443f8b8942a4e9a6dce9fe3494f5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","hash":"04efcbd28b37875cfec88eb87cab7256a9ebb327","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config.pug","hash":"8f41fa9732ea654a10f6e666d9c782c7e27e5ea6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/index.pug","hash":"65fa23680af0daf64930a399c2f2ca37809a8149","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/post-info.pug","hash":"19a05dccfbffdf31cfa48c3208542b924637303d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/post-ui.pug","hash":"b9ebb02af8ccf43e3f73be43db19254fa913c57b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/flink.pug","hash":"fed069baa9b383f57db32bb631115071d29bdc60","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pjax.pug","hash":"460c37caeed6e6e72c1e62292e6c5e9699dd5937","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/subtitle.pug","hash":"bae2f32ac96cebef600c1e37eaa8467c9a7e5d92","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_author.pug","hash":"e37468e63db2a0ac09b65d21b7de3e62425bb455","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_webinfo.pug","hash":"0612aaee878f33ea8d3da0293c7dc3b6cd871466","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/function.styl","hash":"644d520fe80cc82058467708ab82ccad313b0c27","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/index.styl","hash":"714f19e7d66df84938bd1b82b33d5667abe1f147","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/aside.styl","hash":"ca58af8903eb1d1d05edae54fc2e23aeac6da6c5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/chat.styl","hash":"29f48f9370f245e6e575b5836bccf47eb5688d8b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/footer.styl","hash":"26be2afa9d4e7016cf3c42a6cd166f01e8e4ad5c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/head.styl","hash":"d97c1722ce0fcc319f1f90ec2d51f9d746748e2b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/loading.styl","hash":"ef21990de28bd75dcd0f88b8d616e1a7a137502f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/post.styl","hash":"15056fba0bd5a45ea8dc97eb557f6929ff16797a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/third-party.styl","hash":"8314e9749eb1ae40c4bae9735b7a6638b2d6876a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/darkmode.styl","hash":"f67177310f5594954b25a591d186d28d5d450b18","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/homepage.styl","hash":"826dae759062d8f84eb2bf5ab8fdb80e0f79d58b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/algolia.styl","hash":"51e45625929d57c9df3ba9090af99b9b7bb9a15b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/index.styl","hash":"39d61cbe0c1e937f83ba3b147afaa29b4de2f87d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/local-search.styl","hash":"25e58a7a8bda4b73d0a0e551643ca01b09ccd7e5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/note.styl","hash":"08493b66b9f31f2bd3e9a3115017a0ce16142b20","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","hash":"ce8131b712dca80f289015aef75f86e727f62981","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"7848ec58c6ec03243abf80a3b22b4dc10f3edf53","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"e3bf847553515174f6085df982f0623e9783db7a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"58406a7a3bf45815769f652bf3ef81e57dcd07eb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"e4b7bf91a29bd03181593b63e1f3ee1103af2e48","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"5f648086a33a32d169a2f8d8c549c08aa02f67db","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/index.pug","hash":"3f05f8311ae559d768ee3d0925e84ed767c314d3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqus.pug","hash":"a111407fdcafcf1099e26ffa69786f8822c5d9fb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"693d999777dd16e0566d29ac3203d4c167b2f9a7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"2d8fc3fb8f9aec61400acf3c94070bd8539058f8","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"22e2ef30fe5eb1db7566e89943c74ece029b2a8e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/index.pug","hash":"e4850f2c9ba5f6b2248808f7257662679e0fab0a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/js.pug","hash":"9302837f1e35f153323bb4f166514c7e96e8ecdd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"81c6070e06ecc2244040c7007566d7972f46ec4e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/waline.pug","hash":"15462d1ed04651ad3b430c682842ac400f6f9b47","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/katex.pug","hash":"31b007dc0f3de52176f278012ecf17a4bcecde2c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mathjax.pug","hash":"f4dc7d02c8192979404ae9e134c5048d3d0a76e2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mermaid.pug","hash":"8e33aca36a4d3ae9e041ba05ced8eff56ae38f77","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"f6506ccfd1ce994b9e53aa95588d0b6dbad11411","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"233907dd7f5b5f33412701d2ccffbc0bbae8707b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"dd0bc119029b62dce5dc965d5de7377e438fa29a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/algolia.pug","hash":"e8245d0b4933129bb1c485d8de11a9e52e676348","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/local-search.pug","hash":"178c9cdcc4ce5a006885b24ce4a3d624e4734899","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/share-js.pug","hash":"f61d63724ea5c5f352568b3a16bde023affefbe5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":499162500000},{"_id":"source/_posts//README.md","hash":"4bc84f1abaa729ce64c654f6b3108594e9d6b2ac","modified":1652498403049},{"_id":"source/_posts//_sidebar.md","hash":"e2c7e196542d3f48008f428b050e182ac6028572","modified":1652498419949},{"_id":"source/_posts//live_server.md","hash":"c1fb14c89cf9de33b7d5d668adaf6b97424b039c","modified":1652498022650},{"_id":"source/_posts//live_protocol.md","hash":"24c69016430fc0109536a85a6fe1c066dcf0666a","modified":1652773026775},{"_id":"source/_posts/tools/_sidebar.md","hash":"43fa54b8d6c3572cb8582154852dd086f9f89c48","modified":1650872390795},{"_id":"source/_posts/tools/git_learning.md","hash":"0c659da51e0ce4a32edc5ed31ea655b171ed4c23","modified":1657464429927},{"_id":"source/_posts/tools/README.md","hash":"003e3e243859ed9f0da8bcfb129995f3f21c2629","modified":1650870466195},{"_id":"source/categories/index.md","hash":"9013b4f2ff28412acaf0eaa8830d926af17faf4d","modified":1653990558436},{"_id":"source/_posts/av/live_protocol.md","hash":"9f47239e7e3320fad87f3a455fdc930ddef2679d","modified":1653990787354},{"_id":"source/_posts/av/live_server.md","hash":"07302ffd02adcfee48517ca8701c4e8700c0d726","modified":1653990771310},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1653991135292},{"_id":"themes/next/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1653991135292},{"_id":"themes/next/.gitignore","hash":"56f3470755c20311ddd30d421b377697a6e5e68b","modified":1653991135296},{"_id":"themes/next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1653991135296},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1653991135296},{"_id":"themes/next/.travis.yml","hash":"ecca3b919a5b15886e3eca58aa84aafc395590da","modified":1653991135296},{"_id":"themes/next/README.md","hash":"9b4b7d66aca47f9c65d6321b14eef48d95c4dff1","modified":1653991135296},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1653991135292},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1653991135296},{"_id":"themes/next/gulpfile.js","hash":"1b4fc262b89948937b9e3794de812a7c1f2f3592","modified":1653991135296},{"_id":"themes/next/package.json","hash":"62fad6de02adbbba9fb096cbe2dcc15fe25f2435","modified":1653991135300},{"_id":"themes/next/_config.yml","hash":"d4e64a3847c7fdb66a99f46ce96d0da927db4900","modified":1653993343481},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"aa4cb7aff595ca628cb58160ee1eee117989ec4e","modified":1653991135292},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"1a435c20ae8fa183d49bbf96ac956f7c6c25c8af","modified":1653991135296},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"e554931b98f251fd49ff1d2443006d9ea2c20461","modified":1653991135292},{"_id":"themes/next/.github/config.yml","hash":"1d3f4e8794986817c0fead095c74f756d45f91ed","modified":1653991135296},{"_id":"themes/next/.github/issue-close-app.yml","hash":"7cba457eec47dbfcfd4086acd1c69eaafca2f0cd","modified":1653991135296},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1653991135296},{"_id":"themes/next/.github/lock.yml","hash":"61173b9522ebac13db2c544e138808295624f7fd","modified":1653991135296},{"_id":"themes/next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1653991135296},{"_id":"themes/next/.github/release-drafter.yml","hash":"3cc10ce75ecc03a5ce86b00363e2a17eb65d15ea","modified":1653991135296},{"_id":"themes/next/.github/stale.yml","hash":"fdf82de9284f8bc8e0b0712b4cc1cb081a94de59","modified":1653991135296},{"_id":"themes/next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1653991135296},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"c7a994b9542040317d8f99affa1405c143a94a38","modified":1653991135296},{"_id":"themes/next/docs/AUTHORS.md","hash":"10135a2f78ac40e9f46b3add3e360c025400752f","modified":1653991135296},{"_id":"themes/next/docs/DATA-FILES.md","hash":"cddbdc91ee9e65c37a50bec12194f93d36161616","modified":1653991135296},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1653991135296},{"_id":"themes/next/docs/INSTALLATION.md","hash":"af88bcce035780aaa061261ed9d0d6c697678618","modified":1653991135296},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"94dc3404ccb0e5f663af2aa883c1af1d6eae553d","modified":1653991135296},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1653991135296},{"_id":"themes/next/docs/MATH.md","hash":"d645b025ec7fb9fbf799b9bb76af33b9f5b9ed93","modified":1653991135296},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"8b6e4b2c9cfcb969833092bdeaed78534082e3e6","modified":1653991135296},{"_id":"themes/next/languages/ar.yml","hash":"9815e84e53d750c8bcbd9193c2d44d8d910e3444","modified":1653991135296},{"_id":"themes/next/languages/de.yml","hash":"74c59f2744217003b717b59d96e275b54635abf5","modified":1653991135296},{"_id":"themes/next/languages/default.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1653991135296},{"_id":"themes/next/languages/en.yml","hash":"45bc5118828bdc72dcaa25282cd367c8622758cb","modified":1653991135296},{"_id":"themes/next/languages/es.yml","hash":"c64cf05f356096f1464b4b1439da3c6c9b941062","modified":1653991135296},{"_id":"themes/next/languages/fa.yml","hash":"3676b32fda37e122f3c1a655085a1868fb6ad66b","modified":1653991135296},{"_id":"themes/next/languages/fr.yml","hash":"752bf309f46a2cd43890b82300b342d7218d625f","modified":1653991135296},{"_id":"themes/next/languages/hu.yml","hash":"b1ebb77a5fd101195b79f94de293bcf9001d996f","modified":1653991135296},{"_id":"themes/next/languages/id.yml","hash":"572ed855d47aafe26f58c73b1394530754881ec2","modified":1653991135296},{"_id":"themes/next/languages/it.yml","hash":"44759f779ce9c260b895532de1d209ad4bd144bf","modified":1653991135296},{"_id":"themes/next/languages/ja.yml","hash":"0cf0baa663d530f22ff380a051881216d6adcdd8","modified":1653991135296},{"_id":"themes/next/languages/ko.yml","hash":"0feea9e43cd399f3610b94d755a39fff1d371e97","modified":1653991135296},{"_id":"themes/next/languages/nl.yml","hash":"5af3473d9f22897204afabc08bb984b247493330","modified":1653991135296},{"_id":"themes/next/languages/pt.yml","hash":"718d131f42f214842337776e1eaddd1e9a584054","modified":1653991135296},{"_id":"themes/next/languages/pt-BR.yml","hash":"67555b1ba31a0242b12fc6ce3add28531160e35b","modified":1653991135296},{"_id":"themes/next/languages/ru.yml","hash":"e993d5ca072f7f6887e30fc0c19b4da791ca7a88","modified":1653991135296},{"_id":"themes/next/languages/tr.yml","hash":"fe793f4c2608e3f85f0b872fd0ac1fb93e6155e2","modified":1653991135300},{"_id":"themes/next/languages/uk.yml","hash":"3a6d635b1035423b22fc86d9455dba9003724de9","modified":1653991135300},{"_id":"themes/next/languages/vi.yml","hash":"93393b01df148dcbf0863f6eee8e404e2d94ef9e","modified":1653991135300},{"_id":"themes/next/languages/zh-CN.yml","hash":"a1f15571ee7e1e84e3cc0985c3ec4ba1a113f6f8","modified":1653991135300},{"_id":"themes/next/languages/zh-HK.yml","hash":"3789f94010f948e9f23e21235ef422a191753c65","modified":1653991135300},{"_id":"themes/next/languages/zh-TW.yml","hash":"8c09da7c4ec3fca2c6ee897b2eea260596a2baa1","modified":1653991135300},{"_id":"themes/next/layout/archive.swig","hash":"e4e31317a8df68f23156cfc49e9b1aa9a12ad2ed","modified":1653991135300},{"_id":"themes/next/layout/category.swig","hash":"1bde61cf4d2d171647311a0ac2c5c7933f6a53b0","modified":1653991135300},{"_id":"themes/next/layout/_layout.swig","hash":"6a6e92a4664cdb981890a27ac11fd057f44de1d5","modified":1653991135300},{"_id":"themes/next/layout/index.swig","hash":"7f403a18a68e6d662ae3e154b2c1d3bbe0801a23","modified":1653991135300},{"_id":"themes/next/layout/post.swig","hash":"2f6d992ced7e067521fdce05ffe4fd75481f41c5","modified":1653991135300},{"_id":"themes/next/layout/tag.swig","hash":"0dfb653bd5de980426d55a0606d1ab122bd8c017","modified":1653991135300},{"_id":"themes/next/scripts/renderer.js","hash":"49a65df2028a1bc24814dc72fa50d52231ca4f05","modified":1653991135300},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c3e6b8196c983c40fd140bdeca012d03e6e86967","modified":1653991135292},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"12d99fb8b62bd9e34d9672f306c9ae4ace7e053e","modified":1653991135292},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.md","hash":"d3efc0df0275c98440e69476f733097916a2d579","modified":1653991135296},{"_id":"themes/next/layout/page.swig","hash":"db581bdeac5c75fabb0f17d7c5e746e47f2a9168","modified":1653991135300},{"_id":"themes/next/.github/ISSUE_TEMPLATE/question.md","hash":"53df7d537e26aaf062d70d86835c5fd8f81412f3","modified":1653991135296},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"9c4fe2873123bf9ceacab5c50d17d8a0f1baef27","modified":1653991135296},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"0bd2d696f62a997a11a7d84fec0130122234174e","modified":1653991135296},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"5237a368ab99123749d724b6c379415f2c142a96","modified":1653991135296},{"_id":"themes/next/docs/ru/README.md","hash":"85dd68ed1250897a8e4a444a53a68c1d49eb7e11","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"34b88784ec120dfdc20fa82aadeb5f64ef614d14","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"fb23b85db6f7d8279d73ae1f41631f92f64fc864","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"ca1030efdfca5e20f9db2e7a428998e66a24c0d0","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"d3f03be036b75dc71cf3c366cd75aee7c127c874","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"579c7bd8341873fb8be4732476d412814f1a3df7","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"8b18f84503a361fc712b0fe4d4568e2f086ca97d","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"b92585d251f1f9ebe401abb5d932cb920f9b8b10","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/README.md","hash":"c038629ff8f3f24e8593c4c8ecf0bef3a35c750d","modified":1653991135296},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"d9ce7331c1236bbe0a551d56cef2405e47e65325","modified":1653991135296},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"9c8dc0b8170679cdc1ee9ee8dbcbaebf3f42897b","modified":1653991135300},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"71655ca21907e9061b6e8ac52d0d8fbf54d0062b","modified":1653991135300},{"_id":"themes/next/layout/_partials/comments.swig","hash":"db6ab5421b5f4b7cb32ac73ad0e053fdf065f83e","modified":1653991135300},{"_id":"themes/next/layout/_partials/footer.swig","hash":"4369b313cbbeae742cb35f86d23d99d4285f7359","modified":1653991135300},{"_id":"themes/next/layout/_macro/post.swig","hash":"090b5a9b6fca8e968178004cbd6cff205b7eba57","modified":1653991665220},{"_id":"themes/next/layout/_partials/languages.swig","hash":"ba9e272f1065b8f0e8848648caa7dea3f02c6be1","modified":1653991135300},{"_id":"themes/next/layout/_partials/widgets.swig","hash":"83a40ce83dfd5cada417444fb2d6f5470aae6bb0","modified":1653991135300},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1653991135300},{"_id":"themes/next/layout/_scripts/index.swig","hash":"cea942b450bcb0f352da78d76dc6d6f1d23d5029","modified":1653991135300},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"d1f2bfde6f1da51a2b35a7ab9e7e8eb6eefd1c6b","modified":1653991135300},{"_id":"themes/next/layout/_scripts/pjax.swig","hash":"4d2c93c66e069852bb0e3ea2e268d213d07bfa3f","modified":1653991135300},{"_id":"themes/next/layout/_scripts/three.swig","hash":"a4f42f2301866bd25a784a2281069d8b66836d0b","modified":1653991135300},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"b782eb2e34c0c15440837040b5d65b093ab6ec04","modified":1653991135300},{"_id":"themes/next/layout/_third-party/index.swig","hash":"70c3c01dd181de81270c57f3d99b6d8f4c723404","modified":1653991135300},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"311e5eceec9e949f1ea8d623b083cec0b8700ff2","modified":1653991135300},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"ef38c213679e7b6d2a4116f56c9e55d678446069","modified":1653991135300},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":1653991135300},{"_id":"themes/next/scripts/events/index.js","hash":"5743cde07f3d2aa11532a168a652e52ec28514fd","modified":1653991135300},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"aec50ed57b9d5d3faf2db3c88374f107203617e0","modified":1653991135300},{"_id":"themes/next/scripts/filters/front-matter.js","hash":"703bdd142a671b4b67d3d9dfb4a19d1dd7e7e8f7","modified":1653991135300},{"_id":"themes/next/scripts/filters/locals.js","hash":"b193a936ee63451f09f8886343dcfdca577c0141","modified":1653991135300},{"_id":"themes/next/scripts/filters/minify.js","hash":"19985723b9f677ff775f3b17dcebf314819a76ac","modified":1653991135300},{"_id":"themes/next/scripts/filters/post.js","hash":"44ba9b1c0bdda57590b53141306bb90adf0678db","modified":1653991135300},{"_id":"themes/next/scripts/helpers/engine.js","hash":"bdb424c3cc0d145bd0c6015bb1d2443c8a9c6cda","modified":1653991135300},{"_id":"themes/next/scripts/helpers/font.js","hash":"40cf00e9f2b7aa6e5f33d412e03ed10304b15fd7","modified":1653991135300},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"5e11f30ddb5093a88a687446617a46b048fa02e5","modified":1653991135300},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"958e86b2bd24e4fdfcbf9ce73e998efe3491a71f","modified":1653991135300},{"_id":"themes/next/scripts/tags/button.js","hash":"8c6b45f36e324820c919a822674703769e6da32c","modified":1653991135300},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"94e0bbc7999b359baa42fa3731bdcf89c79ae2b3","modified":1653991135300},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f1826ade2d135e2f60e2d95cb035383685b3370c","modified":1653991135300},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"d902fd313e8d35c3cc36f237607c2a0536c9edf1","modified":1653991135300},{"_id":"themes/next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1653991135300},{"_id":"themes/next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1653991135300},{"_id":"themes/next/scripts/tags/pdf.js","hash":"8c613b39e7bff735473e35244b5629d02ee20618","modified":1653991135300},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1653991135300},{"_id":"themes/next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1653991135300},{"_id":"themes/next/scripts/tags/tabs.js","hash":"93d8a734a3035c1d3f04933167b500517557ba3e","modified":1653991135300},{"_id":"themes/next/source/css/_mixins.styl","hash":"e31a557f8879c2f4d8d5567ee1800b3e03f91f6e","modified":1653991135304},{"_id":"themes/next/source/css/_colors.styl","hash":"a8442520f719d3d7a19811cb3b85bcfd4a596e1f","modified":1653991135304},{"_id":"themes/next/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":1653991135304},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1653991135304},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1653991135304},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1653991135304},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1653991135304},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1653991135304},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1653991135304},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1653991135304},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1653991135304},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1653991135304},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1653991135304},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1653991135304},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1653991135304},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1653991135304},{"_id":"themes/next/source/js/algolia-search.js","hash":"498d233eb5c7af6940baf94c1a1c36fdf1dd2636","modified":1653991135304},{"_id":"themes/next/source/js/bookmark.js","hash":"9734ebcb9b83489686f5c2da67dc9e6157e988ad","modified":1653991135304},{"_id":"themes/next/source/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1653991135308},{"_id":"themes/next/source/js/next-boot.js","hash":"a1b0636423009d4a4e4cea97bcbf1842bfab582c","modified":1653991135308},{"_id":"themes/next/source/js/utils.js","hash":"730cca7f164eaf258661a61ff3f769851ff1e5da","modified":1653991135308},{"_id":"themes/next/source/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1653991135308},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"000bad572d76ee95d9c0a78f9ccdc8d97cc7d4b4","modified":1653991135300},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"810d544019e4a8651b756dd23e5592ee851eda71","modified":1653991135300},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"c70f8e71e026e878a4e9d5ab3bbbf9b0b23c240c","modified":1653991135300},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"7dbe93b8297b746afb89700b4d29289556e85267","modified":1653991135300},{"_id":"themes/next/layout/_partials/header/menu-item.swig","hash":"9440d8a3a181698b80e1fa47f5104f4565d8cdf3","modified":1653991135300},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"d31f896680a6c2f2c3f5128b4d4dd46c87ce2130","modified":1653991135300},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"ae2261bea836581918a1c2b0d1028a78718434e0","modified":1653991135300},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"c851717497ca64789f2176c9ecd1dedab237b752","modified":1653991135300},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"9b7a66791d7822c52117fe167612265356512477","modified":1653991135300},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"954ad71536b6eb08bd1f30ac6e2f5493b69d1c04","modified":1653991135300},{"_id":"themes/next/layout/_partials/post/post-followme.swig","hash":"ceba16b9bd3a0c5c8811af7e7e49d0f9dcb2f41e","modified":1653991135300},{"_id":"themes/next/layout/_partials/post/post-footer.swig","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1653991135300},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":1653991135300},{"_id":"themes/next/layout/_partials/post/post-reward.swig","hash":"2b1a73556595c37951e39574df5a3f20b2edeaef","modified":1653991135300},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"48430bd03b8f19c9b8cdb2642005ed67d56c6e0b","modified":1653991135300},{"_id":"themes/next/source/js/local-search.js","hash":"35ccf100d8f9c0fd6bfbb7fa88c2a76c42a69110","modified":1653991135304},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"2be50f9bfb1c56b85b3b6910a7df27f51143632c","modified":1653991135300},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"f48a6a8eba04eb962470ce76dd731e13074d4c45","modified":1653991135300},{"_id":"themes/next/layout/_scripts/pages/schedule.swig","hash":"077b5d66f6309f2e7dcf08645058ff2e03143e6c","modified":1653991135300},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1653991135300},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1653991135300},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1653991135300},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1653991135300},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1653991135300},{"_id":"themes/next/layout/_partials/sidebar/site-overview.swig","hash":"c46849e0af8f8fb78baccd40d2af14df04a074af","modified":1653991135300},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"2fa2b51d56bfac6a1ea76d651c93b9c20b01c09b","modified":1653991135300},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":1653991135300},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"1472cabb0181f60a6a0b7fec8899a4d03dfb2040","modified":1653991135300},{"_id":"themes/next/layout/_third-party/chat/chatra.swig","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":1653991135300},{"_id":"themes/next/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1653991135300},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"f39a5bf3ce9ee9adad282501235e0c588e4356ec","modified":1653991135300},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b14908644225d78c864cd0a9b60c52407de56183","modified":1653991135300},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"82f5b6822aa5ec958aa987b101ef860494c6cf1f","modified":1653991135300},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"f7a9eca599a682479e8ca863db59be7c9c7508c8","modified":1653991135300},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"d6ceb70648555338a80ae5724b778c8c58d7060d","modified":1653991135300},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"6c5976621efd5db5f7c4c6b4f11bc79d6554885f","modified":1653991135300},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"be0a8eccf1f6dc21154af297fc79555343031277","modified":1653991135300},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"4791c977a730f29c846efcf6c9c15131b9400ead","modified":1653991135300},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"d35a999d67f4c302f76fdf13744ceef3c6506481","modified":1653991135300},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"ecf751321e799f0fb3bf94d049e535130e2547aa","modified":1653991135300},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1653991135300},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.swig","hash":"4b1986e43d6abce13450d2b41a736dd6a5620a10","modified":1653991135300},{"_id":"themes/next/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1653991135300},{"_id":"themes/next/layout/_third-party/statistics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1653991135300},{"_id":"themes/next/layout/_third-party/statistics/firestore.swig","hash":"b26ac2bfbe91dd88267f8b96aee6bb222b265b7a","modified":1653991135300},{"_id":"themes/next/layout/_third-party/statistics/index.swig","hash":"5f6a966c509680dbfa70433f9d658cee59c304d7","modified":1653991135300},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.swig","hash":"d56d5af427cdfecc33a0f62ee62c056b4e33d095","modified":1653991135300},{"_id":"themes/next/layout/_third-party/tags/mermaid.swig","hash":"f3c43664a071ff3c0b28bd7e59b5523446829576","modified":1653991135300},{"_id":"themes/next/layout/_third-party/tags/pdf.swig","hash":"d30b0e255a8092043bac46441243f943ed6fb09b","modified":1653991135300},{"_id":"themes/next/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1653991135300},{"_id":"themes/next/scripts/events/lib/config.js","hash":"d34c6040b13649714939f59be5175e137de65ede","modified":1653991135300},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"f233d8d0103ae7f9b861344aa65c1a3c1de8a845","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"a54708fd9309b4357c423a3730eb67f395344a5e","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"7f2d93af012c1e14b8596fecbfc7febb43d9b7f5","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"4c0c99c7e0f00849003dfce02a131104fb671137","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"7f8b92913d21070b489457fa5ed996d2a55f2c32","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"e51dc3072c1ba0ea3008f09ecae8b46242ec6021","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"d5fefc31fba4ab0188305b1af1feb61da49fdeb0","modified":1653991135300},{"_id":"themes/next/scripts/filters/comment/valine.js","hash":"6cbd85f9433c06bae22225ccf75ac55e04f2d106","modified":1653991135300},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":1653991135304},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"62df49459d552bbf73841753da8011a1f5e875c8","modified":1653991135304},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"f70be8e229da7e1715c11dd0e975a2e71e453ac8","modified":1653991135304},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"612ec843372dae709acb17112c1145a53450cc59","modified":1653991135304},{"_id":"themes/next/source/js/schemes/muse.js","hash":"1eb9b88103ddcf8827b1a7cbc56471a9c5592d53","modified":1653991135308},{"_id":"themes/next/source/css/_variables/base.styl","hash":"818508748b7a62e02035e87fe58e75b603ed56dc","modified":1653991135304},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"0ac5ce155bc58c972fe21c4c447f85e6f8755c62","modified":1653991135308},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1653991135308},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"ca5e70662dcfb261c25191cc5db5084dcf661c76","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"a47725574e1bee3bc3b63b0ff2039cc982b17eff","modified":1653991135304},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1653991135308},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"8e7b57a72e757cf95278239641726bb2d5b869d1","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"2e3bf7baf383c9073ec5e67f157d3cb3823c0957","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"681d33e3bc85bdca407d93b134c089264837378c","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"a1690e035b505d28bdef2b4424c13fc6312ab049","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"0b2c4b78eead410020d7c4ded59c75592a648df8","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a2e9e00962e43e98ec2614d6d248ef1773bb9b78","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"b1f0fab7344a20ed6748b04065b141ad423cf4d9","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"8f58570a1bbc34c4989a47a1b7d42a8030f38b06","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"18ce72d90459c9aa66910ac64eae115f2dde3767","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"179e33b8ac7f4d8a8e76736a7e4f965fe9ab8b42","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"f6516d0f7d89dc7b6c6e143a5af54b926f585d82","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"7785bd756e0c4acede3a47fec1ed7b55988385a5","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"bb7ace23345364eb14983e860a7172e1683a4c94","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"7104b9cef90ca3b140d7a7afcf15540a250218fc","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"6136da4bbb7e70cec99f5c7ae8c7e74f5e7c261a","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"a717969829fa6ef88225095737df3f8ee86c286b","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"f0131db6275ceaecae7e1a6a3798b8f89f6c850d","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"4d1c17345d2d39ef7698f7acf82dfc0f59308c34","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"93db5dafe9294542a6b5f647643cb9deaced8e06","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"2b2e7b5cea7783c9c8bb92655e26a67c266886f0","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"e282df938bd029f391c466168d0e68389978f120","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"70a4324b70501132855b5e59029acfc5d3da1ebd","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"85da2f3006f4bef9a2199416ecfab4d288f848c4","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1653991135304},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-regular-400.woff2","hash":"260bb01acd44d88dcb7f501a238ab968f86bef9e","modified":1653991135308},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"e740deadcfc4f29c5cb01e40f9df6277262ba4e3","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"e771dcb0b4673e063c0f3e2d73e7336ac05bcd57","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"d21d4ac1982c13d02f125a67c065412085a92ff2","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"e75693f33dbc92afc55489438267869ae2f3db54","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f49ca072b5a800f735e8f01fc3518f885951dd8e","modified":1653991135304},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"44f47c88c06d89d06f220f102649057118715828","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"902569a9dea90548bec21a823dd3efd94ff7c133","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"1e4190c10c9e0c9ce92653b0dbcec21754b0b69d","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"72d495a88f7d6515af425c12cbc67308a57d88ea","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"65cb6edb69e94e70e3291e9132408361148d41d5","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"6a97bcfa635d637dc59005be3b931109e0d1ead5","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"d114b2a531129e739a27ba6271cfe6857aa9a865","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"99e12c9ce3d14d4837e3d3f12fc867ba9c565317","modified":1653991135304},{"_id":"themes/next/source/lib/font-awesome/css/all.min.css","hash":"0038dc97c79451578b7bd48af60ba62282b4082b","modified":1653991135308},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"a760ee83ba6216871a9f14c5e56dc9bd0d9e2103","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"b49e9fbd3c182b8fc066b8c2caf248e3eb748619","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"e2992846b39bf3857b5104675af02ba73e72eed5","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"9f0b93d109c9aec79450c8a0cf4a4eab717d674d","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"9a878d0119785a2316f42aebcceaa05a120b9a7a","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e2d606f1ac343e9be4f15dbbaf3464bc4df8bf81","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/header.styl","hash":"a793cfff86ad4af818faef04c18013077873f8f0","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"e7a9fdb6478b8674b1cdf94de4f8052843fb71d9","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"5f432a6ed9ca80a413c68b00e93d4a411abf280a","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/footer/footer.styl","hash":"454a4aebfabb4469b92a8cbb49f46c49ac9bf165","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"45a239edca44acecf971d99b04f30a1aafbf6906","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"b2fc519828fe89a1f8f03ff7b809ad68cd46f3d7","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"2cb1876e9e0c9ac32160888af27b1178dbcb0616","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"fa0222197b5eee47e18ac864cdc6eac75678b8fe","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"1f0e7fbe80956f47087c2458ea880acf7a83078b","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"a960a2dd587b15d3b3fe1b59525d6fa971c6a6ec","modified":1653991135304},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"ded41fd9d20a5e8db66aaff7cc50f105f5ef2952","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"9b479c2f9a9bfed77885e5093b8245cc5d768ec7","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"a05a4031e799bc864a4536f9ef61fe643cd421af","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"b3220db827e1adbca7880c2bb23e78fa7cbe95cb","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar.styl","hash":"a9cd93c36bae5af9223e7804963096274e8a4f03","modified":1653991135304},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"2a47f8a6bb589c2fb635e6c1e4a2563c7f63c407","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"f71a3e86c05ea668b008cf05a81f67d92b6d65e4","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/highlight/highlight.styl","hash":"35c871a809afa8306c8cde13651010e282548bc6","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"1d2778ca5aeeeafaa690dc2766b01b352ab76a02","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/highlight/theme.styl","hash":"3b3acc5caa0b95a2598bef4eeacb21bab21bea56","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"709d10f763e357e1472d6471f8be384ec9e2d983","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"d7fce4b51b5f4b7c31d93a9edb6c6ce740aa0d6b","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"e4d9a77ffe98e851c1202676940097ba28253313","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"f23670f1d8e749f3e83766d446790d8fd9620278","modified":1653991135304},{"_id":"themes/next/source/css/_common/scaffolding/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1653991135304},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-brands-400.woff2","hash":"509988477da79c146cb93fb728405f18e923c2de","modified":1653991135308},{"_id":"themes/next/source/lib/font-awesome/webfonts/fa-solid-900.woff2","hash":"75a88815c47a249eadb5f0edc1675957f860cca7","modified":1653991135308},{"_id":"source/_posts/frontend/react_learning.md","hash":"8fad2013bec1c843f665592099b0faabaefac6c7","modified":1653999423882},{"_id":"source/_posts/frontend/_sidebar.md","hash":"e79bc70296bbdbd7a9404b92aae8c457338a9168","modified":1652273855953},{"_id":"source/_posts/frontend/README.md","hash":"3be5c93742939db0cf8483f0c0ef90bb5dd260fa","modified":1652273829648},{"_id":"source/_posts/go/go_micro.md","hash":"af5038f5dcbe73a352244f414393f3187de31b73","modified":1654654850202},{"_id":"source/_posts/tools/linux_operation.md","hash":"9544ff452aee689722c26e11e5bd00ac1fd1b3a1","modified":1657431305722},{"_id":"source/_posts/go/.go_micro.md.swp","hash":"b9745ee445ae674fd43380484ba285f547f53e9f","modified":1654654858270},{"_id":"source/_posts/go/dump.rdb","hash":"87d756e94ffe3e5693670044e45915a545046f5b","modified":1657431337505},{"_id":"source/_posts/img/arch.png","hash":"f7a1520091cd92ae7054b25e254aba1301f5bf77","modified":1654242897000},{"_id":"source/_posts/go/go_config.md","hash":"d68f58fce969d0bc50da22fca240db73d87e7383","modified":1657162666133}],"Category":[{"name":"Golang","_id":"cl3tyo0vu000bgewz00iv72oz"},{"name":"GolangStudy","_id":"cl3tyugyr000dgewz98idcdpx"},{"name":"av","_id":"cl3tzef5q000vgewzh2mu1rqw"},{"name":"tools","_id":"cl3tzf800000ygewzg2escnh0"}],"Data":[],"Page":[{"title":"categories","date":"2022-05-31T09:30:16.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2022-05-31 17:30:16\ntype: \"categories\"\n---\n","updated":"2022-05-31T09:49:18.436Z","path":"categories/index.html","_id":"cl3tyldvz000agewzezoqd7qu","comments":1,"layout":"page","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"docker","_content":"\n# docker\n\n## docker\n\n* docker\n\t- docker client\n\t- docker daemon\n\t\t* containers\n\t\t* images\n\t- registry\n\n* docker\n\t- : `sudo service docker status`\n\t- \n\t``` bash\n\t# \n\tsudo service docker stop\n\t# \n\tsudo service docker start\n\t# \n\tsudo service docker restart\n\t```\n\t- \n\n\n## \n\n* <b></b>\n\n\t<font color=\"red\"><b>note: </b></font>\n\n\t``` bash\n\tsudo docker run --name mysql8019 -p 13306:3306 -e MYSQL_ROOT_PASSWORD=root1234 -d mysql:8.0.19\n\n\tsudo docker run -it --network host --rm mysql mysql -h127.0.0.1 -P13306 --default-character-set=utf8mb4 -uroot -p\n\n\t# ()\n\tsudo docker run --name daemon_dave -d ubuntu /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n\t```\n\n\t:<br/>\n\tUsage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...] <br/>\n\t-i, --interactive=false  <br/>\n\t-t, --tty=false tty <br/>\n\t-d,     <br/>\n\t-e,     <br/>\n\t-P,     <br/>\n\t-p,     <br/>\n\t--rm,   <br/>\n\t-h,     <br/>\n\t--name links <br/>\n\n* <b></b>\n\t``` bash\n\tsudo docker info\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker ps -a\n\n\t# \n\tsudo docker ps\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker start ID\n\n\t# \n\tsudo docker restart ID\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker attach ID\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker stop ID\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker logs bob_the_container\n\n\t# ID\n\tsudo docker logs 16ecf568ca88\n\n\t# \n\n\t# -ftail -fDockerCtrl+C\n\tsudo docker logs -f daemon_dave\n\n\t# --tail \n\n\t# 10\n\tsudo docker logs --tail 10 daemon_dave\n\t# \n\tsudo docker logs --tail 0 -f daemon_dave\n\t \n\t# --t \n\tsudo docker logs -ft daemon_dave\n\t```\n\n* <b></b>\n\t``` bash\n\tsudo docker top ID/\n\t```\n\n* <b></b>\n\t``` bash\n\tsudo docker stats ID/\n\t```\n\n* <b></b>\n\t``` bash\n\tsudo docker inspect\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker start lijiahao\n\n\t# touch\n\tsudo docker exec bob_the_container touch /etc/new_config_file\n\n\t# \n\tsudo docker attach lijiahao \n\tls /etc/new_config_file\n\t```\n\n\t``` bash\n\t#  /bin/bash\n\tsudo docker exec -it 66ba58480ea9 /bin/bash\n\t```\n\n* <b></b>\n\n\t--restartDcoker <br/>\n\t--restart <br/>\n\tDocker <br/>\n\n\t--restartalwaysDocker\n\n\t``` bash\n\tsudo docker run --restart=always -i -t --name container_dong -d ubuntu /bin/sh\n\t```\n\n\t: on-failure0 <br/>\n\ton-failure\n\n\t``` bash\n\tsudo docker run --restart=on-failure:5 -i -t --name container_dong -d ubuntu /bin/sh\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker rm ID\n\n\t# (-q ID)\n\tsudo docker rm $(sudo docker ps -aq)\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker export ID > xxx.tar\n\t```\n\n* \n\t``` bash\n\tsudo docker load -i xxx.tar\n\t```\n\n## \n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker images\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker rmi \n\t# ()\n\tsudo docker rmi -f \n\t# \n\tsudo docker rmi $(sudo docker images -q)\n\t```\n\n* <b></b>\n\t``` bash\n\t# Dockertag\n\t```\n\n* <b></b>\n\t``` bash\n\t/var/lib/dockerDocker\n\t/var/lib/docker/image\n\t/var/lib/docker/containers\n\t```\n\n* <b></b>\n\t``` bash\n\t# ubuntuDocker Hub\n\tsudo docker run -t -i ubuntu /bin/bash\n\n\t# \n\tsudo docker pull ubuntu\n\n\t# docker rundocker pulllatest\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker login\n\n\t# ( )\n\tsudo docker tag  lijiahao/static_web:v2 lijahaohb/static_web:v2\n\n\t# push\n\tsudo docker push lijahaohb/static_web:v2\n\t```\n\n* <b></b>\n\t``` bash\n\t# docker searchDocker Hub\n\tsudo docker search puppet\n\t```\n\n* <b></b>\n\t``` bash\n\t# docker commit\n\n\t# \n\t# ubuntu\n\tsudo docker run -i -t ubuntu /bin/bash\n\n\t# ubuntuApache\n\t# -yqq\n\tapt-get -yqq update\n\t# apache2\n\tapt-get -y install apache2\n\n\t#  \n\t# ID\n\tsudo docker ps -a\n\t# ID\n\tsudo docker commit f3f694f1fc97 jamtur01/apache2\n\n\t# \n\tsudo docker images jamtur01/apache2\n\n\t# dcoker inspect\n\tsudo docker inspect jamtur01/apache2\n\t```\n\n* <b>dockerfile + docker build</b>\n\t- \n\n\t\t[](https://github.com/gzyunke/test-docker)\n\t- `dockerfile`\n\n\t\t`dockerfile:`\n\t\t``` dockerfile\n\t\tFROM node:11\n\t\tMAINTAINER easydoc.net\n\n\t\t# \n\t\tADD . /app\n\n\t\t# \n\t\tWORKDIR /app\n\n\t\t# \n\t\t# RUN  && \n\t\t#  RUN npm install && cd /app && mkdir logs\n\t\tRUN npm install --registry=https://registry.npm.taobao.org\n\n\t\t# CMD \n\t\t#  && shell\n\t\t#  CMD cd /app && ./start.sh\n\t\tCMD node app.js\n\t\t```\n\t- `docker build`\n\t\t``` bash\n\t\tsudo docker build -t=test:v1 .\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker images\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker history test:v1 \n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker run -d -p 8080:8080 --name test-hello test:v1\n\t\t```\n\n## \n\n* `bind mount` \n* `volume` Linux \n* `tmpfs mount` \n\t``` bash\n\t# bind mount  -v /home/lijiahao/docker/test-docker:/code:/app\n\n\t# volume  -v db-data:/app\n\n\tsudo docker run -p 8080:8080 --name test-hello -v /home/lijiahao/docker/test-docker:/app -d test:v1\n\t```\n\n## \n\n* \n\t- docker\n\t- docker networking\n\t- docker\n\n* docker networking\n\t``` bash\n\t# 1. Docker\n\tsudo docker network create test-net\n\n\t# 2. \n\tsudo docker network inspect test-net\n\n\t# 3. \n\tsudo docker network ls\n\n\t# 4. app\n\tsudo docker run -d --name redis --network test-net --network-alias redis redis:latest\n\n\t# 5. app\n\tsudo docker run -p 8080:8080 --name test -v /home/lijiahao/docker/test-docker:/app --network test-net -d test:v1\n\t```\n\n* docker\n\n## docker-compose\n\n* docker-compose\n\t``` bash\n\t# docker-compose\n\tsudo curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n\n\t# \n\tsudo chmod +x /usr/local/bin/docker-compose\n\n\t# \n\tdocker-compose --help\n\t```\n\n* docker-compose \n\t- `docker-compose.yml`\n\t\t\n\t\t`docker-compose.yml`\n\t\t``` yml\n\t\tversion: \"3.7\"\n\n\t\tservices:\n\t\t  app:\n\t\t\tbuild: ./\n\t\t\tports:\n\t\t\t  - 80:8080\n\t\t\tvolumes:\n\t\t\t  - ./:/app\n\t\t\tenvironment:\n\t\t\t  - TZ=Asia/Shanghai\n\t\t  redis:\n\t\t\timage: redis:5.0.13\n\t\t\tvolumes:\n\t\t\t  - redis:/data\n\t\t\tenvironment:\n\t\t\t  - TZ=Asia/Shanghai\n\n\t\tvolumes:\n\t\t  redis:\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose up -d\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose ps\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose stop\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose restart\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose restart service-name\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose exec service-name sh\n\t\t```\n\t- log\n\t\t``` bash\n\t\tsudo docker-compose logs [service-name]\n\t\t```\n\n","source":"_posts/go/docker_learning.md","raw":"---\ntitle: docker \ncategories: \n- GolangStudy\n---\n\n# docker\n\n## docker\n\n* docker\n\t- docker client\n\t- docker daemon\n\t\t* containers\n\t\t* images\n\t- registry\n\n* docker\n\t- : `sudo service docker status`\n\t- \n\t``` bash\n\t# \n\tsudo service docker stop\n\t# \n\tsudo service docker start\n\t# \n\tsudo service docker restart\n\t```\n\t- \n\n\n## \n\n* <b></b>\n\n\t<font color=\"red\"><b>note: </b></font>\n\n\t``` bash\n\tsudo docker run --name mysql8019 -p 13306:3306 -e MYSQL_ROOT_PASSWORD=root1234 -d mysql:8.0.19\n\n\tsudo docker run -it --network host --rm mysql mysql -h127.0.0.1 -P13306 --default-character-set=utf8mb4 -uroot -p\n\n\t# ()\n\tsudo docker run --name daemon_dave -d ubuntu /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n\t```\n\n\t:<br/>\n\tUsage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...] <br/>\n\t-i, --interactive=false  <br/>\n\t-t, --tty=false tty <br/>\n\t-d,     <br/>\n\t-e,     <br/>\n\t-P,     <br/>\n\t-p,     <br/>\n\t--rm,   <br/>\n\t-h,     <br/>\n\t--name links <br/>\n\n* <b></b>\n\t``` bash\n\tsudo docker info\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker ps -a\n\n\t# \n\tsudo docker ps\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker start ID\n\n\t# \n\tsudo docker restart ID\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker attach ID\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker stop ID\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker logs bob_the_container\n\n\t# ID\n\tsudo docker logs 16ecf568ca88\n\n\t# \n\n\t# -ftail -fDockerCtrl+C\n\tsudo docker logs -f daemon_dave\n\n\t# --tail \n\n\t# 10\n\tsudo docker logs --tail 10 daemon_dave\n\t# \n\tsudo docker logs --tail 0 -f daemon_dave\n\t \n\t# --t \n\tsudo docker logs -ft daemon_dave\n\t```\n\n* <b></b>\n\t``` bash\n\tsudo docker top ID/\n\t```\n\n* <b></b>\n\t``` bash\n\tsudo docker stats ID/\n\t```\n\n* <b></b>\n\t``` bash\n\tsudo docker inspect\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker start lijiahao\n\n\t# touch\n\tsudo docker exec bob_the_container touch /etc/new_config_file\n\n\t# \n\tsudo docker attach lijiahao \n\tls /etc/new_config_file\n\t```\n\n\t``` bash\n\t#  /bin/bash\n\tsudo docker exec -it 66ba58480ea9 /bin/bash\n\t```\n\n* <b></b>\n\n\t--restartDcoker <br/>\n\t--restart <br/>\n\tDocker <br/>\n\n\t--restartalwaysDocker\n\n\t``` bash\n\tsudo docker run --restart=always -i -t --name container_dong -d ubuntu /bin/sh\n\t```\n\n\t: on-failure0 <br/>\n\ton-failure\n\n\t``` bash\n\tsudo docker run --restart=on-failure:5 -i -t --name container_dong -d ubuntu /bin/sh\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker rm ID\n\n\t# (-q ID)\n\tsudo docker rm $(sudo docker ps -aq)\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker export ID > xxx.tar\n\t```\n\n* \n\t``` bash\n\tsudo docker load -i xxx.tar\n\t```\n\n## \n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker images\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker rmi \n\t# ()\n\tsudo docker rmi -f \n\t# \n\tsudo docker rmi $(sudo docker images -q)\n\t```\n\n* <b></b>\n\t``` bash\n\t# Dockertag\n\t```\n\n* <b></b>\n\t``` bash\n\t/var/lib/dockerDocker\n\t/var/lib/docker/image\n\t/var/lib/docker/containers\n\t```\n\n* <b></b>\n\t``` bash\n\t# ubuntuDocker Hub\n\tsudo docker run -t -i ubuntu /bin/bash\n\n\t# \n\tsudo docker pull ubuntu\n\n\t# docker rundocker pulllatest\n\t```\n\n* <b></b>\n\t``` bash\n\t# \n\tsudo docker login\n\n\t# ( )\n\tsudo docker tag  lijiahao/static_web:v2 lijahaohb/static_web:v2\n\n\t# push\n\tsudo docker push lijahaohb/static_web:v2\n\t```\n\n* <b></b>\n\t``` bash\n\t# docker searchDocker Hub\n\tsudo docker search puppet\n\t```\n\n* <b></b>\n\t``` bash\n\t# docker commit\n\n\t# \n\t# ubuntu\n\tsudo docker run -i -t ubuntu /bin/bash\n\n\t# ubuntuApache\n\t# -yqq\n\tapt-get -yqq update\n\t# apache2\n\tapt-get -y install apache2\n\n\t#  \n\t# ID\n\tsudo docker ps -a\n\t# ID\n\tsudo docker commit f3f694f1fc97 jamtur01/apache2\n\n\t# \n\tsudo docker images jamtur01/apache2\n\n\t# dcoker inspect\n\tsudo docker inspect jamtur01/apache2\n\t```\n\n* <b>dockerfile + docker build</b>\n\t- \n\n\t\t[](https://github.com/gzyunke/test-docker)\n\t- `dockerfile`\n\n\t\t`dockerfile:`\n\t\t``` dockerfile\n\t\tFROM node:11\n\t\tMAINTAINER easydoc.net\n\n\t\t# \n\t\tADD . /app\n\n\t\t# \n\t\tWORKDIR /app\n\n\t\t# \n\t\t# RUN  && \n\t\t#  RUN npm install && cd /app && mkdir logs\n\t\tRUN npm install --registry=https://registry.npm.taobao.org\n\n\t\t# CMD \n\t\t#  && shell\n\t\t#  CMD cd /app && ./start.sh\n\t\tCMD node app.js\n\t\t```\n\t- `docker build`\n\t\t``` bash\n\t\tsudo docker build -t=test:v1 .\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker images\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker history test:v1 \n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker run -d -p 8080:8080 --name test-hello test:v1\n\t\t```\n\n## \n\n* `bind mount` \n* `volume` Linux \n* `tmpfs mount` \n\t``` bash\n\t# bind mount  -v /home/lijiahao/docker/test-docker:/code:/app\n\n\t# volume  -v db-data:/app\n\n\tsudo docker run -p 8080:8080 --name test-hello -v /home/lijiahao/docker/test-docker:/app -d test:v1\n\t```\n\n## \n\n* \n\t- docker\n\t- docker networking\n\t- docker\n\n* docker networking\n\t``` bash\n\t# 1. Docker\n\tsudo docker network create test-net\n\n\t# 2. \n\tsudo docker network inspect test-net\n\n\t# 3. \n\tsudo docker network ls\n\n\t# 4. app\n\tsudo docker run -d --name redis --network test-net --network-alias redis redis:latest\n\n\t# 5. app\n\tsudo docker run -p 8080:8080 --name test -v /home/lijiahao/docker/test-docker:/app --network test-net -d test:v1\n\t```\n\n* docker\n\n## docker-compose\n\n* docker-compose\n\t``` bash\n\t# docker-compose\n\tsudo curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n\n\t# \n\tsudo chmod +x /usr/local/bin/docker-compose\n\n\t# \n\tdocker-compose --help\n\t```\n\n* docker-compose \n\t- `docker-compose.yml`\n\t\t\n\t\t`docker-compose.yml`\n\t\t``` yml\n\t\tversion: \"3.7\"\n\n\t\tservices:\n\t\t  app:\n\t\t\tbuild: ./\n\t\t\tports:\n\t\t\t  - 80:8080\n\t\t\tvolumes:\n\t\t\t  - ./:/app\n\t\t\tenvironment:\n\t\t\t  - TZ=Asia/Shanghai\n\t\t  redis:\n\t\t\timage: redis:5.0.13\n\t\t\tvolumes:\n\t\t\t  - redis:/data\n\t\t\tenvironment:\n\t\t\t  - TZ=Asia/Shanghai\n\n\t\tvolumes:\n\t\t  redis:\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose up -d\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose ps\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose stop\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose restart\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose restart service-name\n\t\t```\n\t- \n\t\t``` bash\n\t\tsudo docker-compose exec service-name sh\n\t\t```\n\t- log\n\t\t``` bash\n\t\tsudo docker-compose logs [service-name]\n\t\t```\n\n","slug":"go/docker_learning","published":1,"date":"2022-05-31T09:51:28.591Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6ck0001f8wz6oyg6a13","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h1><h2 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h2><ul>\n<li><p>docker</p>\n<ul>\n<li>docker client</li>\n<li>docker daemon<ul>\n<li>containers</li>\n<li>images</li>\n</ul>\n</li>\n<li>registry</li>\n</ul>\n</li>\n<li><p>docker</p>\n<ul>\n<li>: <code>sudo service docker status</code></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo service docker stop</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo service docker start</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo service docker restart</span><br></pre></td></tr></table></figure></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p><b></b></p>\n<p>  <font color=\"red\"><b>note: </b></font></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --name mysql8019 -p 13306:3306 -e MYSQL_ROOT_PASSWORD=root1234 -d mysql:8.0.19</span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker run -it --network host --<span class=\"built_in\">rm</span> mysql mysql -h127.0.0.1 -P13306 --default-character-set=utf8mb4 -uroot -p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sudo docker run --name daemon_dave -d ubuntu /bin/sh -c <span class=\"string\">&quot;while true; do echo hello world; sleep 1; done&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>  :<br/><br>  Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG] <br/><br>  -i, interactive=false  <br/><br>  -t, tty=false tty <br/><br>  -d,     <br/><br>  -e,     <br/><br>  -P,     <br/><br>  -p,     <br/><br>  rm,   <br/><br>  -h,     <br/><br>  name links <br/></p>\n</li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker info</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker ps -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker ps</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker start ID</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker restart ID</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker attach ID</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker stop ID</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker logs bob_the_container</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ID</span></span><br><span class=\"line\">sudo docker logs 16ecf568ca88</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -ftail -fDockerCtrl+C</span></span><br><span class=\"line\">sudo docker logs -f daemon_dave</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --tail </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10</span></span><br><span class=\"line\">sudo docker logs --<span class=\"built_in\">tail</span> 10 daemon_dave</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker logs --<span class=\"built_in\">tail</span> 0 -f daemon_dave</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># --t </span></span><br><span class=\"line\">sudo docker logs -ft daemon_dave</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker top ID/</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker stats ID/</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker inspect</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker start lijiahao</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># touch</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">exec</span> bob_the_container <span class=\"built_in\">touch</span> /etc/new_config_file</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker attach lijiahao </span><br><span class=\"line\"><span class=\"built_in\">ls</span> /etc/new_config_file</span><br></pre></td></tr></table></figure>\n\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  /bin/bash</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">exec</span> -it 66ba58480ea9 /bin/bash</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n<p>  restartDcoker <br/><br>  restart <br/><br>  Docker <br/></p>\n<p>  restartalwaysDocker</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --restart=always -i -t --name container_dong -d ubuntu /bin/sh</span><br></pre></td></tr></table></figure>\n\n<p>  : on-failure0 <br/><br>  on-failure</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --restart=on-failure:5 -i -t --name container_dong -d ubuntu /bin/sh</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">rm</span> ID</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (-q ID)</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">rm</span> $(sudo docker ps -aq)</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">export</span> ID &gt; xxx.tar</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker load -i xxx.tar</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker rmi </span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sudo docker rmi -f </span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker rmi $(sudo docker images -q)</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Dockertag</span></span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/var/lib/dockerDocker</span><br><span class=\"line\">/var/lib/docker/image</span><br><span class=\"line\">/var/lib/docker/containers</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ubuntuDocker Hub</span></span><br><span class=\"line\">sudo docker run -t -i ubuntu /bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker pull ubuntu</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker rundocker pulllatest</span></span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker login</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ( )</span></span><br><span class=\"line\">sudo docker tag  lijiahao/static_web:v2 lijahaohb/static_web:v2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># push</span></span><br><span class=\"line\">sudo docker push lijahaohb/static_web:v2</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker searchDocker Hub</span></span><br><span class=\"line\">sudo docker search puppet</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker commit</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># ubuntu</span></span><br><span class=\"line\">sudo docker run -i -t ubuntu /bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ubuntuApache</span></span><br><span class=\"line\"><span class=\"comment\"># -yqq</span></span><br><span class=\"line\">apt-get -yqq update</span><br><span class=\"line\"><span class=\"comment\"># apache2</span></span><br><span class=\"line\">apt-get -y install apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\"><span class=\"comment\"># ID</span></span><br><span class=\"line\">sudo docker ps -a</span><br><span class=\"line\"><span class=\"comment\"># ID</span></span><br><span class=\"line\">sudo docker commit f3f694f1fc97 jamtur01/apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker images jamtur01/apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># dcoker inspect</span></span><br><span class=\"line\">sudo docker inspect jamtur01/apache2</span><br></pre></td></tr></table></figure></li>\n<li><p><b>dockerfile + docker build</b></p>\n<ul>\n<li><p></p>\n<p>  <a href=\"https://github.com/gzyunke/test-docker\"></a></p>\n</li>\n<li><p><code>dockerfile</code></p>\n<p>  <code>dockerfile:</code></p>\n  <figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> node:<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">MAINTAINER</span> easydoc.net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> . /app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># RUN  &amp;&amp; </span></span><br><span class=\"line\"><span class=\"comment\">#  RUN npm install &amp;&amp; cd /app &amp;&amp; mkdir logs</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> npm install --registry=https://registry.npm.taobao.org</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CMD </span></span><br><span class=\"line\"><span class=\"comment\">#  &amp;&amp; shell</span></span><br><span class=\"line\"><span class=\"comment\">#  CMD cd /app &amp;&amp; ./start.sh</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> node app.js</span></span><br></pre></td></tr></table></figure></li>\n<li><p><code>docker build</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker build -t=<span class=\"built_in\">test</span>:v1 .</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker <span class=\"built_in\">history</span> <span class=\"built_in\">test</span>:v1 </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -d -p 8080:8080 --name test-hello <span class=\"built_in\">test</span>:v1</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><code>bind mount</code> </li>\n<li><code>volume</code> Linux </li>\n<li><code>tmpfs mount</code>   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># bind mount  -v /home/lijiahao/docker/test-docker:/code:/app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># volume  -v db-data:/app</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker run -p 8080:8080 --name test-hello -v /home/lijiahao/docker/test-docker:/app -d <span class=\"built_in\">test</span>:v1</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n<ul>\n<li>docker</li>\n<li>docker networking</li>\n<li>docker</li>\n</ul>\n</li>\n<li><p>docker networking</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. Docker</span></span><br><span class=\"line\">sudo docker network create test-net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. </span></span><br><span class=\"line\">sudo docker network inspect test-net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. </span></span><br><span class=\"line\">sudo docker network <span class=\"built_in\">ls</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. app</span></span><br><span class=\"line\">sudo docker run -d --name redis --network test-net --network-alias redis redis:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. app</span></span><br><span class=\"line\">sudo docker run -p 8080:8080 --name <span class=\"built_in\">test</span> -v /home/lijiahao/docker/test-docker:/app --network test-net -d <span class=\"built_in\">test</span>:v1</span><br></pre></td></tr></table></figure></li>\n<li><p>docker</p>\n</li>\n</ul>\n<h2 id=\"docker-compose\"><a href=\"#docker-compose\" class=\"headerlink\" title=\"docker-compose\"></a>docker-compose</h2><ul>\n<li><p>docker-compose</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker-compose</span></span><br><span class=\"line\">sudo curl -L <span class=\"string\">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class=\"subst\">$(uname -s)</span>-<span class=\"subst\">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">docker-compose --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure></li>\n<li><p>docker-compose </p>\n<ul>\n<li><code>docker-compose.yml</code>  <code>docker-compose.yml</code>  <figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.7&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">app:</span></span><br><span class=\"line\">\t<span class=\"attr\">build:</span> <span class=\"string\">./</span></span><br><span class=\"line\">\t<span class=\"attr\">ports:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"number\">80</span><span class=\"string\">:8080</span></span><br><span class=\"line\">\t<span class=\"attr\">volumes:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">./:/app</span></span><br><span class=\"line\">\t<span class=\"attr\">environment:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">\t<span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.13</span></span><br><span class=\"line\">\t<span class=\"attr\">volumes:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">redis:/data</span></span><br><span class=\"line\">\t<span class=\"attr\">environment:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose up -d</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose ps</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose stop</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose restart</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose restart service-name</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose <span class=\"built_in\">exec</span> service-name sh</span><br></pre></td></tr></table></figure></li>\n<li>log  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose logs [service-name]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h1><h2 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h2><ul>\n<li><p>docker</p>\n<ul>\n<li>docker client</li>\n<li>docker daemon<ul>\n<li>containers</li>\n<li>images</li>\n</ul>\n</li>\n<li>registry</li>\n</ul>\n</li>\n<li><p>docker</p>\n<ul>\n<li>: <code>sudo service docker status</code></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo service docker stop</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo service docker start</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo service docker restart</span><br></pre></td></tr></table></figure></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p><b></b></p>\n<p>  <font color=\"red\"><b>note: </b></font></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --name mysql8019 -p 13306:3306 -e MYSQL_ROOT_PASSWORD=root1234 -d mysql:8.0.19</span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker run -it --network host --<span class=\"built_in\">rm</span> mysql mysql -h127.0.0.1 -P13306 --default-character-set=utf8mb4 -uroot -p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sudo docker run --name daemon_dave -d ubuntu /bin/sh -c <span class=\"string\">&quot;while true; do echo hello world; sleep 1; done&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>  :<br/><br>  Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG] <br/><br>  -i, interactive=false  <br/><br>  -t, tty=false tty <br/><br>  -d,     <br/><br>  -e,     <br/><br>  -P,     <br/><br>  -p,     <br/><br>  rm,   <br/><br>  -h,     <br/><br>  name links <br/></p>\n</li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker info</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker ps -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker ps</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker start ID</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker restart ID</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker attach ID</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker stop ID</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker logs bob_the_container</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ID</span></span><br><span class=\"line\">sudo docker logs 16ecf568ca88</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -ftail -fDockerCtrl+C</span></span><br><span class=\"line\">sudo docker logs -f daemon_dave</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --tail </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10</span></span><br><span class=\"line\">sudo docker logs --<span class=\"built_in\">tail</span> 10 daemon_dave</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker logs --<span class=\"built_in\">tail</span> 0 -f daemon_dave</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># --t </span></span><br><span class=\"line\">sudo docker logs -ft daemon_dave</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker top ID/</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker stats ID/</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker inspect</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker start lijiahao</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># touch</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">exec</span> bob_the_container <span class=\"built_in\">touch</span> /etc/new_config_file</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker attach lijiahao </span><br><span class=\"line\"><span class=\"built_in\">ls</span> /etc/new_config_file</span><br></pre></td></tr></table></figure>\n\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  /bin/bash</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">exec</span> -it 66ba58480ea9 /bin/bash</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n<p>  restartDcoker <br/><br>  restart <br/><br>  Docker <br/></p>\n<p>  restartalwaysDocker</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --restart=always -i -t --name container_dong -d ubuntu /bin/sh</span><br></pre></td></tr></table></figure>\n\n<p>  : on-failure0 <br/><br>  on-failure</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run --restart=on-failure:5 -i -t --name container_dong -d ubuntu /bin/sh</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">rm</span> ID</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (-q ID)</span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">rm</span> $(sudo docker ps -aq)</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker <span class=\"built_in\">export</span> ID &gt; xxx.tar</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker load -i xxx.tar</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker rmi </span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sudo docker rmi -f </span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker rmi $(sudo docker images -q)</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Dockertag</span></span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/var/lib/dockerDocker</span><br><span class=\"line\">/var/lib/docker/image</span><br><span class=\"line\">/var/lib/docker/containers</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ubuntuDocker Hub</span></span><br><span class=\"line\">sudo docker run -t -i ubuntu /bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker pull ubuntu</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker rundocker pulllatest</span></span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker login</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ( )</span></span><br><span class=\"line\">sudo docker tag  lijiahao/static_web:v2 lijahaohb/static_web:v2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># push</span></span><br><span class=\"line\">sudo docker push lijahaohb/static_web:v2</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker searchDocker Hub</span></span><br><span class=\"line\">sudo docker search puppet</span><br></pre></td></tr></table></figure></li>\n<li><p><b></b></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker commit</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># ubuntu</span></span><br><span class=\"line\">sudo docker run -i -t ubuntu /bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ubuntuApache</span></span><br><span class=\"line\"><span class=\"comment\"># -yqq</span></span><br><span class=\"line\">apt-get -yqq update</span><br><span class=\"line\"><span class=\"comment\"># apache2</span></span><br><span class=\"line\">apt-get -y install apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\"><span class=\"comment\"># ID</span></span><br><span class=\"line\">sudo docker ps -a</span><br><span class=\"line\"><span class=\"comment\"># ID</span></span><br><span class=\"line\">sudo docker commit f3f694f1fc97 jamtur01/apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo docker images jamtur01/apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># dcoker inspect</span></span><br><span class=\"line\">sudo docker inspect jamtur01/apache2</span><br></pre></td></tr></table></figure></li>\n<li><p><b>dockerfile + docker build</b></p>\n<ul>\n<li><p></p>\n<p>  <a href=\"https://github.com/gzyunke/test-docker\"></a></p>\n</li>\n<li><p><code>dockerfile</code></p>\n<p>  <code>dockerfile:</code></p>\n  <figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> node:<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"keyword\">MAINTAINER</span> easydoc.net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"language-bash\"> . /app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># RUN  &amp;&amp; </span></span><br><span class=\"line\"><span class=\"comment\">#  RUN npm install &amp;&amp; cd /app &amp;&amp; mkdir logs</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> npm install --registry=https://registry.npm.taobao.org</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CMD </span></span><br><span class=\"line\"><span class=\"comment\">#  &amp;&amp; shell</span></span><br><span class=\"line\"><span class=\"comment\">#  CMD cd /app &amp;&amp; ./start.sh</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> node app.js</span></span><br></pre></td></tr></table></figure></li>\n<li><p><code>docker build</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker build -t=<span class=\"built_in\">test</span>:v1 .</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker images</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker <span class=\"built_in\">history</span> <span class=\"built_in\">test</span>:v1 </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run -d -p 8080:8080 --name test-hello <span class=\"built_in\">test</span>:v1</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><code>bind mount</code> </li>\n<li><code>volume</code> Linux </li>\n<li><code>tmpfs mount</code>   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># bind mount  -v /home/lijiahao/docker/test-docker:/code:/app</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># volume  -v db-data:/app</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker run -p 8080:8080 --name test-hello -v /home/lijiahao/docker/test-docker:/app -d <span class=\"built_in\">test</span>:v1</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n<ul>\n<li>docker</li>\n<li>docker networking</li>\n<li>docker</li>\n</ul>\n</li>\n<li><p>docker networking</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. Docker</span></span><br><span class=\"line\">sudo docker network create test-net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. </span></span><br><span class=\"line\">sudo docker network inspect test-net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. </span></span><br><span class=\"line\">sudo docker network <span class=\"built_in\">ls</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. app</span></span><br><span class=\"line\">sudo docker run -d --name redis --network test-net --network-alias redis redis:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. app</span></span><br><span class=\"line\">sudo docker run -p 8080:8080 --name <span class=\"built_in\">test</span> -v /home/lijiahao/docker/test-docker:/app --network test-net -d <span class=\"built_in\">test</span>:v1</span><br></pre></td></tr></table></figure></li>\n<li><p>docker</p>\n</li>\n</ul>\n<h2 id=\"docker-compose\"><a href=\"#docker-compose\" class=\"headerlink\" title=\"docker-compose\"></a>docker-compose</h2><ul>\n<li><p>docker-compose</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker-compose</span></span><br><span class=\"line\">sudo curl -L <span class=\"string\">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class=\"subst\">$(uname -s)</span>-<span class=\"subst\">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">docker-compose --<span class=\"built_in\">help</span></span><br></pre></td></tr></table></figure></li>\n<li><p>docker-compose </p>\n<ul>\n<li><code>docker-compose.yml</code>  <code>docker-compose.yml</code>  <figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.7&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">app:</span></span><br><span class=\"line\">\t<span class=\"attr\">build:</span> <span class=\"string\">./</span></span><br><span class=\"line\">\t<span class=\"attr\">ports:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"number\">80</span><span class=\"string\">:8080</span></span><br><span class=\"line\">\t<span class=\"attr\">volumes:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">./:/app</span></span><br><span class=\"line\">\t<span class=\"attr\">environment:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">\t<span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.13</span></span><br><span class=\"line\">\t<span class=\"attr\">volumes:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">redis:/data</span></span><br><span class=\"line\">\t<span class=\"attr\">environment:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose up -d</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose ps</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose stop</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose restart</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose restart service-name</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose <span class=\"built_in\">exec</span> service-name sh</span><br></pre></td></tr></table></figure></li>\n<li>log  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker-compose logs [service-name]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n"},{"title":"im-gochat","_content":"# go-chat\n\n* `connect` <br/>\n\t`Server`\n\t``` go\n\ttype Server struct {\n\t\tBuckets   []*Bucket\n\t\tOptions   ServerOptions\n\t\tbucketIdx uint32\n\t\toperator  Operator\n\t}\n\t```\n\n\t`Bucket`\n\t``` go\n\ttype Bucket struct {\n\t\tcLock         sync.RWMutex     // protect the channels for chs\n\t\tchs           map[int]*Channel // map sub key to a channel\n\t\tbucketOptions BucketOptions\n\t\trooms         map[int]*Room // bucket room channels\n\t\troutines      []chan *proto.PushRoomMsgRequest\n\t\troutinesNum   uint64\n\t\tbroadcast     chan []byte\n\t}\n\t```\n\n\t`Room`\n\t``` go\n\ttype Room struct {\n\t\tId          int\n\t\tOnlineCount int // room online user count\n\t\trLock       sync.RWMutex\n\t\tdrop        bool // make room is live\n\t\tnext        *Channel\n\t}\n\t```\n\n\t`Channel`\n\t``` go\n\ttype Channel struct {\n\t\tRoom      *Room\n\t\tNext      *Channel\n\t\tPrev      *Channel\n\t\tbroadcast chan *proto.Msg\n\t\tuserId    int\n\t\tconn      *websocket.Conn\n\t\tconnTcp   *net.TCPConn\n\t}\n\t```\n\n* \n\t\n\n","source":"_posts/go/go_chat.md","raw":"---\ntitle: im-gochat \ncategories: \n- GolangStudy\n---\n# go-chat\n\n* `connect` <br/>\n\t`Server`\n\t``` go\n\ttype Server struct {\n\t\tBuckets   []*Bucket\n\t\tOptions   ServerOptions\n\t\tbucketIdx uint32\n\t\toperator  Operator\n\t}\n\t```\n\n\t`Bucket`\n\t``` go\n\ttype Bucket struct {\n\t\tcLock         sync.RWMutex     // protect the channels for chs\n\t\tchs           map[int]*Channel // map sub key to a channel\n\t\tbucketOptions BucketOptions\n\t\trooms         map[int]*Room // bucket room channels\n\t\troutines      []chan *proto.PushRoomMsgRequest\n\t\troutinesNum   uint64\n\t\tbroadcast     chan []byte\n\t}\n\t```\n\n\t`Room`\n\t``` go\n\ttype Room struct {\n\t\tId          int\n\t\tOnlineCount int // room online user count\n\t\trLock       sync.RWMutex\n\t\tdrop        bool // make room is live\n\t\tnext        *Channel\n\t}\n\t```\n\n\t`Channel`\n\t``` go\n\ttype Channel struct {\n\t\tRoom      *Room\n\t\tNext      *Channel\n\t\tPrev      *Channel\n\t\tbroadcast chan *proto.Msg\n\t\tuserId    int\n\t\tconn      *websocket.Conn\n\t\tconnTcp   *net.TCPConn\n\t}\n\t```\n\n* \n\t\n\n","slug":"go/go_chat","published":1,"date":"2022-05-31T10:26:44.586Z","updated":"2022-05-31T10:26:44.590Z","_id":"cl3tkt6cn0002f8wzfxc7537q","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"go-chat\"><a href=\"#go-chat\" class=\"headerlink\" title=\"go-chat\"></a>go-chat</h1><ul>\n<li><p><code>connect</code> <br/><br>  <code>Server</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Server <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tBuckets   []*Bucket</span><br><span class=\"line\">\tOptions   ServerOptions</span><br><span class=\"line\">\tbucketIdx <span class=\"type\">uint32</span></span><br><span class=\"line\">\toperator  Operator</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>Bucket</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Bucket <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tcLock         sync.RWMutex     <span class=\"comment\">// protect the channels for chs</span></span><br><span class=\"line\">\tchs           <span class=\"keyword\">map</span>[<span class=\"type\">int</span>]*Channel <span class=\"comment\">// map sub key to a channel</span></span><br><span class=\"line\">\tbucketOptions BucketOptions</span><br><span class=\"line\">\trooms         <span class=\"keyword\">map</span>[<span class=\"type\">int</span>]*Room <span class=\"comment\">// bucket room channels</span></span><br><span class=\"line\">\troutines      []<span class=\"keyword\">chan</span> *proto.PushRoomMsgRequest</span><br><span class=\"line\">\troutinesNum   <span class=\"type\">uint64</span></span><br><span class=\"line\">\tbroadcast     <span class=\"keyword\">chan</span> []<span class=\"type\">byte</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>Room</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Room <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tId          <span class=\"type\">int</span></span><br><span class=\"line\">\tOnlineCount <span class=\"type\">int</span> <span class=\"comment\">// room online user count</span></span><br><span class=\"line\">\trLock       sync.RWMutex</span><br><span class=\"line\">\tdrop        <span class=\"type\">bool</span> <span class=\"comment\">// make room is live</span></span><br><span class=\"line\">\tnext        *Channel</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>Channel</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Channel <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tRoom      *Room</span><br><span class=\"line\">\tNext      *Channel</span><br><span class=\"line\">\tPrev      *Channel</span><br><span class=\"line\">\tbroadcast <span class=\"keyword\">chan</span> *proto.Msg</span><br><span class=\"line\">\tuserId    <span class=\"type\">int</span></span><br><span class=\"line\">\tconn      *websocket.Conn</span><br><span class=\"line\">\tconnTcp   *net.TCPConn</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"go-chat\"><a href=\"#go-chat\" class=\"headerlink\" title=\"go-chat\"></a>go-chat</h1><ul>\n<li><p><code>connect</code> <br/><br>  <code>Server</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Server <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tBuckets   []*Bucket</span><br><span class=\"line\">\tOptions   ServerOptions</span><br><span class=\"line\">\tbucketIdx <span class=\"type\">uint32</span></span><br><span class=\"line\">\toperator  Operator</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>Bucket</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Bucket <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tcLock         sync.RWMutex     <span class=\"comment\">// protect the channels for chs</span></span><br><span class=\"line\">\tchs           <span class=\"keyword\">map</span>[<span class=\"type\">int</span>]*Channel <span class=\"comment\">// map sub key to a channel</span></span><br><span class=\"line\">\tbucketOptions BucketOptions</span><br><span class=\"line\">\trooms         <span class=\"keyword\">map</span>[<span class=\"type\">int</span>]*Room <span class=\"comment\">// bucket room channels</span></span><br><span class=\"line\">\troutines      []<span class=\"keyword\">chan</span> *proto.PushRoomMsgRequest</span><br><span class=\"line\">\troutinesNum   <span class=\"type\">uint64</span></span><br><span class=\"line\">\tbroadcast     <span class=\"keyword\">chan</span> []<span class=\"type\">byte</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>Room</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Room <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tId          <span class=\"type\">int</span></span><br><span class=\"line\">\tOnlineCount <span class=\"type\">int</span> <span class=\"comment\">// room online user count</span></span><br><span class=\"line\">\trLock       sync.RWMutex</span><br><span class=\"line\">\tdrop        <span class=\"type\">bool</span> <span class=\"comment\">// make room is live</span></span><br><span class=\"line\">\tnext        *Channel</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>Channel</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Channel <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tRoom      *Room</span><br><span class=\"line\">\tNext      *Channel</span><br><span class=\"line\">\tPrev      *Channel</span><br><span class=\"line\">\tbroadcast <span class=\"keyword\">chan</span> *proto.Msg</span><br><span class=\"line\">\tuserId    <span class=\"type\">int</span></span><br><span class=\"line\">\tconn      *websocket.Conn</span><br><span class=\"line\">\tconnTcp   *net.TCPConn</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n</li>\n</ul>\n"},{"title":"go","_content":"\n# go\n\n## delve\n\n* `delve`\n\t``` bash\n\tgo install github.com/go-delve/delve/cmd/dlv@latest\n\n\t# go1.16\n\tgit clone https://github.com/go-delve/delve\n\tcd delve\n\tgo install github.com/go-delve/delve/cmd/dlv]\n\t```\n\n* \n\t``` bash\n\t# 1\n\tdlv debug xxx.go\n\n\t# 2id,attach\n\tgo build -gcflags \"-N -l\" main.go\n\t./main\n\tps -ef | grep ./main\n\tdlv attach id\n\t```\n\n* \n\t``` bash\n\t# Could not attach to pid 129591: this could be caused by a kernel security setting, try writing \"0\" to /proc/sys/kernel/yama/ptrace_scope\n\n\tsudo sysctl kernel.yama.ptrace_scope=0\n\t```\n\n* `dlv`\n\t- \n\t\t``` bash\n\t\tbreak(b)\t\t\t\n\t\tbreakpoints(bp)\t\t\n\t\tclear\t\t\t\n\t\tclearall\t\t\t\n\t\ttoggle\t\t\t\n\t\t```\n\n\t- \n\t\t``` bash\n\t\tcontinue(c)\t\t\t\t\n\t\tnext(n)\t\t\t\t\t\n\t\tstep(s)\t\t\t\t\t\n\t\tstep-instruction(si)\t\n\t\tstepout(so)\t\t\t\t\t\n\t\trestart(r)\t\t\t\t\n\t\t```\n\t- \n\t\t``` bash\n\t\tlocals\t\t\n\t\tvars \t\t\n\t\targs\t\t\t\n\t\tdisplay\t\tdisplay\t\n\t\tprint(p)\t\n\t\tset\t\t\t\t\n\t\tvars\t\t\n\t\twhatis\t\t\t\n\t\t```\n\n* debug1\n\t`config.yaml`\n\t``` yaml \n\tTimeStamp: \"2018-07-16 10:23:19\"\n\tAuthor: \"WZP\"\n\tPassWd: \"Hello\"\n\tInformation:\n\t  Name: \"Harry\"\n\t  Age: \"37\"\n\t  Alise:\n\t\t- \"Lion\"\n\t\t- \"NK\"\n\t\t- \"KaQS\"\n\t  Image: \"/path/header.rpg\"\n\t  Public: false\n\n\tFavorite:\n\t  Sport:\n\t\t- \"swimming\"\n\t\t- \"football\"\n\t  Music:\n\t\t- \"zui xuan min zu feng\"\n\t  LuckyNumber: 99\n\t```\n\n\t`main.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\t\"fmt\"\n\t\t\t\"log\"\n\n\t\t\t\"github.com/spf13/viper\"\n\t)\n\n\ttype config struct {\n\t\t\tv *viper.Viper\n\t}\n\n\tfunc LoadConfigFromYaml(c *config) error {\n\t\t\tc.v = viper.New()\n\t\t\tc.v.SetConfigFile(\"./config.yaml\")\n\n\t\t\tif err := c.v.ReadInConfig(); err != nil {\n\t\t\t\t\treturn err\n\t\t\t}\n\t\t\tage := c.v.Get(\"Information.Age\")\n\t\t\tname := c.v.Get(\"Information.Name\")\n\t\t\tlog.Printf(\"age:%s, name:%s\\n\", age, name)\n\n\t\t\tm := c.v.Sub(\"information\")\n\t\t\tlog.Printf(\"keys:%s, image:%s\", m.AllKeys(), m.Get(\"image\"))\n\t\t\treturn nil\n\t}\n\n\tfunc main() {\n\t\t\tcfg := config{v: viper.New()}\n\t\t\tif err := LoadConfigFromYaml(&cfg); err != nil {\n\t\t\t\t\tfmt.Println(\"Failed read config\")\n\t\t\t}\n\t}\n\t```\n\n","source":"_posts/go/go_debug.md","raw":"---\ntitle: go \ncategories: \n- GolangStudy\n---\n\n# go\n\n## delve\n\n* `delve`\n\t``` bash\n\tgo install github.com/go-delve/delve/cmd/dlv@latest\n\n\t# go1.16\n\tgit clone https://github.com/go-delve/delve\n\tcd delve\n\tgo install github.com/go-delve/delve/cmd/dlv]\n\t```\n\n* \n\t``` bash\n\t# 1\n\tdlv debug xxx.go\n\n\t# 2id,attach\n\tgo build -gcflags \"-N -l\" main.go\n\t./main\n\tps -ef | grep ./main\n\tdlv attach id\n\t```\n\n* \n\t``` bash\n\t# Could not attach to pid 129591: this could be caused by a kernel security setting, try writing \"0\" to /proc/sys/kernel/yama/ptrace_scope\n\n\tsudo sysctl kernel.yama.ptrace_scope=0\n\t```\n\n* `dlv`\n\t- \n\t\t``` bash\n\t\tbreak(b)\t\t\t\n\t\tbreakpoints(bp)\t\t\n\t\tclear\t\t\t\n\t\tclearall\t\t\t\n\t\ttoggle\t\t\t\n\t\t```\n\n\t- \n\t\t``` bash\n\t\tcontinue(c)\t\t\t\t\n\t\tnext(n)\t\t\t\t\t\n\t\tstep(s)\t\t\t\t\t\n\t\tstep-instruction(si)\t\n\t\tstepout(so)\t\t\t\t\t\n\t\trestart(r)\t\t\t\t\n\t\t```\n\t- \n\t\t``` bash\n\t\tlocals\t\t\n\t\tvars \t\t\n\t\targs\t\t\t\n\t\tdisplay\t\tdisplay\t\n\t\tprint(p)\t\n\t\tset\t\t\t\t\n\t\tvars\t\t\n\t\twhatis\t\t\t\n\t\t```\n\n* debug1\n\t`config.yaml`\n\t``` yaml \n\tTimeStamp: \"2018-07-16 10:23:19\"\n\tAuthor: \"WZP\"\n\tPassWd: \"Hello\"\n\tInformation:\n\t  Name: \"Harry\"\n\t  Age: \"37\"\n\t  Alise:\n\t\t- \"Lion\"\n\t\t- \"NK\"\n\t\t- \"KaQS\"\n\t  Image: \"/path/header.rpg\"\n\t  Public: false\n\n\tFavorite:\n\t  Sport:\n\t\t- \"swimming\"\n\t\t- \"football\"\n\t  Music:\n\t\t- \"zui xuan min zu feng\"\n\t  LuckyNumber: 99\n\t```\n\n\t`main.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\t\"fmt\"\n\t\t\t\"log\"\n\n\t\t\t\"github.com/spf13/viper\"\n\t)\n\n\ttype config struct {\n\t\t\tv *viper.Viper\n\t}\n\n\tfunc LoadConfigFromYaml(c *config) error {\n\t\t\tc.v = viper.New()\n\t\t\tc.v.SetConfigFile(\"./config.yaml\")\n\n\t\t\tif err := c.v.ReadInConfig(); err != nil {\n\t\t\t\t\treturn err\n\t\t\t}\n\t\t\tage := c.v.Get(\"Information.Age\")\n\t\t\tname := c.v.Get(\"Information.Name\")\n\t\t\tlog.Printf(\"age:%s, name:%s\\n\", age, name)\n\n\t\t\tm := c.v.Sub(\"information\")\n\t\t\tlog.Printf(\"keys:%s, image:%s\", m.AllKeys(), m.Get(\"image\"))\n\t\t\treturn nil\n\t}\n\n\tfunc main() {\n\t\t\tcfg := config{v: viper.New()}\n\t\t\tif err := LoadConfigFromYaml(&cfg); err != nil {\n\t\t\t\t\tfmt.Println(\"Failed read config\")\n\t\t\t}\n\t}\n\t```\n\n","slug":"go/go_debug","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6cp0003f8wzf0p7ehx9","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h1><h2 id=\"delve\"><a href=\"#delve\" class=\"headerlink\" title=\"delve\"></a>delve</h2><ul>\n<li><p><code>delve</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go install github.com/go-delve/delve/cmd/dlv@latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># go1.16</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/go-delve/delve</span><br><span class=\"line\"><span class=\"built_in\">cd</span> delve</span><br><span class=\"line\">go install github.com/go-delve/delve/cmd/dlv]</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1</span></span><br><span class=\"line\">dlv debug xxx.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2id,attach</span></span><br><span class=\"line\">go build -gcflags <span class=\"string\">&quot;-N -l&quot;</span> main.go</span><br><span class=\"line\">./main</span><br><span class=\"line\">ps -ef | grep ./main</span><br><span class=\"line\">dlv attach <span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Could not attach to pid 129591: this could be caused by a kernel security setting, try writing &quot;0&quot; to /proc/sys/kernel/yama/ptrace_scope</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo sysctl kernel.yama.ptrace_scope=0</span><br></pre></td></tr></table></figure></li>\n<li><p><code>dlv</code></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">break</span>(b)\t\t\t</span><br><span class=\"line\">breakpoints(bp)\t\t</span><br><span class=\"line\">clear\t\t\t</span><br><span class=\"line\">clearall\t\t\t</span><br><span class=\"line\">toggle\t\t\t</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">continue</span>(c)\t\t\t\t</span><br><span class=\"line\">next(n)\t\t\t\t\t</span><br><span class=\"line\">step(s)\t\t\t\t\t</span><br><span class=\"line\">step-instruction(si)\t</span><br><span class=\"line\">stepout(so)\t\t\t\t\t</span><br><span class=\"line\">restart(r)\t\t\t\t</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">locals\t\t</span><br><span class=\"line\">vars \t\t</span><br><span class=\"line\">args\t\t\t</span><br><span class=\"line\">display\t\tdisplay\t</span><br><span class=\"line\"><span class=\"built_in\">print</span>(p)\t</span><br><span class=\"line\"><span class=\"built_in\">set</span>\t\t\t\t</span><br><span class=\"line\">vars\t\t</span><br><span class=\"line\">whatis\t\t\t</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>debug1<br>  <code>config.yaml</code></p>\n  <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">TimeStamp:</span> <span class=\"string\">&quot;2018-07-16 10:23:19&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Author:</span> <span class=\"string\">&quot;WZP&quot;</span></span><br><span class=\"line\"><span class=\"attr\">PassWd:</span> <span class=\"string\">&quot;Hello&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Information:</span></span><br><span class=\"line\">  <span class=\"attr\">Name:</span> <span class=\"string\">&quot;Harry&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Age:</span> <span class=\"string\">&quot;37&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Alise:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;Lion&quot;</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;NK&quot;</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;KaQS&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Image:</span> <span class=\"string\">&quot;/path/header.rpg&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Public:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Favorite:</span></span><br><span class=\"line\">  <span class=\"attr\">Sport:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;swimming&quot;</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;football&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Music:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;zui xuan min zu feng&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">LuckyNumber:</span> <span class=\"number\">99</span></span><br></pre></td></tr></table></figure>\n\n<p>  <code>main.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"string\">&quot;github.com/spf13/viper&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tv *viper.Viper</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">LoadConfigFromYaml</span><span class=\"params\">(c *config)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\tc.v = viper.New()</span><br><span class=\"line\">\t\tc.v.SetConfigFile(<span class=\"string\">&quot;./config.yaml&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err := c.v.ReadInConfig(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tage := c.v.Get(<span class=\"string\">&quot;Information.Age&quot;</span>)</span><br><span class=\"line\">\t\tname := c.v.Get(<span class=\"string\">&quot;Information.Name&quot;</span>)</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;age:%s, name:%s\\n&quot;</span>, age, name)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tm := c.v.Sub(<span class=\"string\">&quot;information&quot;</span>)</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;keys:%s, image:%s&quot;</span>, m.AllKeys(), m.Get(<span class=\"string\">&quot;image&quot;</span>))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\tcfg := config&#123;v: viper.New()&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err := LoadConfigFromYaml(&amp;cfg); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\tfmt.Println(<span class=\"string\">&quot;Failed read config&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h1><h2 id=\"delve\"><a href=\"#delve\" class=\"headerlink\" title=\"delve\"></a>delve</h2><ul>\n<li><p><code>delve</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go install github.com/go-delve/delve/cmd/dlv@latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># go1.16</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/go-delve/delve</span><br><span class=\"line\"><span class=\"built_in\">cd</span> delve</span><br><span class=\"line\">go install github.com/go-delve/delve/cmd/dlv]</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1</span></span><br><span class=\"line\">dlv debug xxx.go</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2id,attach</span></span><br><span class=\"line\">go build -gcflags <span class=\"string\">&quot;-N -l&quot;</span> main.go</span><br><span class=\"line\">./main</span><br><span class=\"line\">ps -ef | grep ./main</span><br><span class=\"line\">dlv attach <span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Could not attach to pid 129591: this could be caused by a kernel security setting, try writing &quot;0&quot; to /proc/sys/kernel/yama/ptrace_scope</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo sysctl kernel.yama.ptrace_scope=0</span><br></pre></td></tr></table></figure></li>\n<li><p><code>dlv</code></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">break</span>(b)\t\t\t</span><br><span class=\"line\">breakpoints(bp)\t\t</span><br><span class=\"line\">clear\t\t\t</span><br><span class=\"line\">clearall\t\t\t</span><br><span class=\"line\">toggle\t\t\t</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">continue</span>(c)\t\t\t\t</span><br><span class=\"line\">next(n)\t\t\t\t\t</span><br><span class=\"line\">step(s)\t\t\t\t\t</span><br><span class=\"line\">step-instruction(si)\t</span><br><span class=\"line\">stepout(so)\t\t\t\t\t</span><br><span class=\"line\">restart(r)\t\t\t\t</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">locals\t\t</span><br><span class=\"line\">vars \t\t</span><br><span class=\"line\">args\t\t\t</span><br><span class=\"line\">display\t\tdisplay\t</span><br><span class=\"line\"><span class=\"built_in\">print</span>(p)\t</span><br><span class=\"line\"><span class=\"built_in\">set</span>\t\t\t\t</span><br><span class=\"line\">vars\t\t</span><br><span class=\"line\">whatis\t\t\t</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>debug1<br>  <code>config.yaml</code></p>\n  <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">TimeStamp:</span> <span class=\"string\">&quot;2018-07-16 10:23:19&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Author:</span> <span class=\"string\">&quot;WZP&quot;</span></span><br><span class=\"line\"><span class=\"attr\">PassWd:</span> <span class=\"string\">&quot;Hello&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Information:</span></span><br><span class=\"line\">  <span class=\"attr\">Name:</span> <span class=\"string\">&quot;Harry&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Age:</span> <span class=\"string\">&quot;37&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Alise:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;Lion&quot;</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;NK&quot;</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;KaQS&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Image:</span> <span class=\"string\">&quot;/path/header.rpg&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Public:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Favorite:</span></span><br><span class=\"line\">  <span class=\"attr\">Sport:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;swimming&quot;</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;football&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">Music:</span></span><br><span class=\"line\">\t<span class=\"bullet\">-</span> <span class=\"string\">&quot;zui xuan min zu feng&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">LuckyNumber:</span> <span class=\"number\">99</span></span><br></pre></td></tr></table></figure>\n\n<p>  <code>main.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"string\">&quot;github.com/spf13/viper&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\tv *viper.Viper</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">LoadConfigFromYaml</span><span class=\"params\">(c *config)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t\tc.v = viper.New()</span><br><span class=\"line\">\t\tc.v.SetConfigFile(<span class=\"string\">&quot;./config.yaml&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err := c.v.ReadInConfig(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tage := c.v.Get(<span class=\"string\">&quot;Information.Age&quot;</span>)</span><br><span class=\"line\">\t\tname := c.v.Get(<span class=\"string\">&quot;Information.Name&quot;</span>)</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;age:%s, name:%s\\n&quot;</span>, age, name)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tm := c.v.Sub(<span class=\"string\">&quot;information&quot;</span>)</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;keys:%s, image:%s&quot;</span>, m.AllKeys(), m.Get(<span class=\"string\">&quot;image&quot;</span>))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\tcfg := config&#123;v: viper.New()&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err := LoadConfigFromYaml(&amp;cfg); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\tfmt.Println(<span class=\"string\">&quot;Failed read config&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"Golang","_content":"# go Web\n\n## go`net/http`\n\n`:`\n``` go \npackage main\n\nimport (\n\t\"fmt\"\n\t\"net/http\"\n\t\"io/ioutil\"\n)\n\nfunc sayhello(res http.ResponseWriter, req *http.Request) {\n\tb, err := ioutil.ReadFile(\"./hello.txt\")\n\tif err != nil {\n\t\tfmt.Printf(\"ReadFile failed, err: %v\", err)\n\t\treturn\n\t}\n\tfmt.Fprintln(res, string(b))\n}\n\nfunc main() {\n\thttp.HandleFunc(\"/hello\", sayhello)\n\terr := http.ListenAndServe(\":9090\", nil)\n\tif err != nil {\n\t\tfmt.Printf(\"http server failed, err: %v\", err)\n\t\treturn\n\t}\n}\n```\n\n## gin\n\n* gin\n\n``` bash\n# gin\ngo get -u \"github.com/gin-gonic/gin\"\"\n```\n\n``\n``` go\npackage main\n\nimport \"github.com/gin-gonic/gin\"\n\nfunc sayhello(c *gin.Context) {\n\tc.JSON(200, gin.H{\n\t\t\"message\": \"hello golang\",\n\t})\n}\n\nfunc main() {\n\t// \n\tr := gin.Default()\n\n\t//GET/hellosayhello\n\tr.GET(\"/hello\", sayhello)\n\t//\n\tr.Run()\n}\n```\n\n* <b>gin json<b/>\n\n``` go\nfunc main() {\n\tr := gin.Default()\n\n\t// gin.H map[string]interface{}\n\tr.GET(\"/someJSON\", func(c *gin.Context) {\n\t\t// JSON\n\t\tc.JSON(http.StatusOK, gin.H{\"message\": \"Hello world!\"})\n\t})\n\tr.GET(\"/moreJSON\", func(c *gin.Context) {\n\t\t// \n\t\ttype msg struct {\n\t\t\t// tag\n\t\t\tName    string `json:\"user\"`\n\t\t\tMessage string\n\t\t\tAge     int\n\t\t}\n\n\t\tme := msg {\n\t\t\t\"lijihao\",\n\t\t\t\"male\",\n\t\t\t18,\n\t\t}\n\t\tc.JSON(http.StatusOK, me)\n\t})\n\tr.Run(\":8080\")\n}\n```\n\n* <b>gin querystring<b/>\n\n`querystring`URL?`/web?username=&address=` \n\n``` go\npackage main\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\tr.GET(\"/web\", func(c *gin.Context) {\n\t\t//getquerystring\n\t\tname := c.Query(\"query\") //Querygetquerystring\n\t\tage := c.Query(\"age\")\n\t\t//name := c.DefaultQuery(\"query\", \"somebody\") //\n\t\t//name, ok := c.GetQuery(\"query\") //\n\t\t//if !ok {\n\t\t//\tname = \"somebody\"\n\t\t//}\n\t\tc.JSON(http.StatusOK, gin.H {\n\t\t\t\"name\": name,\n\t\t\tS\n\t\t})\n\t})\n\tr.Run(\":9090\")\n}\n```\n\n* <b>gin form<b/>\n\n``` go\npackage main\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\n\tr.LoadHTMLFiles(\"./login.tmpl\", \"./index.tmpl\")\n\n\tr.GET(\"/login\", func(c *gin.Context) {\n\t\tc.HTML(http.StatusOK, \"login.tmpl\", nil)\n\t})\n\n\t// login post\n\tr.POST(\"/login\", func(c *gin.Context) {\n\t\t//form\n\t\tusername := c.PostForm(\"username\")\n\t\tpassword := c.PostForm(\"password\")\n\t\t//username := c.DefaultPostForm(\"username\", \"***\")\n\t\t//password := c.DefaultPostForm(\"password\", \"***\")\n\t\t//username, _ := c.GetPostForm(\"username\")\n\t\t//password, _ := c.GetPostForm(\"password\")\n\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"Username\": username,\n\t\t\t\"Password\": password,\n\t\t})\n\t})\n\tr.Run(\":9090\")\n}\n```\n\n`login.tmpl`:\n\n``` html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>login</title>\n</head>\n<body>\n{{/*form*/}}\n<form action=\"/login\" method=\"post\" novalidate autocomplete=\"off\">\n    <div>\n        <label for=\"username\">username:</label>\n        <input type=\"text\" name=\"username\" id=\"username\">\n    </div>\n\n    <div>\n        <label for=\"password\">password:</label>\n        <input type=\"password\" name=\"password\" id=\"password\">\n    </div>\n\n    <div>\n        <input type=\"submit\" value=\"\">\n    </div>\n\n</form>\n</body>\n</html>\n```\n\n`index.tmpl`:\n\n``` html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>index</title>\n</head>\n<body>\n<h1>Hello Golang {{ .Username }}!</h1>\n<p>{{ .Password }}</p>\n</body>\n</html>\n```\n* <b>gin path</b>\n\nURL`/user/search//` \n``` go\npackage main\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\t//, note:\n\tr.GET(\"/user/:name/:age\", func(c *gin.Context) {\n\t\tname := c.Param(\"name\")\n\t\tage := c.Param(\"age\")\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"Name\": name,\n\t\t\t\"Age\": age,\n\t\t})\n\t})\n\n\tr.GET(\"/blogs/:year/:month\", func(c *gin.Context) {\n\t\tyear := c.Param(\"year\")\n\t\tmonth := c.Param(\"month\")\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"year\": year,\n\t\t\t\"month\": month,\n\t\t})\n\t})\n\tr.Run(\":9090\")\n}\n```\n\n* <b>gin <b/>\n\n\n`ShouldBind()`JSONformQueryString\n\n``` go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\ntype UserInfo struct {\n\t//note: `form:\"xx\" json:\"xxx\"`jsonkey\n\tUsername string `form:\"username\" json:\"username\"`\n\tPassword string `form:\"password\" json:\"password\"`\n}\n\nfunc main() {\n\tr := gin.Default()\n\tr.LoadHTMLFiles(\"./login.tmpl\")\n\tr.GET(\"user\", func(c *gin.Context) {\n\t\t//var u1 UserInfo\n\t\t//u1.Username = c.Query(\"username\")\n\t\t//u1.Password = c.Query(\"password\")\n\t\t//\n\t\tvar u UserInfo\n\t\t//querystring\n\t\terr := c.ShouldBind(&u)\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\tfmt.Printf(\"%#v\", u)\n\t\t\tc.JSON(http.StatusOK, gin.H {\n\t\t\t\t\"status\": \"ok\",\n\t\t\t\t\"name\": u.Username,\n\t\t\t\t\"password\": u.Password,\n\t\t\t})\n\t\t}\n\t})\n\n\tr.GET(\"/login\", func(c *gin.Context) {\n\t\tc.HTML(http.StatusOK, \"login.tmpl\", nil)\n\t})\n\n\tr.POST(\"/form\", func(c *gin.Context) {\n\t\tvar u UserInfo\n\t\t//form\n\t\terr := c.ShouldBind(&u)\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\t\"status\": \"ok\",\n\t\t\t\t\"name\": u.Username,\n\t\t\t\t\"password\": u.Password,\n\t\t\t})\n\t\t}\n\t})\n\n\tr.POST(\"/json\", func(c *gin.Context) {\n\t\tvar u UserInfo\n\t\t//Json\n\t\terr := c.ShouldBind(&u)\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\t\"status\": \"ok\",\n\t\t\t\t\"name\": u.Username,\n\t\t\t\t\"password\": u.Password,\n\t\t\t})\n\t\t}\n\t})\n\n\tr.Run(\":9090\")\n}\n```\n\n`login.tmpl`:\n\n``` html\n<!DOCTYPE html>\n<html lang=\"ch-CN\">\n<head>\n    <title>login</title>\n</head>\n<body>\n{{/*from action --> method--> */}}\n<form action=\"/form\" method=\"post\">\n    <input type=\"text\" name=\"username\">\n    <input type=\"password\" name=\"password\">\n    <input type=\"submit\" value=\"\">\n</form>\n</body>\n</html>\n```\n\n* <b>gin </b>\n\n``` go \npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\tr.LoadHTMLFiles(\"./index.tmpl\")\n\tr.GET(\"/index\", func(c *gin.Context) {\n\t\tc.HTML(http.StatusOK, \"index.tmpl\", nil)\n\t})\n\tr.POST(\"/upload\", func(c *gin.Context) {\n\t\t// \n\t\tf, err := c.FormFile(\"f1\")\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H {\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\t//()\n\t\t\tdst := fmt.Sprintf(\"./%s\", f.Filename)\n\t\t\tc.SaveUploadedFile(f, dst)\n\t\t\tc.JSON(http.StatusOK, gin.H {\n\t\t\t\t\"status\": \"Ok\",\n\t\t\t})\n\t\t}\n\t})\n\tr.Run(\":9090\")\n}\n```\n`index.tmpl`:\n``` html\n<!DOCTYPE html>\n<html lang=\"ch-CN\">\n<head>\n    <title>index</title>\n</head>\n<body>\n<form action=\"/upload\"  method=\"post\" enctype=\"multipart/form-data\">\n    <input type=\"file\" name=\"f1\">\n    <input type=\"submit\" value=\"\">\n</form>\n</body>\n</html>\n```\n\n* <b>gin </b>\n\n``` go\nfunc main() {\n\trouter := gin.Default()\n\t// multipart forms32 MiB\n\t// \n\t// router.MaxMultipartMemory = 8 << 20  // 8 MiB\n\trouter.POST(\"/upload\", func(c *gin.Context) {\n\t\t// Multipart form\n\t\tform, _ := c.MultipartForm()\n\t\tfiles := form.File[\"file\"]\n\n\t\tfor index, file := range files {\n\t\t\tlog.Println(file.Filename)\n\t\t\tdst := fmt.Sprintf(\"C:/tmp/%s_%d\", file.Filename, index)\n\t\t\t// \n\t\t\tc.SaveUploadedFile(file, dst)\n\t\t}\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"message\": fmt.Sprintf(\"%d files uploaded!\", len(files)),\n\t\t})\n\t})\n\trouter.Run()\n}\n```\n\n* <b>gin </b>\n\n:\n``` go\nr.GET(\"/index\", func(c *gin.Context) {\n\tc.Redirect(http.StatusMovedPermanently, \"http://www.sogo.com\")\n})\n```\n\n``` go\nr.GET(\"/a\", func(c *gin.Context) {\n\t//b\n\tc.Request.URL.Path = \"/b\" //URL\n\tr.HandleContext(c) //\n})\nr.GET(\"/b\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"message\": \"b\",\n\t})\n})\n```\n\n* <b>gin </b>\n\n* <b></b>:\n\n``` go\nr.GET(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"GET\",\n\t})\n})\nr.POST(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"POST\",\n\t})\n})\nr.PUT(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"PUT\",\n\t})\n})\nr.DELETE(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"delete\",\n\t})\n})\n```\n`Any`\n``` go\n///user\nr.Any(\"/user\", func(c *gin.Context) {\n\tswitch c.Request.Method {\n\tcase \"GET\":\n\t\tc.JSON(http.StatusOK, gin.H{\"method\": \"GET\"})\n\tcase \"POST\":\n\t\tc.JSON(http.StatusOK, gin.H{\"method\": \"PSOT\"})\n\tcase http.MethodPut:\n\t\tc.JSON(http.StatusOK, gin.H{\"method\": \"PUT\"})\n\t}\n})\n```\n404`views/404.html`\n``` go \nr.NoRoute(func(c *gin.Context) {\n\t\tc.HTML(http.StatusNotFound, \"views/404.html\", nil)\n\t})\n```\n\n<b></b>:\n\n``` go \n// API\n//\nvideoGroup := r.Group(\"/video\")\n{\n\tvideoGroup.GET(\"/index\", func(c *gin.Context) {\n\t\tc.JSON(http.StatusOK, gin.H{\"msg\": \"/video/index\"})\n\t})\n\tvideoGroup.GET(\"/xx\", func(c *gin.Context) {\n\t\tc.JSON(http.StatusOK, gin.H{\"msg\": \"/video/xx\"})\n\t})\n\tvideoGroup.GET(\"/oo\", func(c *gin.Context) {\n\t\tc.JSON(http.StatusOK, gin.H{\"msg\": \"/video/oo\"})\n\t})\n}\n```\n\n``` go\nshopGroup := r.Group(\"/shop\")\n\t{\n\t\tshopGroup.GET(\"/index\", func(c *gin.Context) {...})\n\t\tshopGroup.GET(\"/cart\", func(c *gin.Context) {...})\n\t\tshopGroup.POST(\"/checkout\", func(c *gin.Context) {...})\n\t\t// \n\t\txx := shopGroup.Group(\"xx\")\n\t\txx.GET(\"/oo\", func(c *gin.Context) {...})\n\t}\n```\n* <b>gin </b>:\n\nGinHook\n\n<b></b>\n\nGin`func(c *gin.Context)` \n``` go\n// StatCost \nfunc StatCost(c *gin.Context) {\n\t\tprintln(\"StatCost in\")\n\t\tstart := time.Now()\n\t\tc.Set(\"name\", \"\") // c.Set\n\t\t// \n\t\tc.Next()\n\t\t// \n\t\t// c.Abort()\n\t\t// \n\t\tcost := time.Since(start)\n\t\tlog.Println(cost)\n\t\tprintln(\"StatCost out\")\n}\n```\n:\n``` go\nfunc authMiddleware(doCheck bool) gin.HandlerFunc {\n\t//\n\t//\n\treturn func(c *gin.Context) {\n\t\tif doCheck { //doCheck\n\t\t\t//\n\t\t\t// if \n\t\t\t// c.Next()\n\t\t\t// else\n\t\t\t// c.Abort()\n\t\t} else {\n\t\t\tc.Next()\n\t\t}\n\t}\n}\n```\n\n<b></b>\n\ngin\n\n* \n``` go\nfunc main() {\n\t// \n\tr := gin.New()\n\t// \n\tr.Use(StatCost)\n\n\tr.GET(\"/test\", func(c *gin.Context) {\n\t\tname := c.MustGet(\"name\").(string) // \n\t\tlog.Println(name)\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"message\": \"Hello world!\",\n\t\t})\n\t})\n\tr.Run()\n}\n```\n* \n``` go\n// /test2\nr.GET(\"/test2\", StatCost, func(c *gin.Context) {\n\tname := c.MustGet(\"name\").(string) // \n\tlog.Println(name)\n\tc.JSON(http.StatusOK, gin.H{\n\t\t\"message\": \"Hello world!\",\n\t})\n})\n```\n* \n:\n1. 1:\n``` go\nshopGroup := r.Group(\"/shop\", StatCost)\n{\n    shopGroup.GET(\"/index\", func(c *gin.Context) {...})\n    ...\n}\n```\n2. 2:\n``` go\nshopGroup := r.Group(\"/shop\")\nshopGroup.Use(StatCost)\n{\n    shopGroup.GET(\"/index\", func(c *gin.Context) {...})\n    ...\n}\n```\n\n`note:`\n<b>gin</b>\n`gin.Default()``Logger``Recovery`\n\n`Logger`gin.DefaultWriter`GIN_MODE=release`\n`Recovery`recoverpanicpanic500\n`gin.New()`\n\n","source":"_posts/go/go_gin.md","raw":"---\ntitle: Golang \ncategories: \n- GolangStudy\n---\n# go Web\n\n## go`net/http`\n\n`:`\n``` go \npackage main\n\nimport (\n\t\"fmt\"\n\t\"net/http\"\n\t\"io/ioutil\"\n)\n\nfunc sayhello(res http.ResponseWriter, req *http.Request) {\n\tb, err := ioutil.ReadFile(\"./hello.txt\")\n\tif err != nil {\n\t\tfmt.Printf(\"ReadFile failed, err: %v\", err)\n\t\treturn\n\t}\n\tfmt.Fprintln(res, string(b))\n}\n\nfunc main() {\n\thttp.HandleFunc(\"/hello\", sayhello)\n\terr := http.ListenAndServe(\":9090\", nil)\n\tif err != nil {\n\t\tfmt.Printf(\"http server failed, err: %v\", err)\n\t\treturn\n\t}\n}\n```\n\n## gin\n\n* gin\n\n``` bash\n# gin\ngo get -u \"github.com/gin-gonic/gin\"\"\n```\n\n``\n``` go\npackage main\n\nimport \"github.com/gin-gonic/gin\"\n\nfunc sayhello(c *gin.Context) {\n\tc.JSON(200, gin.H{\n\t\t\"message\": \"hello golang\",\n\t})\n}\n\nfunc main() {\n\t// \n\tr := gin.Default()\n\n\t//GET/hellosayhello\n\tr.GET(\"/hello\", sayhello)\n\t//\n\tr.Run()\n}\n```\n\n* <b>gin json<b/>\n\n``` go\nfunc main() {\n\tr := gin.Default()\n\n\t// gin.H map[string]interface{}\n\tr.GET(\"/someJSON\", func(c *gin.Context) {\n\t\t// JSON\n\t\tc.JSON(http.StatusOK, gin.H{\"message\": \"Hello world!\"})\n\t})\n\tr.GET(\"/moreJSON\", func(c *gin.Context) {\n\t\t// \n\t\ttype msg struct {\n\t\t\t// tag\n\t\t\tName    string `json:\"user\"`\n\t\t\tMessage string\n\t\t\tAge     int\n\t\t}\n\n\t\tme := msg {\n\t\t\t\"lijihao\",\n\t\t\t\"male\",\n\t\t\t18,\n\t\t}\n\t\tc.JSON(http.StatusOK, me)\n\t})\n\tr.Run(\":8080\")\n}\n```\n\n* <b>gin querystring<b/>\n\n`querystring`URL?`/web?username=&address=` \n\n``` go\npackage main\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\tr.GET(\"/web\", func(c *gin.Context) {\n\t\t//getquerystring\n\t\tname := c.Query(\"query\") //Querygetquerystring\n\t\tage := c.Query(\"age\")\n\t\t//name := c.DefaultQuery(\"query\", \"somebody\") //\n\t\t//name, ok := c.GetQuery(\"query\") //\n\t\t//if !ok {\n\t\t//\tname = \"somebody\"\n\t\t//}\n\t\tc.JSON(http.StatusOK, gin.H {\n\t\t\t\"name\": name,\n\t\t\tS\n\t\t})\n\t})\n\tr.Run(\":9090\")\n}\n```\n\n* <b>gin form<b/>\n\n``` go\npackage main\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\n\tr.LoadHTMLFiles(\"./login.tmpl\", \"./index.tmpl\")\n\n\tr.GET(\"/login\", func(c *gin.Context) {\n\t\tc.HTML(http.StatusOK, \"login.tmpl\", nil)\n\t})\n\n\t// login post\n\tr.POST(\"/login\", func(c *gin.Context) {\n\t\t//form\n\t\tusername := c.PostForm(\"username\")\n\t\tpassword := c.PostForm(\"password\")\n\t\t//username := c.DefaultPostForm(\"username\", \"***\")\n\t\t//password := c.DefaultPostForm(\"password\", \"***\")\n\t\t//username, _ := c.GetPostForm(\"username\")\n\t\t//password, _ := c.GetPostForm(\"password\")\n\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"Username\": username,\n\t\t\t\"Password\": password,\n\t\t})\n\t})\n\tr.Run(\":9090\")\n}\n```\n\n`login.tmpl`:\n\n``` html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>login</title>\n</head>\n<body>\n{{/*form*/}}\n<form action=\"/login\" method=\"post\" novalidate autocomplete=\"off\">\n    <div>\n        <label for=\"username\">username:</label>\n        <input type=\"text\" name=\"username\" id=\"username\">\n    </div>\n\n    <div>\n        <label for=\"password\">password:</label>\n        <input type=\"password\" name=\"password\" id=\"password\">\n    </div>\n\n    <div>\n        <input type=\"submit\" value=\"\">\n    </div>\n\n</form>\n</body>\n</html>\n```\n\n`index.tmpl`:\n\n``` html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>index</title>\n</head>\n<body>\n<h1>Hello Golang {{ .Username }}!</h1>\n<p>{{ .Password }}</p>\n</body>\n</html>\n```\n* <b>gin path</b>\n\nURL`/user/search//` \n``` go\npackage main\n\nimport (\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\t//, note:\n\tr.GET(\"/user/:name/:age\", func(c *gin.Context) {\n\t\tname := c.Param(\"name\")\n\t\tage := c.Param(\"age\")\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"Name\": name,\n\t\t\t\"Age\": age,\n\t\t})\n\t})\n\n\tr.GET(\"/blogs/:year/:month\", func(c *gin.Context) {\n\t\tyear := c.Param(\"year\")\n\t\tmonth := c.Param(\"month\")\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"year\": year,\n\t\t\t\"month\": month,\n\t\t})\n\t})\n\tr.Run(\":9090\")\n}\n```\n\n* <b>gin <b/>\n\n\n`ShouldBind()`JSONformQueryString\n\n``` go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\ntype UserInfo struct {\n\t//note: `form:\"xx\" json:\"xxx\"`jsonkey\n\tUsername string `form:\"username\" json:\"username\"`\n\tPassword string `form:\"password\" json:\"password\"`\n}\n\nfunc main() {\n\tr := gin.Default()\n\tr.LoadHTMLFiles(\"./login.tmpl\")\n\tr.GET(\"user\", func(c *gin.Context) {\n\t\t//var u1 UserInfo\n\t\t//u1.Username = c.Query(\"username\")\n\t\t//u1.Password = c.Query(\"password\")\n\t\t//\n\t\tvar u UserInfo\n\t\t//querystring\n\t\terr := c.ShouldBind(&u)\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\tfmt.Printf(\"%#v\", u)\n\t\t\tc.JSON(http.StatusOK, gin.H {\n\t\t\t\t\"status\": \"ok\",\n\t\t\t\t\"name\": u.Username,\n\t\t\t\t\"password\": u.Password,\n\t\t\t})\n\t\t}\n\t})\n\n\tr.GET(\"/login\", func(c *gin.Context) {\n\t\tc.HTML(http.StatusOK, \"login.tmpl\", nil)\n\t})\n\n\tr.POST(\"/form\", func(c *gin.Context) {\n\t\tvar u UserInfo\n\t\t//form\n\t\terr := c.ShouldBind(&u)\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\t\"status\": \"ok\",\n\t\t\t\t\"name\": u.Username,\n\t\t\t\t\"password\": u.Password,\n\t\t\t})\n\t\t}\n\t})\n\n\tr.POST(\"/json\", func(c *gin.Context) {\n\t\tvar u UserInfo\n\t\t//Json\n\t\terr := c.ShouldBind(&u)\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H{\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\t\"status\": \"ok\",\n\t\t\t\t\"name\": u.Username,\n\t\t\t\t\"password\": u.Password,\n\t\t\t})\n\t\t}\n\t})\n\n\tr.Run(\":9090\")\n}\n```\n\n`login.tmpl`:\n\n``` html\n<!DOCTYPE html>\n<html lang=\"ch-CN\">\n<head>\n    <title>login</title>\n</head>\n<body>\n{{/*from action --> method--> */}}\n<form action=\"/form\" method=\"post\">\n    <input type=\"text\" name=\"username\">\n    <input type=\"password\" name=\"password\">\n    <input type=\"submit\" value=\"\">\n</form>\n</body>\n</html>\n```\n\n* <b>gin </b>\n\n``` go \npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/gin-gonic/gin\"\n\t\"net/http\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\tr.LoadHTMLFiles(\"./index.tmpl\")\n\tr.GET(\"/index\", func(c *gin.Context) {\n\t\tc.HTML(http.StatusOK, \"index.tmpl\", nil)\n\t})\n\tr.POST(\"/upload\", func(c *gin.Context) {\n\t\t// \n\t\tf, err := c.FormFile(\"f1\")\n\t\tif err != nil {\n\t\t\tc.JSON(http.StatusBadRequest, gin.H {\n\t\t\t\t\"error\": err.Error(),\n\t\t\t})\n\t\t} else {\n\t\t\t//()\n\t\t\tdst := fmt.Sprintf(\"./%s\", f.Filename)\n\t\t\tc.SaveUploadedFile(f, dst)\n\t\t\tc.JSON(http.StatusOK, gin.H {\n\t\t\t\t\"status\": \"Ok\",\n\t\t\t})\n\t\t}\n\t})\n\tr.Run(\":9090\")\n}\n```\n`index.tmpl`:\n``` html\n<!DOCTYPE html>\n<html lang=\"ch-CN\">\n<head>\n    <title>index</title>\n</head>\n<body>\n<form action=\"/upload\"  method=\"post\" enctype=\"multipart/form-data\">\n    <input type=\"file\" name=\"f1\">\n    <input type=\"submit\" value=\"\">\n</form>\n</body>\n</html>\n```\n\n* <b>gin </b>\n\n``` go\nfunc main() {\n\trouter := gin.Default()\n\t// multipart forms32 MiB\n\t// \n\t// router.MaxMultipartMemory = 8 << 20  // 8 MiB\n\trouter.POST(\"/upload\", func(c *gin.Context) {\n\t\t// Multipart form\n\t\tform, _ := c.MultipartForm()\n\t\tfiles := form.File[\"file\"]\n\n\t\tfor index, file := range files {\n\t\t\tlog.Println(file.Filename)\n\t\t\tdst := fmt.Sprintf(\"C:/tmp/%s_%d\", file.Filename, index)\n\t\t\t// \n\t\t\tc.SaveUploadedFile(file, dst)\n\t\t}\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"message\": fmt.Sprintf(\"%d files uploaded!\", len(files)),\n\t\t})\n\t})\n\trouter.Run()\n}\n```\n\n* <b>gin </b>\n\n:\n``` go\nr.GET(\"/index\", func(c *gin.Context) {\n\tc.Redirect(http.StatusMovedPermanently, \"http://www.sogo.com\")\n})\n```\n\n``` go\nr.GET(\"/a\", func(c *gin.Context) {\n\t//b\n\tc.Request.URL.Path = \"/b\" //URL\n\tr.HandleContext(c) //\n})\nr.GET(\"/b\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"message\": \"b\",\n\t})\n})\n```\n\n* <b>gin </b>\n\n* <b></b>:\n\n``` go\nr.GET(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"GET\",\n\t})\n})\nr.POST(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"POST\",\n\t})\n})\nr.PUT(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"PUT\",\n\t})\n})\nr.DELETE(\"/index\", func(c *gin.Context) {\n\tc.JSON(http.StatusOK, gin.H {\n\t\t\"method\": \"delete\",\n\t})\n})\n```\n`Any`\n``` go\n///user\nr.Any(\"/user\", func(c *gin.Context) {\n\tswitch c.Request.Method {\n\tcase \"GET\":\n\t\tc.JSON(http.StatusOK, gin.H{\"method\": \"GET\"})\n\tcase \"POST\":\n\t\tc.JSON(http.StatusOK, gin.H{\"method\": \"PSOT\"})\n\tcase http.MethodPut:\n\t\tc.JSON(http.StatusOK, gin.H{\"method\": \"PUT\"})\n\t}\n})\n```\n404`views/404.html`\n``` go \nr.NoRoute(func(c *gin.Context) {\n\t\tc.HTML(http.StatusNotFound, \"views/404.html\", nil)\n\t})\n```\n\n<b></b>:\n\n``` go \n// API\n//\nvideoGroup := r.Group(\"/video\")\n{\n\tvideoGroup.GET(\"/index\", func(c *gin.Context) {\n\t\tc.JSON(http.StatusOK, gin.H{\"msg\": \"/video/index\"})\n\t})\n\tvideoGroup.GET(\"/xx\", func(c *gin.Context) {\n\t\tc.JSON(http.StatusOK, gin.H{\"msg\": \"/video/xx\"})\n\t})\n\tvideoGroup.GET(\"/oo\", func(c *gin.Context) {\n\t\tc.JSON(http.StatusOK, gin.H{\"msg\": \"/video/oo\"})\n\t})\n}\n```\n\n``` go\nshopGroup := r.Group(\"/shop\")\n\t{\n\t\tshopGroup.GET(\"/index\", func(c *gin.Context) {...})\n\t\tshopGroup.GET(\"/cart\", func(c *gin.Context) {...})\n\t\tshopGroup.POST(\"/checkout\", func(c *gin.Context) {...})\n\t\t// \n\t\txx := shopGroup.Group(\"xx\")\n\t\txx.GET(\"/oo\", func(c *gin.Context) {...})\n\t}\n```\n* <b>gin </b>:\n\nGinHook\n\n<b></b>\n\nGin`func(c *gin.Context)` \n``` go\n// StatCost \nfunc StatCost(c *gin.Context) {\n\t\tprintln(\"StatCost in\")\n\t\tstart := time.Now()\n\t\tc.Set(\"name\", \"\") // c.Set\n\t\t// \n\t\tc.Next()\n\t\t// \n\t\t// c.Abort()\n\t\t// \n\t\tcost := time.Since(start)\n\t\tlog.Println(cost)\n\t\tprintln(\"StatCost out\")\n}\n```\n:\n``` go\nfunc authMiddleware(doCheck bool) gin.HandlerFunc {\n\t//\n\t//\n\treturn func(c *gin.Context) {\n\t\tif doCheck { //doCheck\n\t\t\t//\n\t\t\t// if \n\t\t\t// c.Next()\n\t\t\t// else\n\t\t\t// c.Abort()\n\t\t} else {\n\t\t\tc.Next()\n\t\t}\n\t}\n}\n```\n\n<b></b>\n\ngin\n\n* \n``` go\nfunc main() {\n\t// \n\tr := gin.New()\n\t// \n\tr.Use(StatCost)\n\n\tr.GET(\"/test\", func(c *gin.Context) {\n\t\tname := c.MustGet(\"name\").(string) // \n\t\tlog.Println(name)\n\t\tc.JSON(http.StatusOK, gin.H{\n\t\t\t\"message\": \"Hello world!\",\n\t\t})\n\t})\n\tr.Run()\n}\n```\n* \n``` go\n// /test2\nr.GET(\"/test2\", StatCost, func(c *gin.Context) {\n\tname := c.MustGet(\"name\").(string) // \n\tlog.Println(name)\n\tc.JSON(http.StatusOK, gin.H{\n\t\t\"message\": \"Hello world!\",\n\t})\n})\n```\n* \n:\n1. 1:\n``` go\nshopGroup := r.Group(\"/shop\", StatCost)\n{\n    shopGroup.GET(\"/index\", func(c *gin.Context) {...})\n    ...\n}\n```\n2. 2:\n``` go\nshopGroup := r.Group(\"/shop\")\nshopGroup.Use(StatCost)\n{\n    shopGroup.GET(\"/index\", func(c *gin.Context) {...})\n    ...\n}\n```\n\n`note:`\n<b>gin</b>\n`gin.Default()``Logger``Recovery`\n\n`Logger`gin.DefaultWriter`GIN_MODE=release`\n`Recovery`recoverpanicpanic500\n`gin.New()`\n\n","slug":"go/go_gin","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6cr0004f8wz0zdzersq","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"go-Web\"><a href=\"#go-Web\" class=\"headerlink\" title=\"go Web\"></a>go Web</h1><h2 id=\"gonet-http\"><a href=\"#gonet-http\" class=\"headerlink\" title=\"gonet/http\"></a>go<code>net/http</code></h2><p><code>:</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;io/ioutil&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sayhello</span><span class=\"params\">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class=\"line\">\tb, err := ioutil.ReadFile(<span class=\"string\">&quot;./hello.txt&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;ReadFile failed, err: %v&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Fprintln(res, <span class=\"type\">string</span>(b))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\thttp.HandleFunc(<span class=\"string\">&quot;/hello&quot;</span>, sayhello)</span><br><span class=\"line\">\terr := http.ListenAndServe(<span class=\"string\">&quot;:9090&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;http server failed, err: %v&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"gin\"><a href=\"#gin\" class=\"headerlink\" title=\"gin\"></a>gin</h2><ul>\n<li>gin</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># gin</span></span><br><span class=\"line\">go get -u <span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span><span class=\"string\">&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><code></code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sayhello</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(<span class=\"number\">200</span>, gin.H&#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;hello golang&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//GET/hellosayhello</span></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/hello&quot;</span>, sayhello)</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tr.Run()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin json<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// gin.H map[string]interface&#123;&#125;</span></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/someJSON&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// JSON</span></span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello world!&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/moreJSON&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\t<span class=\"keyword\">type</span> msg <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// tag</span></span><br><span class=\"line\">\t\t\tName    <span class=\"type\">string</span> <span class=\"string\">`json:&quot;user&quot;`</span></span><br><span class=\"line\">\t\t\tMessage <span class=\"type\">string</span></span><br><span class=\"line\">\t\t\tAge     <span class=\"type\">int</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tme := msg &#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;lijihao&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;male&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"number\">18</span>,</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, me)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin querystring<b/></li>\n</ul>\n<p><code>querystring</code>URL?<code>/web?username=&amp;address=</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/web&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//getquerystring</span></span><br><span class=\"line\">\t\tname := c.Query(<span class=\"string\">&quot;query&quot;</span>) <span class=\"comment\">//Querygetquerystring</span></span><br><span class=\"line\">\t\tage := c.Query(<span class=\"string\">&quot;age&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">//name := c.DefaultQuery(&quot;query&quot;, &quot;somebody&quot;) //</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//name, ok := c.GetQuery(&quot;query&quot;) //</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//if !ok &#123;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//\tname = &quot;somebody&quot;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;name&quot;</span>: name,</span><br><span class=\"line\">\t\t\tS</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin form<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.LoadHTMLFiles(<span class=\"string\">&quot;./login.tmpl&quot;</span>, <span class=\"string\">&quot;./index.tmpl&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusOK, <span class=\"string\">&quot;login.tmpl&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// login post</span></span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//form</span></span><br><span class=\"line\">\t\tusername := c.PostForm(<span class=\"string\">&quot;username&quot;</span>)</span><br><span class=\"line\">\t\tpassword := c.PostForm(<span class=\"string\">&quot;password&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">//username := c.DefaultPostForm(&quot;username&quot;, &quot;***&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//password := c.DefaultPostForm(&quot;password&quot;, &quot;***&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//username, _ := c.GetPostForm(&quot;username&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//password, _ := c.GetPostForm(&quot;password&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Username&quot;</span>: username,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Password&quot;</span>: password,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>login.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>login<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">&#123;&#123;/*form*/&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/login&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">novalidate</span> <span class=\"attr\">autocomplete</span>=<span class=\"string\">&quot;off&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>username:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span>password:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>index.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>index<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello Golang &#123;&#123; .Username &#125;&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; .Password &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><b>gin path</b></li>\n</ul>\n<p>URL<code>/user/search//</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\t<span class=\"comment\">//, note:</span></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/user/:name/:age&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tname := c.Param(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">\t\tage := c.Param(<span class=\"string\">&quot;age&quot;</span>)</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Name&quot;</span>: name,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Age&quot;</span>: age,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/blogs/:year/:month&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tyear := c.Param(<span class=\"string\">&quot;year&quot;</span>)</span><br><span class=\"line\">\t\tmonth := c.Param(<span class=\"string\">&quot;month&quot;</span>)</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;year&quot;</span>: year,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;month&quot;</span>: month,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin <b/></li>\n</ul>\n<p><code>ShouldBind()</code>JSONformQueryString</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> UserInfo <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//note: `form:&quot;xx&quot; json:&quot;xxx&quot;`jsonkey</span></span><br><span class=\"line\">\tUsername <span class=\"type\">string</span> <span class=\"string\">`form:&quot;username&quot; json:&quot;username&quot;`</span></span><br><span class=\"line\">\tPassword <span class=\"type\">string</span> <span class=\"string\">`form:&quot;password&quot; json:&quot;password&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.LoadHTMLFiles(<span class=\"string\">&quot;./login.tmpl&quot;</span>)</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;user&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//var u1 UserInfo</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//u1.Username = c.Query(&quot;username&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//u1.Password = c.Query(&quot;password&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t\t<span class=\"comment\">//querystring</span></span><br><span class=\"line\">\t\terr := c.ShouldBind(&amp;u)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Printf(<span class=\"string\">&quot;%#v&quot;</span>, u)</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;ok&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;name&quot;</span>: u.Username,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;password&quot;</span>: u.Password,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusOK, <span class=\"string\">&quot;login.tmpl&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/form&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t\t<span class=\"comment\">//form</span></span><br><span class=\"line\">\t\terr := c.ShouldBind(&amp;u)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;ok&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;name&quot;</span>: u.Username,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;password&quot;</span>: u.Password,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/json&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t\t<span class=\"comment\">//Json</span></span><br><span class=\"line\">\t\terr := c.ShouldBind(&amp;u)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;ok&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;name&quot;</span>: u.Username,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;password&quot;</span>: u.Password,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>login.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;ch-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>login<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">&#123;&#123;/*from action --&gt; method--&gt; */&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/form&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin </b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.LoadHTMLFiles(<span class=\"string\">&quot;./index.tmpl&quot;</span>)</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusOK, <span class=\"string\">&quot;index.tmpl&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/upload&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tf, err := c.FormFile(<span class=\"string\">&quot;f1&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//()</span></span><br><span class=\"line\">\t\t\tdst := fmt.Sprintf(<span class=\"string\">&quot;./%s&quot;</span>, f.Filename)</span><br><span class=\"line\">\t\t\tc.SaveUploadedFile(f, dst)</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;Ok&quot;</span>,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>index.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;ch-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>index<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/upload&quot;</span>  <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;f1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin </b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\trouter := gin.Default()</span><br><span class=\"line\">\t<span class=\"comment\">// multipart forms32 MiB</span></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t<span class=\"comment\">// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB</span></span><br><span class=\"line\">\trouter.POST(<span class=\"string\">&quot;/upload&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Multipart form</span></span><br><span class=\"line\">\t\tform, _ := c.MultipartForm()</span><br><span class=\"line\">\t\tfiles := form.File[<span class=\"string\">&quot;file&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> index, file := <span class=\"keyword\">range</span> files &#123;</span><br><span class=\"line\">\t\t\tlog.Println(file.Filename)</span><br><span class=\"line\">\t\t\tdst := fmt.Sprintf(<span class=\"string\">&quot;C:/tmp/%s_%d&quot;</span>, file.Filename, index)</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\t\tc.SaveUploadedFile(file, dst)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;message&quot;</span>: fmt.Sprintf(<span class=\"string\">&quot;%d files uploaded!&quot;</span>, <span class=\"built_in\">len</span>(files)),</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\trouter.Run()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin </b></li>\n</ul>\n<p>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.Redirect(http.StatusMovedPermanently, <span class=\"string\">&quot;http://www.sogo.com&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/a&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//b</span></span><br><span class=\"line\">\tc.Request.URL.Path = <span class=\"string\">&quot;/b&quot;</span> <span class=\"comment\">//URL</span></span><br><span class=\"line\">\tr.HandleContext(c) <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.GET(<span class=\"string\">&quot;/b&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;b&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><b>gin </b></p>\n</li>\n<li><p><b></b>:</p>\n</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.POST(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;POST&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.PUT(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;PUT&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.DELETE(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;delete&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><code>Any</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///user</span></span><br><span class=\"line\">r.Any(<span class=\"string\">&quot;/user&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> c.Request.Method &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"string\">&quot;GET&quot;</span>:</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"string\">&quot;POST&quot;</span>:</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;PSOT&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> http.MethodPut:</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;PUT&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>404<code>views/404.html</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.NoRoute(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusNotFound, <span class=\"string\">&quot;views/404.html&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><b></b>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// API</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">videoGroup := r.Group(<span class=\"string\">&quot;/video&quot;</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvideoGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;/video/index&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tvideoGroup.GET(<span class=\"string\">&quot;/xx&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;/video/xx&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tvideoGroup.GET(<span class=\"string\">&quot;/oo&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;/video/oo&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopGroup := r.Group(<span class=\"string\">&quot;/shop&quot;</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tshopGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t\tshopGroup.GET(<span class=\"string\">&quot;/cart&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t\tshopGroup.POST(<span class=\"string\">&quot;/checkout&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\txx := shopGroup.Group(<span class=\"string\">&quot;xx&quot;</span>)</span><br><span class=\"line\">\t\txx.GET(<span class=\"string\">&quot;/oo&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><b>gin </b>:</li>\n</ul>\n<p>GinHook</p>\n<p><b></b></p>\n<p>Gin<code>func(c *gin.Context)</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// StatCost </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">StatCost</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">println</span>(<span class=\"string\">&quot;StatCost in&quot;</span>)</span><br><span class=\"line\">\t\tstart := time.Now()</span><br><span class=\"line\">\t\tc.Set(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;&quot;</span>) <span class=\"comment\">// c.Set</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tc.Next()</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\t<span class=\"comment\">// c.Abort()</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tcost := time.Since(start)</span><br><span class=\"line\">\t\tlog.Println(cost)</span><br><span class=\"line\">\t\t<span class=\"built_in\">println</span>(<span class=\"string\">&quot;StatCost out&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">authMiddleware</span><span class=\"params\">(doCheck <span class=\"type\">bool</span>)</span></span> gin.HandlerFunc &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> doCheck &#123; <span class=\"comment\">//doCheck</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// if </span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// c.Next()</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// else</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// c.Abort()</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tc.Next()</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><b></b></p>\n<p>gin</p>\n<ul>\n<li><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr := gin.New()</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr.Use(StatCost)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/test&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tname := c.MustGet(<span class=\"string\">&quot;name&quot;</span>).(<span class=\"type\">string</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">\t\tlog.Println(name)</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello world!&quot;</span>,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// /test2</span></span><br><span class=\"line\">r.GET(<span class=\"string\">&quot;/test2&quot;</span>, StatCost, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tname := c.MustGet(<span class=\"string\">&quot;name&quot;</span>).(<span class=\"type\">string</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">\tlog.Println(name)</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello world!&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li><br>:</li>\n</ul>\n<ol>\n<li>1:<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopGroup := r.Group(<span class=\"string\">&quot;/shop&quot;</span>, StatCost)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    shopGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>2:<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopGroup := r.Group(<span class=\"string\">&quot;/shop&quot;</span>)</span><br><span class=\"line\">shopGroup.Use(StatCost)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    shopGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p><code>note:</code><br><b>gin</b><br><code>gin.Default()</code><code>Logger</code><code>Recovery</code></p>\n<p><code>Logger</code>gin.DefaultWriter<code>GIN_MODE=release</code><br><code>Recovery</code>recoverpanicpanic500<br><code>gin.New()</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"go-Web\"><a href=\"#go-Web\" class=\"headerlink\" title=\"go Web\"></a>go Web</h1><h2 id=\"gonet-http\"><a href=\"#gonet-http\" class=\"headerlink\" title=\"gonet/http\"></a>go<code>net/http</code></h2><p><code>:</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;io/ioutil&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sayhello</span><span class=\"params\">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class=\"line\">\tb, err := ioutil.ReadFile(<span class=\"string\">&quot;./hello.txt&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;ReadFile failed, err: %v&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Fprintln(res, <span class=\"type\">string</span>(b))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\thttp.HandleFunc(<span class=\"string\">&quot;/hello&quot;</span>, sayhello)</span><br><span class=\"line\">\terr := http.ListenAndServe(<span class=\"string\">&quot;:9090&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;http server failed, err: %v&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"gin\"><a href=\"#gin\" class=\"headerlink\" title=\"gin\"></a>gin</h2><ul>\n<li>gin</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># gin</span></span><br><span class=\"line\">go get -u <span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span><span class=\"string\">&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><code></code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sayhello</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(<span class=\"number\">200</span>, gin.H&#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;hello golang&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//GET/hellosayhello</span></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/hello&quot;</span>, sayhello)</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tr.Run()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin json<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// gin.H map[string]interface&#123;&#125;</span></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/someJSON&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// JSON</span></span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello world!&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/moreJSON&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\t<span class=\"keyword\">type</span> msg <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// tag</span></span><br><span class=\"line\">\t\t\tName    <span class=\"type\">string</span> <span class=\"string\">`json:&quot;user&quot;`</span></span><br><span class=\"line\">\t\t\tMessage <span class=\"type\">string</span></span><br><span class=\"line\">\t\t\tAge     <span class=\"type\">int</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tme := msg &#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;lijihao&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;male&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"number\">18</span>,</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, me)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin querystring<b/></li>\n</ul>\n<p><code>querystring</code>URL?<code>/web?username=&amp;address=</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/web&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//getquerystring</span></span><br><span class=\"line\">\t\tname := c.Query(<span class=\"string\">&quot;query&quot;</span>) <span class=\"comment\">//Querygetquerystring</span></span><br><span class=\"line\">\t\tage := c.Query(<span class=\"string\">&quot;age&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">//name := c.DefaultQuery(&quot;query&quot;, &quot;somebody&quot;) //</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//name, ok := c.GetQuery(&quot;query&quot;) //</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//if !ok &#123;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//\tname = &quot;somebody&quot;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;name&quot;</span>: name,</span><br><span class=\"line\">\t\t\tS</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin form<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.LoadHTMLFiles(<span class=\"string\">&quot;./login.tmpl&quot;</span>, <span class=\"string\">&quot;./index.tmpl&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusOK, <span class=\"string\">&quot;login.tmpl&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// login post</span></span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//form</span></span><br><span class=\"line\">\t\tusername := c.PostForm(<span class=\"string\">&quot;username&quot;</span>)</span><br><span class=\"line\">\t\tpassword := c.PostForm(<span class=\"string\">&quot;password&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"comment\">//username := c.DefaultPostForm(&quot;username&quot;, &quot;***&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//password := c.DefaultPostForm(&quot;password&quot;, &quot;***&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//username, _ := c.GetPostForm(&quot;username&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//password, _ := c.GetPostForm(&quot;password&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Username&quot;</span>: username,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Password&quot;</span>: password,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>login.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>login<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">&#123;&#123;/*form*/&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/login&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">novalidate</span> <span class=\"attr\">autocomplete</span>=<span class=\"string\">&quot;off&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span>username:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span>password:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>index.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>index<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello Golang &#123;&#123; .Username &#125;&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123; .Password &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><b>gin path</b></li>\n</ul>\n<p>URL<code>/user/search//</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\t<span class=\"comment\">//, note:</span></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/user/:name/:age&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tname := c.Param(<span class=\"string\">&quot;name&quot;</span>)</span><br><span class=\"line\">\t\tage := c.Param(<span class=\"string\">&quot;age&quot;</span>)</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Name&quot;</span>: name,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Age&quot;</span>: age,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/blogs/:year/:month&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tyear := c.Param(<span class=\"string\">&quot;year&quot;</span>)</span><br><span class=\"line\">\t\tmonth := c.Param(<span class=\"string\">&quot;month&quot;</span>)</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;year&quot;</span>: year,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;month&quot;</span>: month,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin <b/></li>\n</ul>\n<p><code>ShouldBind()</code>JSONformQueryString</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> UserInfo <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//note: `form:&quot;xx&quot; json:&quot;xxx&quot;`jsonkey</span></span><br><span class=\"line\">\tUsername <span class=\"type\">string</span> <span class=\"string\">`form:&quot;username&quot; json:&quot;username&quot;`</span></span><br><span class=\"line\">\tPassword <span class=\"type\">string</span> <span class=\"string\">`form:&quot;password&quot; json:&quot;password&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.LoadHTMLFiles(<span class=\"string\">&quot;./login.tmpl&quot;</span>)</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;user&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//var u1 UserInfo</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//u1.Username = c.Query(&quot;username&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//u1.Password = c.Query(&quot;password&quot;)</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t\t<span class=\"comment\">//querystring</span></span><br><span class=\"line\">\t\terr := c.ShouldBind(&amp;u)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Printf(<span class=\"string\">&quot;%#v&quot;</span>, u)</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;ok&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;name&quot;</span>: u.Username,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;password&quot;</span>: u.Password,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/login&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusOK, <span class=\"string\">&quot;login.tmpl&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/form&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t\t<span class=\"comment\">//form</span></span><br><span class=\"line\">\t\terr := c.ShouldBind(&amp;u)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;ok&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;name&quot;</span>: u.Username,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;password&quot;</span>: u.Password,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/json&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t\t<span class=\"comment\">//Json</span></span><br><span class=\"line\">\t\terr := c.ShouldBind(&amp;u)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;ok&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;name&quot;</span>: u.Username,</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;password&quot;</span>: u.Password,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>login.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;ch-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>login<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">&#123;&#123;/*from action --&gt; method--&gt; */&#125;&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/form&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin </b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tr := gin.Default()</span><br><span class=\"line\">\tr.LoadHTMLFiles(<span class=\"string\">&quot;./index.tmpl&quot;</span>)</span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusOK, <span class=\"string\">&quot;index.tmpl&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.POST(<span class=\"string\">&quot;/upload&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tf, err := c.FormFile(<span class=\"string\">&quot;f1&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusBadRequest, gin.H &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;error&quot;</span>: err.Error(),</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//()</span></span><br><span class=\"line\">\t\t\tdst := fmt.Sprintf(<span class=\"string\">&quot;./%s&quot;</span>, f.Filename)</span><br><span class=\"line\">\t\t\tc.SaveUploadedFile(f, dst)</span><br><span class=\"line\">\t\t\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;status&quot;</span>: <span class=\"string\">&quot;Ok&quot;</span>,</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run(<span class=\"string\">&quot;:9090&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>index.tmpl</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;ch-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>index<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;/upload&quot;</span>  <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;f1&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin </b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\trouter := gin.Default()</span><br><span class=\"line\">\t<span class=\"comment\">// multipart forms32 MiB</span></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t<span class=\"comment\">// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB</span></span><br><span class=\"line\">\trouter.POST(<span class=\"string\">&quot;/upload&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Multipart form</span></span><br><span class=\"line\">\t\tform, _ := c.MultipartForm()</span><br><span class=\"line\">\t\tfiles := form.File[<span class=\"string\">&quot;file&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> index, file := <span class=\"keyword\">range</span> files &#123;</span><br><span class=\"line\">\t\t\tlog.Println(file.Filename)</span><br><span class=\"line\">\t\t\tdst := fmt.Sprintf(<span class=\"string\">&quot;C:/tmp/%s_%d&quot;</span>, file.Filename, index)</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\t\tc.SaveUploadedFile(file, dst)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;message&quot;</span>: fmt.Sprintf(<span class=\"string\">&quot;%d files uploaded!&quot;</span>, <span class=\"built_in\">len</span>(files)),</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\trouter.Run()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>gin </b></li>\n</ul>\n<p>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.Redirect(http.StatusMovedPermanently, <span class=\"string\">&quot;http://www.sogo.com&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/a&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//b</span></span><br><span class=\"line\">\tc.Request.URL.Path = <span class=\"string\">&quot;/b&quot;</span> <span class=\"comment\">//URL</span></span><br><span class=\"line\">\tr.HandleContext(c) <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.GET(<span class=\"string\">&quot;/b&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;b&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><b>gin </b></p>\n</li>\n<li><p><b></b>:</p>\n</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.POST(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;POST&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.PUT(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;PUT&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">r.DELETE(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;delete&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><code>Any</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///user</span></span><br><span class=\"line\">r.Any(<span class=\"string\">&quot;/user&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> c.Request.Method &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"string\">&quot;GET&quot;</span>:</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"string\">&quot;POST&quot;</span>:</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;PSOT&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> http.MethodPut:</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;PUT&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>404<code>views/404.html</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">r.NoRoute(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.HTML(http.StatusNotFound, <span class=\"string\">&quot;views/404.html&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><b></b>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// API</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">videoGroup := r.Group(<span class=\"string\">&quot;/video&quot;</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvideoGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;/video/index&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tvideoGroup.GET(<span class=\"string\">&quot;/xx&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;/video/xx&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tvideoGroup.GET(<span class=\"string\">&quot;/oo&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;<span class=\"string\">&quot;msg&quot;</span>: <span class=\"string\">&quot;/video/oo&quot;</span>&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopGroup := r.Group(<span class=\"string\">&quot;/shop&quot;</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tshopGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t\tshopGroup.GET(<span class=\"string\">&quot;/cart&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t\tshopGroup.POST(<span class=\"string\">&quot;/checkout&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\txx := shopGroup.Group(<span class=\"string\">&quot;xx&quot;</span>)</span><br><span class=\"line\">\t\txx.GET(<span class=\"string\">&quot;/oo&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><b>gin </b>:</li>\n</ul>\n<p>GinHook</p>\n<p><b></b></p>\n<p>Gin<code>func(c *gin.Context)</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// StatCost </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">StatCost</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">println</span>(<span class=\"string\">&quot;StatCost in&quot;</span>)</span><br><span class=\"line\">\t\tstart := time.Now()</span><br><span class=\"line\">\t\tc.Set(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;&quot;</span>) <span class=\"comment\">// c.Set</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tc.Next()</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\t<span class=\"comment\">// c.Abort()</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tcost := time.Since(start)</span><br><span class=\"line\">\t\tlog.Println(cost)</span><br><span class=\"line\">\t\t<span class=\"built_in\">println</span>(<span class=\"string\">&quot;StatCost out&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">authMiddleware</span><span class=\"params\">(doCheck <span class=\"type\">bool</span>)</span></span> gin.HandlerFunc &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> doCheck &#123; <span class=\"comment\">//doCheck</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// if </span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// c.Next()</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// else</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// c.Abort()</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tc.Next()</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><b></b></p>\n<p>gin</p>\n<ul>\n<li><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr := gin.New()</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr.Use(StatCost)</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.GET(<span class=\"string\">&quot;/test&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\t\tname := c.MustGet(<span class=\"string\">&quot;name&quot;</span>).(<span class=\"type\">string</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">\t\tlog.Println(name)</span><br><span class=\"line\">\t\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello world!&quot;</span>,</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tr.Run()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// /test2</span></span><br><span class=\"line\">r.GET(<span class=\"string\">&quot;/test2&quot;</span>, StatCost, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;</span><br><span class=\"line\">\tname := c.MustGet(<span class=\"string\">&quot;name&quot;</span>).(<span class=\"type\">string</span>) <span class=\"comment\">// </span></span><br><span class=\"line\">\tlog.Println(name)</span><br><span class=\"line\">\tc.JSON(http.StatusOK, gin.H&#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;message&quot;</span>: <span class=\"string\">&quot;Hello world!&quot;</span>,</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li><br>:</li>\n</ul>\n<ol>\n<li>1:<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopGroup := r.Group(<span class=\"string\">&quot;/shop&quot;</span>, StatCost)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    shopGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>2:<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shopGroup := r.Group(<span class=\"string\">&quot;/shop&quot;</span>)</span><br><span class=\"line\">shopGroup.Use(StatCost)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    shopGroup.GET(<span class=\"string\">&quot;/index&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(c *gin.Context)</span></span> &#123;...&#125;)</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p><code>note:</code><br><b>gin</b><br><code>gin.Default()</code><code>Logger</code><code>Recovery</code></p>\n<p><code>Logger</code>gin.DefaultWriter<code>GIN_MODE=release</code><br><code>Recovery</code>recoverpanicpanic500<br><code>gin.New()</code></p>\n"},{"title":"Golangkafka","_content":"# Kafka API\n\n## API\n\n* `sarama`\n``` bash\n  go get -u github.com/Shopify/sarama\n```\n\n* \n\t- Kafka  Producer ,main  Sender ,RecordAccumulator\n\t- main  RecordAccumulator,Sender  RecordAccumulator  Kafka broker\n\n* \n\n``\n\n``` go \npackage main\n\nimport (\n\t\"github.com/Shopify/sarama\"\n\t\"log\"\n\t\"os\"\n\t\"os/signal\"\n\t\"sync\"\n)\n\nfunc main() {\n\tconfig := sarama.NewConfig()\n\n\tconfig.Producer.Return.Successes = true\n\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner\n\n\tclient,err := sarama.NewClient([]string{\"localhost:9092\"}, config)\n\tdefer client.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tproducer, err := sarama.NewAsyncProducerFromClient(client)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\t// Trap SIGINT to trigger a graceful shutdown.\n\tsignals := make(chan os.Signal, 1)\n\tsignal.Notify(signals, os.Interrupt)\n\n\tvar (\n\t\twg        sync.WaitGroup\n\t\tenqueued, successes, errors int\n\t)\n\n\twg.Add(1)\n\t// start a groutines to count successes num\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor range producer.Successes() {\n\t\t\tsuccesses++\n\t\t}\n\t}()\n\n\twg.Add(1)\n\t// start a groutines to count error num\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor err := range producer.Errors() {\n\t\t\tlog.Println(err)\n\t\t\terrors++\n\t\t}\n\t}()\n\n\tfor {\n\t\tmessage := &sarama.ProducerMessage{Topic: \"my-topic\", Value: sarama.StringEncoder(\"testing 123\")}\n\t\tselect {\n\t\tcase producer.Input() <- message:\n\t\t\tenqueued++\n\n\t\tcase <-signals:\n\t\t\tproducer.AsyncClose() // Trigger a shutdown of the producer.\n\t\t\tbreak \n\t\t}\n\t}\n\n\twg.Wait()\n\n\tlog.Printf(\"Successfully produced: %d; errors: %d\\n\", successes, errors)\n}\n```\n\n* \n\n` `\n\n``` go\n// Kafka\npackage main\n\nimport \"github.com/Shopify/sarama\"\nimport \"fmt\"\n\nfunc main() {\n\tconfig := sarama.NewConfig()\n\tconfig.Producer.RequiredAcks = sarama.WaitForAll          // leaderfollow\n\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner // partition\n\tconfig.Producer.Return.Successes = true                   // success channel\n\n\t// \n\tmsg := &sarama.ProducerMessage{}\n\tmsg.Topic = \"web_log\"\n\tmsg.Value = sarama.StringEncoder(\"this is a test log\")\n\t// kafka\n\tclient, err := sarama.NewSyncProducer([]string{\"127.0.0.1:9092\"}, config)\n\tif err != nil {\n\t\tfmt.Println(\"producer closed, err:\", err)\n\t\treturn\n\t}\n\tdefer client.Close()\n\t// \n\tpid, offset, err := client.SendMessage(msg)\n\tif err != nil {\n\t\tfmt.Println(\"send msg failed, err:\", err)\n\t\treturn\n\t}\n\tfmt.Printf(\"pid:%v offset:%v\\n\", pid, offset)\n}\n```\n\n\n## API\n\n* \n\n``` go\n// kafka\npackage main\n\nimport (\n\t\"github.com/Shopify/sarama\"\n\t\"log\"\n\t\"os\"\n\t\"os/signal\"\n)\n\nfunc main()  {\n\tconfig := sarama.NewConfig()\n\tconfig.Consumer.Return.Errors = true\n\tclient,err := sarama.NewClient([]string{\"localhost:9092\"}, config)\n\tdefer client.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tconsumer, err := sarama.NewConsumerFromClient(client)\n\n\tdefer consumer.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t// get partitionId list\n\tpartitions,err := consumer.Partitions(\"my-topic\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tfor _, partitionId := range partitions{\n\t\t// create partitionConsumer for every partitionId\n\t\tpartitionConsumer, err := consumer.ConsumePartition(\"my-topic\", partitionId, sarama.OffsetNewest)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\n\t\tgo func(pc *sarama.PartitionConsumer) {\n\t\t\tdefer (*pc).Close()\n\t\t\t// block\n\t\t\tfor message := range (*pc).Messages(){\n\t\t\t\tvalue := string(message.Value)\n\t\t\t\tlog.Printf(\"Partitionid: %d; offset:%d, value: %s\\n\", message.Partition,message.Offset, value)\n\t\t\t}\n\n\t\t}(&partitionConsumer)\n\t}\n\tsignals := make(chan os.Signal, 1)\n\tsignal.Notify(signals, os.Interrupt)\n\tselect {\n\tcase <-signals:\n\n\t}\n}\n```\n\n* \n\n``` go \npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"github.com/Shopify/sarama\"\n\t\"os\"\n\t\"os/signal\"\n\t\"sync\"\n)\ntype consumerGroupHandler struct{\n\tname string\n}\n\nfunc (consumerGroupHandler) Setup(_ sarama.ConsumerGroupSession) error   { return nil }\nfunc (consumerGroupHandler) Cleanup(_ sarama.ConsumerGroupSession) error { return nil }\nfunc (h consumerGroupHandler) ConsumeClaim(sess sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\tfor msg := range claim.Messages() {\n\t\tfmt.Printf(\"%s Message topic:%q partition:%d offset:%d  value:%s\\n\",h.name, msg.Topic, msg.Partition, msg.Offset, string(msg.Value))\n\t\t// \n\t\tsess.MarkMessage(msg, \"\")\n\t}\n\treturn nil\n}\n\nfunc handleErrors(group *sarama.ConsumerGroup,wg  *sync.WaitGroup ){\n\twg.Done()\n\tfor err := range (*group).Errors() {\n\t\tfmt.Println(\"ERROR\", err)\n\t}\n}\n\nfunc consume(group *sarama.ConsumerGroup,wg  *sync.WaitGroup, name string) {\n\tfmt.Println(name + \"start\")\n\twg.Done()\n\tctx := context.Background()\n\tfor {\n\t\ttopics := []string{\"my_topic\"}\n\t\thandler := consumerGroupHandler{name: name}\n\t\terr := (*group).Consume(ctx, topics, handler)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\t}\n}\n\nfunc main(){\n\tvar wg sync.WaitGroup\n\tconfig := sarama.NewConfig()\n\tconfig.Consumer.Return.Errors = false\n\tconfig.Version = sarama.V0_10_2_0\n\tclient,err := sarama.NewClient([]string{\"localhost:9092\"}, config)\n\tdefer client.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tgroup, err := sarama.NewConsumerGroupFromClient(\"c1\", client)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer group.Close()\n\twg.Add(3)\n\tgo consume(&group,&wg,\"c1\")\n\twg.Wait()\n\tsignals := make(chan os.Signal, 1)\n\tsignal.Notify(signals, os.Interrupt)\n\tselect {\n\tcase <-signals:\n\t}\n}\n```\n\n\t\t\n","source":"_posts/go/go_kafka.md","raw":"---\ntitle: Golangkafka \ncategories: \n- GolangStudy\n---\n# Kafka API\n\n## API\n\n* `sarama`\n``` bash\n  go get -u github.com/Shopify/sarama\n```\n\n* \n\t- Kafka  Producer ,main  Sender ,RecordAccumulator\n\t- main  RecordAccumulator,Sender  RecordAccumulator  Kafka broker\n\n* \n\n``\n\n``` go \npackage main\n\nimport (\n\t\"github.com/Shopify/sarama\"\n\t\"log\"\n\t\"os\"\n\t\"os/signal\"\n\t\"sync\"\n)\n\nfunc main() {\n\tconfig := sarama.NewConfig()\n\n\tconfig.Producer.Return.Successes = true\n\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner\n\n\tclient,err := sarama.NewClient([]string{\"localhost:9092\"}, config)\n\tdefer client.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tproducer, err := sarama.NewAsyncProducerFromClient(client)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\t// Trap SIGINT to trigger a graceful shutdown.\n\tsignals := make(chan os.Signal, 1)\n\tsignal.Notify(signals, os.Interrupt)\n\n\tvar (\n\t\twg        sync.WaitGroup\n\t\tenqueued, successes, errors int\n\t)\n\n\twg.Add(1)\n\t// start a groutines to count successes num\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor range producer.Successes() {\n\t\t\tsuccesses++\n\t\t}\n\t}()\n\n\twg.Add(1)\n\t// start a groutines to count error num\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor err := range producer.Errors() {\n\t\t\tlog.Println(err)\n\t\t\terrors++\n\t\t}\n\t}()\n\n\tfor {\n\t\tmessage := &sarama.ProducerMessage{Topic: \"my-topic\", Value: sarama.StringEncoder(\"testing 123\")}\n\t\tselect {\n\t\tcase producer.Input() <- message:\n\t\t\tenqueued++\n\n\t\tcase <-signals:\n\t\t\tproducer.AsyncClose() // Trigger a shutdown of the producer.\n\t\t\tbreak \n\t\t}\n\t}\n\n\twg.Wait()\n\n\tlog.Printf(\"Successfully produced: %d; errors: %d\\n\", successes, errors)\n}\n```\n\n* \n\n` `\n\n``` go\n// Kafka\npackage main\n\nimport \"github.com/Shopify/sarama\"\nimport \"fmt\"\n\nfunc main() {\n\tconfig := sarama.NewConfig()\n\tconfig.Producer.RequiredAcks = sarama.WaitForAll          // leaderfollow\n\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner // partition\n\tconfig.Producer.Return.Successes = true                   // success channel\n\n\t// \n\tmsg := &sarama.ProducerMessage{}\n\tmsg.Topic = \"web_log\"\n\tmsg.Value = sarama.StringEncoder(\"this is a test log\")\n\t// kafka\n\tclient, err := sarama.NewSyncProducer([]string{\"127.0.0.1:9092\"}, config)\n\tif err != nil {\n\t\tfmt.Println(\"producer closed, err:\", err)\n\t\treturn\n\t}\n\tdefer client.Close()\n\t// \n\tpid, offset, err := client.SendMessage(msg)\n\tif err != nil {\n\t\tfmt.Println(\"send msg failed, err:\", err)\n\t\treturn\n\t}\n\tfmt.Printf(\"pid:%v offset:%v\\n\", pid, offset)\n}\n```\n\n\n## API\n\n* \n\n``` go\n// kafka\npackage main\n\nimport (\n\t\"github.com/Shopify/sarama\"\n\t\"log\"\n\t\"os\"\n\t\"os/signal\"\n)\n\nfunc main()  {\n\tconfig := sarama.NewConfig()\n\tconfig.Consumer.Return.Errors = true\n\tclient,err := sarama.NewClient([]string{\"localhost:9092\"}, config)\n\tdefer client.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tconsumer, err := sarama.NewConsumerFromClient(client)\n\n\tdefer consumer.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\t// get partitionId list\n\tpartitions,err := consumer.Partitions(\"my-topic\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tfor _, partitionId := range partitions{\n\t\t// create partitionConsumer for every partitionId\n\t\tpartitionConsumer, err := consumer.ConsumePartition(\"my-topic\", partitionId, sarama.OffsetNewest)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\n\t\tgo func(pc *sarama.PartitionConsumer) {\n\t\t\tdefer (*pc).Close()\n\t\t\t// block\n\t\t\tfor message := range (*pc).Messages(){\n\t\t\t\tvalue := string(message.Value)\n\t\t\t\tlog.Printf(\"Partitionid: %d; offset:%d, value: %s\\n\", message.Partition,message.Offset, value)\n\t\t\t}\n\n\t\t}(&partitionConsumer)\n\t}\n\tsignals := make(chan os.Signal, 1)\n\tsignal.Notify(signals, os.Interrupt)\n\tselect {\n\tcase <-signals:\n\n\t}\n}\n```\n\n* \n\n``` go \npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"github.com/Shopify/sarama\"\n\t\"os\"\n\t\"os/signal\"\n\t\"sync\"\n)\ntype consumerGroupHandler struct{\n\tname string\n}\n\nfunc (consumerGroupHandler) Setup(_ sarama.ConsumerGroupSession) error   { return nil }\nfunc (consumerGroupHandler) Cleanup(_ sarama.ConsumerGroupSession) error { return nil }\nfunc (h consumerGroupHandler) ConsumeClaim(sess sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n\tfor msg := range claim.Messages() {\n\t\tfmt.Printf(\"%s Message topic:%q partition:%d offset:%d  value:%s\\n\",h.name, msg.Topic, msg.Partition, msg.Offset, string(msg.Value))\n\t\t// \n\t\tsess.MarkMessage(msg, \"\")\n\t}\n\treturn nil\n}\n\nfunc handleErrors(group *sarama.ConsumerGroup,wg  *sync.WaitGroup ){\n\twg.Done()\n\tfor err := range (*group).Errors() {\n\t\tfmt.Println(\"ERROR\", err)\n\t}\n}\n\nfunc consume(group *sarama.ConsumerGroup,wg  *sync.WaitGroup, name string) {\n\tfmt.Println(name + \"start\")\n\twg.Done()\n\tctx := context.Background()\n\tfor {\n\t\ttopics := []string{\"my_topic\"}\n\t\thandler := consumerGroupHandler{name: name}\n\t\terr := (*group).Consume(ctx, topics, handler)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\t}\n}\n\nfunc main(){\n\tvar wg sync.WaitGroup\n\tconfig := sarama.NewConfig()\n\tconfig.Consumer.Return.Errors = false\n\tconfig.Version = sarama.V0_10_2_0\n\tclient,err := sarama.NewClient([]string{\"localhost:9092\"}, config)\n\tdefer client.Close()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tgroup, err := sarama.NewConsumerGroupFromClient(\"c1\", client)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer group.Close()\n\twg.Add(3)\n\tgo consume(&group,&wg,\"c1\")\n\twg.Wait()\n\tsignals := make(chan os.Signal, 1)\n\tsignal.Notify(signals, os.Interrupt)\n\tselect {\n\tcase <-signals:\n\t}\n}\n```\n\n\t\t\n","slug":"go/go_kafka","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6ct0005f8wzakd609vx","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Kafka-API\"><a href=\"#Kafka-API\" class=\"headerlink\" title=\"Kafka API\"></a>Kafka API</h1><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><ul>\n<li><p><code>sarama</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/Shopify/sarama</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<ul>\n<li>Kafka  Producer ,main  Sender ,RecordAccumulator</li>\n<li>main  RecordAccumulator,Sender  RecordAccumulator  Kafka broker</li>\n</ul>\n</li>\n<li><p></p>\n</li>\n</ul>\n<p><code></code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os/signal&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\"></span><br><span class=\"line\">\tconfig.Producer.Return.Successes = <span class=\"literal\">true</span></span><br><span class=\"line\">\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner</span><br><span class=\"line\"></span><br><span class=\"line\">\tclient,err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tproducer, err := sarama.NewAsyncProducerFromClient(client)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Trap SIGINT to trigger a graceful shutdown.</span></span><br><span class=\"line\">\tsignals := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> os.Signal, <span class=\"number\">1</span>)</span><br><span class=\"line\">\tsignal.Notify(signals, os.Interrupt)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> (</span><br><span class=\"line\">\t\twg        sync.WaitGroup</span><br><span class=\"line\">\t\tenqueued, successes, errors <span class=\"type\">int</span></span><br><span class=\"line\">\t)</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// start a groutines to count successes num</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> wg.Done()</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> <span class=\"keyword\">range</span> producer.Successes() &#123;</span><br><span class=\"line\">\t\t\tsuccesses++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// start a groutines to count error num</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> wg.Done()</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> err := <span class=\"keyword\">range</span> producer.Errors() &#123;</span><br><span class=\"line\">\t\t\tlog.Println(err)</span><br><span class=\"line\">\t\t\terrors++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tmessage := &amp;sarama.ProducerMessage&#123;Topic: <span class=\"string\">&quot;my-topic&quot;</span>, Value: sarama.StringEncoder(<span class=\"string\">&quot;testing 123&quot;</span>)&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> producer.Input() &lt;- message:</span><br><span class=\"line\">\t\t\tenqueued++</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-signals:</span><br><span class=\"line\">\t\t\tproducer.AsyncClose() <span class=\"comment\">// Trigger a shutdown of the producer.</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span> </span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\"></span><br><span class=\"line\">\tlog.Printf(<span class=\"string\">&quot;Successfully produced: %d; errors: %d\\n&quot;</span>, successes, errors)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p><code> </code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Kafka</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\">\tconfig.Producer.RequiredAcks = sarama.WaitForAll          <span class=\"comment\">// leaderfollow</span></span><br><span class=\"line\">\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner <span class=\"comment\">// partition</span></span><br><span class=\"line\">\tconfig.Producer.Return.Successes = <span class=\"literal\">true</span>                   <span class=\"comment\">// success channel</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tmsg := &amp;sarama.ProducerMessage&#123;&#125;</span><br><span class=\"line\">\tmsg.Topic = <span class=\"string\">&quot;web_log&quot;</span></span><br><span class=\"line\">\tmsg.Value = sarama.StringEncoder(<span class=\"string\">&quot;this is a test log&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// kafka</span></span><br><span class=\"line\">\tclient, err := sarama.NewSyncProducer([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;127.0.0.1:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;producer closed, err:&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tpid, offset, err := client.SendMessage(msg)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;send msg failed, err:&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;pid:%v offset:%v\\n&quot;</span>, pid, offset)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><ul>\n<li></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// kafka</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os/signal&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\">\tconfig.Consumer.Return.Errors = <span class=\"literal\">true</span></span><br><span class=\"line\">\tclient,err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tconsumer, err := sarama.NewConsumerFromClient(client)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> consumer.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// get partitionId list</span></span><br><span class=\"line\">\tpartitions,err := consumer.Partitions(<span class=\"string\">&quot;my-topic&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, partitionId := <span class=\"keyword\">range</span> partitions&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// create partitionConsumer for every partitionId</span></span><br><span class=\"line\">\t\tpartitionConsumer, err := consumer.ConsumePartition(<span class=\"string\">&quot;my-topic&quot;</span>, partitionId, sarama.OffsetNewest)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(pc *sarama.PartitionConsumer)</span></span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">defer</span> (*pc).Close()</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// block</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> message := <span class=\"keyword\">range</span> (*pc).Messages()&#123;</span><br><span class=\"line\">\t\t\t\tvalue := <span class=\"type\">string</span>(message.Value)</span><br><span class=\"line\">\t\t\t\tlog.Printf(<span class=\"string\">&quot;Partitionid: %d; offset:%d, value: %s\\n&quot;</span>, message.Partition,message.Offset, value)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;(&amp;partitionConsumer)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tsignals := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> os.Signal, <span class=\"number\">1</span>)</span><br><span class=\"line\">\tsignal.Notify(signals, os.Interrupt)</span><br><span class=\"line\">\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> &lt;-signals:</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os/signal&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">type</span> consumerGroupHandler <span class=\"keyword\">struct</span>&#123;</span><br><span class=\"line\">\tname <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(consumerGroupHandler)</span></span> Setup(_ sarama.ConsumerGroupSession) <span class=\"type\">error</span>   &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(consumerGroupHandler)</span></span> Cleanup(_ sarama.ConsumerGroupSession) <span class=\"type\">error</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h consumerGroupHandler)</span></span> ConsumeClaim(sess sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> msg := <span class=\"keyword\">range</span> claim.Messages() &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;%s Message topic:%q partition:%d offset:%d  value:%s\\n&quot;</span>,h.name, msg.Topic, msg.Partition, msg.Offset, <span class=\"type\">string</span>(msg.Value))</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tsess.MarkMessage(msg, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">handleErrors</span><span class=\"params\">(group *sarama.ConsumerGroup,wg  *sync.WaitGroup )</span></span>&#123;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> err := <span class=\"keyword\">range</span> (*group).Errors() &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;ERROR&quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">consume</span><span class=\"params\">(group *sarama.ConsumerGroup,wg  *sync.WaitGroup, name <span class=\"type\">string</span>)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(name + <span class=\"string\">&quot;start&quot;</span>)</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">\tctx := context.Background()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\ttopics := []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;my_topic&quot;</span>&#125;</span><br><span class=\"line\">\t\thandler := consumerGroupHandler&#123;name: name&#125;</span><br><span class=\"line\">\t\terr := (*group).Consume(ctx, topics, handler)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\">\tconfig.Consumer.Return.Errors = <span class=\"literal\">false</span></span><br><span class=\"line\">\tconfig.Version = sarama.V0_10_2_0</span><br><span class=\"line\">\tclient,err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tgroup, err := sarama.NewConsumerGroupFromClient(<span class=\"string\">&quot;c1&quot;</span>, client)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> group.Close()</span><br><span class=\"line\">\twg.Add(<span class=\"number\">3</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> consume(&amp;group,&amp;wg,<span class=\"string\">&quot;c1&quot;</span>)</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">\tsignals := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> os.Signal, <span class=\"number\">1</span>)</span><br><span class=\"line\">\tsignal.Notify(signals, os.Interrupt)</span><br><span class=\"line\">\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> &lt;-signals:</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Kafka-API\"><a href=\"#Kafka-API\" class=\"headerlink\" title=\"Kafka API\"></a>Kafka API</h1><h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><ul>\n<li><p><code>sarama</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/Shopify/sarama</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<ul>\n<li>Kafka  Producer ,main  Sender ,RecordAccumulator</li>\n<li>main  RecordAccumulator,Sender  RecordAccumulator  Kafka broker</li>\n</ul>\n</li>\n<li><p></p>\n</li>\n</ul>\n<p><code></code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os/signal&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\"></span><br><span class=\"line\">\tconfig.Producer.Return.Successes = <span class=\"literal\">true</span></span><br><span class=\"line\">\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner</span><br><span class=\"line\"></span><br><span class=\"line\">\tclient,err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tproducer, err := sarama.NewAsyncProducerFromClient(client)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Trap SIGINT to trigger a graceful shutdown.</span></span><br><span class=\"line\">\tsignals := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> os.Signal, <span class=\"number\">1</span>)</span><br><span class=\"line\">\tsignal.Notify(signals, os.Interrupt)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> (</span><br><span class=\"line\">\t\twg        sync.WaitGroup</span><br><span class=\"line\">\t\tenqueued, successes, errors <span class=\"type\">int</span></span><br><span class=\"line\">\t)</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// start a groutines to count successes num</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> wg.Done()</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> <span class=\"keyword\">range</span> producer.Successes() &#123;</span><br><span class=\"line\">\t\t\tsuccesses++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Add(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// start a groutines to count error num</span></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> wg.Done()</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> err := <span class=\"keyword\">range</span> producer.Errors() &#123;</span><br><span class=\"line\">\t\t\tlog.Println(err)</span><br><span class=\"line\">\t\t\terrors++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tmessage := &amp;sarama.ProducerMessage&#123;Topic: <span class=\"string\">&quot;my-topic&quot;</span>, Value: sarama.StringEncoder(<span class=\"string\">&quot;testing 123&quot;</span>)&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> producer.Input() &lt;- message:</span><br><span class=\"line\">\t\t\tenqueued++</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-signals:</span><br><span class=\"line\">\t\t\tproducer.AsyncClose() <span class=\"comment\">// Trigger a shutdown of the producer.</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span> </span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\"></span><br><span class=\"line\">\tlog.Printf(<span class=\"string\">&quot;Successfully produced: %d; errors: %d\\n&quot;</span>, successes, errors)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p><code> </code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Kafka</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\">\tconfig.Producer.RequiredAcks = sarama.WaitForAll          <span class=\"comment\">// leaderfollow</span></span><br><span class=\"line\">\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner <span class=\"comment\">// partition</span></span><br><span class=\"line\">\tconfig.Producer.Return.Successes = <span class=\"literal\">true</span>                   <span class=\"comment\">// success channel</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tmsg := &amp;sarama.ProducerMessage&#123;&#125;</span><br><span class=\"line\">\tmsg.Topic = <span class=\"string\">&quot;web_log&quot;</span></span><br><span class=\"line\">\tmsg.Value = sarama.StringEncoder(<span class=\"string\">&quot;this is a test log&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// kafka</span></span><br><span class=\"line\">\tclient, err := sarama.NewSyncProducer([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;127.0.0.1:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;producer closed, err:&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tpid, offset, err := client.SendMessage(msg)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;send msg failed, err:&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;pid:%v offset:%v\\n&quot;</span>, pid, offset)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"API\"><a href=\"#API\" class=\"headerlink\" title=\"API\"></a>API</h2><ul>\n<li></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// kafka</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os/signal&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\">\tconfig.Consumer.Return.Errors = <span class=\"literal\">true</span></span><br><span class=\"line\">\tclient,err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tconsumer, err := sarama.NewConsumerFromClient(client)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> consumer.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// get partitionId list</span></span><br><span class=\"line\">\tpartitions,err := consumer.Partitions(<span class=\"string\">&quot;my-topic&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, partitionId := <span class=\"keyword\">range</span> partitions&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// create partitionConsumer for every partitionId</span></span><br><span class=\"line\">\t\tpartitionConsumer, err := consumer.ConsumePartition(<span class=\"string\">&quot;my-topic&quot;</span>, partitionId, sarama.OffsetNewest)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(pc *sarama.PartitionConsumer)</span></span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">defer</span> (*pc).Close()</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// block</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> message := <span class=\"keyword\">range</span> (*pc).Messages()&#123;</span><br><span class=\"line\">\t\t\t\tvalue := <span class=\"type\">string</span>(message.Value)</span><br><span class=\"line\">\t\t\t\tlog.Printf(<span class=\"string\">&quot;Partitionid: %d; offset:%d, value: %s\\n&quot;</span>, message.Partition,message.Offset, value)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;(&amp;partitionConsumer)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tsignals := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> os.Signal, <span class=\"number\">1</span>)</span><br><span class=\"line\">\tsignal.Notify(signals, os.Interrupt)</span><br><span class=\"line\">\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> &lt;-signals:</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/Shopify/sarama&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os/signal&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">type</span> consumerGroupHandler <span class=\"keyword\">struct</span>&#123;</span><br><span class=\"line\">\tname <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(consumerGroupHandler)</span></span> Setup(_ sarama.ConsumerGroupSession) <span class=\"type\">error</span>   &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(consumerGroupHandler)</span></span> Cleanup(_ sarama.ConsumerGroupSession) <span class=\"type\">error</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(h consumerGroupHandler)</span></span> ConsumeClaim(sess sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> msg := <span class=\"keyword\">range</span> claim.Messages() &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;%s Message topic:%q partition:%d offset:%d  value:%s\\n&quot;</span>,h.name, msg.Topic, msg.Partition, msg.Offset, <span class=\"type\">string</span>(msg.Value))</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\">\t\tsess.MarkMessage(msg, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">handleErrors</span><span class=\"params\">(group *sarama.ConsumerGroup,wg  *sync.WaitGroup )</span></span>&#123;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> err := <span class=\"keyword\">range</span> (*group).Errors() &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;ERROR&quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">consume</span><span class=\"params\">(group *sarama.ConsumerGroup,wg  *sync.WaitGroup, name <span class=\"type\">string</span>)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(name + <span class=\"string\">&quot;start&quot;</span>)</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">\tctx := context.Background()</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\ttopics := []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;my_topic&quot;</span>&#125;</span><br><span class=\"line\">\t\thandler := consumerGroupHandler&#123;name: name&#125;</span><br><span class=\"line\">\t\terr := (*group).Consume(ctx, topics, handler)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\tconfig := sarama.NewConfig()</span><br><span class=\"line\">\tconfig.Consumer.Return.Errors = <span class=\"literal\">false</span></span><br><span class=\"line\">\tconfig.Version = sarama.V0_10_2_0</span><br><span class=\"line\">\tclient,err := sarama.NewClient([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:9092&quot;</span>&#125;, config)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> client.Close()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tgroup, err := sarama.NewConsumerGroupFromClient(<span class=\"string\">&quot;c1&quot;</span>, client)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> group.Close()</span><br><span class=\"line\">\twg.Add(<span class=\"number\">3</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> consume(&amp;group,&amp;wg,<span class=\"string\">&quot;c1&quot;</span>)</span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">\tsignals := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> os.Signal, <span class=\"number\">1</span>)</span><br><span class=\"line\">\tsignal.Notify(signals, os.Interrupt)</span><br><span class=\"line\">\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> &lt;-signals:</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"-go_live","_content":"## go_live\n\n*  \n\t- [go_livertmp](https://zhuanlan.zhihu.com/p/447683475)\n\t- [rtmp]()\n\n","source":"_posts/go/go_live.md","raw":"---\ntitle: -go_live \ncategories: \n- GolangStudy\n---\n## go_live\n\n*  \n\t- [go_livertmp](https://zhuanlan.zhihu.com/p/447683475)\n\t- [rtmp]()\n\n","slug":"go/go_live","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6cu0006f8wzf1peaaq7","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"go-live\"><a href=\"#go-live\" class=\"headerlink\" title=\"go_live\"></a>go_live</h2><ul>\n<li> <ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/447683475\">go_livertmp</a></li>\n<li><a href=\"\">rtmp</a></li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"go-live\"><a href=\"#go-live\" class=\"headerlink\" title=\"go_live\"></a>go_live</h2><ul>\n<li> <ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/447683475\">go_livertmp</a></li>\n<li><a href=\"\">rtmp</a></li>\n</ul>\n</li>\n</ul>\n"},{"title":"im-goim","_content":"\n## goim\n\n![](../img/arch.png)\n\n## \n\n* `kafka`\n\t- `zookeeper`\n\t\t``` bash\n\t\tsudo bin/zookeeper-server-start.sh  config/zookeeper.properties\n\n\t\t# zookeeper\n\t\tsudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties\n\t\t```\n\t- `kafka`\n\t\t``` bash\n\t\tsudo bin/kafka-server-start.sh config/server.properties\n\n\t\t# kafka\n\t\tsudo bin/kafka-server-start.sh -daemon config/server.properties\n\t\t```\n\n* goim\n\t``` bash\n\tgit clone https://github.com/Terry-Mao/goim\n\tcd goim \n\tmake build\n\t# make build target\n\t```\n\n* `discovery`\n\t``` bash\n\tgit clone https://github.com/bilibili/discovery.git\n\tcd discovery\n\t# make build Makefile cmd/discovery/discovery-example.tomlcmd/discovery/discovery.toml\n\tmake build\n\t```\n\n* `discovery`\n\t``` bash\n\tcd discovery\n\t./dist/bin/discovery -conf ./dist/conf/discovery.toml\n\t```\n\n* `comet`\n\t``` bash\n\t# \n\texport REGION=sh\n    export ZONE=sh001\n    export DEPLOY_ENV=dev\n\n\t# \n\ttarget/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 \n\n\t# \n\tnohup target/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 -debug=true 2>&1 > target/comet.log &\n\t```\n\n* `logic`\n\t``` bash\n\t# \n\ttarget/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10\n\n\t# \n\tnohup target/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 2>&1 > target/logic.log &\n\t```\n\n* `job`\n\t``` bash\n\t# \n\ttarget/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev\n\n\t# \n\tnohup target/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev 2>&1 > target/job.log &\n\t```\n\n* `logic``comet`,`job`\n\t``` bash\n\tmake run\n\t```\n\n","source":"_posts/go/go_im.md","raw":"---\ntitle: im-goim \ncategories: \n- GolangStudy\n---\n\n## goim\n\n![](../img/arch.png)\n\n## \n\n* `kafka`\n\t- `zookeeper`\n\t\t``` bash\n\t\tsudo bin/zookeeper-server-start.sh  config/zookeeper.properties\n\n\t\t# zookeeper\n\t\tsudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties\n\t\t```\n\t- `kafka`\n\t\t``` bash\n\t\tsudo bin/kafka-server-start.sh config/server.properties\n\n\t\t# kafka\n\t\tsudo bin/kafka-server-start.sh -daemon config/server.properties\n\t\t```\n\n* goim\n\t``` bash\n\tgit clone https://github.com/Terry-Mao/goim\n\tcd goim \n\tmake build\n\t# make build target\n\t```\n\n* `discovery`\n\t``` bash\n\tgit clone https://github.com/bilibili/discovery.git\n\tcd discovery\n\t# make build Makefile cmd/discovery/discovery-example.tomlcmd/discovery/discovery.toml\n\tmake build\n\t```\n\n* `discovery`\n\t``` bash\n\tcd discovery\n\t./dist/bin/discovery -conf ./dist/conf/discovery.toml\n\t```\n\n* `comet`\n\t``` bash\n\t# \n\texport REGION=sh\n    export ZONE=sh001\n    export DEPLOY_ENV=dev\n\n\t# \n\ttarget/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 \n\n\t# \n\tnohup target/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 -debug=true 2>&1 > target/comet.log &\n\t```\n\n* `logic`\n\t``` bash\n\t# \n\ttarget/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10\n\n\t# \n\tnohup target/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 2>&1 > target/logic.log &\n\t```\n\n* `job`\n\t``` bash\n\t# \n\ttarget/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev\n\n\t# \n\tnohup target/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev 2>&1 > target/job.log &\n\t```\n\n* `logic``comet`,`job`\n\t``` bash\n\tmake run\n\t```\n\n","slug":"go/go_im","published":1,"date":"2022-07-08T02:16:25.023Z","updated":"2022-07-08T02:16:25.023Z","_id":"cl3tkt6cw0007f8wz1p7406ey","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"goim\"><a href=\"#goim\" class=\"headerlink\" title=\"goim\"></a>goim</h2><p><img src=\"../img/arch.png\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p><code>kafka</code></p>\n<ul>\n<li><code>zookeeper</code>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/zookeeper-server-start.sh  config/zookeeper.properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># zookeeper</span></span><br><span class=\"line\">sudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties</span><br></pre></td></tr></table></figure></li>\n<li><code>kafka</code>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/kafka-server-start.sh config/server.properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kafka</span></span><br><span class=\"line\">sudo bin/kafka-server-start.sh -daemon config/server.properties</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>goim</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/Terry-Mao/goim</span><br><span class=\"line\"><span class=\"built_in\">cd</span> goim </span><br><span class=\"line\">make build</span><br><span class=\"line\"><span class=\"comment\"># make build target</span></span><br></pre></td></tr></table></figure></li>\n<li><p><code>discovery</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/bilibili/discovery.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> discovery</span><br><span class=\"line\"><span class=\"comment\"># make build Makefile cmd/discovery/discovery-example.tomlcmd/discovery/discovery.toml</span></span><br><span class=\"line\">make build</span><br></pre></td></tr></table></figure></li>\n<li><p><code>discovery</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> discovery</span><br><span class=\"line\">./dist/bin/discovery -conf ./dist/conf/discovery.toml</span><br></pre></td></tr></table></figure></li>\n<li><p><code>comet</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> REGION=sh</span><br><span class=\"line\">   <span class=\"built_in\">export</span> ZONE=sh001</span><br><span class=\"line\">   <span class=\"built_in\">export</span> DEPLOY_ENV=dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">target/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> target/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 -debug=<span class=\"literal\">true</span> 2&gt;&amp;1 &gt; target/comet.log &amp;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>logic</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">target/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> target/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 2&gt;&amp;1 &gt; target/logic.log &amp;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>job</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">target/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> target/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev 2&gt;&amp;1 &gt; target/job.log &amp;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>logic</code><code>comet</code>,<code>job</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make run</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"goim\"><a href=\"#goim\" class=\"headerlink\" title=\"goim\"></a>goim</h2><p><img src=\"../img/arch.png\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p><code>kafka</code></p>\n<ul>\n<li><code>zookeeper</code>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/zookeeper-server-start.sh  config/zookeeper.properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># zookeeper</span></span><br><span class=\"line\">sudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties</span><br></pre></td></tr></table></figure></li>\n<li><code>kafka</code>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/kafka-server-start.sh config/server.properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kafka</span></span><br><span class=\"line\">sudo bin/kafka-server-start.sh -daemon config/server.properties</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>goim</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/Terry-Mao/goim</span><br><span class=\"line\"><span class=\"built_in\">cd</span> goim </span><br><span class=\"line\">make build</span><br><span class=\"line\"><span class=\"comment\"># make build target</span></span><br></pre></td></tr></table></figure></li>\n<li><p><code>discovery</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/bilibili/discovery.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> discovery</span><br><span class=\"line\"><span class=\"comment\"># make build Makefile cmd/discovery/discovery-example.tomlcmd/discovery/discovery.toml</span></span><br><span class=\"line\">make build</span><br></pre></td></tr></table></figure></li>\n<li><p><code>discovery</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> discovery</span><br><span class=\"line\">./dist/bin/discovery -conf ./dist/conf/discovery.toml</span><br></pre></td></tr></table></figure></li>\n<li><p><code>comet</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> REGION=sh</span><br><span class=\"line\">   <span class=\"built_in\">export</span> ZONE=sh001</span><br><span class=\"line\">   <span class=\"built_in\">export</span> DEPLOY_ENV=dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">target/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> target/comet -conf=target/comet.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 -addrs=127.0.0.1 -debug=<span class=\"literal\">true</span> 2&gt;&amp;1 &gt; target/comet.log &amp;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>logic</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">target/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> target/logic -conf=target/logic.toml -region=sh -zone=sh001 -deploy.env=dev -weight=10 2&gt;&amp;1 &gt; target/logic.log &amp;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>job</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">target/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> target/job -conf=target/job.toml -region=sh -zone=sh001 -deploy.env=dev 2&gt;&amp;1 &gt; target/job.log &amp;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>logic</code><code>comet</code>,<code>job</code></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make run</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"Golang redis","_content":"\n## `go-redis`\n\n``` bash\ngo get github.com/go-redis/redis/v8\n```\n\n## redis\n\n\n\n","source":"_posts/go/go_redis.md","raw":"---\ntitle: Golang redis \ncategories: \n- GolangStudy\n---\n\n## `go-redis`\n\n``` bash\ngo get github.com/go-redis/redis/v8\n```\n\n## redis\n\n\n\n","slug":"go/go_redis","published":1,"date":"2022-07-03T02:30:48.106Z","updated":"2022-07-03T02:30:48.106Z","_id":"cl3tkt6cy0008f8wz0t3ihje3","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"go-redis\"><a href=\"#go-redis\" class=\"headerlink\" title=\"go-redis\"></a><code>go-redis</code></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get github.com/go-redis/redis/v8</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"redis\"><a href=\"#redis\" class=\"headerlink\" title=\"redis\"></a>redis</h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"go-redis\"><a href=\"#go-redis\" class=\"headerlink\" title=\"go-redis\"></a><code>go-redis</code></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get github.com/go-redis/redis/v8</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"redis\"><a href=\"#redis\" class=\"headerlink\" title=\"redis\"></a>redis</h2>"},{"title":"Golang rpc","_content":"\n## \n\n* : `zookeeper``eureka``consul``etcd`  \n\n* : v\n\n* : pullpush\n\n## rpcx\n\n* [rpcx](https://doc.rpcx.io/)\n\n* `rpcx`\n\n``` bash\ngo get -u -v -tags \"reuseport quic kcp zookeeper etcd consul ping\" github.com/smallnest/rpcx/...\n```\n\n`:`\n\n`server/server.go`\n\n``` go\npackage main\n\nimport (\n\t\"flag\"\n\t\"github.com/smallnest/rpcx/server\"\n\t\"github.com/smallnest/rpcx/serverplugin\"\n\t\"log\"\n\t\"time\"\n)\n\nvar (\n\taddr      = flag.String(\"addr\", \"localhost:8972\", \"server address\")\n\tetcdServers = []string{\"127.0.0.1:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main() {\n\tflag.Parse()\n\n\t//1newstruct\n\ts := server.NewServer()\n\t//2zookeeper\n\taddRegistryPlugin(s)\n\t//3\n\ts.RegisterName(\"Arith\", new(Arith), \"\")\n\t//4\n\ts.Serve(\"tcp\", *addr)\n}\n\nfunc addRegistryPlugin(s *server.Server) {\n\tr := &serverplugin.EtcdV3RegisterPlugin{\n\t\tServiceAddress: \"tcp@\" + *addr,\n\t\tEtcdServers:   etcdServers,\n\t\tBasePath:       basePath,\n\t\tUpdateInterval: time.Minute,\n\t}\n\terr := r.Start()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\ts.Plugins.Add(r)\n}\n```\n\n`server/rpc.go`\n\n``` go\npackage main \n\n// \ntype Arith int\n\nfunc (t *Arith) Mul(cxt context.Context, args *Args, reply *int) error {\n  fmt.Println(\"Mul on\", *addr)\n  *reply = args.A * args.B\n  return nil\n}\n\nfunc (t *Arith) Div(cxt context.Context, args *Args, quo *Quotient) error {\n  fmt.Println(\"Div on\", *addr)\n  if args.B == 0 {\n    return errors.New(\"divide by 0\")\n  }\n\n  quo.Quo = args.A / args.B\n  quo.Rem = args.A % args.B\n  return nil\n}\n```\n\n`proto/proto.go`\n\n``` go\npackage proto\n\ntype Args struct {\n\tA, B int\n}\n\ntype Quotient struct {\n\tQuo, Rem int\n}\n\n```\n\n* server\n* \n* \n* \n\n\n``\n\n`client.go`\n\n``` go\npackage main\n\nimport (\n\t\"github.com/smallnest/rpcx/client\"\n\t\"context\"\n\t\"flag\"\n\t\"log\"\n\t\"time\"\n\n\t\"exercise/rpcx_test/proto\"\n)\nvar (\n\tetcdServers = []string{\"localhost:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main()  {\n\tflag.Parse()\n\n\t//1ZookeeperDiscovery\n\td := client.NewEtcdV3Discovery(basePath,\"Arith\", etcdServers, nil)\n\t//2\n\txclient := client.NewXClient(\"Arith\", client.Failtry, client.RandomSelect, d, client.DefaultOption)\n\n\tdefer xclient.Close()\n\n\targs := &proto.Args{\n\t\tA: 25,\n\t\tB: 4,\n\t}\n\n\tquo := &proto.Quotient{}\n\n\tfor {\n\t\treply := new(int)\n\n\t\terr := xclient.Call(context.Background(), \"Mul\", args, reply)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\n\t\tlog.Printf(\"%d * %d = %d\", args.A, args.B, *reply)\n\n\t\terr = xclient.Call(context.Background(), \"Div\", args, quo)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\t\tlog.Printf(\"%d / %d = %d, %d\", args.A, args.B, quo.Quo, quo.Rem)\n\t\ttime.Sleep(3*time.Second)\n\t}\n}\n\n```\n\n* \n\n\n\t- \n\t- \n\n* \n* \n\n\n## protobuf\n\n* protobuf\n``` bash\n# protobuf\ngit clone https://github.com/protocolbuffers/protobuf.git\n# \nsudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y\n# \ncd protobuf/\n# configure\n./autogen.sh\n# \n./configure\n# ()\nmake\n# \nsudo make install\n#  \nsudo ldconfig\n# \nprotoc -h\n```\n\n* go \n``` bash\ngo get -u github.com/golang/protobuf/protoc-gen-go\ngo get -u google.golang.org/protobuf/proto\n```\n\n## protobuf\n\n* .proto\n\n\t`pb/Person.proto: `\n\n\t``` protobuf\n\tsyntax = \"proto3\";\n\tpackage pb;\n\n\timport \"google/protobuf/timestamp.proto\";\n\n\toption go_package = \"./;pb\";\n\n\tmessage Person {\n\t\tstring name = 1;\n\t\tint32 id = 2;  // Unique ID number for this person.\n\t\tstring email = 3;\n\n\t\tenum PhoneType {\n\t\t  MOBILE = 0;\n\t\t  HOME = 1;\n\t\t  WORK = 2;\n\t\t}\n\n\t\tmessage PhoneNumber {\n\t\t  string number = 1;\n\t\t  PhoneType type = 2;\n\t\t}\n\n\t\trepeated PhoneNumber phones = 4;\n\n\t\tgoogle.protobuf.Timestamp last_updated = 5;\n\t  }\n\n\t  // Our address book file is just one of these.\n\t  message AddressBook {\n\t\trepeated Person people = 1;\n\t}\n\t```\n\n* .proto\n``` bash\nprotoc *.proto --go_out=.\n```\n\n* \n\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"fmt\"\n\t\t\"zinx/myDemo/protobufDemo/pb\"\n\n\t\t\"google.golang.org/protobuf/proto\"\n\t)\n\n\tfunc main() {\n\t\t// Person\n\t\tperson := &pb.Person{\n\t\t\tName:  \"lijiahao\",\n\t\t\tId:    0,\n\t\t\tEmail: \"18702748294@163.com\",\n\t\t\tPhones: []*pb.Person_PhoneNumber{\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"15136588270\",\n\t\t\t\t\tType: pb.Person_MOBILE,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"190019393\",\n\t\t\t\t\tType: pb.Person_HOME,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"17182920303\",\n\t\t\t\t\tType: pb.Person_WORK,\n\t\t\t\t},\n\t\t\t},\n\t\t}\n\n\t\t// Person\n\t\tdata, err := proto.Marshal(person)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"proto marshal error: \", err)\n\t\t}\n\n\t\t// \n\t\tnewData := &pb.Person{}\n\t\terr = proto.Unmarshal(data, newData)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"unmarshal error: \", err)\n\t\t}\n\t\tfmt.Println(newData)\n\t}\n\t```\n\n## grpc \n\n* grpc go\n```\ngo get -u -v google.golang.org/grpc\n```\n\n* .proto\n\n\t`pb/hello_grpc.proto`\n\n\t``` protobuf\n\t// protobuf\n\tsyntax = \"proto3\";\n\n\tpackage pb;\n\n\toption go_package = \"./;hello_grpc\";\n\n\t// \n\tservice Greeter {\n\t  rpc SayHello (HelloRequest) returns (HelloReply) {}\n\t}\n\n\tmessage HelloRequest {\n\t  string name = 1;\n\t}\n\n\tmessage HelloReply {\n\t  string message = 1;\n\t}\n\t```\n\n* .proto\n\t- go\n\t\t``` bash\n\t\tgo get -u github.com/golang/protobuf/protoc-gen-go\n\t\t```\n\t- .proto\n\t\t``` bash\n\t\tprotoc -I pb/ pb/*.proto --go_out=plugins=grpc:service\n\t\t* -I protoproto\n\t\t* --go_out=plugins=grpc:go\n\t\t```\n\n\n* \n\t`server/server.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"fmt\"\n\t\t\"hello_grpc/service\"\n\t\t\"google.golang.org/grpc\"\n\t\t\"google.golang.org/grpc/reflection\"\n\t\t\"net\"\n\t)\n\n\ttype server struct {}\n\n\t// \n\tfunc (s *server) SayHello(ctx context.Context, in *service.HelloRequest) (*service.HelloReply, error) {\n\t\treturn &service.HelloReply{Message: \"hello \" + in.Name}, nil\n\t}\n\n\tfunc main() {\n\t\t// \n\t\tlis, err := net.Listen(\"tcp\", \":8080\")\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\t// gRPC\n\t\ts := grpc.NewServer()\n\n\t\t// \n\t\tservice.RegisterGreeterServer(s, &server{})\n\n\t\treflection.Register(s)\n\n\t\t// \n\t\terr = s.Serve(lis)\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t}\n\t```\n\n* \n\t`client/client.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"fmt\"\n\t\t\"hello_grpc/service\"\n\t\t\"google.golang.org/grpc\"\n\t)\n\n\tfunc main(){\n\t\t// \n\t\tconn, err := grpc.Dial(\":8080\", grpc.WithInsecure())\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t\tdefer conn.Close()\n\n\t\t// \n\t\tc := service.NewGreeterClient(conn)\n\n\t\t// \n\t\tr, err := c.SayHello(context.Background(), &service.HelloRequest{Name: \"horika\"})\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\tfmt.Printf(\": %s\", r.Message)\n\t}\n\n\t```\n\n## RPC\n* \n\t- Rpc()\n\t``` go\n\trpc.RegisterName(\"\", )\n\t```\n\n\t- \n\t``` go\n\tlistener, err := net.Listen()\n\t```\n\n\t- \n\t``` go\n\tconn, err := listener.Accept()\n\t```\n\n\t- Rpc\n\t``` go\n\trpc.ServeConn(conn)\n\t```\n\n* \n\t- Rpc\n\t``` go\n\tconn, err := rpc.Dial()\n\t```\n\n\t- \n\t``` go\n\tconn.Call(\".\", , )\n\t```\n\n* \n\t``` go\n\tpackage design\n\n\timport (\n\t\t\"net/rpc\"\n\t\t\"net/rpc/jsonrpc\"\n\t)\n\n\t// \n\t/*\n\t\t* \n\t\t* \n\t*/\n\ttype MyInterface interface {\n\t\tHelloWorld(string, *string) error\n\t}\n\n\tfunc RegisterService(i MyInterface) error {\n\t\treturn rpc.RegisterName(\"hello\", i)\n\t}\n\n\t// \n\t/*\n\t\t* \n\t\t* ( rpc.Client) \n\t\t* InitClient\n\t*/\n\ttype MyClient struct {\n\t\tc *rpc.Client\n\t}\n\n\tfunc InitClient(addr string) *MyClient {\n\t\tconn, _ := jsonrpc.Dial(\"tcp\", addr)\n\n\t\treturn &MyClient{c:conn}\n\t}\n\n\tfunc (m *MyClient)HelloWorld(a string, b *string) error {\n\t\treturn m.c.Call(\"hello.HelloWorld\", a, b)\n\t}\n\t```\n\n","source":"_posts/go/go_rpc.md","raw":"---\ntitle: Golang rpc \ncategories: \n- GolangStudy\n---\n\n## \n\n* : `zookeeper``eureka``consul``etcd`  \n\n* : v\n\n* : pullpush\n\n## rpcx\n\n* [rpcx](https://doc.rpcx.io/)\n\n* `rpcx`\n\n``` bash\ngo get -u -v -tags \"reuseport quic kcp zookeeper etcd consul ping\" github.com/smallnest/rpcx/...\n```\n\n`:`\n\n`server/server.go`\n\n``` go\npackage main\n\nimport (\n\t\"flag\"\n\t\"github.com/smallnest/rpcx/server\"\n\t\"github.com/smallnest/rpcx/serverplugin\"\n\t\"log\"\n\t\"time\"\n)\n\nvar (\n\taddr      = flag.String(\"addr\", \"localhost:8972\", \"server address\")\n\tetcdServers = []string{\"127.0.0.1:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main() {\n\tflag.Parse()\n\n\t//1newstruct\n\ts := server.NewServer()\n\t//2zookeeper\n\taddRegistryPlugin(s)\n\t//3\n\ts.RegisterName(\"Arith\", new(Arith), \"\")\n\t//4\n\ts.Serve(\"tcp\", *addr)\n}\n\nfunc addRegistryPlugin(s *server.Server) {\n\tr := &serverplugin.EtcdV3RegisterPlugin{\n\t\tServiceAddress: \"tcp@\" + *addr,\n\t\tEtcdServers:   etcdServers,\n\t\tBasePath:       basePath,\n\t\tUpdateInterval: time.Minute,\n\t}\n\terr := r.Start()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\ts.Plugins.Add(r)\n}\n```\n\n`server/rpc.go`\n\n``` go\npackage main \n\n// \ntype Arith int\n\nfunc (t *Arith) Mul(cxt context.Context, args *Args, reply *int) error {\n  fmt.Println(\"Mul on\", *addr)\n  *reply = args.A * args.B\n  return nil\n}\n\nfunc (t *Arith) Div(cxt context.Context, args *Args, quo *Quotient) error {\n  fmt.Println(\"Div on\", *addr)\n  if args.B == 0 {\n    return errors.New(\"divide by 0\")\n  }\n\n  quo.Quo = args.A / args.B\n  quo.Rem = args.A % args.B\n  return nil\n}\n```\n\n`proto/proto.go`\n\n``` go\npackage proto\n\ntype Args struct {\n\tA, B int\n}\n\ntype Quotient struct {\n\tQuo, Rem int\n}\n\n```\n\n* server\n* \n* \n* \n\n\n``\n\n`client.go`\n\n``` go\npackage main\n\nimport (\n\t\"github.com/smallnest/rpcx/client\"\n\t\"context\"\n\t\"flag\"\n\t\"log\"\n\t\"time\"\n\n\t\"exercise/rpcx_test/proto\"\n)\nvar (\n\tetcdServers = []string{\"localhost:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main()  {\n\tflag.Parse()\n\n\t//1ZookeeperDiscovery\n\td := client.NewEtcdV3Discovery(basePath,\"Arith\", etcdServers, nil)\n\t//2\n\txclient := client.NewXClient(\"Arith\", client.Failtry, client.RandomSelect, d, client.DefaultOption)\n\n\tdefer xclient.Close()\n\n\targs := &proto.Args{\n\t\tA: 25,\n\t\tB: 4,\n\t}\n\n\tquo := &proto.Quotient{}\n\n\tfor {\n\t\treply := new(int)\n\n\t\terr := xclient.Call(context.Background(), \"Mul\", args, reply)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\n\t\tlog.Printf(\"%d * %d = %d\", args.A, args.B, *reply)\n\n\t\terr = xclient.Call(context.Background(), \"Div\", args, quo)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\t\tlog.Printf(\"%d / %d = %d, %d\", args.A, args.B, quo.Quo, quo.Rem)\n\t\ttime.Sleep(3*time.Second)\n\t}\n}\n\n```\n\n* \n\n\n\t- \n\t- \n\n* \n* \n\n\n## protobuf\n\n* protobuf\n``` bash\n# protobuf\ngit clone https://github.com/protocolbuffers/protobuf.git\n# \nsudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y\n# \ncd protobuf/\n# configure\n./autogen.sh\n# \n./configure\n# ()\nmake\n# \nsudo make install\n#  \nsudo ldconfig\n# \nprotoc -h\n```\n\n* go \n``` bash\ngo get -u github.com/golang/protobuf/protoc-gen-go\ngo get -u google.golang.org/protobuf/proto\n```\n\n## protobuf\n\n* .proto\n\n\t`pb/Person.proto: `\n\n\t``` protobuf\n\tsyntax = \"proto3\";\n\tpackage pb;\n\n\timport \"google/protobuf/timestamp.proto\";\n\n\toption go_package = \"./;pb\";\n\n\tmessage Person {\n\t\tstring name = 1;\n\t\tint32 id = 2;  // Unique ID number for this person.\n\t\tstring email = 3;\n\n\t\tenum PhoneType {\n\t\t  MOBILE = 0;\n\t\t  HOME = 1;\n\t\t  WORK = 2;\n\t\t}\n\n\t\tmessage PhoneNumber {\n\t\t  string number = 1;\n\t\t  PhoneType type = 2;\n\t\t}\n\n\t\trepeated PhoneNumber phones = 4;\n\n\t\tgoogle.protobuf.Timestamp last_updated = 5;\n\t  }\n\n\t  // Our address book file is just one of these.\n\t  message AddressBook {\n\t\trepeated Person people = 1;\n\t}\n\t```\n\n* .proto\n``` bash\nprotoc *.proto --go_out=.\n```\n\n* \n\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"fmt\"\n\t\t\"zinx/myDemo/protobufDemo/pb\"\n\n\t\t\"google.golang.org/protobuf/proto\"\n\t)\n\n\tfunc main() {\n\t\t// Person\n\t\tperson := &pb.Person{\n\t\t\tName:  \"lijiahao\",\n\t\t\tId:    0,\n\t\t\tEmail: \"18702748294@163.com\",\n\t\t\tPhones: []*pb.Person_PhoneNumber{\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"15136588270\",\n\t\t\t\t\tType: pb.Person_MOBILE,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"190019393\",\n\t\t\t\t\tType: pb.Person_HOME,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"17182920303\",\n\t\t\t\t\tType: pb.Person_WORK,\n\t\t\t\t},\n\t\t\t},\n\t\t}\n\n\t\t// Person\n\t\tdata, err := proto.Marshal(person)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"proto marshal error: \", err)\n\t\t}\n\n\t\t// \n\t\tnewData := &pb.Person{}\n\t\terr = proto.Unmarshal(data, newData)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"unmarshal error: \", err)\n\t\t}\n\t\tfmt.Println(newData)\n\t}\n\t```\n\n## grpc \n\n* grpc go\n```\ngo get -u -v google.golang.org/grpc\n```\n\n* .proto\n\n\t`pb/hello_grpc.proto`\n\n\t``` protobuf\n\t// protobuf\n\tsyntax = \"proto3\";\n\n\tpackage pb;\n\n\toption go_package = \"./;hello_grpc\";\n\n\t// \n\tservice Greeter {\n\t  rpc SayHello (HelloRequest) returns (HelloReply) {}\n\t}\n\n\tmessage HelloRequest {\n\t  string name = 1;\n\t}\n\n\tmessage HelloReply {\n\t  string message = 1;\n\t}\n\t```\n\n* .proto\n\t- go\n\t\t``` bash\n\t\tgo get -u github.com/golang/protobuf/protoc-gen-go\n\t\t```\n\t- .proto\n\t\t``` bash\n\t\tprotoc -I pb/ pb/*.proto --go_out=plugins=grpc:service\n\t\t* -I protoproto\n\t\t* --go_out=plugins=grpc:go\n\t\t```\n\n\n* \n\t`server/server.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"fmt\"\n\t\t\"hello_grpc/service\"\n\t\t\"google.golang.org/grpc\"\n\t\t\"google.golang.org/grpc/reflection\"\n\t\t\"net\"\n\t)\n\n\ttype server struct {}\n\n\t// \n\tfunc (s *server) SayHello(ctx context.Context, in *service.HelloRequest) (*service.HelloReply, error) {\n\t\treturn &service.HelloReply{Message: \"hello \" + in.Name}, nil\n\t}\n\n\tfunc main() {\n\t\t// \n\t\tlis, err := net.Listen(\"tcp\", \":8080\")\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\t// gRPC\n\t\ts := grpc.NewServer()\n\n\t\t// \n\t\tservice.RegisterGreeterServer(s, &server{})\n\n\t\treflection.Register(s)\n\n\t\t// \n\t\terr = s.Serve(lis)\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t}\n\t```\n\n* \n\t`client/client.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"fmt\"\n\t\t\"hello_grpc/service\"\n\t\t\"google.golang.org/grpc\"\n\t)\n\n\tfunc main(){\n\t\t// \n\t\tconn, err := grpc.Dial(\":8080\", grpc.WithInsecure())\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t\tdefer conn.Close()\n\n\t\t// \n\t\tc := service.NewGreeterClient(conn)\n\n\t\t// \n\t\tr, err := c.SayHello(context.Background(), &service.HelloRequest{Name: \"horika\"})\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\tfmt.Printf(\": %s\", r.Message)\n\t}\n\n\t```\n\n## RPC\n* \n\t- Rpc()\n\t``` go\n\trpc.RegisterName(\"\", )\n\t```\n\n\t- \n\t``` go\n\tlistener, err := net.Listen()\n\t```\n\n\t- \n\t``` go\n\tconn, err := listener.Accept()\n\t```\n\n\t- Rpc\n\t``` go\n\trpc.ServeConn(conn)\n\t```\n\n* \n\t- Rpc\n\t``` go\n\tconn, err := rpc.Dial()\n\t```\n\n\t- \n\t``` go\n\tconn.Call(\".\", , )\n\t```\n\n* \n\t``` go\n\tpackage design\n\n\timport (\n\t\t\"net/rpc\"\n\t\t\"net/rpc/jsonrpc\"\n\t)\n\n\t// \n\t/*\n\t\t* \n\t\t* \n\t*/\n\ttype MyInterface interface {\n\t\tHelloWorld(string, *string) error\n\t}\n\n\tfunc RegisterService(i MyInterface) error {\n\t\treturn rpc.RegisterName(\"hello\", i)\n\t}\n\n\t// \n\t/*\n\t\t* \n\t\t* ( rpc.Client) \n\t\t* InitClient\n\t*/\n\ttype MyClient struct {\n\t\tc *rpc.Client\n\t}\n\n\tfunc InitClient(addr string) *MyClient {\n\t\tconn, _ := jsonrpc.Dial(\"tcp\", addr)\n\n\t\treturn &MyClient{c:conn}\n\t}\n\n\tfunc (m *MyClient)HelloWorld(a string, b *string) error {\n\t\treturn m.c.Call(\"hello.HelloWorld\", a, b)\n\t}\n\t```\n\n","slug":"go/go_rpc","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6cz0009f8wz7fk3cy63","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>: <code>zookeeper</code><code>eureka</code><code>consul</code><code>etcd</code>  </p>\n</li>\n<li><p>: v</p>\n</li>\n<li><p>: pullpush</p>\n</li>\n</ul>\n<h2 id=\"rpcx\"><a href=\"#rpcx\" class=\"headerlink\" title=\"rpcx\"></a>rpcx</h2><ul>\n<li><p><a href=\"https://doc.rpcx.io/\">rpcx</a></p>\n</li>\n<li><p><code>rpcx</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v -tags <span class=\"string\">&quot;reuseport quic kcp zookeeper etcd consul ping&quot;</span> github.com/smallnest/rpcx/...</span><br></pre></td></tr></table></figure>\n\n<p><code>:</code></p>\n<p><code>server/server.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/server&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/serverplugin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\taddr      = flag.String(<span class=\"string\">&quot;addr&quot;</span>, <span class=\"string\">&quot;localhost:8972&quot;</span>, <span class=\"string\">&quot;server address&quot;</span>)</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;127.0.0.1:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1newstruct</span></span><br><span class=\"line\">\ts := server.NewServer()</span><br><span class=\"line\">\t<span class=\"comment\">//2zookeeper</span></span><br><span class=\"line\">\taddRegistryPlugin(s)</span><br><span class=\"line\">\t<span class=\"comment\">//3</span></span><br><span class=\"line\">\ts.RegisterName(<span class=\"string\">&quot;Arith&quot;</span>, <span class=\"built_in\">new</span>(Arith), <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//4</span></span><br><span class=\"line\">\ts.Serve(<span class=\"string\">&quot;tcp&quot;</span>, *addr)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addRegistryPlugin</span><span class=\"params\">(s *server.Server)</span></span> &#123;</span><br><span class=\"line\">\tr := &amp;serverplugin.EtcdV3RegisterPlugin&#123;</span><br><span class=\"line\">\t\tServiceAddress: <span class=\"string\">&quot;tcp@&quot;</span> + *addr,</span><br><span class=\"line\">\t\tEtcdServers:   etcdServers,</span><br><span class=\"line\">\t\tBasePath:       basePath,</span><br><span class=\"line\">\t\tUpdateInterval: time.Minute,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr := r.Start()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Fatal(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ts.Plugins.Add(r)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>server/rpc.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Arith <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Mul(cxt context.Context, args *Args, reply *<span class=\"type\">int</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Mul on&quot;</span>, *addr)</span><br><span class=\"line\">  *reply = args.A * args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Div(cxt context.Context, args *Args, quo *Quotient) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Div on&quot;</span>, *addr)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> args.B == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;divide by 0&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  quo.Quo = args.A / args.B</span><br><span class=\"line\">  quo.Rem = args.A % args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>proto/proto.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> proto</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Args <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tA, B <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Quotient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tQuo, Rem <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>server</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><code></code></p>\n<p><code>client.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/client&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpcx_test/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1ZookeeperDiscovery</span></span><br><span class=\"line\">\td := client.NewEtcdV3Discovery(basePath,<span class=\"string\">&quot;Arith&quot;</span>, etcdServers, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//2</span></span><br><span class=\"line\">\txclient := client.NewXClient(<span class=\"string\">&quot;Arith&quot;</span>, client.Failtry, client.RandomSelect, d, client.DefaultOption)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> xclient.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\targs := &amp;proto.Args&#123;</span><br><span class=\"line\">\t\tA: <span class=\"number\">25</span>,</span><br><span class=\"line\">\t\tB: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tquo := &amp;proto.Quotient&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\treply := <span class=\"built_in\">new</span>(<span class=\"type\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr := xclient.Call(context.Background(), <span class=\"string\">&quot;Mul&quot;</span>, args, reply)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d * %d = %d&quot;</span>, args.A, args.B, *reply)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr = xclient.Call(context.Background(), <span class=\"string\">&quot;Div&quot;</span>, args, quo)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d / %d = %d, %d&quot;</span>, args.A, args.B, quo.Quo, quo.Rem)</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">3</span>*time.Second)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p><br>    - <br>    - </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>protobuf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># protobuf</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/protocolbuffers/protobuf.git</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> protobuf/</span><br><span class=\"line\"><span class=\"comment\"># configure</span></span><br><span class=\"line\">./autogen.sh</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">./configure</span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\">sudo ldconfig</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">protoc -h</span><br></pre></td></tr></table></figure></li>\n<li><p>go </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class=\"line\">go get -u google.golang.org/protobuf/proto</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>.proto</p>\n<p>  <code>pb/Person.proto: </code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;google/protobuf/timestamp.proto&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;pb&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"type\">int32</span> id = <span class=\"number\">2</span>;  <span class=\"comment\">// Unique ID number for this person.</span></span><br><span class=\"line\">\t<span class=\"type\">string</span> email = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">enum </span><span class=\"title class_\">PhoneType</span> &#123;</span><br><span class=\"line\">\t  MOBILE = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t  HOME = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  WORK = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">message </span><span class=\"title class_\">PhoneNumber</span> &#123;</span><br><span class=\"line\">\t  <span class=\"type\">string</span> number = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  PhoneType type = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> PhoneNumber phones = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tgoogle.protobuf.Timestamp last_updated = <span class=\"number\">5</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Our address book file is just one of these.</span></span><br><span class=\"line\">  <span class=\"keyword\">message </span><span class=\"title class_\">AddressBook</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> Person people = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc *.proto --go_out=.</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;zinx/myDemo/protobufDemo/pb&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/protobuf/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tperson := &amp;pb.Person&#123;</span><br><span class=\"line\">\t\tName:  <span class=\"string\">&quot;lijiahao&quot;</span>,</span><br><span class=\"line\">\t\tId:    <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\tEmail: <span class=\"string\">&quot;18702748294@163.com&quot;</span>,</span><br><span class=\"line\">\t\tPhones: []*pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;15136588270&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_MOBILE,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;190019393&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_HOME,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;17182920303&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_WORK,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tdata, err := proto.Marshal(person)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;proto marshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tnewData := &amp;pb.Person&#123;&#125;</span><br><span class=\"line\">\terr = proto.Unmarshal(data, newData)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;unmarshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Println(newData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"grpc-\"><a href=\"#grpc-\" class=\"headerlink\" title=\"grpc \"></a>grpc </h2><ul>\n<li><p>grpc go</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v google.golang.org/grpc</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<p>  <code>pb/hello_grpc.proto</code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// protobuf</span></span><br><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;hello_grpc&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">service </span><span class=\"title class_\">Greeter</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">rpc</span> SayHello (HelloRequest) <span class=\"keyword\">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloReply</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> message = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<ul>\n<li>go  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br></pre></td></tr></table></figure></li>\n<li>.proto  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc -I pb/ pb/*.proto --go_out=plugins=grpc:service</span><br><span class=\"line\">* -I protoproto</span><br><span class=\"line\">* --go_out=plugins=grpc:go</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p><br>  <code>server/server.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;hello_grpc/service&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc/reflection&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> server <span class=\"keyword\">struct</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *server)</span></span> SayHello(ctx context.Context, in *service.HelloRequest) (*service.HelloReply, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;service.HelloReply&#123;Message: <span class=\"string\">&quot;hello &quot;</span> + in.Name&#125;, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tlis, err := net.Listen(<span class=\"string\">&quot;tcp&quot;</span>, <span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// gRPC</span></span><br><span class=\"line\">\ts := grpc.NewServer()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tservice.RegisterGreeterServer(s, &amp;server&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\treflection.Register(s)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\terr = s.Serve(lis)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><br>  <code>client/client.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;hello_grpc/service&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tconn, err := grpc.Dial(<span class=\"string\">&quot;:8080&quot;</span>, grpc.WithInsecure())</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tc := service.NewGreeterClient(conn)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr, err := c.SayHello(context.Background(), &amp;service.HelloRequest&#123;Name: <span class=\"string\">&quot;horika&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, r.Message)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"RPC\"><a href=\"#RPC\" class=\"headerlink\" title=\"RPC\"></a>RPC</h2><ul>\n<li><p></p>\n<ul>\n<li><p>Rpc()</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.RegisterName(<span class=\"string\">&quot;&quot;</span>, )</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listener, err := net.Listen()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := listener.Accept()</span><br></pre></td></tr></table></figure></li>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := rpc.Dial()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn.Call(<span class=\"string\">&quot;.&quot;</span>, , )</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> design</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc/jsonrpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyInterface <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tHelloWorld(<span class=\"type\">string</span>, *<span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">RegisterService</span><span class=\"params\">(i MyInterface)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> rpc.RegisterName(<span class=\"string\">&quot;hello&quot;</span>, i)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* ( rpc.Client) </span></span><br><span class=\"line\"><span class=\"comment\">\t* InitClient</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyClient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tc *rpc.Client</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">InitClient</span><span class=\"params\">(addr <span class=\"type\">string</span>)</span></span> *MyClient &#123;</span><br><span class=\"line\">\tconn, _ := jsonrpc.Dial(<span class=\"string\">&quot;tcp&quot;</span>, addr)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MyClient&#123;c:conn&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *MyClient)</span></span>HelloWorld(a <span class=\"type\">string</span>, b *<span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> m.c.Call(<span class=\"string\">&quot;hello.HelloWorld&quot;</span>, a, b)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>: <code>zookeeper</code><code>eureka</code><code>consul</code><code>etcd</code>  </p>\n</li>\n<li><p>: v</p>\n</li>\n<li><p>: pullpush</p>\n</li>\n</ul>\n<h2 id=\"rpcx\"><a href=\"#rpcx\" class=\"headerlink\" title=\"rpcx\"></a>rpcx</h2><ul>\n<li><p><a href=\"https://doc.rpcx.io/\">rpcx</a></p>\n</li>\n<li><p><code>rpcx</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v -tags <span class=\"string\">&quot;reuseport quic kcp zookeeper etcd consul ping&quot;</span> github.com/smallnest/rpcx/...</span><br></pre></td></tr></table></figure>\n\n<p><code>:</code></p>\n<p><code>server/server.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/server&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/serverplugin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\taddr      = flag.String(<span class=\"string\">&quot;addr&quot;</span>, <span class=\"string\">&quot;localhost:8972&quot;</span>, <span class=\"string\">&quot;server address&quot;</span>)</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;127.0.0.1:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1newstruct</span></span><br><span class=\"line\">\ts := server.NewServer()</span><br><span class=\"line\">\t<span class=\"comment\">//2zookeeper</span></span><br><span class=\"line\">\taddRegistryPlugin(s)</span><br><span class=\"line\">\t<span class=\"comment\">//3</span></span><br><span class=\"line\">\ts.RegisterName(<span class=\"string\">&quot;Arith&quot;</span>, <span class=\"built_in\">new</span>(Arith), <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//4</span></span><br><span class=\"line\">\ts.Serve(<span class=\"string\">&quot;tcp&quot;</span>, *addr)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addRegistryPlugin</span><span class=\"params\">(s *server.Server)</span></span> &#123;</span><br><span class=\"line\">\tr := &amp;serverplugin.EtcdV3RegisterPlugin&#123;</span><br><span class=\"line\">\t\tServiceAddress: <span class=\"string\">&quot;tcp@&quot;</span> + *addr,</span><br><span class=\"line\">\t\tEtcdServers:   etcdServers,</span><br><span class=\"line\">\t\tBasePath:       basePath,</span><br><span class=\"line\">\t\tUpdateInterval: time.Minute,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr := r.Start()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Fatal(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ts.Plugins.Add(r)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>server/rpc.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Arith <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Mul(cxt context.Context, args *Args, reply *<span class=\"type\">int</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Mul on&quot;</span>, *addr)</span><br><span class=\"line\">  *reply = args.A * args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Div(cxt context.Context, args *Args, quo *Quotient) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Div on&quot;</span>, *addr)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> args.B == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;divide by 0&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  quo.Quo = args.A / args.B</span><br><span class=\"line\">  quo.Rem = args.A % args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>proto/proto.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> proto</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Args <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tA, B <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Quotient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tQuo, Rem <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>server</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><code></code></p>\n<p><code>client.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/client&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpcx_test/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1ZookeeperDiscovery</span></span><br><span class=\"line\">\td := client.NewEtcdV3Discovery(basePath,<span class=\"string\">&quot;Arith&quot;</span>, etcdServers, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//2</span></span><br><span class=\"line\">\txclient := client.NewXClient(<span class=\"string\">&quot;Arith&quot;</span>, client.Failtry, client.RandomSelect, d, client.DefaultOption)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> xclient.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\targs := &amp;proto.Args&#123;</span><br><span class=\"line\">\t\tA: <span class=\"number\">25</span>,</span><br><span class=\"line\">\t\tB: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tquo := &amp;proto.Quotient&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\treply := <span class=\"built_in\">new</span>(<span class=\"type\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr := xclient.Call(context.Background(), <span class=\"string\">&quot;Mul&quot;</span>, args, reply)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d * %d = %d&quot;</span>, args.A, args.B, *reply)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr = xclient.Call(context.Background(), <span class=\"string\">&quot;Div&quot;</span>, args, quo)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d / %d = %d, %d&quot;</span>, args.A, args.B, quo.Quo, quo.Rem)</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">3</span>*time.Second)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p><br>    - <br>    - </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>protobuf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># protobuf</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/protocolbuffers/protobuf.git</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> protobuf/</span><br><span class=\"line\"><span class=\"comment\"># configure</span></span><br><span class=\"line\">./autogen.sh</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">./configure</span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\">sudo ldconfig</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">protoc -h</span><br></pre></td></tr></table></figure></li>\n<li><p>go </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class=\"line\">go get -u google.golang.org/protobuf/proto</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>.proto</p>\n<p>  <code>pb/Person.proto: </code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;google/protobuf/timestamp.proto&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;pb&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"type\">int32</span> id = <span class=\"number\">2</span>;  <span class=\"comment\">// Unique ID number for this person.</span></span><br><span class=\"line\">\t<span class=\"type\">string</span> email = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">enum </span><span class=\"title class_\">PhoneType</span> &#123;</span><br><span class=\"line\">\t  MOBILE = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t  HOME = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  WORK = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">message </span><span class=\"title class_\">PhoneNumber</span> &#123;</span><br><span class=\"line\">\t  <span class=\"type\">string</span> number = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  PhoneType type = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> PhoneNumber phones = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tgoogle.protobuf.Timestamp last_updated = <span class=\"number\">5</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Our address book file is just one of these.</span></span><br><span class=\"line\">  <span class=\"keyword\">message </span><span class=\"title class_\">AddressBook</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> Person people = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc *.proto --go_out=.</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;zinx/myDemo/protobufDemo/pb&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/protobuf/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tperson := &amp;pb.Person&#123;</span><br><span class=\"line\">\t\tName:  <span class=\"string\">&quot;lijiahao&quot;</span>,</span><br><span class=\"line\">\t\tId:    <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\tEmail: <span class=\"string\">&quot;18702748294@163.com&quot;</span>,</span><br><span class=\"line\">\t\tPhones: []*pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;15136588270&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_MOBILE,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;190019393&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_HOME,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;17182920303&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_WORK,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tdata, err := proto.Marshal(person)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;proto marshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tnewData := &amp;pb.Person&#123;&#125;</span><br><span class=\"line\">\terr = proto.Unmarshal(data, newData)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;unmarshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Println(newData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"grpc-\"><a href=\"#grpc-\" class=\"headerlink\" title=\"grpc \"></a>grpc </h2><ul>\n<li><p>grpc go</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v google.golang.org/grpc</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<p>  <code>pb/hello_grpc.proto</code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// protobuf</span></span><br><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;hello_grpc&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">service </span><span class=\"title class_\">Greeter</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">rpc</span> SayHello (HelloRequest) <span class=\"keyword\">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloReply</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> message = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<ul>\n<li>go  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br></pre></td></tr></table></figure></li>\n<li>.proto  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc -I pb/ pb/*.proto --go_out=plugins=grpc:service</span><br><span class=\"line\">* -I protoproto</span><br><span class=\"line\">* --go_out=plugins=grpc:go</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p><br>  <code>server/server.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;hello_grpc/service&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc/reflection&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> server <span class=\"keyword\">struct</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *server)</span></span> SayHello(ctx context.Context, in *service.HelloRequest) (*service.HelloReply, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;service.HelloReply&#123;Message: <span class=\"string\">&quot;hello &quot;</span> + in.Name&#125;, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tlis, err := net.Listen(<span class=\"string\">&quot;tcp&quot;</span>, <span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// gRPC</span></span><br><span class=\"line\">\ts := grpc.NewServer()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tservice.RegisterGreeterServer(s, &amp;server&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\treflection.Register(s)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\terr = s.Serve(lis)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><br>  <code>client/client.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;hello_grpc/service&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tconn, err := grpc.Dial(<span class=\"string\">&quot;:8080&quot;</span>, grpc.WithInsecure())</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tc := service.NewGreeterClient(conn)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr, err := c.SayHello(context.Background(), &amp;service.HelloRequest&#123;Name: <span class=\"string\">&quot;horika&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, r.Message)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"RPC\"><a href=\"#RPC\" class=\"headerlink\" title=\"RPC\"></a>RPC</h2><ul>\n<li><p></p>\n<ul>\n<li><p>Rpc()</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.RegisterName(<span class=\"string\">&quot;&quot;</span>, )</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listener, err := net.Listen()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := listener.Accept()</span><br></pre></td></tr></table></figure></li>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := rpc.Dial()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn.Call(<span class=\"string\">&quot;.&quot;</span>, , )</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> design</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc/jsonrpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyInterface <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tHelloWorld(<span class=\"type\">string</span>, *<span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">RegisterService</span><span class=\"params\">(i MyInterface)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> rpc.RegisterName(<span class=\"string\">&quot;hello&quot;</span>, i)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* ( rpc.Client) </span></span><br><span class=\"line\"><span class=\"comment\">\t* InitClient</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyClient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tc *rpc.Client</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">InitClient</span><span class=\"params\">(addr <span class=\"type\">string</span>)</span></span> *MyClient &#123;</span><br><span class=\"line\">\tconn, _ := jsonrpc.Dial(<span class=\"string\">&quot;tcp&quot;</span>, addr)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MyClient&#123;c:conn&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *MyClient)</span></span>HelloWorld(a <span class=\"type\">string</span>, b *<span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> m.c.Call(<span class=\"string\">&quot;hello.HelloWorld&quot;</span>, a, b)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"Golang","_content":"# go\n\n## go test\n\n## go benchmark\n\n## go \n* [go pprof](https://blog.wolfogre.com/posts/go-ppof-practice/)\n* [go pprof](https://cizixs.com/2017/09/11/profiling-golang-program/)\n\n\n\n\n","source":"_posts/go/go_test.md","raw":"---\ntitle: Golang \ncategories: \n- GolangStudy\n---\n# go\n\n## go test\n\n## go benchmark\n\n## go \n* [go pprof](https://blog.wolfogre.com/posts/go-ppof-practice/)\n* [go pprof](https://cizixs.com/2017/09/11/profiling-golang-program/)\n\n\n\n\n","slug":"go/go_test","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6d0000af8wz30luhxsw","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h1><h2 id=\"go-test\"><a href=\"#go-test\" class=\"headerlink\" title=\"go test\"></a>go test</h2><h2 id=\"go-benchmark\"><a href=\"#go-benchmark\" class=\"headerlink\" title=\"go benchmark\"></a>go benchmark</h2><h2 id=\"go-\"><a href=\"#go-\" class=\"headerlink\" title=\"go \"></a>go </h2><ul>\n<li><a href=\"https://blog.wolfogre.com/posts/go-ppof-practice/\">go pprof</a></li>\n<li><a href=\"https://cizixs.com/2017/09/11/profiling-golang-program/\">go pprof</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h1><h2 id=\"go-test\"><a href=\"#go-test\" class=\"headerlink\" title=\"go test\"></a>go test</h2><h2 id=\"go-benchmark\"><a href=\"#go-benchmark\" class=\"headerlink\" title=\"go benchmark\"></a>go benchmark</h2><h2 id=\"go-\"><a href=\"#go-\" class=\"headerlink\" title=\"go \"></a>go </h2><ul>\n<li><a href=\"https://blog.wolfogre.com/posts/go-ppof-practice/\">go pprof</a></li>\n<li><a href=\"https://cizixs.com/2017/09/11/profiling-golang-program/\">go pprof</a></li>\n</ul>\n"},{"title":"Redis","_content":"# Redis\n\n## redis\n\n* redis, , \n\n* \n\t- master() slave\n\t- slave()  master(slave)\n\t- : masterslave\n\n* masterslave(masterslave slavemaster)\n\n* \n\t- master\n\t\t* \n\t\t* slave\n\t\t* ()\n\t- slave\n\t\t* \n\t\t* \n\n* \n\t- : masterslave\n\t- : slavemasterslave\n\t\tredis\n\t- : mater slave\n\t- : \n\t- : redis\n\n* \n\t- (slavemaster)\n\t\t* slavemastermasterslaveslave\n\t\t* \n\t\t\t1slave : slaveof ip port   ()\n\t\t\t2master\n\t\t\t3masterIP:   masterhost  masterport\n\t\t\t4mastersocket\n\t\t\t5slaveping\n\t\t\t6masterpong\n\t\t\t7slave: auth password\n\t\t\t8master\n\t\t\t9slave: replconflistening-port <port-number>\n\t\t\t10masterslave\n\n\t\t* \n\t\t\t1\n\t\t\t\tslaveof <masterip> <masterport>\n\t\t\t2\n\t\t\t\tredis-server --slaveof <masterip> <masterport>\n\t\t\t3()\n\t\t\t\tslaveof <masterip> <masterport>\n\t\t* \n\t\t\tslaveof no one\n\t- \n\t\t1. slave `psync2 ? -1` (? runid -1 offset)\n\t\t2. masterbgsaveRDBoffset\n\t\t3.  +FULLRESYNC runid offset\n\t\t   RDBsocketslave\n\t\t4. slave runidoffsetRDBRDB()\n\t\t5.  psync2 runid offset\n\t\t6. runidoffset\n\t\t7. runidoffset\n\t\t8. runidoffsetoffset\n\t\t9.  +CONTINUE offset\n\t\t9. offset, rewriteaof\n\n\t\t*  \n\t\t* RDB\n\t\t* RDB\n\t\t* \n\t\t* \n\n\t\t* : master: repl-backlog-size \n\n\t- \n\t\t* \n\t\t* \n\t\t\t- id(run id)\n\t\t\t\t* IDID\n\t\t\t\t* ID4016\n\t\t\t\t* ID\n\t\t\t\t* IDmasterslaveIDslaveslaveID\n\t\t\t\n\t\t\t- \n\t\t\t\t* master\n\t\t\t\t* \n\t\t\t\t\t* \n\t\t\t\t\t* \n\t\t\t\t\t* offsetslave\n\t\t\t\t\t* masteroffset\n\t\t\t\t\t* slaveoffset\n\t\t\t- \n\n\t\t* \n\t\t\t- masterslave\n\t\t\t- master:\n\t\t\t\t* : PING\n\t\t\t\t* : repl-ping-slave-period(10)\n\t\t\t\t* : slave\n\t\t\t\t* : INFO replication\n\t\t\t- slave:\n\t\t\t\t* : REPLICONF ACK offset\n\t\t\t\t* : 1s\n\t\t\t\t* :\n\t\t\t\t\t* master\n\t\t\t\t\t* slave\n\n## \n\n* masterslavemaster\n* \n\t- masterslave\n\t\t* : sentinelmasterslave\n\t\t* sentinelsentinelmasterslave\n\t- () : ()\n\t-  : masterslaveslavemasterslavemaster\n\t\t* master: S_DOWN() O_DOWN()\n\n\t\t* master\n\t\t\t* \n\t\t\t* \n\t\t\t* (offset runid)\n* \n\t* \n\t* (,) sentinel.conf\n\t* :   redis-sentinel sentinel-.conf\n\n\n## \n\n* redisQPS10/\n\n* \n\t* \n\t* \n\t* \n\n* Redis\n\t* \n\t\t* key\n\t\t* 16384\n\t\t* \n\t\t* \n\t* \n\t\t* \n\t\t* \n\t\t* \n\n* cluster\n\t* cluster-enabled yes   cluster\n\t* cluster-config-file  nodes-6379.conf\n\t* cluster-node-timeout 10000\n\t* cluster-migration-barrier <count>  masterslave\n* cluster\n\t* cluster nodes     \t\t\t  \n\t* cluster replicate <master-id>   redis\n\t* cluster meet ip:port            \n\t* cluster forget<id>              slot\n\t* cluster failover \t\t\t\t  \n\n\t* redis-trib.rb create --replicas 1(masterslave) 127.0.0.1:6379(masterip:port)\n\t* redis-cli -c (-c)\n\n# \n\n* \n\t- \n\t- \n\t\t* \n\t\t\t* \n\t\t\t* LRU\n\t\t* \n\t\t\t* redis\n\t\t\t* \n\t\t* \n\t\t\t* \n\t\t\t* CDN()\n* \n\t- key\n\t- ()\n\t\t* \n\t\t* \n\t\t\tNginx + redis + ehcache\n\t\t* Mysql\n\t\t* \n\t\t\t* redis\n\t\t\t\t* CPUCPU\n\t\t\t\t* \n\t\t\t\t* \n\t\t\t\t* \n\t\t* \n\t- ()\n\t\t* LRULFU()\n\t\t* \n\t\t\t* \n\t\t\t* +key\n\t\t* key\n\t\t* \n\t\t* ()\n* \n\t- key\n\t- \n\t\t* \n\t\t* key\n\t\t* \n\t\t* , \n\t\t* ()\n\n* \n\t- redis\n\t- \n\t\t* (\n\t- \n\t- key\n\n* \n\t- \n\t\t* latency     \t\t\t\tRedis\n\t\t* instantaneous_os_per_sec  \n\t\t* hit rate \t\t\t\t\t\n\t- \n\t\t* used_memory \t\t\t\t\n\t\t* mem_fragmentation_ratio \t\n\t\t* evicted_keys \t\t\t\tkey\n\t\t* blocked_clients          \t\n\t- \n\t- \n\t- \n\t\t* rejected_connenctions   \t\t\tmaxclient \n\t\t* keyspace_misses \t\t\t\t\tkey\n\t\t* master_link_down_since_seconds  \t\n* (benchmark)\n\t- redis-benchmark [-h] [-p] [-c] [-n <requests>] [-k]\n\teg:\n\t\t* redis-benchmark    50,10000\n\t\t* redis-benchmark  -c 100 -n 5000       -c  -n  \n* \n\t- monitor    \n\t- slowlog    \n\t  * \n\t\tslowlog [operator]\n\t\t\t* get:      \n\t\t\t* len     \n\t\t\t* reset: \t\n\t  * \n\t\t* slowlog-log-slower-than 1000    (: )\n\t\t* slow-max-len  100 \t\t\t  \n\t\t\t\n\n\n\n\n\n\n\n\n\n\n\t\t\t\n\t\t\t\n\n\n","source":"_posts/go/redis_cluster.md","raw":"---\ntitle: Redis \ncategories: \n- GolangStudy\n---\n# Redis\n\n## redis\n\n* redis, , \n\n* \n\t- master() slave\n\t- slave()  master(slave)\n\t- : masterslave\n\n* masterslave(masterslave slavemaster)\n\n* \n\t- master\n\t\t* \n\t\t* slave\n\t\t* ()\n\t- slave\n\t\t* \n\t\t* \n\n* \n\t- : masterslave\n\t- : slavemasterslave\n\t\tredis\n\t- : mater slave\n\t- : \n\t- : redis\n\n* \n\t- (slavemaster)\n\t\t* slavemastermasterslaveslave\n\t\t* \n\t\t\t1slave : slaveof ip port   ()\n\t\t\t2master\n\t\t\t3masterIP:   masterhost  masterport\n\t\t\t4mastersocket\n\t\t\t5slaveping\n\t\t\t6masterpong\n\t\t\t7slave: auth password\n\t\t\t8master\n\t\t\t9slave: replconflistening-port <port-number>\n\t\t\t10masterslave\n\n\t\t* \n\t\t\t1\n\t\t\t\tslaveof <masterip> <masterport>\n\t\t\t2\n\t\t\t\tredis-server --slaveof <masterip> <masterport>\n\t\t\t3()\n\t\t\t\tslaveof <masterip> <masterport>\n\t\t* \n\t\t\tslaveof no one\n\t- \n\t\t1. slave `psync2 ? -1` (? runid -1 offset)\n\t\t2. masterbgsaveRDBoffset\n\t\t3.  +FULLRESYNC runid offset\n\t\t   RDBsocketslave\n\t\t4. slave runidoffsetRDBRDB()\n\t\t5.  psync2 runid offset\n\t\t6. runidoffset\n\t\t7. runidoffset\n\t\t8. runidoffsetoffset\n\t\t9.  +CONTINUE offset\n\t\t9. offset, rewriteaof\n\n\t\t*  \n\t\t* RDB\n\t\t* RDB\n\t\t* \n\t\t* \n\n\t\t* : master: repl-backlog-size \n\n\t- \n\t\t* \n\t\t* \n\t\t\t- id(run id)\n\t\t\t\t* IDID\n\t\t\t\t* ID4016\n\t\t\t\t* ID\n\t\t\t\t* IDmasterslaveIDslaveslaveID\n\t\t\t\n\t\t\t- \n\t\t\t\t* master\n\t\t\t\t* \n\t\t\t\t\t* \n\t\t\t\t\t* \n\t\t\t\t\t* offsetslave\n\t\t\t\t\t* masteroffset\n\t\t\t\t\t* slaveoffset\n\t\t\t- \n\n\t\t* \n\t\t\t- masterslave\n\t\t\t- master:\n\t\t\t\t* : PING\n\t\t\t\t* : repl-ping-slave-period(10)\n\t\t\t\t* : slave\n\t\t\t\t* : INFO replication\n\t\t\t- slave:\n\t\t\t\t* : REPLICONF ACK offset\n\t\t\t\t* : 1s\n\t\t\t\t* :\n\t\t\t\t\t* master\n\t\t\t\t\t* slave\n\n## \n\n* masterslavemaster\n* \n\t- masterslave\n\t\t* : sentinelmasterslave\n\t\t* sentinelsentinelmasterslave\n\t- () : ()\n\t-  : masterslaveslavemasterslavemaster\n\t\t* master: S_DOWN() O_DOWN()\n\n\t\t* master\n\t\t\t* \n\t\t\t* \n\t\t\t* (offset runid)\n* \n\t* \n\t* (,) sentinel.conf\n\t* :   redis-sentinel sentinel-.conf\n\n\n## \n\n* redisQPS10/\n\n* \n\t* \n\t* \n\t* \n\n* Redis\n\t* \n\t\t* key\n\t\t* 16384\n\t\t* \n\t\t* \n\t* \n\t\t* \n\t\t* \n\t\t* \n\n* cluster\n\t* cluster-enabled yes   cluster\n\t* cluster-config-file  nodes-6379.conf\n\t* cluster-node-timeout 10000\n\t* cluster-migration-barrier <count>  masterslave\n* cluster\n\t* cluster nodes     \t\t\t  \n\t* cluster replicate <master-id>   redis\n\t* cluster meet ip:port            \n\t* cluster forget<id>              slot\n\t* cluster failover \t\t\t\t  \n\n\t* redis-trib.rb create --replicas 1(masterslave) 127.0.0.1:6379(masterip:port)\n\t* redis-cli -c (-c)\n\n# \n\n* \n\t- \n\t- \n\t\t* \n\t\t\t* \n\t\t\t* LRU\n\t\t* \n\t\t\t* redis\n\t\t\t* \n\t\t* \n\t\t\t* \n\t\t\t* CDN()\n* \n\t- key\n\t- ()\n\t\t* \n\t\t* \n\t\t\tNginx + redis + ehcache\n\t\t* Mysql\n\t\t* \n\t\t\t* redis\n\t\t\t\t* CPUCPU\n\t\t\t\t* \n\t\t\t\t* \n\t\t\t\t* \n\t\t* \n\t- ()\n\t\t* LRULFU()\n\t\t* \n\t\t\t* \n\t\t\t* +key\n\t\t* key\n\t\t* \n\t\t* ()\n* \n\t- key\n\t- \n\t\t* \n\t\t* key\n\t\t* \n\t\t* , \n\t\t* ()\n\n* \n\t- redis\n\t- \n\t\t* (\n\t- \n\t- key\n\n* \n\t- \n\t\t* latency     \t\t\t\tRedis\n\t\t* instantaneous_os_per_sec  \n\t\t* hit rate \t\t\t\t\t\n\t- \n\t\t* used_memory \t\t\t\t\n\t\t* mem_fragmentation_ratio \t\n\t\t* evicted_keys \t\t\t\tkey\n\t\t* blocked_clients          \t\n\t- \n\t- \n\t- \n\t\t* rejected_connenctions   \t\t\tmaxclient \n\t\t* keyspace_misses \t\t\t\t\tkey\n\t\t* master_link_down_since_seconds  \t\n* (benchmark)\n\t- redis-benchmark [-h] [-p] [-c] [-n <requests>] [-k]\n\teg:\n\t\t* redis-benchmark    50,10000\n\t\t* redis-benchmark  -c 100 -n 5000       -c  -n  \n* \n\t- monitor    \n\t- slowlog    \n\t  * \n\t\tslowlog [operator]\n\t\t\t* get:      \n\t\t\t* len     \n\t\t\t* reset: \t\n\t  * \n\t\t* slowlog-log-slower-than 1000    (: )\n\t\t* slow-max-len  100 \t\t\t  \n\t\t\t\n\n\n\n\n\n\n\n\n\n\n\t\t\t\n\t\t\t\n\n\n","slug":"go/redis_cluster","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6d1000bf8wz7g729joi","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h1><h2 id=\"redis\"><a href=\"#redis\" class=\"headerlink\" title=\"redis\"></a>redis</h2><ul>\n<li><p>redis, , </p>\n</li>\n<li><p></p>\n<ul>\n<li>master() slave</li>\n<li>slave()  master(slave)</li>\n<li>: masterslave</li>\n</ul>\n</li>\n<li><p>masterslave(masterslave slavemaster)</p>\n</li>\n<li><p></p>\n<ul>\n<li>master<ul>\n<li></li>\n<li>slave</li>\n<li>()</li>\n</ul>\n</li>\n<li>slave<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>: masterslave</li>\n<li>: slavemasterslave<br>  redis</li>\n<li>: mater slave</li>\n<li>: </li>\n<li>: redis</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>(slavemaster)</p>\n<ul>\n<li><p>slavemastermasterslaveslave</p>\n</li>\n<li><p><br>  1slave : slaveof ip port   ()<br>  2master<br>  3masterIP:   masterhost  masterport<br>  4mastersocket<br>  5slaveping<br>  6masterpong<br>  7slave: auth password<br>  8master<br>  9slave: replconflistening-port <port-number><br>  10masterslave</p>\n</li>\n<li><p><br>  1</p>\n<pre><code>  slaveof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre>\n<p>  2</p>\n<pre><code>  redis-server --slaveof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre>\n<p>  3()</p>\n<pre><code>  slaveof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre>\n</li>\n<li><p><br>  slaveof no one</p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ol>\n<li>slave <code>psync2 ? -1</code> (? runid -1 offset)</li>\n<li>masterbgsaveRDBoffset</li>\n<li> +FULLRESYNC runid offset<br>RDBsocketslave</li>\n<li>slave runidoffsetRDBRDB()</li>\n<li> psync2 runid offset</li>\n<li>runidoffset</li>\n<li>runidoffset</li>\n<li>runidoffsetoffset</li>\n<li> +CONTINUE offset</li>\n<li>offset, rewriteaof</li>\n</ol>\n<ul>\n<li><p> </p>\n</li>\n<li><p>RDB</p>\n</li>\n<li><p>RDB</p>\n</li>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n<li><p>: master: repl-backlog-size </p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>id(run id)<ul>\n<li>IDID</li>\n<li>ID4016</li>\n<li>ID</li>\n<li>IDmasterslaveIDslaveslaveID</li>\n</ul>\n</li>\n<li><ul>\n<li>master</li>\n<li><ul>\n<li></li>\n<li></li>\n<li>offsetslave</li>\n<li>masteroffset</li>\n<li>slaveoffset</li>\n</ul>\n</li>\n</ul>\n</li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>masterslave</li>\n<li>master:<ul>\n<li>: PING</li>\n<li>: repl-ping-slave-period(10)</li>\n<li>: slave</li>\n<li>: INFO replication</li>\n</ul>\n</li>\n<li>slave:<ul>\n<li>: REPLICONF ACK offset</li>\n<li>: 1s</li>\n<li>:<ul>\n<li>master</li>\n<li>slave</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>masterslavemaster</p>\n</li>\n<li><p></p>\n<ul>\n<li><p>masterslave</p>\n<ul>\n<li>: sentinelmasterslave</li>\n<li>sentinelsentinelmasterslave</li>\n</ul>\n</li>\n<li><p>() : ()</p>\n</li>\n<li><p> : masterslaveslavemasterslavemaster</p>\n<ul>\n<li><p>master: S_DOWN() O_DOWN()</p>\n</li>\n<li><p>master</p>\n<ul>\n<li></li>\n<li></li>\n<li>(offset runid)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li>(,) sentinel.conf</li>\n<li>:   redis-sentinel sentinel-.conf</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>redisQPS10/</p>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p>Redis</p>\n<ul>\n<li><ul>\n<li>key</li>\n<li>16384</li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>cluster</p>\n<ul>\n<li>cluster-enabled yes   cluster</li>\n<li>cluster-config-file  nodes-6379.conf</li>\n<li>cluster-node-timeout 10000</li>\n<li>cluster-migration-barrier <count>  masterslave</li>\n</ul>\n</li>\n<li><p>cluster</p>\n<ul>\n<li><p>cluster nodes                   </p>\n</li>\n<li><p>cluster replicate <master-id>   redis</p>\n</li>\n<li><p>cluster meet ip:port            </p>\n</li>\n<li><p>cluster forget<id>              slot</p>\n</li>\n<li><p>cluster failover                   </p>\n</li>\n<li><p>redis-trib.rb create replicas 1(masterslave) 127.0.0.1:6379(masterip:port)</p>\n</li>\n<li><p>redis-cli -c (-c)</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><p></p>\n<ul>\n<li></li>\n<li><ul>\n<li><ul>\n<li></li>\n<li>LRU</li>\n</ul>\n</li>\n<li><ul>\n<li>redis</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li>CDN()</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>key</li>\n<li>()<ul>\n<li></li>\n<li><br>  Nginx + redis + ehcache</li>\n<li>Mysql</li>\n<li><ul>\n<li>redis<ul>\n<li>CPUCPU</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li></li>\n</ul>\n</li>\n<li>()<ul>\n<li>LRULFU()</li>\n<li><ul>\n<li></li>\n<li>+key</li>\n</ul>\n</li>\n<li>key</li>\n<li></li>\n<li>()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>key</li>\n<li><ul>\n<li></li>\n<li>key</li>\n<li></li>\n<li>, </li>\n<li>()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>redis</li>\n<li><ul>\n<li>(</li>\n</ul>\n</li>\n<li></li>\n<li>key</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><ul>\n<li>latency                     Redis</li>\n<li>instantaneous_os_per_sec  </li>\n<li>hit rate                     </li>\n</ul>\n</li>\n<li><ul>\n<li>used_memory                 </li>\n<li>mem_fragmentation_ratio     </li>\n<li>evicted_keys                 key</li>\n<li>blocked_clients              </li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li><ul>\n<li>rejected_connenctions               maxclient </li>\n<li>keyspace_misses                     key</li>\n<li>master_link_down_since_seconds      </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>(benchmark)</p>\n<ul>\n<li>redis-benchmark [-h] [-p] [-c] [-n <requests>] [-k]<br>eg:<ul>\n<li>redis-benchmark    50,10000</li>\n<li>redis-benchmark  -c 100 -n 5000       -c  -n  </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>monitor    </li>\n<li>slowlog    <ul>\n<li><br>slowlog [operator]<pre><code>* get:      \n* len     \n* reset:     \n</code></pre>\n</li>\n<li><ul>\n<li>slowlog-log-slower-than 1000    (: )</li>\n<li>slow-max-len  100               </li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h1><h2 id=\"redis\"><a href=\"#redis\" class=\"headerlink\" title=\"redis\"></a>redis</h2><ul>\n<li><p>redis, , </p>\n</li>\n<li><p></p>\n<ul>\n<li>master() slave</li>\n<li>slave()  master(slave)</li>\n<li>: masterslave</li>\n</ul>\n</li>\n<li><p>masterslave(masterslave slavemaster)</p>\n</li>\n<li><p></p>\n<ul>\n<li>master<ul>\n<li></li>\n<li>slave</li>\n<li>()</li>\n</ul>\n</li>\n<li>slave<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>: masterslave</li>\n<li>: slavemasterslave<br>  redis</li>\n<li>: mater slave</li>\n<li>: </li>\n<li>: redis</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>(slavemaster)</p>\n<ul>\n<li><p>slavemastermasterslaveslave</p>\n</li>\n<li><p><br>  1slave : slaveof ip port   ()<br>  2master<br>  3masterIP:   masterhost  masterport<br>  4mastersocket<br>  5slaveping<br>  6masterpong<br>  7slave: auth password<br>  8master<br>  9slave: replconflistening-port <port-number><br>  10masterslave</p>\n</li>\n<li><p><br>  1</p>\n<pre><code>  slaveof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre>\n<p>  2</p>\n<pre><code>  redis-server --slaveof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre>\n<p>  3()</p>\n<pre><code>  slaveof &lt;masterip&gt; &lt;masterport&gt;\n</code></pre>\n</li>\n<li><p><br>  slaveof no one</p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ol>\n<li>slave <code>psync2 ? -1</code> (? runid -1 offset)</li>\n<li>masterbgsaveRDBoffset</li>\n<li> +FULLRESYNC runid offset<br>RDBsocketslave</li>\n<li>slave runidoffsetRDBRDB()</li>\n<li> psync2 runid offset</li>\n<li>runidoffset</li>\n<li>runidoffset</li>\n<li>runidoffsetoffset</li>\n<li> +CONTINUE offset</li>\n<li>offset, rewriteaof</li>\n</ol>\n<ul>\n<li><p> </p>\n</li>\n<li><p>RDB</p>\n</li>\n<li><p>RDB</p>\n</li>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n<li><p>: master: repl-backlog-size </p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>id(run id)<ul>\n<li>IDID</li>\n<li>ID4016</li>\n<li>ID</li>\n<li>IDmasterslaveIDslaveslaveID</li>\n</ul>\n</li>\n<li><ul>\n<li>master</li>\n<li><ul>\n<li></li>\n<li></li>\n<li>offsetslave</li>\n<li>masteroffset</li>\n<li>slaveoffset</li>\n</ul>\n</li>\n</ul>\n</li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>masterslave</li>\n<li>master:<ul>\n<li>: PING</li>\n<li>: repl-ping-slave-period(10)</li>\n<li>: slave</li>\n<li>: INFO replication</li>\n</ul>\n</li>\n<li>slave:<ul>\n<li>: REPLICONF ACK offset</li>\n<li>: 1s</li>\n<li>:<ul>\n<li>master</li>\n<li>slave</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>masterslavemaster</p>\n</li>\n<li><p></p>\n<ul>\n<li><p>masterslave</p>\n<ul>\n<li>: sentinelmasterslave</li>\n<li>sentinelsentinelmasterslave</li>\n</ul>\n</li>\n<li><p>() : ()</p>\n</li>\n<li><p> : masterslaveslavemasterslavemaster</p>\n<ul>\n<li><p>master: S_DOWN() O_DOWN()</p>\n</li>\n<li><p>master</p>\n<ul>\n<li></li>\n<li></li>\n<li>(offset runid)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li>(,) sentinel.conf</li>\n<li>:   redis-sentinel sentinel-.conf</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>redisQPS10/</p>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p>Redis</p>\n<ul>\n<li><ul>\n<li>key</li>\n<li>16384</li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>cluster</p>\n<ul>\n<li>cluster-enabled yes   cluster</li>\n<li>cluster-config-file  nodes-6379.conf</li>\n<li>cluster-node-timeout 10000</li>\n<li>cluster-migration-barrier <count>  masterslave</li>\n</ul>\n</li>\n<li><p>cluster</p>\n<ul>\n<li><p>cluster nodes                   </p>\n</li>\n<li><p>cluster replicate <master-id>   redis</p>\n</li>\n<li><p>cluster meet ip:port            </p>\n</li>\n<li><p>cluster forget<id>              slot</p>\n</li>\n<li><p>cluster failover                   </p>\n</li>\n<li><p>redis-trib.rb create replicas 1(masterslave) 127.0.0.1:6379(masterip:port)</p>\n</li>\n<li><p>redis-cli -c (-c)</p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><p></p>\n<ul>\n<li></li>\n<li><ul>\n<li><ul>\n<li></li>\n<li>LRU</li>\n</ul>\n</li>\n<li><ul>\n<li>redis</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li>CDN()</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>key</li>\n<li>()<ul>\n<li></li>\n<li><br>  Nginx + redis + ehcache</li>\n<li>Mysql</li>\n<li><ul>\n<li>redis<ul>\n<li>CPUCPU</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n</li>\n<li></li>\n</ul>\n</li>\n<li>()<ul>\n<li>LRULFU()</li>\n<li><ul>\n<li></li>\n<li>+key</li>\n</ul>\n</li>\n<li>key</li>\n<li></li>\n<li>()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>key</li>\n<li><ul>\n<li></li>\n<li>key</li>\n<li></li>\n<li>, </li>\n<li>()</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>redis</li>\n<li><ul>\n<li>(</li>\n</ul>\n</li>\n<li></li>\n<li>key</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><ul>\n<li>latency                     Redis</li>\n<li>instantaneous_os_per_sec  </li>\n<li>hit rate                     </li>\n</ul>\n</li>\n<li><ul>\n<li>used_memory                 </li>\n<li>mem_fragmentation_ratio     </li>\n<li>evicted_keys                 key</li>\n<li>blocked_clients              </li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li><ul>\n<li>rejected_connenctions               maxclient </li>\n<li>keyspace_misses                     key</li>\n<li>master_link_down_since_seconds      </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>(benchmark)</p>\n<ul>\n<li>redis-benchmark [-h] [-p] [-c] [-n <requests>] [-k]<br>eg:<ul>\n<li>redis-benchmark    50,10000</li>\n<li>redis-benchmark  -c 100 -n 5000       -c  -n  </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>monitor    </li>\n<li>slowlog    <ul>\n<li><br>slowlog [operator]<pre><code>* get:      \n* len     \n* reset:     \n</code></pre>\n</li>\n<li><ul>\n<li>slowlog-log-slower-than 1000    (: )</li>\n<li>slow-max-len  100               </li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n"},{"title":"Golang ORM","_content":"# gorm\n\nORM: object relational mapping  ()\n\n  <--->   <br/>\n  <--->   <br/>\n    <--->   <br/>\n\n## gorm\n\n``` bash\ngo get -u \"github.com/jinzhu/gorm\"\n```\n\n## gorm\n\n`GORM`:\n\n``` go \nimport _ \"github.com/jinzhu/gorm/dialects/mysql\"\n// import _ \"github.com/jinzhu/gorm/dialects/postgres\"\n// import _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n// import _ \"github.com/jinzhu/gorm/dialects/mssql\"\n```\n\n* mysql\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/mysql\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"mysql\", \"user:password@(localhost)/dbname?charset=utf8mb4&parseTime=True&loc=Local\")\n  defer db.Close()\n}\n```\n\n* postgreSql\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"postgres\", \"host=myhost port=myport user=gorm dbname=gorm password=mypassword\")\n  defer db.Close()\n}\n```\n\n* Sqlite3\n\n`Sqlite3`\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"sqlite3\", \"/tmp/gorm.db\")\n  defer db.Close()\n}\n```\n\n* SQL server\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/mssql\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"mssql\", \"sqlserver://username:password@localhost:1433?database=dbname\")\n  defer db.Close()\n}\n```\n\n## Dockermysql\n\n1. mysql:\n``` bash\nsudo docker pull mysql\n```\n2. `13306``mysql8019``root` `root1234`MySQL:\n``` bash\ndocker run --name mysql8019 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=cv11010216 -d mysql:8.0.19\n```\n3. `MySQL Client`:\n``` bash\ndocker run -it --network host --rm mysql mysql -h127.0.0.1 -P3306 --default-character-set=utf8mb4 -uroot -p\n```\n\n## gormmysql\n\n``` go \npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n)\nimport _ \"github.com/jinzhu/gorm/dialects/mysql\"\n\ntype UserInfo struct {\n\tID int\n\tName string\n\tGender string\n\tHobby string\n}\n\nfunc main() {\n\t//\n\tdb, err := gorm.Open(\"mysql\", \"root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&parseTime=True\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\n\t// ()\n\tdb.AutoMigrate(&UserInfo{})\n\n\t//\n\tu1 := UserInfo{1, \"lijiahao\", \"male\", \"zhaozijin\"}\n\tdb.Create(&u1)\n\n\t//\n\tvar u UserInfo\n\tvar uu UserInfo\n\tdb.First(&u)\n\tfmt.Printf(\"%#v\\n\", u)\n\tdb.Find(&uu, \"hoddy=?\", \"\")\n\tfmt.printf(\"%v\", uu)\n\n\t//\n\tdb.Model(&u).Update(\"bobby\", \"\")\n\n\t//\n\tdb.Delete(&u)\n}\n```\n\n* gorm Model\n\n``` go \ntype User struct {\n\tgorm.Model\n\tName string\n\tAge sql.NullInt64 //\n\tBirthday *time.Time\n\tEmail string `gorm:\"type:varchar(120);unique_index\"`\n\tRole string `gorm:\"size:255\"`  //255\n\tMemberNumber *string `gorm:\"unique;not null\"` //\n\tNum int `gorm:\"AUTO_INCREMENT\"` //num\n\tAddress string \t`gorm:\"index:addr\"` //addressaddr\n\tIgnoreMe int `gorm:\"-\"` //\n\n}\n```\n\n* gorm.Model\n\nGORM`gorm.Model``gorm.Model``ID`, `CreatedAt`, `UpdatedAt`, `DeletedAt`Golang\n\n``` go \n// gorm.Model \ntype Model struct {\n  ID        uint `gorm:\"primary_key\"`\n  CreatedAt time.Time\n  UpdatedAt time.Time\n  DeletedAt *time.Time\n}\n```\n* \n\nGORM ID\n``` go \ntype User struct {\n  ID   string // `ID`\n  Name string\n}\n\n// `AnimalID`\ntype Animal struct {\n  AnimalID int64 `gorm:\"primary_key\"`\n  Name     string\n  Age      int64\n}\n```\n\n* \n\n:\n``` go \ntype User struct {} //  `users`\n\n//  User  `profiles`\nfunc (User) TableName() string {\n  return \"profiles\"\n}\n\nfunc (u User) TableName() string {\n  if u.Role == \"admin\" {\n    return \"admin_users\"\n  } else {\n    return \"users\"\n  }\n}\n\n//  true `User`  `user`\ndb.SingularTable(true)\n```\n\n`Table()`\n\n``` go \n// User`deleted_users`\ndb.Table(\"deleted_users\").CreateTable(&User{})\n\nvar deleted_users []User\ndb.Table(\"deleted_users\").Find(&deleted_users)\n//// SELECT * FROM deleted_users;\n\ndb.Table(\"deleted_users\").Where(\"name = ?\", \"jinzhu\").Delete()\n//// DELETE FROM deleted_users WHERE name = 'jinzhu';\n```\n\nGORM\n\n``` go\ngorm.DefaultTableNameHandler = func (db *gorm.DB, defaultTableName string) string  {\n  return \"sms_\" + defaultTableName;\n}\n```\n\n* \n\n``` go \ntype User struct {\n  ID        uint      // column name is `id`\n  Name      string    // column name is `name`\n  Birthday  time.Time // column name is `birthday`\n  CreatedAt time.Time // column name is `created_at`\n}\n```\n\ntag\n\n``` go\ntype Animal struct {\n  AnimalId    int64     `gorm:\"column:beast_id\"`        \n  Birthday    time.Time `gorm:\"column:day_of_the_beast\"` \n  Age         int64     `gorm:\"column:age_of_the_beast\"`\n}\n```\n\n## gorm CRUD \n\n### <b></b>\n\n``` go\npackage main\n\nimport \"github.com/jinzhu/gorm\"\nimport _\"github.com/jinzhu/gorm/dialects/mysql\"\n\n// 1. \ntype Person struct {\n\tID int64\n\tName string `gorm:\"default:''\"` //tag\n\tAge int64\n}\n\nfunc main() {\n\tdb, err := gorm.Open(\"mysql\", \"root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&parseTime=True\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\n\t//2. \n\tdb.AutoMigrate(&Person{})\n\n\t//3. \n\tu := Person{\n\t\tID: 1,\n\t\tAge: 17,\n\t}\n\t//NewRecord()Create()\n\tprintln(db.NewRecord(&u))\n\tdb.Create(&u)\n\tprintln(db.NewRecord(&u))\n}\n```\n\n<font color=red>:</font>tag SQL    Gorm\n\n`eg:`\n\n``` go \nvar user = User{Name: \"\", Age: 99}\ndb.Create(&user)\n```\n\n<font color=red>:</font>SQL`INSERT INTO users(\"age\") values('99');`NameName\n\n<font color=red>:</font>, 0, \"\",false  Scanner/Valuer\n\n(1). :\n\n``` go \n// \ntype User struct {\n  ID   int64\n  Name *string `gorm:\"default:''\"`\n  Age  int64\n}\nuser := User{Name: new(string), Age: 18))}\ndb.Create(&user)  // name''\n```\n\n(2). Scanner/Valuer\n\n``` go \n//  Scanner/Valuer\ntype User struct {\n\tID int64\n\tName sql.NullString `gorm:\"default:''\"` // sql.NullString Scanner/Valuer\n\tAge  int64\n}\nuser := User{Name: sql.NullString{\"\", true}, Age:18}\ndb.Create(&user)  // name''\n```\n\n### <b></b>\n\n* <b></b>\n\n``` go \n// \ndb.First(&user)\n//// SELECT * FROM users ORDER BY id LIMIT 1;\n\n// \ndb.Take(&user)\n//// SELECT * FROM users LIMIT 1;\n\n// \ndb.Last(&user)\n//// SELECT * FROM users ORDER BY id DESC LIMIT 1;\n\n// \ndb.Find(&users)\n//// SELECT * FROM users;\n\n// ()\ndb.First(&user, 10)\n//// SELECT * FROM users WHERE id = 10;\n```\n\n* <b>where</b>\n\n``` go \n// Get first matched record\ndb.Where(\"name = ?\", \"jinzhu\").First(&user)\n//// SELECT * FROM users WHERE name = 'jinzhu' limit 1;\n\n// Get all matched records\ndb.Where(\"name = ?\", \"jinzhu\").Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu';\n\n// <>\ndb.Where(\"name <> ?\", \"jinzhu\").Find(&users)\n//// SELECT * FROM users WHERE name <> 'jinzhu';\n\n// IN\ndb.Where(\"name IN (?)\", []string{\"jinzhu\", \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name in ('jinzhu','jinzhu 2');\n\n// LIKE\ndb.Where(\"name LIKE ?\", \"%jin%\").Find(&users)\n//// SELECT * FROM users WHERE name LIKE '%jin%';\n\n// AND\ndb.Where(\"name = ? AND age >= ?\", \"jinzhu\", \"22\").Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu' AND age >= 22;\n\n// Time\ndb.Where(\"updated_at > ?\", lastWeek).Find(&users)\n//// SELECT * FROM users WHERE updated_at > '2000-01-01 00:00:00';\n\n// BETWEEN\ndb.Where(\"created_at BETWEEN ? AND ?\", lastWeek, today).Find(&users)\n//// SELECT * FROM users WHERE created_at BETWEEN '2000-01-01 00:00:00' AND '2000-01-08 00:00:00';\n```\n\n* <b>Struct & Map</b>\n\n``` go \n// Struct\ndb.Where(&User{Name: \"jinzhu\", Age: 20}).First(&user)\n//// SELECT * FROM users WHERE name = \"jinzhu\" AND age = 20 LIMIT 1;\n\n// Map\ndb.Where(map[string]interface{}{\"name\": \"jinzhu\", \"age\": 20}).Find(&users)\n//// SELECT * FROM users WHERE name = \"jinzhu\" AND age = 20;\n\n// \ndb.Where([]int64{20, 21, 22}).Find(&users)\n//// SELECT * FROM users WHERE id IN (20, 21, 22);\n```\n\n<font color=red><b>:</b></font>GORM0''false\n\n``` go\ndb.Where(&User{Name: \"jinzhu\", Age: 0}).Find(&users)\n//// SELECT * FROM users WHERE name = \"jinzhu\";\n```\n Scanner/Valuer :\n``` go \n// \ntype User struct {\n  gorm.Model\n  Name string\n  Age  *int\n}\n\n//  Scanner/Valuer\ntype User struct {\n  gorm.Model\n  Name string\n  Age  sql.NullInt64  // sql.NullInt64  Scanner/Valuer \n}\n```\n\n* <b>Not<b/>\n\n``` go \ndb.Not(\"name\", \"jinzhu\").First(&user)\n//// SELECT * FROM users WHERE name <> \"jinzhu\" LIMIT 1;\n\n// Not In\ndb.Not(\"name\", []string{\"jinzhu\", \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name NOT IN (\"jinzhu\", \"jinzhu 2\");\n\n// Not In slice of primary keys\ndb.Not([]int64{1,2,3}).First(&user)\n//// SELECT * FROM users WHERE id NOT IN (1,2,3);\n\ndb.Not([]int64{}).First(&user)\n//// SELECT * FROM users;\n\n// Plain SQL\ndb.Not(\"name = ?\", \"jinzhu\").First(&user)\n//// SELECT * FROM users WHERE NOT(name = \"jinzhu\");\n\n// Struct\ndb.Not(User{Name: \"jinzhu\"}).First(&user)\n//// SELECT * FROM users WHERE name <> \"jinzhu\";\n```\n\n* <b>Or<b/>\n\n``` go \ndb.Where(\"role = ?\", \"admin\").Or(\"role = ?\", \"super_admin\").Find(&users)\n//// SELECT * FROM users WHERE role = 'admin' OR role = 'super_admin';\n\n// Struct\ndb.Where(\"name = 'jinzhu'\").Or(User{Name: \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu' OR name = 'jinzhu 2';\n\n// Map\ndb.Where(\"name = 'jinzhu'\").Or(map[string]interface{}{\"name\": \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu' OR name = 'jinzhu 2';\n```\n\n* <b></b>\n\n, \n\n``` go \n//  ()\ndb.First(&user, 23)\n//// SELECT * FROM users WHERE id = 23 LIMIT 1;\n// , \ndb.First(&user, \"id = ?\", \"string_primary_key\")\n//// SELECT * FROM users WHERE id = 'string_primary_key' LIMIT 1;\n\n// Plain SQL\ndb.Find(&user, \"name = ?\", \"jinzhu\")\n//// SELECT * FROM users WHERE name = \"jinzhu\";\n\ndb.Find(&users, \"name <> ? AND age > ?\", \"jinzhu\", 20)\n//// SELECT * FROM users WHERE name <> \"jinzhu\" AND age > 20;\n\n// Struct\ndb.Find(&users, User{Age: 20})\n//// SELECT * FROM users WHERE age = 20;\n\n// Map\ndb.Find(&users, map[string]interface{}{\"age\": 20})\n//// SELECT * FROM users WHERE age = 20;\n```\n\n* <b></b>\n\n``` go \n//  SQL  SQL \ndb.Set(\"gorm:query_option\", \"FOR UPDATE\").First(&user, 10)\n//// SELECT * FROM users WHERE id = 10 FOR UPDATE;\n```\n\n* <b>FirstOrCreate</b>\n\n,  ( struct  map )\n\n``` go \n// \ndb.FirstOrCreate(&user, User{Name: \"non_existing\"})\n//// INSERT INTO \"users\" (name) VALUES (\"non_existing\");\n//// user -> User{Id: 112, Name: \"non_existing\"}\n\n// \ndb.Where(User{Name: \"Jinzhu\"}).FirstOrCreate(&user)\n//// user -> User{Id: 111, Name: \"Jinzhu\"}\n```\n\n* <b>Attrs</b>\n\n struct \n``` go\n // \ndb.Where(User{Name: \"non_existing\"}).Attrs(User{Age: 20}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'non_existing';\n//// INSERT INTO \"users\" (name, age) VALUES (\"non_existing\", 20);\n//// user -> User{Id: 112, Name: \"non_existing\", Age: 20}\n\n// \ndb.Where(User{Name: \"jinzhu\"}).Attrs(User{Age: 30}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'jinzhu';\n//// user -> User{Id: 111, Name: \"jinzhu\", Age: 20}\n```\n\n* <b>Assign</b>\n\n struct \n``` go \n// \ndb.Where(User{Name: \"non_existing\"}).Assign(User{Age: 20}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'non_existing';\n//// INSERT INTO \"users\" (name, age) VALUES (\"non_existing\", 20);\n//// user -> User{Id: 112, Name: \"non_existing\", Age: 20}\n\n// \ndb.Where(User{Name: \"jinzhu\"}).Assign(User{Age: 30}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'jinzhu';\n//// UPDATE users SET age=30 WHERE id = 111;\n//// user -> User{Id: 111, Name: \"jinzhu\", Age: 30}\n```\n\n* <b></b>\n\n `*gorm.expr` \n\n``` go\ndb.Where(\"amount > ?\", db.Table(\"orders\").Select(\"AVG(amount)\").Where(\"state = ?\", \"paid\").SubQuery()).Find(&orders)\n\n// SELECT * FROM \"orders\"  WHERE \"orders\".\"deleted_at\" IS NULL AND (amount > (SELECT AVG(amount) FROM \"orders\"  WHERE (state = 'paid')));\n```\n\n* <b></b>\n\n`Select`\n\n``` go \ndb.Select(\"name, age\").Find(&users)\n//// SELECT name, age FROM users;\n\ndb.Select([]string{\"name\", \"age\"}).Find(&users)\n//// SELECT name, age FROM users;\n\ndb.Table(\"users\").Select(\"COALESCE(age,?)\", 42).Rows()\n//// SELECT COALESCE(age,'42') FROM users;\n```\n\n* <b></b>\n\nOrder reorder  true \n\n``` go \ndb.Order(\"age desc, name\").Find(&users)\n//// SELECT * FROM users ORDER BY age desc, name;\n\n// \ndb.Order(\"age desc\").Order(\"name\").Find(&users)\n//// SELECT * FROM users ORDER BY age desc, name;\n\n// \ndb.Order(\"age desc\").Find(&users1).Order(\"age\", true).Find(&users2)\n//// SELECT * FROM users ORDER BY age desc; (users1)\n//// SELECT * FROM users ORDER BY age; (users2)\n```\n\n* <b></b>\n\nLimit\n\n``` go \ndb.Limit(3).Find(&users)\n//// SELECT * FROM users LIMIT 3;\n\n// -1  Limit \ndb.Limit(10).Find(&users1).Limit(-1).Find(&users2)\n//// SELECT * FROM users LIMIT 10; (users1)\n//// SELECT * FROM users; (users2)\n```\n\n* <b></b>\n\nOffset\n\n``` go \ndb.Offset(3).Find(&users)\n//// SELECT * FROM users OFFSET 3;\n\n// -1  Offset \ndb.Offset(10).Find(&users1).Offset(-1).Find(&users2)\n//// SELECT * FROM users OFFSET 10; (users1)\n//// SELECT * FROM users; (users2)\n```\n\n* <b></b>\n\n``` go\ndb.Where(\"name = ?\", \"jinzhu\").Or(\"name = ?\", \"jinzhu 2\").Find(&users).Count(&count)\n//// SELECT * from USERS WHERE name = 'jinzhu' OR name = 'jinzhu 2'; (users)\n//// SELECT count(*) FROM users WHERE name = 'jinzhu' OR name = 'jinzhu 2'; (count)\n\ndb.Model(&User{}).Where(\"name = ?\", \"jinzhu\").Count(&count)\n//// SELECT count(*) FROM users WHERE name = 'jinzhu'; (count)\n\ndb.Table(\"deleted_users\").Count(&count)\n//// SELECT count(*) FROM deleted_users;\n\ndb.Table(\"deleted_users\").Select(\"count(distinct(name))\").Count(&count)\n//// SELECT count( distinct(name) ) FROM deleted_users; (count)\n```\n\n<font color=red><b>:</b></font>Count   SELECT count \n\n* <b>Group & Having</b>\n\n``` go \nrows, err := db.Table(\"orders\").Select(\"date(created_at) as date, sum(amount) as total\").Group(\"date(created_at)\").Rows()\nfor rows.Next() {\n  ...\n}\n\n// Scan\ntype Result struct {\n\tDate time.Time\n\tTotal int\n}\nvar rets []Result\ndb.Table(\"users\").Select(\"date(created_at) as date, sum(age) as total\").Group(\"date(created_at)\").Scan(&rets)\n\nrows, err := db.Table(\"orders\").Select(\"date(created_at) as date, sum(amount) as total\").Group(\"date(created_at)\").Having(\"sum(amount) > ?\", 100).Rows()\nfor rows.Next() {\n  ...\n}\n\ntype Result struct {\n  Date  time.Time\n  Total int64\n}\ndb.Table(\"orders\").Select(\"date(created_at) as date, sum(amount) as total\").Group(\"date(created_at)\").Having(\"sum(amount) > ?\", 100).Scan(&results)\n```\n\n* <b></b>\n\n``` go \nrows, err := db.Table(\"users\").Select(\"users.name, emails.email\").Joins(\"left join emails on emails.user_id = users.id\").Rows()\nfor rows.Next() {\n  ...\n}\n\ndb.Table(\"users\").Select(\"users.name, emails.email\").Joins(\"left join emails on emails.user_id = users.id\").Scan(&results)\n\n// \ndb.Joins(\"JOIN emails ON emails.user_id = users.id AND emails.email = ?\", \"jinzhu@example.org\").Joins(\"JOIN credit_cards ON credit_cards.user_id = users.id\").Where(\"credit_cards.number = ?\", \"411111111111\").Find(&user)\n```\n\n* <b>Pluck</b>\n\nPluck`model``Scan`\n``` go \nvar ages []int64\ndb.Find(&users).Pluck(\"age\", &ages)\n\nvar names []string\ndb.Model(&User{}).Pluck(\"name\", &names)\n\ndb.Table(\"deleted_users\").Pluck(\"name\", &names)\n\n//  \ndb.Select(\"name, age\").Find(&users)\n```\n\n* <b>Scan<b/>\n\n``` go \ntype Result struct {\n  Name string\n  Age  int\n}\n\nvar result Result\ndb.Table(\"users\").Select(\"name, age\").Where(\"name = ?\", \"Antonio\").Scan(&result)\n\nvar results []Result\ndb.Table(\"users\").Select(\"name, age\").Where(\"id > ?\", 0).Scan(&results)\n\n//  SQL\ndb.Raw(\"SELECT name, age FROM users WHERE name = ?\", \"Antonio\").Scan(&result)\n```\n\n* <b><b/>\n\n``` go \n// \ntx := db.Where(\"name = ?\", \"jinzhu\")\n\n// \nif someCondition {\n  tx = tx.Where(\"age = ?\", 20)\n} else {\n  tx = tx.Where(\"age = ?\", 30)\n}\n\nif yetAnotherCondition {\n  tx = tx.Where(\"active = ?\", 1)\n}\n```\n\n<font color=red><b>:<b/></font>Query\n\n* <b><b/>\n\nSQL, CRUD\n`Create`, `First`, `Find`, `Take`, `Save`, `UpdateXXX`, `Delete`, `Scan`, `Row`, `Rows`\n\n* <b></b>\n\nScopesScope\n\n``` go\nfunc AmountGreaterThan1000(db *gorm.DB) *gorm.DB {\n  return db.Where(\"amount > ?\", 1000)\n}\n\nfunc PaidWithCreditCard(db *gorm.DB) *gorm.DB {\n  return db.Where(\"pay_mode_sign = ?\", \"C\")\n}\n\nfunc PaidWithCod(db *gorm.DB) *gorm.DB {\n  return db.Where(\"pay_mode_sign = ?\", \"C\")\n}\n\nfunc OrderStatus(status []string) func (db *gorm.DB) *gorm.DB {\n  return func (db *gorm.DB) *gorm.DB {\n    return db.Scopes(AmountGreaterThan1000).Where(\"status IN (?)\", status)\n  }\n}\n\ndb.Scopes(AmountGreaterThan1000, PaidWithCreditCard).Find(&orders)\n//  1000 \n\ndb.Scopes(AmountGreaterThan1000, PaidWithCod).Find(&orders)\n//  1000  COD \n\ndb.Scopes(AmountGreaterThan1000, OrderStatus([]string{\"paid\", \"shipped\"})).Find(&orders)\n//  1000 \n```\n\n* <b></b>\n\nGORM ()\n\n``` go \ndb.Where(\"name LIKE ?\", \"jinzhu%\").Find(&users, \"id IN (?)\", []int{1, 2, 3}).Count(&count)\n```\nsql:\n``` sql\nSELECT * FROM users WHERE name LIKE 'jinzhu%' AND id IN (1, 2, 3)\n\nSELECT count(*) FROM users WHERE name LIKE 'jinzhu%'\n```\n\n### <b></b>\n\n* <b></b>\n\n`Save()`\n``` go \ndb.First(&user)\n\nuser.Name = \"\"\nuser.Age = 99\ndb.Save(&user)\n\n////  UPDATE `users` SET `created_at` = '2020-02-16 12:52:20', `updated_at` = '2020-02-16 12:54:55', `deleted_at` = NULL, `name` = '', `age` = 99, `active` = true  WHERE `users`.`deleted_at` IS NULL AND `users`.`id` = 1\n```\n\n* <b></b>\n\n`Update``Updates`\n\n``` go \n// \ndb.Model(&user).Update(\"name\", \"hello\")\n//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111;\n\n// \ndb.Model(&user).Where(\"active = ?\", true).Update(\"name\", \"hello\")\n//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111 AND active=true;\n\n//  map \ndb.Model(&user).Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false})\n//// UPDATE users SET name='hello', age=18, active=false, updated_at='2013-11-17 21:34:10' WHERE id=111;\n\n//  struct \ndb.Model(&user).Updates(User{Name: \"hello\", Age: 18})\n//// UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 21:34:10' WHERE id = 111;\n\n//  struct GORM\n// \"\", 0, false \ndb.Model(&user).Updates(User{Name: \"\", Age: 0, Active: false})\n```\n\n* <b></b>\n\n`Select``Omit`\n\n``` go \ndb.Model(&user).Select(\"name\").Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false})\n//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111;\n\ndb.Model(&user).Omit(\"name\").Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false})\n//// UPDATE users SET age=18, active=false, updated_at='2013-11-17 21:34:10' WHERE id=111;\n```\n\n* <b>Hooks</b>\n\n`model``BeforeUpdate`, `AfterUpdate``UpdatedAt`, `Associations`, `UpdateColumn` `UpdateColumns`\n\n``` go \n//  `Update`\ndb.Model(&user).UpdateColumn(\"name\", \"hello\")\n//// UPDATE users SET name='hello' WHERE id = 111;\n\n//  `Updates`\ndb.Model(&user).UpdateColumns(User{Name: \"hello\", Age: 18})\n//// UPDATE users SET name='hello', age=18 WHERE id = 111;\n```\n\n* <b></b>\n\n`Hooks()`\n\n``` go \ndb.Table(\"users\").Where(\"id IN (?)\", []int{10, 11}).Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18})\n//// UPDATE users SET name='hello', age=18 WHERE id IN (10, 11);\n\n//  struct map[string]interface{}\ndb.Model(User{}).Updates(User{Name: \"hello\", Age: 18})\n//// UPDATE users SET name='hello', age=18;\n\n//  `RowsAffected` \ndb.Model(User{}).Updates(User{Name: \"hello\", Age: 18}).RowsAffected\n```\n\n* <b>sql</b>\n\nuser\n\n``` go \nvar user User\ndb.First(&user)\n```\n``` go \ndb.Model(&user).Update(\"age\", gorm.Expr(\"age * ? + ?\", 2, 100))\n//// UPDATE `users` SET `age` = age * 2 + 100, `updated_at` = '2020-02-16 13:10:20'  WHERE `users`.`id` = 1;\n\ndb.Model(&user).Updates(map[string]interface{}{\"age\": gorm.Expr(\"age * ? + ?\", 2, 100)})\n//// UPDATE \"users\" SET \"age\" = age * '2' + '100', \"updated_at\" = '2020-02-16 13:05:51' WHERE `users`.`id` = 1;\n\ndb.Model(&user).UpdateColumn(\"age\", gorm.Expr(\"age - ?\", 1))\n//// UPDATE \"users\" SET \"age\" = age - 1 WHERE \"id\" = '1';\n\ndb.Model(&user).Where(\"age > 10\").UpdateColumn(\"age\", gorm.Expr(\"age - ?\", 1))\n//// UPDATE \"users\" SET \"age\" = age - 1 WHERE \"id\" = '1' AND quantity > 10;\n```\n\n* <b>Hooks</b>\n\n`BeforeUpdate`, `BeforeSave``Hooks` `scope.SetColumn`, \n\n``` go \nfunc (user *User) BeforeSave(scope *gorm.Scope) (err error) {\n  if pw, err := bcrypt.GenerateFromPassword(user.Password, 0); err == nil {\n    scope.SetColumn(\"EncryptedPassword\", pw)\n  }\n}\n```\n\n### <b></b>\n\n* <b></b>\n\n<font color=red><b>:</b></font> GORM GORM  model \n\n``` go \n// \ndb.Delete(&email)\n//// DELETE from emails where id=10;\n\n//  SQL  SQL \ndb.Set(\"gorm:delete_option\", \"OPTION (OPTIMIZE FOR UNKNOWN)\").Delete(&email)\n//// DELETE from emails where id=10 OPTION (OPTIMIZE FOR UNKNOWN);\n```\n\n* <b></b>\n\n``` go \ndb.Where(\"email LIKE ?\", \"%jinzhu%\").Delete(Email{})\n//// DELETE from emails where email LIKE \"%jinzhu%\";\n\ndb.Delete(Email{}, \"email LIKE ?\", \"%jinzhu%\")\n//// DELETE from emails where email LIKE \"%jinzhu%\";\n```\n\n* <b></b>\n\nmodel`DeletedAt` `Delete`  `DeletedAt`\n\n``` go \ndb.Delete(&user)\n//// UPDATE users SET deleted_at=\"2013-10-29 10:23\" WHERE id = 111;\n\n// \ndb.Where(\"age = ?\", 20).Delete(&User{})\n//// UPDATE users SET deleted_at=\"2013-10-29 10:23\" WHERE age = 20;\n\n// \ndb.Where(\"age = 20\").Find(&user)\n//// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;\n\n// Unscoped \ndb.Unscoped().Where(\"age = 20\").Find(&users)\n//// SELECT * FROM users WHERE age = 20;\n```\n\n* <b></b>\n\n``` go \n// Unscoped \ndb.Unscoped().Delete(&order)\n//// DELETE FROM orders WHERE id=10;\n```\n","source":"_posts/go/go_gorm.md","raw":"---\ntitle: Golang ORM \ncategories: \n- GolangStudy\n---\n# gorm\n\nORM: object relational mapping  ()\n\n  <--->   <br/>\n  <--->   <br/>\n    <--->   <br/>\n\n## gorm\n\n``` bash\ngo get -u \"github.com/jinzhu/gorm\"\n```\n\n## gorm\n\n`GORM`:\n\n``` go \nimport _ \"github.com/jinzhu/gorm/dialects/mysql\"\n// import _ \"github.com/jinzhu/gorm/dialects/postgres\"\n// import _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n// import _ \"github.com/jinzhu/gorm/dialects/mssql\"\n```\n\n* mysql\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/mysql\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"mysql\", \"user:password@(localhost)/dbname?charset=utf8mb4&parseTime=True&loc=Local\")\n  defer db.Close()\n}\n```\n\n* postgreSql\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"postgres\", \"host=myhost port=myport user=gorm dbname=gorm password=mypassword\")\n  defer db.Close()\n}\n```\n\n* Sqlite3\n\n`Sqlite3`\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"sqlite3\", \"/tmp/gorm.db\")\n  defer db.Close()\n}\n```\n\n* SQL server\n\n``` go\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/mssql\"\n)\n\nfunc main() {\n  db, err := gorm.Open(\"mssql\", \"sqlserver://username:password@localhost:1433?database=dbname\")\n  defer db.Close()\n}\n```\n\n## Dockermysql\n\n1. mysql:\n``` bash\nsudo docker pull mysql\n```\n2. `13306``mysql8019``root` `root1234`MySQL:\n``` bash\ndocker run --name mysql8019 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=cv11010216 -d mysql:8.0.19\n```\n3. `MySQL Client`:\n``` bash\ndocker run -it --network host --rm mysql mysql -h127.0.0.1 -P3306 --default-character-set=utf8mb4 -uroot -p\n```\n\n## gormmysql\n\n``` go \npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/jinzhu/gorm\"\n)\nimport _ \"github.com/jinzhu/gorm/dialects/mysql\"\n\ntype UserInfo struct {\n\tID int\n\tName string\n\tGender string\n\tHobby string\n}\n\nfunc main() {\n\t//\n\tdb, err := gorm.Open(\"mysql\", \"root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&parseTime=True\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\n\t// ()\n\tdb.AutoMigrate(&UserInfo{})\n\n\t//\n\tu1 := UserInfo{1, \"lijiahao\", \"male\", \"zhaozijin\"}\n\tdb.Create(&u1)\n\n\t//\n\tvar u UserInfo\n\tvar uu UserInfo\n\tdb.First(&u)\n\tfmt.Printf(\"%#v\\n\", u)\n\tdb.Find(&uu, \"hoddy=?\", \"\")\n\tfmt.printf(\"%v\", uu)\n\n\t//\n\tdb.Model(&u).Update(\"bobby\", \"\")\n\n\t//\n\tdb.Delete(&u)\n}\n```\n\n* gorm Model\n\n``` go \ntype User struct {\n\tgorm.Model\n\tName string\n\tAge sql.NullInt64 //\n\tBirthday *time.Time\n\tEmail string `gorm:\"type:varchar(120);unique_index\"`\n\tRole string `gorm:\"size:255\"`  //255\n\tMemberNumber *string `gorm:\"unique;not null\"` //\n\tNum int `gorm:\"AUTO_INCREMENT\"` //num\n\tAddress string \t`gorm:\"index:addr\"` //addressaddr\n\tIgnoreMe int `gorm:\"-\"` //\n\n}\n```\n\n* gorm.Model\n\nGORM`gorm.Model``gorm.Model``ID`, `CreatedAt`, `UpdatedAt`, `DeletedAt`Golang\n\n``` go \n// gorm.Model \ntype Model struct {\n  ID        uint `gorm:\"primary_key\"`\n  CreatedAt time.Time\n  UpdatedAt time.Time\n  DeletedAt *time.Time\n}\n```\n* \n\nGORM ID\n``` go \ntype User struct {\n  ID   string // `ID`\n  Name string\n}\n\n// `AnimalID`\ntype Animal struct {\n  AnimalID int64 `gorm:\"primary_key\"`\n  Name     string\n  Age      int64\n}\n```\n\n* \n\n:\n``` go \ntype User struct {} //  `users`\n\n//  User  `profiles`\nfunc (User) TableName() string {\n  return \"profiles\"\n}\n\nfunc (u User) TableName() string {\n  if u.Role == \"admin\" {\n    return \"admin_users\"\n  } else {\n    return \"users\"\n  }\n}\n\n//  true `User`  `user`\ndb.SingularTable(true)\n```\n\n`Table()`\n\n``` go \n// User`deleted_users`\ndb.Table(\"deleted_users\").CreateTable(&User{})\n\nvar deleted_users []User\ndb.Table(\"deleted_users\").Find(&deleted_users)\n//// SELECT * FROM deleted_users;\n\ndb.Table(\"deleted_users\").Where(\"name = ?\", \"jinzhu\").Delete()\n//// DELETE FROM deleted_users WHERE name = 'jinzhu';\n```\n\nGORM\n\n``` go\ngorm.DefaultTableNameHandler = func (db *gorm.DB, defaultTableName string) string  {\n  return \"sms_\" + defaultTableName;\n}\n```\n\n* \n\n``` go \ntype User struct {\n  ID        uint      // column name is `id`\n  Name      string    // column name is `name`\n  Birthday  time.Time // column name is `birthday`\n  CreatedAt time.Time // column name is `created_at`\n}\n```\n\ntag\n\n``` go\ntype Animal struct {\n  AnimalId    int64     `gorm:\"column:beast_id\"`        \n  Birthday    time.Time `gorm:\"column:day_of_the_beast\"` \n  Age         int64     `gorm:\"column:age_of_the_beast\"`\n}\n```\n\n## gorm CRUD \n\n### <b></b>\n\n``` go\npackage main\n\nimport \"github.com/jinzhu/gorm\"\nimport _\"github.com/jinzhu/gorm/dialects/mysql\"\n\n// 1. \ntype Person struct {\n\tID int64\n\tName string `gorm:\"default:''\"` //tag\n\tAge int64\n}\n\nfunc main() {\n\tdb, err := gorm.Open(\"mysql\", \"root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&parseTime=True\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer db.Close()\n\n\t//2. \n\tdb.AutoMigrate(&Person{})\n\n\t//3. \n\tu := Person{\n\t\tID: 1,\n\t\tAge: 17,\n\t}\n\t//NewRecord()Create()\n\tprintln(db.NewRecord(&u))\n\tdb.Create(&u)\n\tprintln(db.NewRecord(&u))\n}\n```\n\n<font color=red>:</font>tag SQL    Gorm\n\n`eg:`\n\n``` go \nvar user = User{Name: \"\", Age: 99}\ndb.Create(&user)\n```\n\n<font color=red>:</font>SQL`INSERT INTO users(\"age\") values('99');`NameName\n\n<font color=red>:</font>, 0, \"\",false  Scanner/Valuer\n\n(1). :\n\n``` go \n// \ntype User struct {\n  ID   int64\n  Name *string `gorm:\"default:''\"`\n  Age  int64\n}\nuser := User{Name: new(string), Age: 18))}\ndb.Create(&user)  // name''\n```\n\n(2). Scanner/Valuer\n\n``` go \n//  Scanner/Valuer\ntype User struct {\n\tID int64\n\tName sql.NullString `gorm:\"default:''\"` // sql.NullString Scanner/Valuer\n\tAge  int64\n}\nuser := User{Name: sql.NullString{\"\", true}, Age:18}\ndb.Create(&user)  // name''\n```\n\n### <b></b>\n\n* <b></b>\n\n``` go \n// \ndb.First(&user)\n//// SELECT * FROM users ORDER BY id LIMIT 1;\n\n// \ndb.Take(&user)\n//// SELECT * FROM users LIMIT 1;\n\n// \ndb.Last(&user)\n//// SELECT * FROM users ORDER BY id DESC LIMIT 1;\n\n// \ndb.Find(&users)\n//// SELECT * FROM users;\n\n// ()\ndb.First(&user, 10)\n//// SELECT * FROM users WHERE id = 10;\n```\n\n* <b>where</b>\n\n``` go \n// Get first matched record\ndb.Where(\"name = ?\", \"jinzhu\").First(&user)\n//// SELECT * FROM users WHERE name = 'jinzhu' limit 1;\n\n// Get all matched records\ndb.Where(\"name = ?\", \"jinzhu\").Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu';\n\n// <>\ndb.Where(\"name <> ?\", \"jinzhu\").Find(&users)\n//// SELECT * FROM users WHERE name <> 'jinzhu';\n\n// IN\ndb.Where(\"name IN (?)\", []string{\"jinzhu\", \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name in ('jinzhu','jinzhu 2');\n\n// LIKE\ndb.Where(\"name LIKE ?\", \"%jin%\").Find(&users)\n//// SELECT * FROM users WHERE name LIKE '%jin%';\n\n// AND\ndb.Where(\"name = ? AND age >= ?\", \"jinzhu\", \"22\").Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu' AND age >= 22;\n\n// Time\ndb.Where(\"updated_at > ?\", lastWeek).Find(&users)\n//// SELECT * FROM users WHERE updated_at > '2000-01-01 00:00:00';\n\n// BETWEEN\ndb.Where(\"created_at BETWEEN ? AND ?\", lastWeek, today).Find(&users)\n//// SELECT * FROM users WHERE created_at BETWEEN '2000-01-01 00:00:00' AND '2000-01-08 00:00:00';\n```\n\n* <b>Struct & Map</b>\n\n``` go \n// Struct\ndb.Where(&User{Name: \"jinzhu\", Age: 20}).First(&user)\n//// SELECT * FROM users WHERE name = \"jinzhu\" AND age = 20 LIMIT 1;\n\n// Map\ndb.Where(map[string]interface{}{\"name\": \"jinzhu\", \"age\": 20}).Find(&users)\n//// SELECT * FROM users WHERE name = \"jinzhu\" AND age = 20;\n\n// \ndb.Where([]int64{20, 21, 22}).Find(&users)\n//// SELECT * FROM users WHERE id IN (20, 21, 22);\n```\n\n<font color=red><b>:</b></font>GORM0''false\n\n``` go\ndb.Where(&User{Name: \"jinzhu\", Age: 0}).Find(&users)\n//// SELECT * FROM users WHERE name = \"jinzhu\";\n```\n Scanner/Valuer :\n``` go \n// \ntype User struct {\n  gorm.Model\n  Name string\n  Age  *int\n}\n\n//  Scanner/Valuer\ntype User struct {\n  gorm.Model\n  Name string\n  Age  sql.NullInt64  // sql.NullInt64  Scanner/Valuer \n}\n```\n\n* <b>Not<b/>\n\n``` go \ndb.Not(\"name\", \"jinzhu\").First(&user)\n//// SELECT * FROM users WHERE name <> \"jinzhu\" LIMIT 1;\n\n// Not In\ndb.Not(\"name\", []string{\"jinzhu\", \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name NOT IN (\"jinzhu\", \"jinzhu 2\");\n\n// Not In slice of primary keys\ndb.Not([]int64{1,2,3}).First(&user)\n//// SELECT * FROM users WHERE id NOT IN (1,2,3);\n\ndb.Not([]int64{}).First(&user)\n//// SELECT * FROM users;\n\n// Plain SQL\ndb.Not(\"name = ?\", \"jinzhu\").First(&user)\n//// SELECT * FROM users WHERE NOT(name = \"jinzhu\");\n\n// Struct\ndb.Not(User{Name: \"jinzhu\"}).First(&user)\n//// SELECT * FROM users WHERE name <> \"jinzhu\";\n```\n\n* <b>Or<b/>\n\n``` go \ndb.Where(\"role = ?\", \"admin\").Or(\"role = ?\", \"super_admin\").Find(&users)\n//// SELECT * FROM users WHERE role = 'admin' OR role = 'super_admin';\n\n// Struct\ndb.Where(\"name = 'jinzhu'\").Or(User{Name: \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu' OR name = 'jinzhu 2';\n\n// Map\ndb.Where(\"name = 'jinzhu'\").Or(map[string]interface{}{\"name\": \"jinzhu 2\"}).Find(&users)\n//// SELECT * FROM users WHERE name = 'jinzhu' OR name = 'jinzhu 2';\n```\n\n* <b></b>\n\n, \n\n``` go \n//  ()\ndb.First(&user, 23)\n//// SELECT * FROM users WHERE id = 23 LIMIT 1;\n// , \ndb.First(&user, \"id = ?\", \"string_primary_key\")\n//// SELECT * FROM users WHERE id = 'string_primary_key' LIMIT 1;\n\n// Plain SQL\ndb.Find(&user, \"name = ?\", \"jinzhu\")\n//// SELECT * FROM users WHERE name = \"jinzhu\";\n\ndb.Find(&users, \"name <> ? AND age > ?\", \"jinzhu\", 20)\n//// SELECT * FROM users WHERE name <> \"jinzhu\" AND age > 20;\n\n// Struct\ndb.Find(&users, User{Age: 20})\n//// SELECT * FROM users WHERE age = 20;\n\n// Map\ndb.Find(&users, map[string]interface{}{\"age\": 20})\n//// SELECT * FROM users WHERE age = 20;\n```\n\n* <b></b>\n\n``` go \n//  SQL  SQL \ndb.Set(\"gorm:query_option\", \"FOR UPDATE\").First(&user, 10)\n//// SELECT * FROM users WHERE id = 10 FOR UPDATE;\n```\n\n* <b>FirstOrCreate</b>\n\n,  ( struct  map )\n\n``` go \n// \ndb.FirstOrCreate(&user, User{Name: \"non_existing\"})\n//// INSERT INTO \"users\" (name) VALUES (\"non_existing\");\n//// user -> User{Id: 112, Name: \"non_existing\"}\n\n// \ndb.Where(User{Name: \"Jinzhu\"}).FirstOrCreate(&user)\n//// user -> User{Id: 111, Name: \"Jinzhu\"}\n```\n\n* <b>Attrs</b>\n\n struct \n``` go\n // \ndb.Where(User{Name: \"non_existing\"}).Attrs(User{Age: 20}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'non_existing';\n//// INSERT INTO \"users\" (name, age) VALUES (\"non_existing\", 20);\n//// user -> User{Id: 112, Name: \"non_existing\", Age: 20}\n\n// \ndb.Where(User{Name: \"jinzhu\"}).Attrs(User{Age: 30}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'jinzhu';\n//// user -> User{Id: 111, Name: \"jinzhu\", Age: 20}\n```\n\n* <b>Assign</b>\n\n struct \n``` go \n// \ndb.Where(User{Name: \"non_existing\"}).Assign(User{Age: 20}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'non_existing';\n//// INSERT INTO \"users\" (name, age) VALUES (\"non_existing\", 20);\n//// user -> User{Id: 112, Name: \"non_existing\", Age: 20}\n\n// \ndb.Where(User{Name: \"jinzhu\"}).Assign(User{Age: 30}).FirstOrCreate(&user)\n//// SELECT * FROM users WHERE name = 'jinzhu';\n//// UPDATE users SET age=30 WHERE id = 111;\n//// user -> User{Id: 111, Name: \"jinzhu\", Age: 30}\n```\n\n* <b></b>\n\n `*gorm.expr` \n\n``` go\ndb.Where(\"amount > ?\", db.Table(\"orders\").Select(\"AVG(amount)\").Where(\"state = ?\", \"paid\").SubQuery()).Find(&orders)\n\n// SELECT * FROM \"orders\"  WHERE \"orders\".\"deleted_at\" IS NULL AND (amount > (SELECT AVG(amount) FROM \"orders\"  WHERE (state = 'paid')));\n```\n\n* <b></b>\n\n`Select`\n\n``` go \ndb.Select(\"name, age\").Find(&users)\n//// SELECT name, age FROM users;\n\ndb.Select([]string{\"name\", \"age\"}).Find(&users)\n//// SELECT name, age FROM users;\n\ndb.Table(\"users\").Select(\"COALESCE(age,?)\", 42).Rows()\n//// SELECT COALESCE(age,'42') FROM users;\n```\n\n* <b></b>\n\nOrder reorder  true \n\n``` go \ndb.Order(\"age desc, name\").Find(&users)\n//// SELECT * FROM users ORDER BY age desc, name;\n\n// \ndb.Order(\"age desc\").Order(\"name\").Find(&users)\n//// SELECT * FROM users ORDER BY age desc, name;\n\n// \ndb.Order(\"age desc\").Find(&users1).Order(\"age\", true).Find(&users2)\n//// SELECT * FROM users ORDER BY age desc; (users1)\n//// SELECT * FROM users ORDER BY age; (users2)\n```\n\n* <b></b>\n\nLimit\n\n``` go \ndb.Limit(3).Find(&users)\n//// SELECT * FROM users LIMIT 3;\n\n// -1  Limit \ndb.Limit(10).Find(&users1).Limit(-1).Find(&users2)\n//// SELECT * FROM users LIMIT 10; (users1)\n//// SELECT * FROM users; (users2)\n```\n\n* <b></b>\n\nOffset\n\n``` go \ndb.Offset(3).Find(&users)\n//// SELECT * FROM users OFFSET 3;\n\n// -1  Offset \ndb.Offset(10).Find(&users1).Offset(-1).Find(&users2)\n//// SELECT * FROM users OFFSET 10; (users1)\n//// SELECT * FROM users; (users2)\n```\n\n* <b></b>\n\n``` go\ndb.Where(\"name = ?\", \"jinzhu\").Or(\"name = ?\", \"jinzhu 2\").Find(&users).Count(&count)\n//// SELECT * from USERS WHERE name = 'jinzhu' OR name = 'jinzhu 2'; (users)\n//// SELECT count(*) FROM users WHERE name = 'jinzhu' OR name = 'jinzhu 2'; (count)\n\ndb.Model(&User{}).Where(\"name = ?\", \"jinzhu\").Count(&count)\n//// SELECT count(*) FROM users WHERE name = 'jinzhu'; (count)\n\ndb.Table(\"deleted_users\").Count(&count)\n//// SELECT count(*) FROM deleted_users;\n\ndb.Table(\"deleted_users\").Select(\"count(distinct(name))\").Count(&count)\n//// SELECT count( distinct(name) ) FROM deleted_users; (count)\n```\n\n<font color=red><b>:</b></font>Count   SELECT count \n\n* <b>Group & Having</b>\n\n``` go \nrows, err := db.Table(\"orders\").Select(\"date(created_at) as date, sum(amount) as total\").Group(\"date(created_at)\").Rows()\nfor rows.Next() {\n  ...\n}\n\n// Scan\ntype Result struct {\n\tDate time.Time\n\tTotal int\n}\nvar rets []Result\ndb.Table(\"users\").Select(\"date(created_at) as date, sum(age) as total\").Group(\"date(created_at)\").Scan(&rets)\n\nrows, err := db.Table(\"orders\").Select(\"date(created_at) as date, sum(amount) as total\").Group(\"date(created_at)\").Having(\"sum(amount) > ?\", 100).Rows()\nfor rows.Next() {\n  ...\n}\n\ntype Result struct {\n  Date  time.Time\n  Total int64\n}\ndb.Table(\"orders\").Select(\"date(created_at) as date, sum(amount) as total\").Group(\"date(created_at)\").Having(\"sum(amount) > ?\", 100).Scan(&results)\n```\n\n* <b></b>\n\n``` go \nrows, err := db.Table(\"users\").Select(\"users.name, emails.email\").Joins(\"left join emails on emails.user_id = users.id\").Rows()\nfor rows.Next() {\n  ...\n}\n\ndb.Table(\"users\").Select(\"users.name, emails.email\").Joins(\"left join emails on emails.user_id = users.id\").Scan(&results)\n\n// \ndb.Joins(\"JOIN emails ON emails.user_id = users.id AND emails.email = ?\", \"jinzhu@example.org\").Joins(\"JOIN credit_cards ON credit_cards.user_id = users.id\").Where(\"credit_cards.number = ?\", \"411111111111\").Find(&user)\n```\n\n* <b>Pluck</b>\n\nPluck`model``Scan`\n``` go \nvar ages []int64\ndb.Find(&users).Pluck(\"age\", &ages)\n\nvar names []string\ndb.Model(&User{}).Pluck(\"name\", &names)\n\ndb.Table(\"deleted_users\").Pluck(\"name\", &names)\n\n//  \ndb.Select(\"name, age\").Find(&users)\n```\n\n* <b>Scan<b/>\n\n``` go \ntype Result struct {\n  Name string\n  Age  int\n}\n\nvar result Result\ndb.Table(\"users\").Select(\"name, age\").Where(\"name = ?\", \"Antonio\").Scan(&result)\n\nvar results []Result\ndb.Table(\"users\").Select(\"name, age\").Where(\"id > ?\", 0).Scan(&results)\n\n//  SQL\ndb.Raw(\"SELECT name, age FROM users WHERE name = ?\", \"Antonio\").Scan(&result)\n```\n\n* <b><b/>\n\n``` go \n// \ntx := db.Where(\"name = ?\", \"jinzhu\")\n\n// \nif someCondition {\n  tx = tx.Where(\"age = ?\", 20)\n} else {\n  tx = tx.Where(\"age = ?\", 30)\n}\n\nif yetAnotherCondition {\n  tx = tx.Where(\"active = ?\", 1)\n}\n```\n\n<font color=red><b>:<b/></font>Query\n\n* <b><b/>\n\nSQL, CRUD\n`Create`, `First`, `Find`, `Take`, `Save`, `UpdateXXX`, `Delete`, `Scan`, `Row`, `Rows`\n\n* <b></b>\n\nScopesScope\n\n``` go\nfunc AmountGreaterThan1000(db *gorm.DB) *gorm.DB {\n  return db.Where(\"amount > ?\", 1000)\n}\n\nfunc PaidWithCreditCard(db *gorm.DB) *gorm.DB {\n  return db.Where(\"pay_mode_sign = ?\", \"C\")\n}\n\nfunc PaidWithCod(db *gorm.DB) *gorm.DB {\n  return db.Where(\"pay_mode_sign = ?\", \"C\")\n}\n\nfunc OrderStatus(status []string) func (db *gorm.DB) *gorm.DB {\n  return func (db *gorm.DB) *gorm.DB {\n    return db.Scopes(AmountGreaterThan1000).Where(\"status IN (?)\", status)\n  }\n}\n\ndb.Scopes(AmountGreaterThan1000, PaidWithCreditCard).Find(&orders)\n//  1000 \n\ndb.Scopes(AmountGreaterThan1000, PaidWithCod).Find(&orders)\n//  1000  COD \n\ndb.Scopes(AmountGreaterThan1000, OrderStatus([]string{\"paid\", \"shipped\"})).Find(&orders)\n//  1000 \n```\n\n* <b></b>\n\nGORM ()\n\n``` go \ndb.Where(\"name LIKE ?\", \"jinzhu%\").Find(&users, \"id IN (?)\", []int{1, 2, 3}).Count(&count)\n```\nsql:\n``` sql\nSELECT * FROM users WHERE name LIKE 'jinzhu%' AND id IN (1, 2, 3)\n\nSELECT count(*) FROM users WHERE name LIKE 'jinzhu%'\n```\n\n### <b></b>\n\n* <b></b>\n\n`Save()`\n``` go \ndb.First(&user)\n\nuser.Name = \"\"\nuser.Age = 99\ndb.Save(&user)\n\n////  UPDATE `users` SET `created_at` = '2020-02-16 12:52:20', `updated_at` = '2020-02-16 12:54:55', `deleted_at` = NULL, `name` = '', `age` = 99, `active` = true  WHERE `users`.`deleted_at` IS NULL AND `users`.`id` = 1\n```\n\n* <b></b>\n\n`Update``Updates`\n\n``` go \n// \ndb.Model(&user).Update(\"name\", \"hello\")\n//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111;\n\n// \ndb.Model(&user).Where(\"active = ?\", true).Update(\"name\", \"hello\")\n//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111 AND active=true;\n\n//  map \ndb.Model(&user).Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false})\n//// UPDATE users SET name='hello', age=18, active=false, updated_at='2013-11-17 21:34:10' WHERE id=111;\n\n//  struct \ndb.Model(&user).Updates(User{Name: \"hello\", Age: 18})\n//// UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 21:34:10' WHERE id = 111;\n\n//  struct GORM\n// \"\", 0, false \ndb.Model(&user).Updates(User{Name: \"\", Age: 0, Active: false})\n```\n\n* <b></b>\n\n`Select``Omit`\n\n``` go \ndb.Model(&user).Select(\"name\").Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false})\n//// UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111;\n\ndb.Model(&user).Omit(\"name\").Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false})\n//// UPDATE users SET age=18, active=false, updated_at='2013-11-17 21:34:10' WHERE id=111;\n```\n\n* <b>Hooks</b>\n\n`model``BeforeUpdate`, `AfterUpdate``UpdatedAt`, `Associations`, `UpdateColumn` `UpdateColumns`\n\n``` go \n//  `Update`\ndb.Model(&user).UpdateColumn(\"name\", \"hello\")\n//// UPDATE users SET name='hello' WHERE id = 111;\n\n//  `Updates`\ndb.Model(&user).UpdateColumns(User{Name: \"hello\", Age: 18})\n//// UPDATE users SET name='hello', age=18 WHERE id = 111;\n```\n\n* <b></b>\n\n`Hooks()`\n\n``` go \ndb.Table(\"users\").Where(\"id IN (?)\", []int{10, 11}).Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18})\n//// UPDATE users SET name='hello', age=18 WHERE id IN (10, 11);\n\n//  struct map[string]interface{}\ndb.Model(User{}).Updates(User{Name: \"hello\", Age: 18})\n//// UPDATE users SET name='hello', age=18;\n\n//  `RowsAffected` \ndb.Model(User{}).Updates(User{Name: \"hello\", Age: 18}).RowsAffected\n```\n\n* <b>sql</b>\n\nuser\n\n``` go \nvar user User\ndb.First(&user)\n```\n``` go \ndb.Model(&user).Update(\"age\", gorm.Expr(\"age * ? + ?\", 2, 100))\n//// UPDATE `users` SET `age` = age * 2 + 100, `updated_at` = '2020-02-16 13:10:20'  WHERE `users`.`id` = 1;\n\ndb.Model(&user).Updates(map[string]interface{}{\"age\": gorm.Expr(\"age * ? + ?\", 2, 100)})\n//// UPDATE \"users\" SET \"age\" = age * '2' + '100', \"updated_at\" = '2020-02-16 13:05:51' WHERE `users`.`id` = 1;\n\ndb.Model(&user).UpdateColumn(\"age\", gorm.Expr(\"age - ?\", 1))\n//// UPDATE \"users\" SET \"age\" = age - 1 WHERE \"id\" = '1';\n\ndb.Model(&user).Where(\"age > 10\").UpdateColumn(\"age\", gorm.Expr(\"age - ?\", 1))\n//// UPDATE \"users\" SET \"age\" = age - 1 WHERE \"id\" = '1' AND quantity > 10;\n```\n\n* <b>Hooks</b>\n\n`BeforeUpdate`, `BeforeSave``Hooks` `scope.SetColumn`, \n\n``` go \nfunc (user *User) BeforeSave(scope *gorm.Scope) (err error) {\n  if pw, err := bcrypt.GenerateFromPassword(user.Password, 0); err == nil {\n    scope.SetColumn(\"EncryptedPassword\", pw)\n  }\n}\n```\n\n### <b></b>\n\n* <b></b>\n\n<font color=red><b>:</b></font> GORM GORM  model \n\n``` go \n// \ndb.Delete(&email)\n//// DELETE from emails where id=10;\n\n//  SQL  SQL \ndb.Set(\"gorm:delete_option\", \"OPTION (OPTIMIZE FOR UNKNOWN)\").Delete(&email)\n//// DELETE from emails where id=10 OPTION (OPTIMIZE FOR UNKNOWN);\n```\n\n* <b></b>\n\n``` go \ndb.Where(\"email LIKE ?\", \"%jinzhu%\").Delete(Email{})\n//// DELETE from emails where email LIKE \"%jinzhu%\";\n\ndb.Delete(Email{}, \"email LIKE ?\", \"%jinzhu%\")\n//// DELETE from emails where email LIKE \"%jinzhu%\";\n```\n\n* <b></b>\n\nmodel`DeletedAt` `Delete`  `DeletedAt`\n\n``` go \ndb.Delete(&user)\n//// UPDATE users SET deleted_at=\"2013-10-29 10:23\" WHERE id = 111;\n\n// \ndb.Where(\"age = ?\", 20).Delete(&User{})\n//// UPDATE users SET deleted_at=\"2013-10-29 10:23\" WHERE age = 20;\n\n// \ndb.Where(\"age = 20\").Find(&user)\n//// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;\n\n// Unscoped \ndb.Unscoped().Where(\"age = 20\").Find(&users)\n//// SELECT * FROM users WHERE age = 20;\n```\n\n* <b></b>\n\n``` go \n// Unscoped \ndb.Unscoped().Delete(&order)\n//// DELETE FROM orders WHERE id=10;\n```\n","slug":"go/go_gorm","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6e4000cf8wzhrmw9i2t","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"gorm\"><a href=\"#gorm\" class=\"headerlink\" title=\"gorm\"></a>gorm</h1><p>ORM: object relational mapping  ()</p>\n<p>  &lt;&gt;   <br/><br>  &lt;&gt;   <br/><br>    &lt;&gt;   <br/></p>\n<h2 id=\"gorm\"><a href=\"#gorm\" class=\"headerlink\" title=\"gorm\"></a>gorm</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"gorm\"><a href=\"#gorm\" class=\"headerlink\" title=\"gorm\"></a>gorm</h2><p><code>GORM</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import _ &quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import _ &quot;github.com/jinzhu/gorm/dialects/sqlite&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import _ &quot;github.com/jinzhu/gorm/dialects/mssql&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mysql</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;mysql&quot;</span>, <span class=\"string\">&quot;user:password@(localhost)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>postgreSql</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;postgres&quot;</span>, <span class=\"string\">&quot;host=myhost port=myport user=gorm dbname=gorm password=mypassword&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Sqlite3</li>\n</ul>\n<p><code>Sqlite3</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/sqlite&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;sqlite3&quot;</span>, <span class=\"string\">&quot;/tmp/gorm.db&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>SQL server</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mssql&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;mssql&quot;</span>, <span class=\"string\">&quot;sqlserver://username:password@localhost:1433?database=dbname&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Dockermysql\"><a href=\"#Dockermysql\" class=\"headerlink\" title=\"Dockermysql\"></a>Dockermysql</h2><ol>\n<li>mysql:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull mysql</span><br></pre></td></tr></table></figure></li>\n<li><code>13306</code><code>mysql8019</code><code>root</code> <code>root1234</code>MySQL:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name mysql8019 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=cv11010216 -d mysql:8.0.19</span><br></pre></td></tr></table></figure></li>\n<li><code>MySQL Client</code>:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --network host --<span class=\"built_in\">rm</span> mysql mysql -h127.0.0.1 -P3306 --default-character-set=utf8mb4 -uroot -p</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"gormmysql\"><a href=\"#gormmysql\" class=\"headerlink\" title=\"gormmysql\"></a>gormmysql</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">import</span> _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> UserInfo <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tID <span class=\"type\">int</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span></span><br><span class=\"line\">\tGender <span class=\"type\">string</span></span><br><span class=\"line\">\tHobby <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tdb, err := gorm.Open(<span class=\"string\">&quot;mysql&quot;</span>, <span class=\"string\">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// ()</span></span><br><span class=\"line\">\tdb.AutoMigrate(&amp;UserInfo&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tu1 := UserInfo&#123;<span class=\"number\">1</span>, <span class=\"string\">&quot;lijiahao&quot;</span>, <span class=\"string\">&quot;male&quot;</span>, <span class=\"string\">&quot;zhaozijin&quot;</span>&#125;</span><br><span class=\"line\">\tdb.Create(&amp;u1)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> uu UserInfo</span><br><span class=\"line\">\tdb.First(&amp;u)</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;%#v\\n&quot;</span>, u)</span><br><span class=\"line\">\tdb.Find(&amp;uu, <span class=\"string\">&quot;hoddy=?&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\tfmt.printf(<span class=\"string\">&quot;%v&quot;</span>, uu)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tdb.Model(&amp;u).Update(<span class=\"string\">&quot;bobby&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tdb.Delete(&amp;u)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>gorm Model</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tgorm.Model</span><br><span class=\"line\">\tName <span class=\"type\">string</span></span><br><span class=\"line\">\tAge sql.NullInt64 <span class=\"comment\">//</span></span><br><span class=\"line\">\tBirthday *time.Time</span><br><span class=\"line\">\tEmail <span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;type:varchar(120);unique_index&quot;`</span></span><br><span class=\"line\">\tRole <span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;size:255&quot;`</span>  <span class=\"comment\">//255</span></span><br><span class=\"line\">\tMemberNumber *<span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;unique;not null&quot;`</span> <span class=\"comment\">//</span></span><br><span class=\"line\">\tNum <span class=\"type\">int</span> <span class=\"string\">`gorm:&quot;AUTO_INCREMENT&quot;`</span> <span class=\"comment\">//num</span></span><br><span class=\"line\">\tAddress <span class=\"type\">string</span> \t<span class=\"string\">`gorm:&quot;index:addr&quot;`</span> <span class=\"comment\">//addressaddr</span></span><br><span class=\"line\">\tIgnoreMe <span class=\"type\">int</span> <span class=\"string\">`gorm:&quot;-&quot;`</span> <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>gorm.Model</li>\n</ul>\n<p>GORM<code>gorm.Model</code><code>gorm.Model</code><code>ID</code>, <code>CreatedAt</code>, <code>UpdatedAt</code>, <code>DeletedAt</code>Golang</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// gorm.Model </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Model <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID        <span class=\"type\">uint</span> <span class=\"string\">`gorm:&quot;primary_key&quot;`</span></span><br><span class=\"line\">  CreatedAt time.Time</span><br><span class=\"line\">  UpdatedAt time.Time</span><br><span class=\"line\">  DeletedAt *time.Time</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li></li>\n</ul>\n<p>GORM ID</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID   <span class=\"type\">string</span> <span class=\"comment\">// `ID`</span></span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// `AnimalID`</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Animal <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  AnimalID <span class=\"type\">int64</span> <span class=\"string\">`gorm:&quot;primary_key&quot;`</span></span><br><span class=\"line\">  Name     <span class=\"type\">string</span></span><br><span class=\"line\">  Age      <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;&#125; <span class=\"comment\">//  `users`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  User  `profiles`</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(User)</span></span> TableName() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;profiles&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(u User)</span></span> TableName() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> u.Role == <span class=\"string\">&quot;admin&quot;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;admin_users&quot;</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;users&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  true `User`  `user`</span></span><br><span class=\"line\">db.SingularTable(<span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>Table()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// User`deleted_users`</span></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).CreateTable(&amp;User&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> deleted_users []User</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Find(&amp;deleted_users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM deleted_users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Delete()</span><br><span class=\"line\"><span class=\"comment\">//// DELETE FROM deleted_users WHERE name = &#x27;jinzhu&#x27;;</span></span><br></pre></td></tr></table></figure>\n\n<p>GORM</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gorm.DefaultTableNameHandler = <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(db *gorm.DB, defaultTableName <span class=\"type\">string</span>)</span></span> <span class=\"type\">string</span>  &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;sms_&quot;</span> + defaultTableName;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID        <span class=\"type\">uint</span>      <span class=\"comment\">// column name is `id`</span></span><br><span class=\"line\">  Name      <span class=\"type\">string</span>    <span class=\"comment\">// column name is `name`</span></span><br><span class=\"line\">  Birthday  time.Time <span class=\"comment\">// column name is `birthday`</span></span><br><span class=\"line\">  CreatedAt time.Time <span class=\"comment\">// column name is `created_at`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>tag</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Animal <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  AnimalId    <span class=\"type\">int64</span>     <span class=\"string\">`gorm:&quot;column:beast_id&quot;`</span>        </span><br><span class=\"line\">  Birthday    time.Time <span class=\"string\">`gorm:&quot;column:day_of_the_beast&quot;`</span> </span><br><span class=\"line\">  Age         <span class=\"type\">int64</span>     <span class=\"string\">`gorm:&quot;column:age_of_the_beast&quot;`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"gorm-CRUD\"><a href=\"#gorm-CRUD\" class=\"headerlink\" title=\"gorm CRUD\"></a>gorm CRUD</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> _<span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1. </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Person <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tID <span class=\"type\">int64</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;default:&#x27;&#x27;&quot;`</span> <span class=\"comment\">//tag</span></span><br><span class=\"line\">\tAge <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tdb, err := gorm.Open(<span class=\"string\">&quot;mysql&quot;</span>, <span class=\"string\">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//2. </span></span><br><span class=\"line\">\tdb.AutoMigrate(&amp;Person&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//3. </span></span><br><span class=\"line\">\tu := Person&#123;</span><br><span class=\"line\">\t\tID: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\tAge: <span class=\"number\">17</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//NewRecord()Create()</span></span><br><span class=\"line\">\t<span class=\"built_in\">println</span>(db.NewRecord(&amp;u))</span><br><span class=\"line\">\tdb.Create(&amp;u)</span><br><span class=\"line\">\t<span class=\"built_in\">println</span>(db.NewRecord(&amp;u))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><font color=red>:</font>tag SQL    Gorm</p>\n<p><code>eg:</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> user = User&#123;Name: <span class=\"string\">&quot;&quot;</span>, Age: <span class=\"number\">99</span>&#125;</span><br><span class=\"line\">db.Create(&amp;user)</span><br></pre></td></tr></table></figure>\n\n<p><font color=red>:</font>SQL<code>INSERT INTO users(&quot;age&quot;) values(&#39;99&#39;);</code>NameName</p>\n<p><font color=red>:</font>, 0, ,false  Scanner/Valuer</p>\n<p>(1). :</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID   <span class=\"type\">int64</span></span><br><span class=\"line\">  Name *<span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;default:&#x27;&#x27;&quot;`</span></span><br><span class=\"line\">  Age  <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">user := User&#123;Name: <span class=\"built_in\">new</span>(<span class=\"type\">string</span>), Age: <span class=\"number\">18</span>))&#125;</span><br><span class=\"line\">db.Create(&amp;user)  <span class=\"comment\">// name&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>(2). Scanner/Valuer</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  Scanner/Valuer</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tID <span class=\"type\">int64</span></span><br><span class=\"line\">\tName sql.NullString <span class=\"string\">`gorm:&quot;default:&#x27;&#x27;&quot;`</span> <span class=\"comment\">// sql.NullString Scanner/Valuer</span></span><br><span class=\"line\">\tAge  <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">user := User&#123;Name: sql.NullString&#123;<span class=\"string\">&quot;&quot;</span>, <span class=\"literal\">true</span>&#125;, Age:<span class=\"number\">18</span>&#125;</span><br><span class=\"line\">db.Create(&amp;user)  <span class=\"comment\">// name&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY id LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Take(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Last(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY id DESC LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ()</span></span><br><span class=\"line\">db.First(&amp;user, <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = 10;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>where</b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Get first matched record</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; limit 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Get all matched records</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// &lt;&gt;</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name &lt;&gt; ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// IN</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name IN (?)&quot;</span>, []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name in (&#x27;jinzhu&#x27;,&#x27;jinzhu 2&#x27;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// LIKE</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name LIKE ?&quot;</span>, <span class=\"string\">&quot;%jin%&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name LIKE &#x27;%jin%&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// AND</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ? AND age &gt;= ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;22&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; AND age &gt;= 22;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Time</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;updated_at &gt; ?&quot;</span>, lastWeek).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE updated_at &gt; &#x27;2000-01-01 00:00:00&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// BETWEEN</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;created_at BETWEEN ? AND ?&quot;</span>, lastWeek, today).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE created_at BETWEEN &#x27;2000-01-01 00:00:00&#x27; AND &#x27;2000-01-08 00:00:00&#x27;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Struct &amp; Map</b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Where(&amp;User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>, Age: <span class=\"number\">20</span>&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 20 LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Map</span></span><br><span class=\"line\">db.Where(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">20</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where([]<span class=\"type\">int64</span>&#123;<span class=\"number\">20</span>, <span class=\"number\">21</span>, <span class=\"number\">22</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id IN (20, 21, 22);</span></span><br></pre></td></tr></table></figure>\n\n<p><font color=red><b>:</b></font>GORM0false</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(&amp;User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>, Age: <span class=\"number\">0</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot;;</span></span><br></pre></td></tr></table></figure>\n<p> Scanner/Valuer :</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  gorm.Model</span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">  Age  *<span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  Scanner/Valuer</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  gorm.Model</span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">  Age  sql.NullInt64  <span class=\"comment\">// sql.NullInt64  Scanner/Valuer </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Not<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Not(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot; LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Not In</span></span><br><span class=\"line\">db.Not(<span class=\"string\">&quot;name&quot;</span>, []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name NOT IN (&quot;jinzhu&quot;, &quot;jinzhu 2&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Not In slice of primary keys</span></span><br><span class=\"line\">db.Not([]<span class=\"type\">int64</span>&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id NOT IN (1,2,3);</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Not([]<span class=\"type\">int64</span>&#123;&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Plain SQL</span></span><br><span class=\"line\">db.Not(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE NOT(name = &quot;jinzhu&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Not(User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Or<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;role = ?&quot;</span>, <span class=\"string\">&quot;admin&quot;</span>).Or(<span class=\"string\">&quot;role = ?&quot;</span>, <span class=\"string\">&quot;super_admin&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE role = &#x27;admin&#x27; OR role = &#x27;super_admin&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = &#x27;jinzhu&#x27;&quot;</span>).Or(User&#123;Name: <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Map</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = &#x27;jinzhu&#x27;&quot;</span>).Or(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>, </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  ()</span></span><br><span class=\"line\">db.First(&amp;user, <span class=\"number\">23</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = 23 LIMIT 1;</span></span><br><span class=\"line\"><span class=\"comment\">// , </span></span><br><span class=\"line\">db.First(&amp;user, <span class=\"string\">&quot;id = ?&quot;</span>, <span class=\"string\">&quot;string_primary_key&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = &#x27;string_primary_key&#x27; LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Plain SQL</span></span><br><span class=\"line\">db.Find(&amp;user, <span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Find(&amp;users, <span class=\"string\">&quot;name &lt;&gt; ? AND age &gt; ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot; AND age &gt; 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Find(&amp;users, User&#123;Age: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Map</span></span><br><span class=\"line\">db.Find(&amp;users, <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  SQL  SQL </span></span><br><span class=\"line\">db.Set(<span class=\"string\">&quot;gorm:query_option&quot;</span>, <span class=\"string\">&quot;FOR UPDATE&quot;</span>).First(&amp;user, <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = 10 FOR UPDATE;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>FirstOrCreate</b></li>\n</ul>\n<p>,  ( struct  map )</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.FirstOrCreate(&amp;user, User&#123;Name: <span class=\"string\">&quot;non_existing&quot;</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// INSERT INTO &quot;users&quot; (name) VALUES (&quot;non_existing&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 112, Name: &quot;non_existing&quot;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;Jinzhu&quot;</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 111, Name: &quot;Jinzhu&quot;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Attrs</b></li>\n</ul>\n<p> struct </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;non_existing&quot;</span>&#125;).Attrs(User&#123;Age: <span class=\"number\">20</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;non_existing&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// INSERT INTO &quot;users&quot; (name, age) VALUES (&quot;non_existing&quot;, 20);</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 112, Name: &quot;non_existing&quot;, Age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>&#125;).Attrs(User&#123;Age: <span class=\"number\">30</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 111, Name: &quot;jinzhu&quot;, Age: 20&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Assign</b></li>\n</ul>\n<p> struct </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;non_existing&quot;</span>&#125;).Assign(User&#123;Age: <span class=\"number\">20</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;non_existing&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// INSERT INTO &quot;users&quot; (name, age) VALUES (&quot;non_existing&quot;, 20);</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 112, Name: &quot;non_existing&quot;, Age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>&#125;).Assign(User&#123;Age: <span class=\"number\">30</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET age=30 WHERE id = 111;</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 111, Name: &quot;jinzhu&quot;, Age: 30&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p> <code>*gorm.expr</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;amount &gt; ?&quot;</span>, db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;AVG(amount)&quot;</span>).Where(<span class=\"string\">&quot;state = ?&quot;</span>, <span class=\"string\">&quot;paid&quot;</span>).SubQuery()).Find(&amp;orders)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SELECT * FROM &quot;orders&quot;  WHERE &quot;orders&quot;.&quot;deleted_at&quot; IS NULL AND (amount &gt; (SELECT AVG(amount) FROM &quot;orders&quot;  WHERE (state = &#x27;paid&#x27;)));</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Select</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Select(<span class=\"string\">&quot;name, age&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT name, age FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Select([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;age&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT name, age FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;COALESCE(age,?)&quot;</span>, <span class=\"number\">42</span>).Rows()</span><br><span class=\"line\"><span class=\"comment\">//// SELECT COALESCE(age,&#x27;42&#x27;) FROM users;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>Order reorder  true </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Order(<span class=\"string\">&quot;age desc, name&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age desc, name;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Order(<span class=\"string\">&quot;age desc&quot;</span>).Order(<span class=\"string\">&quot;name&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age desc, name;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Order(<span class=\"string\">&quot;age desc&quot;</span>).Find(&amp;users1).Order(<span class=\"string\">&quot;age&quot;</span>, <span class=\"literal\">true</span>).Find(&amp;users2)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age desc; (users1)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age; (users2)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>Limit</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Limit(<span class=\"number\">3</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users LIMIT 3;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// -1  Limit </span></span><br><span class=\"line\">db.Limit(<span class=\"number\">10</span>).Find(&amp;users1).Limit(<span class=\"number\">-1</span>).Find(&amp;users2)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users LIMIT 10; (users1)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users; (users2)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>Offset</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Offset(<span class=\"number\">3</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users OFFSET 3;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// -1  Offset </span></span><br><span class=\"line\">db.Offset(<span class=\"number\">10</span>).Find(&amp;users1).Offset(<span class=\"number\">-1</span>).Find(&amp;users2)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users OFFSET 10; (users1)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users; (users2)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Or(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu 2&quot;</span>).Find(&amp;users).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * from USERS WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;; (users)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT count(*) FROM users WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;; (count)</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;User&#123;&#125;).Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT count(*) FROM users WHERE name = &#x27;jinzhu&#x27;; (count)</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT count(*) FROM deleted_users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Select(<span class=\"string\">&quot;count(distinct(name))&quot;</span>).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT count( distinct(name) ) FROM deleted_users; (count)</span></span><br></pre></td></tr></table></figure>\n\n<p><font color=red><b>:</b></font>Count   SELECT count </p>\n<ul>\n<li><b>Group &amp; Having</b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rows, err := db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Rows()</span><br><span class=\"line\"><span class=\"keyword\">for</span> rows.Next() &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scan</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Result <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tDate time.Time</span><br><span class=\"line\">\tTotal <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rets []Result</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(age) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Scan(&amp;rets)</span><br><span class=\"line\"></span><br><span class=\"line\">rows, err := db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Having(<span class=\"string\">&quot;sum(amount) &gt; ?&quot;</span>, <span class=\"number\">100</span>).Rows()</span><br><span class=\"line\"><span class=\"keyword\">for</span> rows.Next() &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Result <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  Date  time.Time</span><br><span class=\"line\">  Total <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Having(<span class=\"string\">&quot;sum(amount) &gt; ?&quot;</span>, <span class=\"number\">100</span>).Scan(&amp;results)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rows, err := db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;users.name, emails.email&quot;</span>).Joins(<span class=\"string\">&quot;left join emails on emails.user_id = users.id&quot;</span>).Rows()</span><br><span class=\"line\"><span class=\"keyword\">for</span> rows.Next() &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;users.name, emails.email&quot;</span>).Joins(<span class=\"string\">&quot;left join emails on emails.user_id = users.id&quot;</span>).Scan(&amp;results)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Joins(<span class=\"string\">&quot;JOIN emails ON emails.user_id = users.id AND emails.email = ?&quot;</span>, <span class=\"string\">&quot;jinzhu@example.org&quot;</span>).Joins(<span class=\"string\">&quot;JOIN credit_cards ON credit_cards.user_id = users.id&quot;</span>).Where(<span class=\"string\">&quot;credit_cards.number = ?&quot;</span>, <span class=\"string\">&quot;411111111111&quot;</span>).Find(&amp;user)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Pluck</b></li>\n</ul>\n<p>Pluck<code>model</code><code>Scan</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ages []<span class=\"type\">int64</span></span><br><span class=\"line\">db.Find(&amp;users).Pluck(<span class=\"string\">&quot;age&quot;</span>, &amp;ages)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> names []<span class=\"type\">string</span></span><br><span class=\"line\">db.Model(&amp;User&#123;&#125;).Pluck(<span class=\"string\">&quot;name&quot;</span>, &amp;names)</span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Pluck(<span class=\"string\">&quot;name&quot;</span>, &amp;names)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  </span></span><br><span class=\"line\">db.Select(<span class=\"string\">&quot;name, age&quot;</span>).Find(&amp;users)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Scan<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Result <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">  Age  <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> result Result</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;name, age&quot;</span>).Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;Antonio&quot;</span>).Scan(&amp;result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> results []Result</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;name, age&quot;</span>).Where(<span class=\"string\">&quot;id &gt; ?&quot;</span>, <span class=\"number\">0</span>).Scan(&amp;results)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  SQL</span></span><br><span class=\"line\">db.Raw(<span class=\"string\">&quot;SELECT name, age FROM users WHERE name = ?&quot;</span>, <span class=\"string\">&quot;Antonio&quot;</span>).Scan(&amp;result)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b><b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">tx := db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> someCondition &#123;</span><br><span class=\"line\">  tx = tx.Where(<span class=\"string\">&quot;age = ?&quot;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  tx = tx.Where(<span class=\"string\">&quot;age = ?&quot;</span>, <span class=\"number\">30</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> yetAnotherCondition &#123;</span><br><span class=\"line\">  tx = tx.Where(<span class=\"string\">&quot;active = ?&quot;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><font color=red><b>:<b/></font>Query</p>\n<ul>\n<li><b><b/></li>\n</ul>\n<p>SQL, CRUD<br><code>Create</code>, <code>First</code>, <code>Find</code>, <code>Take</code>, <code>Save</code>, <code>UpdateXXX</code>, <code>Delete</code>, <code>Scan</code>, <code>Row</code>, <code>Rows</code></p>\n<ul>\n<li><b></b></li>\n</ul>\n<p>ScopesScope</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">AmountGreaterThan1000</span><span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> db.Where(<span class=\"string\">&quot;amount &gt; ?&quot;</span>, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">PaidWithCreditCard</span><span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> db.Where(<span class=\"string\">&quot;pay_mode_sign = ?&quot;</span>, <span class=\"string\">&quot;C&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">PaidWithCod</span><span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> db.Where(<span class=\"string\">&quot;pay_mode_sign = ?&quot;</span>, <span class=\"string\">&quot;C&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">OrderStatus</span><span class=\"params\">(status []<span class=\"type\">string</span>)</span></span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> db.Scopes(AmountGreaterThan1000).Where(<span class=\"string\">&quot;status IN (?)&quot;</span>, status)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">db.Scopes(AmountGreaterThan1000, PaidWithCreditCard).Find(&amp;orders)</span><br><span class=\"line\"><span class=\"comment\">//  1000 </span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Scopes(AmountGreaterThan1000, PaidWithCod).Find(&amp;orders)</span><br><span class=\"line\"><span class=\"comment\">//  1000  COD </span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Scopes(AmountGreaterThan1000, OrderStatus([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;paid&quot;</span>, <span class=\"string\">&quot;shipped&quot;</span>&#125;)).Find(&amp;orders)</span><br><span class=\"line\"><span class=\"comment\">//  1000 </span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>GORM ()</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;name LIKE ?&quot;</span>, <span class=\"string\">&quot;jinzhu%&quot;</span>).Find(&amp;users, <span class=\"string\">&quot;id IN (?)&quot;</span>, []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;).Count(&amp;count)</span><br></pre></td></tr></table></figure>\n<p>sql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> users <span class=\"keyword\">WHERE</span> name <span class=\"keyword\">LIKE</span> <span class=\"string\">&#x27;jinzhu%&#x27;</span> <span class=\"keyword\">AND</span> id <span class=\"keyword\">IN</span> (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> users <span class=\"keyword\">WHERE</span> name <span class=\"keyword\">LIKE</span> <span class=\"string\">&#x27;jinzhu%&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><ul>\n<li><b></b></li>\n</ul>\n<p><code>Save()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.First(&amp;user)</span><br><span class=\"line\"></span><br><span class=\"line\">user.Name = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">user.Age = <span class=\"number\">99</span></span><br><span class=\"line\">db.Save(&amp;user)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">////  UPDATE `users` SET `created_at` = &#x27;2020-02-16 12:52:20&#x27;, `updated_at` = &#x27;2020-02-16 12:54:55&#x27;, `deleted_at` = NULL, `name` = &#x27;&#x27;, `age` = 99, `active` = true  WHERE `users`.`deleted_at` IS NULL AND `users`.`id` = 1</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Update</code><code>Updates</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Model(&amp;user).Update(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Model(&amp;user).Where(<span class=\"string\">&quot;active = ?&quot;</span>, <span class=\"literal\">true</span>).Update(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111 AND active=true;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  map </span></span><br><span class=\"line\">db.Model(&amp;user).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>, <span class=\"string\">&quot;active&quot;</span>: <span class=\"literal\">false</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18, active=false, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  struct </span></span><br><span class=\"line\">db.Model(&amp;user).Updates(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18, updated_at = &#x27;2013-11-17 21:34:10&#x27; WHERE id = 111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  struct GORM</span></span><br><span class=\"line\"><span class=\"comment\">// &quot;&quot;, 0, false </span></span><br><span class=\"line\">db.Model(&amp;user).Updates(User&#123;Name: <span class=\"string\">&quot;&quot;</span>, Age: <span class=\"number\">0</span>, Active: <span class=\"literal\">false</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Select</code><code>Omit</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Model(&amp;user).Select(<span class=\"string\">&quot;name&quot;</span>).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>, <span class=\"string\">&quot;active&quot;</span>: <span class=\"literal\">false</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).Omit(<span class=\"string\">&quot;name&quot;</span>).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>, <span class=\"string\">&quot;active&quot;</span>: <span class=\"literal\">false</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET age=18, active=false, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Hooks</b></li>\n</ul>\n<p><code>model</code><code>BeforeUpdate</code>, <code>AfterUpdate</code><code>UpdatedAt</code>, <code>Associations</code>, <code>UpdateColumn</code> <code>UpdateColumns</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  `Update`</span></span><br><span class=\"line\">db.Model(&amp;user).UpdateColumn(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27; WHERE id = 111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  `Updates`</span></span><br><span class=\"line\">db.Model(&amp;user).UpdateColumns(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18 WHERE id = 111;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Hooks()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Where(<span class=\"string\">&quot;id IN (?)&quot;</span>, []<span class=\"type\">int</span>&#123;<span class=\"number\">10</span>, <span class=\"number\">11</span>&#125;).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18 WHERE id IN (10, 11);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  struct map[string]interface&#123;&#125;</span></span><br><span class=\"line\">db.Model(User&#123;&#125;).Updates(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  `RowsAffected` </span></span><br><span class=\"line\">db.Model(User&#123;&#125;).Updates(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;).RowsAffected</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>sql</b></li>\n</ul>\n<p>user</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> user User</span><br><span class=\"line\">db.First(&amp;user)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Model(&amp;user).Update(<span class=\"string\">&quot;age&quot;</span>, gorm.Expr(<span class=\"string\">&quot;age * ? + ?&quot;</span>, <span class=\"number\">2</span>, <span class=\"number\">100</span>))</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE `users` SET `age` = age * 2 + 100, `updated_at` = &#x27;2020-02-16 13:10:20&#x27;  WHERE `users`.`id` = 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;age&quot;</span>: gorm.Expr(<span class=\"string\">&quot;age * ? + ?&quot;</span>, <span class=\"number\">2</span>, <span class=\"number\">100</span>)&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE &quot;users&quot; SET &quot;age&quot; = age * &#x27;2&#x27; + &#x27;100&#x27;, &quot;updated_at&quot; = &#x27;2020-02-16 13:05:51&#x27; WHERE `users`.`id` = 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).UpdateColumn(<span class=\"string\">&quot;age&quot;</span>, gorm.Expr(<span class=\"string\">&quot;age - ?&quot;</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE &quot;users&quot; SET &quot;age&quot; = age - 1 WHERE &quot;id&quot; = &#x27;1&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).Where(<span class=\"string\">&quot;age &gt; 10&quot;</span>).UpdateColumn(<span class=\"string\">&quot;age&quot;</span>, gorm.Expr(<span class=\"string\">&quot;age - ?&quot;</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE &quot;users&quot; SET &quot;age&quot; = age - 1 WHERE &quot;id&quot; = &#x27;1&#x27; AND quantity &gt; 10;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Hooks</b></li>\n</ul>\n<p><code>BeforeUpdate</code>, <code>BeforeSave</code><code>Hooks</code> <code>scope.SetColumn</code>, </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(user *User)</span></span> BeforeSave(scope *gorm.Scope) (err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> pw, err := bcrypt.GenerateFromPassword(user.Password, <span class=\"number\">0</span>); err == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    scope.SetColumn(<span class=\"string\">&quot;EncryptedPassword&quot;</span>, pw)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><ul>\n<li><b></b></li>\n</ul>\n<p><font color=red><b>:</b></font> GORM GORM  model </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Delete(&amp;email)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where id=10;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  SQL  SQL </span></span><br><span class=\"line\">db.Set(<span class=\"string\">&quot;gorm:delete_option&quot;</span>, <span class=\"string\">&quot;OPTION (OPTIMIZE FOR UNKNOWN)&quot;</span>).Delete(&amp;email)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where id=10 OPTION (OPTIMIZE FOR UNKNOWN);</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;email LIKE ?&quot;</span>, <span class=\"string\">&quot;%jinzhu%&quot;</span>).Delete(Email&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where email LIKE &quot;%jinzhu%&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Delete(Email&#123;&#125;, <span class=\"string\">&quot;email LIKE ?&quot;</span>, <span class=\"string\">&quot;%jinzhu%&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where email LIKE &quot;%jinzhu%&quot;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>model<code>DeletedAt</code> <code>Delete</code>  <code>DeletedAt</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Delete(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE id = 111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;age = ?&quot;</span>, <span class=\"number\">20</span>).Delete(&amp;User&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE age = 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;age = 20&quot;</span>).Find(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unscoped </span></span><br><span class=\"line\">db.Unscoped().Where(<span class=\"string\">&quot;age = 20&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Unscoped </span></span><br><span class=\"line\">db.Unscoped().Delete(&amp;order)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE FROM orders WHERE id=10;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"gorm\"><a href=\"#gorm\" class=\"headerlink\" title=\"gorm\"></a>gorm</h1><p>ORM: object relational mapping  ()</p>\n<p>  &lt;&gt;   <br/><br>  &lt;&gt;   <br/><br>    &lt;&gt;   <br/></p>\n<h2 id=\"gorm\"><a href=\"#gorm\" class=\"headerlink\" title=\"gorm\"></a>gorm</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"gorm\"><a href=\"#gorm\" class=\"headerlink\" title=\"gorm\"></a>gorm</h2><p><code>GORM</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import _ &quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import _ &quot;github.com/jinzhu/gorm/dialects/sqlite&quot;</span></span><br><span class=\"line\"><span class=\"comment\">// import _ &quot;github.com/jinzhu/gorm/dialects/mssql&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mysql</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;mysql&quot;</span>, <span class=\"string\">&quot;user:password@(localhost)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>postgreSql</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/postgres&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;postgres&quot;</span>, <span class=\"string\">&quot;host=myhost port=myport user=gorm dbname=gorm password=mypassword&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Sqlite3</li>\n</ul>\n<p><code>Sqlite3</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/sqlite&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;sqlite3&quot;</span>, <span class=\"string\">&quot;/tmp/gorm.db&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>SQL server</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">  _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mssql&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  db, err := gorm.Open(<span class=\"string\">&quot;mssql&quot;</span>, <span class=\"string\">&quot;sqlserver://username:password@localhost:1433?database=dbname&quot;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Dockermysql\"><a href=\"#Dockermysql\" class=\"headerlink\" title=\"Dockermysql\"></a>Dockermysql</h2><ol>\n<li>mysql:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker pull mysql</span><br></pre></td></tr></table></figure></li>\n<li><code>13306</code><code>mysql8019</code><code>root</code> <code>root1234</code>MySQL:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name mysql8019 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=cv11010216 -d mysql:8.0.19</span><br></pre></td></tr></table></figure></li>\n<li><code>MySQL Client</code>:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it --network host --<span class=\"built_in\">rm</span> mysql mysql -h127.0.0.1 -P3306 --default-character-set=utf8mb4 -uroot -p</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"gormmysql\"><a href=\"#gormmysql\" class=\"headerlink\" title=\"gormmysql\"></a>gormmysql</h2><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">import</span> _ <span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> UserInfo <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tID <span class=\"type\">int</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span></span><br><span class=\"line\">\tGender <span class=\"type\">string</span></span><br><span class=\"line\">\tHobby <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tdb, err := gorm.Open(<span class=\"string\">&quot;mysql&quot;</span>, <span class=\"string\">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// ()</span></span><br><span class=\"line\">\tdb.AutoMigrate(&amp;UserInfo&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tu1 := UserInfo&#123;<span class=\"number\">1</span>, <span class=\"string\">&quot;lijiahao&quot;</span>, <span class=\"string\">&quot;male&quot;</span>, <span class=\"string\">&quot;zhaozijin&quot;</span>&#125;</span><br><span class=\"line\">\tdb.Create(&amp;u1)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> u UserInfo</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> uu UserInfo</span><br><span class=\"line\">\tdb.First(&amp;u)</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;%#v\\n&quot;</span>, u)</span><br><span class=\"line\">\tdb.Find(&amp;uu, <span class=\"string\">&quot;hoddy=?&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\tfmt.printf(<span class=\"string\">&quot;%v&quot;</span>, uu)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tdb.Model(&amp;u).Update(<span class=\"string\">&quot;bobby&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tdb.Delete(&amp;u)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>gorm Model</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tgorm.Model</span><br><span class=\"line\">\tName <span class=\"type\">string</span></span><br><span class=\"line\">\tAge sql.NullInt64 <span class=\"comment\">//</span></span><br><span class=\"line\">\tBirthday *time.Time</span><br><span class=\"line\">\tEmail <span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;type:varchar(120);unique_index&quot;`</span></span><br><span class=\"line\">\tRole <span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;size:255&quot;`</span>  <span class=\"comment\">//255</span></span><br><span class=\"line\">\tMemberNumber *<span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;unique;not null&quot;`</span> <span class=\"comment\">//</span></span><br><span class=\"line\">\tNum <span class=\"type\">int</span> <span class=\"string\">`gorm:&quot;AUTO_INCREMENT&quot;`</span> <span class=\"comment\">//num</span></span><br><span class=\"line\">\tAddress <span class=\"type\">string</span> \t<span class=\"string\">`gorm:&quot;index:addr&quot;`</span> <span class=\"comment\">//addressaddr</span></span><br><span class=\"line\">\tIgnoreMe <span class=\"type\">int</span> <span class=\"string\">`gorm:&quot;-&quot;`</span> <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>gorm.Model</li>\n</ul>\n<p>GORM<code>gorm.Model</code><code>gorm.Model</code><code>ID</code>, <code>CreatedAt</code>, <code>UpdatedAt</code>, <code>DeletedAt</code>Golang</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// gorm.Model </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Model <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID        <span class=\"type\">uint</span> <span class=\"string\">`gorm:&quot;primary_key&quot;`</span></span><br><span class=\"line\">  CreatedAt time.Time</span><br><span class=\"line\">  UpdatedAt time.Time</span><br><span class=\"line\">  DeletedAt *time.Time</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li></li>\n</ul>\n<p>GORM ID</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID   <span class=\"type\">string</span> <span class=\"comment\">// `ID`</span></span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// `AnimalID`</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Animal <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  AnimalID <span class=\"type\">int64</span> <span class=\"string\">`gorm:&quot;primary_key&quot;`</span></span><br><span class=\"line\">  Name     <span class=\"type\">string</span></span><br><span class=\"line\">  Age      <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;&#125; <span class=\"comment\">//  `users`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  User  `profiles`</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(User)</span></span> TableName() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;profiles&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(u User)</span></span> TableName() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> u.Role == <span class=\"string\">&quot;admin&quot;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;admin_users&quot;</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;users&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  true `User`  `user`</span></span><br><span class=\"line\">db.SingularTable(<span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<p><code>Table()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// User`deleted_users`</span></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).CreateTable(&amp;User&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> deleted_users []User</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Find(&amp;deleted_users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM deleted_users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Delete()</span><br><span class=\"line\"><span class=\"comment\">//// DELETE FROM deleted_users WHERE name = &#x27;jinzhu&#x27;;</span></span><br></pre></td></tr></table></figure>\n\n<p>GORM</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gorm.DefaultTableNameHandler = <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(db *gorm.DB, defaultTableName <span class=\"type\">string</span>)</span></span> <span class=\"type\">string</span>  &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;sms_&quot;</span> + defaultTableName;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID        <span class=\"type\">uint</span>      <span class=\"comment\">// column name is `id`</span></span><br><span class=\"line\">  Name      <span class=\"type\">string</span>    <span class=\"comment\">// column name is `name`</span></span><br><span class=\"line\">  Birthday  time.Time <span class=\"comment\">// column name is `birthday`</span></span><br><span class=\"line\">  CreatedAt time.Time <span class=\"comment\">// column name is `created_at`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>tag</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Animal <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  AnimalId    <span class=\"type\">int64</span>     <span class=\"string\">`gorm:&quot;column:beast_id&quot;`</span>        </span><br><span class=\"line\">  Birthday    time.Time <span class=\"string\">`gorm:&quot;column:day_of_the_beast&quot;`</span> </span><br><span class=\"line\">  Age         <span class=\"type\">int64</span>     <span class=\"string\">`gorm:&quot;column:age_of_the_beast&quot;`</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"gorm-CRUD\"><a href=\"#gorm-CRUD\" class=\"headerlink\" title=\"gorm CRUD\"></a>gorm CRUD</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> _<span class=\"string\">&quot;github.com/jinzhu/gorm/dialects/mysql&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1. </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Person <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tID <span class=\"type\">int64</span></span><br><span class=\"line\">\tName <span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;default:&#x27;&#x27;&quot;`</span> <span class=\"comment\">//tag</span></span><br><span class=\"line\">\tAge <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tdb, err := gorm.Open(<span class=\"string\">&quot;mysql&quot;</span>, <span class=\"string\">&quot;root:root1234@(127.0.0.1:13306)/db1?charset=utf8mb4&amp;parseTime=True&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> db.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//2. </span></span><br><span class=\"line\">\tdb.AutoMigrate(&amp;Person&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//3. </span></span><br><span class=\"line\">\tu := Person&#123;</span><br><span class=\"line\">\t\tID: <span class=\"number\">1</span>,</span><br><span class=\"line\">\t\tAge: <span class=\"number\">17</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//NewRecord()Create()</span></span><br><span class=\"line\">\t<span class=\"built_in\">println</span>(db.NewRecord(&amp;u))</span><br><span class=\"line\">\tdb.Create(&amp;u)</span><br><span class=\"line\">\t<span class=\"built_in\">println</span>(db.NewRecord(&amp;u))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><font color=red>:</font>tag SQL    Gorm</p>\n<p><code>eg:</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> user = User&#123;Name: <span class=\"string\">&quot;&quot;</span>, Age: <span class=\"number\">99</span>&#125;</span><br><span class=\"line\">db.Create(&amp;user)</span><br></pre></td></tr></table></figure>\n\n<p><font color=red>:</font>SQL<code>INSERT INTO users(&quot;age&quot;) values(&#39;99&#39;);</code>NameName</p>\n<p><font color=red>:</font>, 0, ,false  Scanner/Valuer</p>\n<p>(1). :</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  ID   <span class=\"type\">int64</span></span><br><span class=\"line\">  Name *<span class=\"type\">string</span> <span class=\"string\">`gorm:&quot;default:&#x27;&#x27;&quot;`</span></span><br><span class=\"line\">  Age  <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">user := User&#123;Name: <span class=\"built_in\">new</span>(<span class=\"type\">string</span>), Age: <span class=\"number\">18</span>))&#125;</span><br><span class=\"line\">db.Create(&amp;user)  <span class=\"comment\">// name&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>(2). Scanner/Valuer</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  Scanner/Valuer</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tID <span class=\"type\">int64</span></span><br><span class=\"line\">\tName sql.NullString <span class=\"string\">`gorm:&quot;default:&#x27;&#x27;&quot;`</span> <span class=\"comment\">// sql.NullString Scanner/Valuer</span></span><br><span class=\"line\">\tAge  <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">user := User&#123;Name: sql.NullString&#123;<span class=\"string\">&quot;&quot;</span>, <span class=\"literal\">true</span>&#125;, Age:<span class=\"number\">18</span>&#125;</span><br><span class=\"line\">db.Create(&amp;user)  <span class=\"comment\">// name&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY id LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Take(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Last(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY id DESC LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ()</span></span><br><span class=\"line\">db.First(&amp;user, <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = 10;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>where</b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Get first matched record</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; limit 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Get all matched records</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// &lt;&gt;</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name &lt;&gt; ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// IN</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name IN (?)&quot;</span>, []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name in (&#x27;jinzhu&#x27;,&#x27;jinzhu 2&#x27;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// LIKE</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name LIKE ?&quot;</span>, <span class=\"string\">&quot;%jin%&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name LIKE &#x27;%jin%&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// AND</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ? AND age &gt;= ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;22&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; AND age &gt;= 22;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Time</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;updated_at &gt; ?&quot;</span>, lastWeek).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE updated_at &gt; &#x27;2000-01-01 00:00:00&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// BETWEEN</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;created_at BETWEEN ? AND ?&quot;</span>, lastWeek, today).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE created_at BETWEEN &#x27;2000-01-01 00:00:00&#x27; AND &#x27;2000-01-08 00:00:00&#x27;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Struct &amp; Map</b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Where(&amp;User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>, Age: <span class=\"number\">20</span>&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 20 LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Map</span></span><br><span class=\"line\">db.Where(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">20</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where([]<span class=\"type\">int64</span>&#123;<span class=\"number\">20</span>, <span class=\"number\">21</span>, <span class=\"number\">22</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id IN (20, 21, 22);</span></span><br></pre></td></tr></table></figure>\n\n<p><font color=red><b>:</b></font>GORM0false</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(&amp;User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>, Age: <span class=\"number\">0</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot;;</span></span><br></pre></td></tr></table></figure>\n<p> Scanner/Valuer :</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  gorm.Model</span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">  Age  *<span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  Scanner/Valuer</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  gorm.Model</span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">  Age  sql.NullInt64  <span class=\"comment\">// sql.NullInt64  Scanner/Valuer </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Not<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Not(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot; LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Not In</span></span><br><span class=\"line\">db.Not(<span class=\"string\">&quot;name&quot;</span>, []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name NOT IN (&quot;jinzhu&quot;, &quot;jinzhu 2&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Not In slice of primary keys</span></span><br><span class=\"line\">db.Not([]<span class=\"type\">int64</span>&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id NOT IN (1,2,3);</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Not([]<span class=\"type\">int64</span>&#123;&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Plain SQL</span></span><br><span class=\"line\">db.Not(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE NOT(name = &quot;jinzhu&quot;);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Not(User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>&#125;).First(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Or<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;role = ?&quot;</span>, <span class=\"string\">&quot;admin&quot;</span>).Or(<span class=\"string\">&quot;role = ?&quot;</span>, <span class=\"string\">&quot;super_admin&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE role = &#x27;admin&#x27; OR role = &#x27;super_admin&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = &#x27;jinzhu&#x27;&quot;</span>).Or(User&#123;Name: <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Map</span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;name = &#x27;jinzhu&#x27;&quot;</span>).Or(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;jinzhu 2&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>, </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  ()</span></span><br><span class=\"line\">db.First(&amp;user, <span class=\"number\">23</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = 23 LIMIT 1;</span></span><br><span class=\"line\"><span class=\"comment\">// , </span></span><br><span class=\"line\">db.First(&amp;user, <span class=\"string\">&quot;id = ?&quot;</span>, <span class=\"string\">&quot;string_primary_key&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = &#x27;string_primary_key&#x27; LIMIT 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Plain SQL</span></span><br><span class=\"line\">db.Find(&amp;user, <span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &quot;jinzhu&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Find(&amp;users, <span class=\"string\">&quot;name &lt;&gt; ? AND age &gt; ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot; AND age &gt; 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Struct</span></span><br><span class=\"line\">db.Find(&amp;users, User&#123;Age: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Map</span></span><br><span class=\"line\">db.Find(&amp;users, <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">20</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  SQL  SQL </span></span><br><span class=\"line\">db.Set(<span class=\"string\">&quot;gorm:query_option&quot;</span>, <span class=\"string\">&quot;FOR UPDATE&quot;</span>).First(&amp;user, <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE id = 10 FOR UPDATE;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>FirstOrCreate</b></li>\n</ul>\n<p>,  ( struct  map )</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.FirstOrCreate(&amp;user, User&#123;Name: <span class=\"string\">&quot;non_existing&quot;</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// INSERT INTO &quot;users&quot; (name) VALUES (&quot;non_existing&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 112, Name: &quot;non_existing&quot;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;Jinzhu&quot;</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 111, Name: &quot;Jinzhu&quot;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Attrs</b></li>\n</ul>\n<p> struct </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;non_existing&quot;</span>&#125;).Attrs(User&#123;Age: <span class=\"number\">20</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;non_existing&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// INSERT INTO &quot;users&quot; (name, age) VALUES (&quot;non_existing&quot;, 20);</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 112, Name: &quot;non_existing&quot;, Age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>&#125;).Attrs(User&#123;Age: <span class=\"number\">30</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 111, Name: &quot;jinzhu&quot;, Age: 20&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Assign</b></li>\n</ul>\n<p> struct </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;non_existing&quot;</span>&#125;).Assign(User&#123;Age: <span class=\"number\">20</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;non_existing&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// INSERT INTO &quot;users&quot; (name, age) VALUES (&quot;non_existing&quot;, 20);</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 112, Name: &quot;non_existing&quot;, Age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(User&#123;Name: <span class=\"string\">&quot;jinzhu&quot;</span>&#125;).Assign(User&#123;Age: <span class=\"number\">30</span>&#125;).FirstOrCreate(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE name = &#x27;jinzhu&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET age=30 WHERE id = 111;</span></span><br><span class=\"line\"><span class=\"comment\">//// user -&gt; User&#123;Id: 111, Name: &quot;jinzhu&quot;, Age: 30&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p> <code>*gorm.expr</code> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;amount &gt; ?&quot;</span>, db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;AVG(amount)&quot;</span>).Where(<span class=\"string\">&quot;state = ?&quot;</span>, <span class=\"string\">&quot;paid&quot;</span>).SubQuery()).Find(&amp;orders)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SELECT * FROM &quot;orders&quot;  WHERE &quot;orders&quot;.&quot;deleted_at&quot; IS NULL AND (amount &gt; (SELECT AVG(amount) FROM &quot;orders&quot;  WHERE (state = &#x27;paid&#x27;)));</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Select</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Select(<span class=\"string\">&quot;name, age&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT name, age FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Select([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;age&quot;</span>&#125;).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT name, age FROM users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;COALESCE(age,?)&quot;</span>, <span class=\"number\">42</span>).Rows()</span><br><span class=\"line\"><span class=\"comment\">//// SELECT COALESCE(age,&#x27;42&#x27;) FROM users;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>Order reorder  true </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Order(<span class=\"string\">&quot;age desc, name&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age desc, name;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Order(<span class=\"string\">&quot;age desc&quot;</span>).Order(<span class=\"string\">&quot;name&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age desc, name;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Order(<span class=\"string\">&quot;age desc&quot;</span>).Find(&amp;users1).Order(<span class=\"string\">&quot;age&quot;</span>, <span class=\"literal\">true</span>).Find(&amp;users2)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age desc; (users1)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users ORDER BY age; (users2)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>Limit</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Limit(<span class=\"number\">3</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users LIMIT 3;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// -1  Limit </span></span><br><span class=\"line\">db.Limit(<span class=\"number\">10</span>).Find(&amp;users1).Limit(<span class=\"number\">-1</span>).Find(&amp;users2)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users LIMIT 10; (users1)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users; (users2)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>Offset</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Offset(<span class=\"number\">3</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users OFFSET 3;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// -1  Offset </span></span><br><span class=\"line\">db.Offset(<span class=\"number\">10</span>).Find(&amp;users1).Offset(<span class=\"number\">-1</span>).Find(&amp;users2)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users OFFSET 10; (users1)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users; (users2)</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Or(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu 2&quot;</span>).Find(&amp;users).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * from USERS WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;; (users)</span></span><br><span class=\"line\"><span class=\"comment\">//// SELECT count(*) FROM users WHERE name = &#x27;jinzhu&#x27; OR name = &#x27;jinzhu 2&#x27;; (count)</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;User&#123;&#125;).Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT count(*) FROM users WHERE name = &#x27;jinzhu&#x27;; (count)</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT count(*) FROM deleted_users;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Select(<span class=\"string\">&quot;count(distinct(name))&quot;</span>).Count(&amp;count)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT count( distinct(name) ) FROM deleted_users; (count)</span></span><br></pre></td></tr></table></figure>\n\n<p><font color=red><b>:</b></font>Count   SELECT count </p>\n<ul>\n<li><b>Group &amp; Having</b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rows, err := db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Rows()</span><br><span class=\"line\"><span class=\"keyword\">for</span> rows.Next() &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scan</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Result <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tDate time.Time</span><br><span class=\"line\">\tTotal <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> rets []Result</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(age) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Scan(&amp;rets)</span><br><span class=\"line\"></span><br><span class=\"line\">rows, err := db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Having(<span class=\"string\">&quot;sum(amount) &gt; ?&quot;</span>, <span class=\"number\">100</span>).Rows()</span><br><span class=\"line\"><span class=\"keyword\">for</span> rows.Next() &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Result <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  Date  time.Time</span><br><span class=\"line\">  Total <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;orders&quot;</span>).Select(<span class=\"string\">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class=\"string\">&quot;date(created_at)&quot;</span>).Having(<span class=\"string\">&quot;sum(amount) &gt; ?&quot;</span>, <span class=\"number\">100</span>).Scan(&amp;results)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rows, err := db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;users.name, emails.email&quot;</span>).Joins(<span class=\"string\">&quot;left join emails on emails.user_id = users.id&quot;</span>).Rows()</span><br><span class=\"line\"><span class=\"keyword\">for</span> rows.Next() &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;users.name, emails.email&quot;</span>).Joins(<span class=\"string\">&quot;left join emails on emails.user_id = users.id&quot;</span>).Scan(&amp;results)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Joins(<span class=\"string\">&quot;JOIN emails ON emails.user_id = users.id AND emails.email = ?&quot;</span>, <span class=\"string\">&quot;jinzhu@example.org&quot;</span>).Joins(<span class=\"string\">&quot;JOIN credit_cards ON credit_cards.user_id = users.id&quot;</span>).Where(<span class=\"string\">&quot;credit_cards.number = ?&quot;</span>, <span class=\"string\">&quot;411111111111&quot;</span>).Find(&amp;user)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Pluck</b></li>\n</ul>\n<p>Pluck<code>model</code><code>Scan</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ages []<span class=\"type\">int64</span></span><br><span class=\"line\">db.Find(&amp;users).Pluck(<span class=\"string\">&quot;age&quot;</span>, &amp;ages)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> names []<span class=\"type\">string</span></span><br><span class=\"line\">db.Model(&amp;User&#123;&#125;).Pluck(<span class=\"string\">&quot;name&quot;</span>, &amp;names)</span><br><span class=\"line\"></span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;deleted_users&quot;</span>).Pluck(<span class=\"string\">&quot;name&quot;</span>, &amp;names)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  </span></span><br><span class=\"line\">db.Select(<span class=\"string\">&quot;name, age&quot;</span>).Find(&amp;users)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Scan<b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Result <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  Name <span class=\"type\">string</span></span><br><span class=\"line\">  Age  <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> result Result</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;name, age&quot;</span>).Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;Antonio&quot;</span>).Scan(&amp;result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> results []Result</span><br><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Select(<span class=\"string\">&quot;name, age&quot;</span>).Where(<span class=\"string\">&quot;id &gt; ?&quot;</span>, <span class=\"number\">0</span>).Scan(&amp;results)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  SQL</span></span><br><span class=\"line\">db.Raw(<span class=\"string\">&quot;SELECT name, age FROM users WHERE name = ?&quot;</span>, <span class=\"string\">&quot;Antonio&quot;</span>).Scan(&amp;result)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b><b/></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">tx := db.Where(<span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"string\">&quot;jinzhu&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> someCondition &#123;</span><br><span class=\"line\">  tx = tx.Where(<span class=\"string\">&quot;age = ?&quot;</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  tx = tx.Where(<span class=\"string\">&quot;age = ?&quot;</span>, <span class=\"number\">30</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> yetAnotherCondition &#123;</span><br><span class=\"line\">  tx = tx.Where(<span class=\"string\">&quot;active = ?&quot;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><font color=red><b>:<b/></font>Query</p>\n<ul>\n<li><b><b/></li>\n</ul>\n<p>SQL, CRUD<br><code>Create</code>, <code>First</code>, <code>Find</code>, <code>Take</code>, <code>Save</code>, <code>UpdateXXX</code>, <code>Delete</code>, <code>Scan</code>, <code>Row</code>, <code>Rows</code></p>\n<ul>\n<li><b></b></li>\n</ul>\n<p>ScopesScope</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">AmountGreaterThan1000</span><span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> db.Where(<span class=\"string\">&quot;amount &gt; ?&quot;</span>, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">PaidWithCreditCard</span><span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> db.Where(<span class=\"string\">&quot;pay_mode_sign = ?&quot;</span>, <span class=\"string\">&quot;C&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">PaidWithCod</span><span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> db.Where(<span class=\"string\">&quot;pay_mode_sign = ?&quot;</span>, <span class=\"string\">&quot;C&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">OrderStatus</span><span class=\"params\">(status []<span class=\"type\">string</span>)</span></span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(db *gorm.DB)</span></span> *gorm.DB &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> db.Scopes(AmountGreaterThan1000).Where(<span class=\"string\">&quot;status IN (?)&quot;</span>, status)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">db.Scopes(AmountGreaterThan1000, PaidWithCreditCard).Find(&amp;orders)</span><br><span class=\"line\"><span class=\"comment\">//  1000 </span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Scopes(AmountGreaterThan1000, PaidWithCod).Find(&amp;orders)</span><br><span class=\"line\"><span class=\"comment\">//  1000  COD </span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Scopes(AmountGreaterThan1000, OrderStatus([]<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;paid&quot;</span>, <span class=\"string\">&quot;shipped&quot;</span>&#125;)).Find(&amp;orders)</span><br><span class=\"line\"><span class=\"comment\">//  1000 </span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>GORM ()</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;name LIKE ?&quot;</span>, <span class=\"string\">&quot;jinzhu%&quot;</span>).Find(&amp;users, <span class=\"string\">&quot;id IN (?)&quot;</span>, []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;).Count(&amp;count)</span><br></pre></td></tr></table></figure>\n<p>sql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> users <span class=\"keyword\">WHERE</span> name <span class=\"keyword\">LIKE</span> <span class=\"string\">&#x27;jinzhu%&#x27;</span> <span class=\"keyword\">AND</span> id <span class=\"keyword\">IN</span> (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> users <span class=\"keyword\">WHERE</span> name <span class=\"keyword\">LIKE</span> <span class=\"string\">&#x27;jinzhu%&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><ul>\n<li><b></b></li>\n</ul>\n<p><code>Save()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.First(&amp;user)</span><br><span class=\"line\"></span><br><span class=\"line\">user.Name = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">user.Age = <span class=\"number\">99</span></span><br><span class=\"line\">db.Save(&amp;user)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">////  UPDATE `users` SET `created_at` = &#x27;2020-02-16 12:52:20&#x27;, `updated_at` = &#x27;2020-02-16 12:54:55&#x27;, `deleted_at` = NULL, `name` = &#x27;&#x27;, `age` = 99, `active` = true  WHERE `users`.`deleted_at` IS NULL AND `users`.`id` = 1</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Update</code><code>Updates</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Model(&amp;user).Update(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Model(&amp;user).Where(<span class=\"string\">&quot;active = ?&quot;</span>, <span class=\"literal\">true</span>).Update(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111 AND active=true;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  map </span></span><br><span class=\"line\">db.Model(&amp;user).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>, <span class=\"string\">&quot;active&quot;</span>: <span class=\"literal\">false</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18, active=false, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  struct </span></span><br><span class=\"line\">db.Model(&amp;user).Updates(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18, updated_at = &#x27;2013-11-17 21:34:10&#x27; WHERE id = 111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  struct GORM</span></span><br><span class=\"line\"><span class=\"comment\">// &quot;&quot;, 0, false </span></span><br><span class=\"line\">db.Model(&amp;user).Updates(User&#123;Name: <span class=\"string\">&quot;&quot;</span>, Age: <span class=\"number\">0</span>, Active: <span class=\"literal\">false</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Select</code><code>Omit</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Model(&amp;user).Select(<span class=\"string\">&quot;name&quot;</span>).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>, <span class=\"string\">&quot;active&quot;</span>: <span class=\"literal\">false</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).Omit(<span class=\"string\">&quot;name&quot;</span>).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>, <span class=\"string\">&quot;active&quot;</span>: <span class=\"literal\">false</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET age=18, active=false, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Hooks</b></li>\n</ul>\n<p><code>model</code><code>BeforeUpdate</code>, <code>AfterUpdate</code><code>UpdatedAt</code>, <code>Associations</code>, <code>UpdateColumn</code> <code>UpdateColumns</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  `Update`</span></span><br><span class=\"line\">db.Model(&amp;user).UpdateColumn(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27; WHERE id = 111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  `Updates`</span></span><br><span class=\"line\">db.Model(&amp;user).UpdateColumns(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18 WHERE id = 111;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p><code>Hooks()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Table(<span class=\"string\">&quot;users&quot;</span>).Where(<span class=\"string\">&quot;id IN (?)&quot;</span>, []<span class=\"type\">int</span>&#123;<span class=\"number\">10</span>, <span class=\"number\">11</span>&#125;).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18 WHERE id IN (10, 11);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  struct map[string]interface&#123;&#125;</span></span><br><span class=\"line\">db.Model(User&#123;&#125;).Updates(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET name=&#x27;hello&#x27;, age=18;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  `RowsAffected` </span></span><br><span class=\"line\">db.Model(User&#123;&#125;).Updates(User&#123;Name: <span class=\"string\">&quot;hello&quot;</span>, Age: <span class=\"number\">18</span>&#125;).RowsAffected</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>sql</b></li>\n</ul>\n<p>user</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> user User</span><br><span class=\"line\">db.First(&amp;user)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Model(&amp;user).Update(<span class=\"string\">&quot;age&quot;</span>, gorm.Expr(<span class=\"string\">&quot;age * ? + ?&quot;</span>, <span class=\"number\">2</span>, <span class=\"number\">100</span>))</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE `users` SET `age` = age * 2 + 100, `updated_at` = &#x27;2020-02-16 13:10:20&#x27;  WHERE `users`.`id` = 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).Updates(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;&#123;<span class=\"string\">&quot;age&quot;</span>: gorm.Expr(<span class=\"string\">&quot;age * ? + ?&quot;</span>, <span class=\"number\">2</span>, <span class=\"number\">100</span>)&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE &quot;users&quot; SET &quot;age&quot; = age * &#x27;2&#x27; + &#x27;100&#x27;, &quot;updated_at&quot; = &#x27;2020-02-16 13:05:51&#x27; WHERE `users`.`id` = 1;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).UpdateColumn(<span class=\"string\">&quot;age&quot;</span>, gorm.Expr(<span class=\"string\">&quot;age - ?&quot;</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE &quot;users&quot; SET &quot;age&quot; = age - 1 WHERE &quot;id&quot; = &#x27;1&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Model(&amp;user).Where(<span class=\"string\">&quot;age &gt; 10&quot;</span>).UpdateColumn(<span class=\"string\">&quot;age&quot;</span>, gorm.Expr(<span class=\"string\">&quot;age - ?&quot;</span>, <span class=\"number\">1</span>))</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE &quot;users&quot; SET &quot;age&quot; = age - 1 WHERE &quot;id&quot; = &#x27;1&#x27; AND quantity &gt; 10;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b>Hooks</b></li>\n</ul>\n<p><code>BeforeUpdate</code>, <code>BeforeSave</code><code>Hooks</code> <code>scope.SetColumn</code>, </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(user *User)</span></span> BeforeSave(scope *gorm.Scope) (err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> pw, err := bcrypt.GenerateFromPassword(user.Password, <span class=\"number\">0</span>); err == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    scope.SetColumn(<span class=\"string\">&quot;EncryptedPassword&quot;</span>, pw)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><b></b></h3><ul>\n<li><b></b></li>\n</ul>\n<p><font color=red><b>:</b></font> GORM GORM  model </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Delete(&amp;email)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where id=10;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  SQL  SQL </span></span><br><span class=\"line\">db.Set(<span class=\"string\">&quot;gorm:delete_option&quot;</span>, <span class=\"string\">&quot;OPTION (OPTIMIZE FOR UNKNOWN)&quot;</span>).Delete(&amp;email)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where id=10 OPTION (OPTIMIZE FOR UNKNOWN);</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Where(<span class=\"string\">&quot;email LIKE ?&quot;</span>, <span class=\"string\">&quot;%jinzhu%&quot;</span>).Delete(Email&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where email LIKE &quot;%jinzhu%&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">db.Delete(Email&#123;&#125;, <span class=\"string\">&quot;email LIKE ?&quot;</span>, <span class=\"string\">&quot;%jinzhu%&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE from emails where email LIKE &quot;%jinzhu%&quot;;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<p>model<code>DeletedAt</code> <code>Delete</code>  <code>DeletedAt</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.Delete(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE id = 111;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;age = ?&quot;</span>, <span class=\"number\">20</span>).Delete(&amp;User&#123;&#125;)</span><br><span class=\"line\"><span class=\"comment\">//// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE age = 20;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">db.Where(<span class=\"string\">&quot;age = 20&quot;</span>).Find(&amp;user)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unscoped </span></span><br><span class=\"line\">db.Unscoped().Where(<span class=\"string\">&quot;age = 20&quot;</span>).Find(&amp;users)</span><br><span class=\"line\"><span class=\"comment\">//// SELECT * FROM users WHERE age = 20;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><b></b></li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Unscoped </span></span><br><span class=\"line\">db.Unscoped().Delete(&amp;order)</span><br><span class=\"line\"><span class=\"comment\">//// DELETE FROM orders WHERE id=10;</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Kafka","_content":"# Kafka \n\n* Kafka/\n\n## \n\n* :\n\t- : \n\t- : \n\t- : ( > )\n\t- : \n\t- : \n\n* \n\t- ([  ])\n\t\t```\n\t\t* queuequeue\n\n\t\t* queueQueue\n\t\t```\n\n\t\t![](https://img-blog.csdnimg.cn/20200802210501168.png)\n\n\t- ([  ], )\n\n\t\t```\n\t\t* topic\n\n\t\t* topic\n\t\t```\n\n\t\t![](https://pic2.zhimg.com/v2-08a36aa5e745285aebe8352d9f7fbebf_r.jpg)\n\n## Kafka\n\n![](https://www.diguage.com/images/kafka/kafka-architecture.png)\n\n* ProducerTopic Partition \n* \n* Consumer \n\n* Kafka\n\t- Producer  Kafka Broker \n\t- Consumer  Kafka Broker \n\t- Consumer Group CG\n\t- Broker  Kafka  broker broker  broker  topic\n\t- Topic topic  topic\n\t- Partition  topic  broker  topic  partition partition  \n\t- Replica  partition  Kafka Kafka  topic  leader  follower\n\t- Leader  leader\n\t- Follower  leader  leader leader  follower  leader\n\t- offset\n\t- Zookeeper Kafka  zookeeperzookeeper  Kafka \n\n## Kafka\n\n* Kafka\n\t- zookeeper\n\t\t``` bash\n\t\tsudo bin/zookeeper-server-start.sh  config/zookeeper.properties \n\t\t# zookeeper\n\t\tsudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties \n\t\t```\n\t- kafka\n\t\t``` bash\n\t\tsudo bin/kafka-server-start.sh config/server.properties \n\t\t# kafka\n\t\tsudo bin/kafka-server-start.sh -daemon config/server.properties \n\t\t```\n\n* Kafka\n\t- kafka\n\t`sudo bin/kafka-server-stop.sh`\n\t- zookeeper\n\t`sudo bin/zookeeper-server-stop.sh`\n\n\n* kafaka\n\n* Topic\n\t``` bash\n\tbin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test\n\n\t\t- --replication-factor  \n\t\t- --partitions  \n\t\t- --topic topic\n\t```\n\n* Topic\n\t``` bash\n\t#zookkeeper\n\tbin/kafka-topics.sh --list --zookeeper localhost:2181  \n\t#kafka\n\tbin/kafka-topics.sh --list --bootstrap-server localhost:9092\n\t```\n\n* Topic\n\t``` bash\n\tbin/kafka-topics.sh --delete --zookeeper localhost:2181 --topic test \n\t```\n\n* Topic\n\t``` bash\n\tbin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic test \n\t```\n\n* \n\t``` bash\n\t#kafka\n\tbin/kafka-console-producer.sh --broker-list localhost:9092 --topic test \n\t```\n\n* \n\t``` bash\n\tbin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning\n\t#kafka\n\tbin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning\n\t```\n\n## Kafka\n\n`Kafka`\n\n![](https://www.freesion.com/images/679/61ba1660d8ee0128987a3e012674cad7.png)\n\n* Kafka  topic  topic\n\n* topic  partition  partition  log  log  Producer Producer  log  offset offset\n\n`Kafka`\n\n![preview](https://pic2.zhimg.com/v2-23dcdca68db7e5406e3f036297f68c4d_r.jpg)\n\n*  log  log Kafka  partition  segment segment .index  .log \n\n## Kafka\n\n* \n\t-  partition  topic  partition  partition \n\t-  partition \n\n* \n\t```\n\t Producer  ProducerRecord \n\t- topicstring NotNull\n\t- partitionint \n\t- timestamplong \n\t- keystring\n\t- valuestring \n\t- headersarray Nullable\n\t```\n\t-  partition   partition \n\t-  partition  key  key  hash  partition \n\t-  partition  key  partition  round-robin \n\n* \n\t-  producer  topictopic  partition  producer  producer  ackacknowledge  producer  ack\n\n\t![preview](https://pic3.zhimg.com/v2-2225e28f85f77380de5fcededf77249e_r.jpg)\n\n\t- \n\t\t```\n\t\t* ack?\n\t\t\t- leader \n\t\t\t- leaderfollower\n\t\t* followerack?\n\t\t\t- \n\t\t\t- \n\t\t* Kafkaack\n\t\t```\n\t\t![preview](https://pic4.zhimg.com/v2-05f1d9b679c8db558d56dc9afcc8c4c3_r.jpg)\n\n\t- ISR\n\t\t```\n\t\t*  follower producer  follower  leader  \n\n\t\t* leader in-sync replica setISR),  leader  follower  ISR  follower leader  producer  ack follower  leader  follower  ISR  replica.lag.time.max.ms \n\n\t\t* leader  ISR  leader\n\t\t```\n\t\n\t- acks \n\t\t```\n\t\t*  ISR  follower  \n\n\t\t*  Kafka \n\t\t```\n\n\t\t* 0producer  broker  ackbroker  broker \n\t\t* 1producer  broker  ackpartition  leader  ack follower  leader \n\t\t* -1allproducer  broker  ackpartition  leader  follower  ack broker  ack leader \n\n\t\t![img](https://pic2.zhimg.com/80/v2-73974b936cd969c98eab1a088e680bd5_720w.jpg)\n\t\n\t- \n\t\t![preview](https://pic2.zhimg.com/v2-b417f990a4378583e76dfde8672bf4d1_r.jpg)\n\n\t\t```\n\t\t* LEO offset \n\t\t* HW offsetISR  LEO\n\t\t```\n\t\t* Follower \n\t\t\t```\n\t\t\tfollower  ISR  follower follower   HW log  HW  HW  leader  follower  LEO  partition  HW follower  leader  ISR \n\t\t\t```\n\t\t* Leader \n\t\t\t```\n\t\t\t* leader  ISR  leader follower  log  HW  leader  \n\n\t\t\t* acks\n\t\t\t```\n\n\t- Exactly Once \n\t\t```\n\t\t*  ACK -1 producer  server  At Least Once \n\n\t\t*  ACK 0At Most Once \n\n\t\t* At Least Once At Most Once \n\n\t\t*  Exactly Once \n\n\t\t* producer  server server At Least Once +  = Exactly Once\n\n\t\t*  producer  enable.idompotence  true \n\n\t\t*  producer  PID partition  Sequence Number borker  <PID,Partition,SeqNumber> broker  \n\n\t\t*  PID  partition  Exactly Once\n\t\t```\n\n* \n\t- ack: \n\t- ISR: \n\t- HWLEO\n\n## Kafka\n\n* \n\t- consumer  pull broker \n\n\t- brokerconsumer, consumer   pull  consumer \n\n\t- pull  Kafka  broker  Kafka  timeoutconsumer  timeout\n\n* \n\t-  consumer group  consumer topic  partition partition  partition  consumer \n\n\t- Kafka  RoundRobin Rangerange\n\n\t- \n\t- RoundRobin\n\n\t\t![preview](https://pic2.zhimg.com/v2-71b0b3eba72505d5658e94446bc159b9_r.jpg)\n\n\t- Range range \n\n\t\t![img](https://pic4.zhimg.com/80/v2-587357091d733d72a6fb62555ec0a247_720w.jpg)\n\n* offset\n\t- consumer consumer  consumer  offset \n\t- Kafka 0.9 consumer  offset  Zookeeper  0.9 consumer  offset  Kafka  topic  topic  __consumer_offsets<-->offset\n\n## Kafka\n\n* \n\t```\n\tkafka  Partition  append Consumer  offset  offset \n\t```\n\n* \n\t![preview](https://pic1.zhimg.com/v2-023030c309ec9406c0a69763f451bcb0_r.jpg)\n\t```\n\t- IO:\n\t\t1\n\t\t2copyapplicationbuffer\n\t\t3applicationbuffercopysocket()\n\t\t4socket buffercopy\n\n\t\t* copyIOIOCPU()DMACPUcopy \n\t```\n\t![preview](https://pic3.zhimg.com/v2-798463e8afa943f27eec0c980f910f86_r.jpg)\n\t```\n\t: \n\t\t1.kernel buffer\n\t\t2.socket bufferkernel buffer\n\t\t3.socket bufferkernel buffercopy\n\n\t\t*  2copyZero-Copy(kernelkernelZero-Copy)\n\t```\n\n## Kafka\n\n* Kafka\n\n* Kafka\n\t- \n\t- read-process-write\n\n```\n*  Producer <Topic, Partition>Exactly Once\n\n* Exactly Once\n\t-  Commit  Commit\n\t-  Kafka Stream  Topic  Topic Topic  Topic \n\n*  IDTransaction IDTransactin IDPIDTransaction IDPID\n\n* KafkaTransaction Coordinatorpid\n```\n\n## \n\n* (fire-and-forget):  Kafka \n* (ync): producer.send()Futureget()\n* (async): Kafka producer.send()  \n\n## Kafka:\n\n* Kafka Kafka :\n<img src=\"https://pic4.zhimg.com/v2-1d7719726f1cdcc2bd608a8e9df2c71b_r.jpg\" alt=\"preview\" style=\"zoom:50%;\" />\n*  broker  broker  broker  kafka \n\n## Kafka \n\n* broker :  topic  broker  broker  leader \n* :  broker  leader  leader \n* :  broker  leader  leader \n* leader  broker  leader \n\n## \n\n*  kafka \n* : ,\n* :  broker  broker  broker \n* broker \n*  \n\n## \n\n*  topic =\n* \n\n## Kafka\n\n* Kafka broker kafka \n\t-  leader  leader \n\t- ISR broker \n\t-  topic \n\n## Kafka\n\n* \n* Page Cache: Kafka  Page Cache\n* : Kafka socket  NIC \n* +\n* \n* \n","source":"_posts/go/kafka.md","raw":"---\ntitle: Kafka \ncategories: \n- GolangStudy\n---\n# Kafka \n\n* Kafka/\n\n## \n\n* :\n\t- : \n\t- : \n\t- : ( > )\n\t- : \n\t- : \n\n* \n\t- ([  ])\n\t\t```\n\t\t* queuequeue\n\n\t\t* queueQueue\n\t\t```\n\n\t\t![](https://img-blog.csdnimg.cn/20200802210501168.png)\n\n\t- ([  ], )\n\n\t\t```\n\t\t* topic\n\n\t\t* topic\n\t\t```\n\n\t\t![](https://pic2.zhimg.com/v2-08a36aa5e745285aebe8352d9f7fbebf_r.jpg)\n\n## Kafka\n\n![](https://www.diguage.com/images/kafka/kafka-architecture.png)\n\n* ProducerTopic Partition \n* \n* Consumer \n\n* Kafka\n\t- Producer  Kafka Broker \n\t- Consumer  Kafka Broker \n\t- Consumer Group CG\n\t- Broker  Kafka  broker broker  broker  topic\n\t- Topic topic  topic\n\t- Partition  topic  broker  topic  partition partition  \n\t- Replica  partition  Kafka Kafka  topic  leader  follower\n\t- Leader  leader\n\t- Follower  leader  leader leader  follower  leader\n\t- offset\n\t- Zookeeper Kafka  zookeeperzookeeper  Kafka \n\n## Kafka\n\n* Kafka\n\t- zookeeper\n\t\t``` bash\n\t\tsudo bin/zookeeper-server-start.sh  config/zookeeper.properties \n\t\t# zookeeper\n\t\tsudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties \n\t\t```\n\t- kafka\n\t\t``` bash\n\t\tsudo bin/kafka-server-start.sh config/server.properties \n\t\t# kafka\n\t\tsudo bin/kafka-server-start.sh -daemon config/server.properties \n\t\t```\n\n* Kafka\n\t- kafka\n\t`sudo bin/kafka-server-stop.sh`\n\t- zookeeper\n\t`sudo bin/zookeeper-server-stop.sh`\n\n\n* kafaka\n\n* Topic\n\t``` bash\n\tbin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test\n\n\t\t- --replication-factor  \n\t\t- --partitions  \n\t\t- --topic topic\n\t```\n\n* Topic\n\t``` bash\n\t#zookkeeper\n\tbin/kafka-topics.sh --list --zookeeper localhost:2181  \n\t#kafka\n\tbin/kafka-topics.sh --list --bootstrap-server localhost:9092\n\t```\n\n* Topic\n\t``` bash\n\tbin/kafka-topics.sh --delete --zookeeper localhost:2181 --topic test \n\t```\n\n* Topic\n\t``` bash\n\tbin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic test \n\t```\n\n* \n\t``` bash\n\t#kafka\n\tbin/kafka-console-producer.sh --broker-list localhost:9092 --topic test \n\t```\n\n* \n\t``` bash\n\tbin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning\n\t#kafka\n\tbin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning\n\t```\n\n## Kafka\n\n`Kafka`\n\n![](https://www.freesion.com/images/679/61ba1660d8ee0128987a3e012674cad7.png)\n\n* Kafka  topic  topic\n\n* topic  partition  partition  log  log  Producer Producer  log  offset offset\n\n`Kafka`\n\n![preview](https://pic2.zhimg.com/v2-23dcdca68db7e5406e3f036297f68c4d_r.jpg)\n\n*  log  log Kafka  partition  segment segment .index  .log \n\n## Kafka\n\n* \n\t-  partition  topic  partition  partition \n\t-  partition \n\n* \n\t```\n\t Producer  ProducerRecord \n\t- topicstring NotNull\n\t- partitionint \n\t- timestamplong \n\t- keystring\n\t- valuestring \n\t- headersarray Nullable\n\t```\n\t-  partition   partition \n\t-  partition  key  key  hash  partition \n\t-  partition  key  partition  round-robin \n\n* \n\t-  producer  topictopic  partition  producer  producer  ackacknowledge  producer  ack\n\n\t![preview](https://pic3.zhimg.com/v2-2225e28f85f77380de5fcededf77249e_r.jpg)\n\n\t- \n\t\t```\n\t\t* ack?\n\t\t\t- leader \n\t\t\t- leaderfollower\n\t\t* followerack?\n\t\t\t- \n\t\t\t- \n\t\t* Kafkaack\n\t\t```\n\t\t![preview](https://pic4.zhimg.com/v2-05f1d9b679c8db558d56dc9afcc8c4c3_r.jpg)\n\n\t- ISR\n\t\t```\n\t\t*  follower producer  follower  leader  \n\n\t\t* leader in-sync replica setISR),  leader  follower  ISR  follower leader  producer  ack follower  leader  follower  ISR  replica.lag.time.max.ms \n\n\t\t* leader  ISR  leader\n\t\t```\n\t\n\t- acks \n\t\t```\n\t\t*  ISR  follower  \n\n\t\t*  Kafka \n\t\t```\n\n\t\t* 0producer  broker  ackbroker  broker \n\t\t* 1producer  broker  ackpartition  leader  ack follower  leader \n\t\t* -1allproducer  broker  ackpartition  leader  follower  ack broker  ack leader \n\n\t\t![img](https://pic2.zhimg.com/80/v2-73974b936cd969c98eab1a088e680bd5_720w.jpg)\n\t\n\t- \n\t\t![preview](https://pic2.zhimg.com/v2-b417f990a4378583e76dfde8672bf4d1_r.jpg)\n\n\t\t```\n\t\t* LEO offset \n\t\t* HW offsetISR  LEO\n\t\t```\n\t\t* Follower \n\t\t\t```\n\t\t\tfollower  ISR  follower follower   HW log  HW  HW  leader  follower  LEO  partition  HW follower  leader  ISR \n\t\t\t```\n\t\t* Leader \n\t\t\t```\n\t\t\t* leader  ISR  leader follower  log  HW  leader  \n\n\t\t\t* acks\n\t\t\t```\n\n\t- Exactly Once \n\t\t```\n\t\t*  ACK -1 producer  server  At Least Once \n\n\t\t*  ACK 0At Most Once \n\n\t\t* At Least Once At Most Once \n\n\t\t*  Exactly Once \n\n\t\t* producer  server server At Least Once +  = Exactly Once\n\n\t\t*  producer  enable.idompotence  true \n\n\t\t*  producer  PID partition  Sequence Number borker  <PID,Partition,SeqNumber> broker  \n\n\t\t*  PID  partition  Exactly Once\n\t\t```\n\n* \n\t- ack: \n\t- ISR: \n\t- HWLEO\n\n## Kafka\n\n* \n\t- consumer  pull broker \n\n\t- brokerconsumer, consumer   pull  consumer \n\n\t- pull  Kafka  broker  Kafka  timeoutconsumer  timeout\n\n* \n\t-  consumer group  consumer topic  partition partition  partition  consumer \n\n\t- Kafka  RoundRobin Rangerange\n\n\t- \n\t- RoundRobin\n\n\t\t![preview](https://pic2.zhimg.com/v2-71b0b3eba72505d5658e94446bc159b9_r.jpg)\n\n\t- Range range \n\n\t\t![img](https://pic4.zhimg.com/80/v2-587357091d733d72a6fb62555ec0a247_720w.jpg)\n\n* offset\n\t- consumer consumer  consumer  offset \n\t- Kafka 0.9 consumer  offset  Zookeeper  0.9 consumer  offset  Kafka  topic  topic  __consumer_offsets<-->offset\n\n## Kafka\n\n* \n\t```\n\tkafka  Partition  append Consumer  offset  offset \n\t```\n\n* \n\t![preview](https://pic1.zhimg.com/v2-023030c309ec9406c0a69763f451bcb0_r.jpg)\n\t```\n\t- IO:\n\t\t1\n\t\t2copyapplicationbuffer\n\t\t3applicationbuffercopysocket()\n\t\t4socket buffercopy\n\n\t\t* copyIOIOCPU()DMACPUcopy \n\t```\n\t![preview](https://pic3.zhimg.com/v2-798463e8afa943f27eec0c980f910f86_r.jpg)\n\t```\n\t: \n\t\t1.kernel buffer\n\t\t2.socket bufferkernel buffer\n\t\t3.socket bufferkernel buffercopy\n\n\t\t*  2copyZero-Copy(kernelkernelZero-Copy)\n\t```\n\n## Kafka\n\n* Kafka\n\n* Kafka\n\t- \n\t- read-process-write\n\n```\n*  Producer <Topic, Partition>Exactly Once\n\n* Exactly Once\n\t-  Commit  Commit\n\t-  Kafka Stream  Topic  Topic Topic  Topic \n\n*  IDTransaction IDTransactin IDPIDTransaction IDPID\n\n* KafkaTransaction Coordinatorpid\n```\n\n## \n\n* (fire-and-forget):  Kafka \n* (ync): producer.send()Futureget()\n* (async): Kafka producer.send()  \n\n## Kafka:\n\n* Kafka Kafka :\n<img src=\"https://pic4.zhimg.com/v2-1d7719726f1cdcc2bd608a8e9df2c71b_r.jpg\" alt=\"preview\" style=\"zoom:50%;\" />\n*  broker  broker  broker  kafka \n\n## Kafka \n\n* broker :  topic  broker  broker  leader \n* :  broker  leader  leader \n* :  broker  leader  leader \n* leader  broker  leader \n\n## \n\n*  kafka \n* : ,\n* :  broker  broker  broker \n* broker \n*  \n\n## \n\n*  topic =\n* \n\n## Kafka\n\n* Kafka broker kafka \n\t-  leader  leader \n\t- ISR broker \n\t-  topic \n\n## Kafka\n\n* \n* Page Cache: Kafka  Page Cache\n* : Kafka socket  NIC \n* +\n* \n* \n","slug":"go/kafka","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6e8000df8wz93wk0xks","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h1><ul>\n<li>Kafka/</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>:</p>\n<ul>\n<li>: </li>\n<li>: </li>\n<li>: ( &gt; )</li>\n<li>: </li>\n<li>: </li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>([  ])</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* queuequeue</span><br><span class=\"line\"></span><br><span class=\"line\">* queueQueue</span><br></pre></td></tr></table></figure>\n\n<p>  <img src=\"https://img-blog.csdnimg.cn/20200802210501168.png\" alt=\"\"></p>\n</li>\n<li><p>([  ], )</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* topic</span><br><span class=\"line\"></span><br><span class=\"line\">* topic</span><br></pre></td></tr></table></figure>\n\n<p>  <img src=\"https://pic2.zhimg.com/v2-08a36aa5e745285aebe8352d9f7fbebf_r.jpg\" alt=\"\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><p><img src=\"https://www.diguage.com/images/kafka/kafka-architecture.png\" alt=\"\"></p>\n<ul>\n<li><p>ProducerTopic Partition </p>\n</li>\n<li><p></p>\n</li>\n<li><p>Consumer </p>\n</li>\n<li><p>Kafka</p>\n<ul>\n<li>Producer  Kafka Broker </li>\n<li>Consumer  Kafka Broker </li>\n<li>Consumer Group CG</li>\n<li>Broker  Kafka  broker broker  broker  topic</li>\n<li>Topic topic  topic</li>\n<li>Partition  topic  broker  topic  partition partition  </li>\n<li>Replica  partition  Kafka Kafka  topic  leader  follower</li>\n<li>Leader  leader</li>\n<li>Follower  leader  leader leader  follower  leader</li>\n<li>offset</li>\n<li>Zookeeper Kafka  zookeeperzookeeper  Kafka </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p>Kafka</p>\n<ul>\n<li>zookeeper  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/zookeeper-server-start.sh  config/zookeeper.properties </span><br><span class=\"line\"><span class=\"comment\"># zookeeper</span></span><br><span class=\"line\">sudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties </span><br></pre></td></tr></table></figure></li>\n<li>kafka  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/kafka-server-start.sh config/server.properties </span><br><span class=\"line\"><span class=\"comment\"># kafka</span></span><br><span class=\"line\">sudo bin/kafka-server-start.sh -daemon config/server.properties </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Kafka</p>\n<ul>\n<li>kafka<br><code>sudo bin/kafka-server-stop.sh</code></li>\n<li>zookeeper<br><code>sudo bin/zookeeper-server-stop.sh</code></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p>kafaka</p>\n</li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t- --replication-factor  </span><br><span class=\"line\">\t- --partitions  </span><br><span class=\"line\">\t- --topic topic</span><br></pre></td></tr></table></figure></li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#zookkeeper</span></span><br><span class=\"line\">bin/kafka-topics.sh --list --zookeeper localhost:2181  </span><br><span class=\"line\"><span class=\"comment\">#kafka</span></span><br><span class=\"line\">bin/kafka-topics.sh --list --bootstrap-server localhost:9092</span><br></pre></td></tr></table></figure></li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --delete --zookeeper localhost:2181 --topic <span class=\"built_in\">test</span> </span><br></pre></td></tr></table></figure></li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic <span class=\"built_in\">test</span> </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#kafka</span></span><br><span class=\"line\">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class=\"built_in\">test</span> </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic <span class=\"built_in\">test</span> --from-beginning</span><br><span class=\"line\"><span class=\"comment\">#kafka</span></span><br><span class=\"line\">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --from-beginning</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><p><code>Kafka</code></p>\n<p><img src=\"https://www.freesion.com/images/679/61ba1660d8ee0128987a3e012674cad7.png\" alt=\"\"></p>\n<ul>\n<li><p>Kafka  topic  topic</p>\n</li>\n<li><p>topic  partition  partition  log  log  Producer Producer  log  offset offset</p>\n</li>\n</ul>\n<p><code>Kafka</code></p>\n<p><img src=\"https://pic2.zhimg.com/v2-23dcdca68db7e5406e3f036297f68c4d_r.jpg\" alt=\"preview\"></p>\n<ul>\n<li> log  log Kafka  partition  segment segment .index  .log </li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p></p>\n<ul>\n<li> partition  topic  partition  partition </li>\n<li> partition </li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Producer  ProducerRecord </span><br><span class=\"line\">- topicstring NotNull</span><br><span class=\"line\">- partitionint </span><br><span class=\"line\">- timestamplong </span><br><span class=\"line\">- keystring</span><br><span class=\"line\">- valuestring </span><br><span class=\"line\">- headersarray Nullable</span><br></pre></td></tr></table></figure>\n<ul>\n<li> partition   partition </li>\n<li> partition  key  key  hash  partition </li>\n<li> partition  key  partition  round-robin </li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li> producer  topictopic  partition  producer  producer  ackacknowledge  producer  ack</li>\n</ul>\n<p>  <img src=\"https://pic3.zhimg.com/v2-2225e28f85f77380de5fcededf77249e_r.jpg\" alt=\"preview\"></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* ack?</span><br><span class=\"line\">\t- leader </span><br><span class=\"line\">\t- leaderfollower</span><br><span class=\"line\">* followerack?</span><br><span class=\"line\">\t- </span><br><span class=\"line\">\t- </span><br><span class=\"line\">* Kafkaack</span><br></pre></td></tr></table></figure>\n<p>  <img src=\"https://pic4.zhimg.com/v2-05f1d9b679c8db558d56dc9afcc8c4c3_r.jpg\" alt=\"preview\"></p>\n</li>\n<li><p>ISR</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  follower producer  follower  leader  </span><br><span class=\"line\"></span><br><span class=\"line\">* leader in-sync replica setISR),  leader  follower  ISR  follower leader  producer  ack follower  leader  follower  ISR  replica.lag.time.max.ms </span><br><span class=\"line\"></span><br><span class=\"line\">* leader  ISR  leader</span><br></pre></td></tr></table></figure></li>\n<li><p>acks </p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  ISR  follower  </span><br><span class=\"line\"></span><br><span class=\"line\">*  Kafka </span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>0producer  broker  ackbroker  broker </li>\n<li>1producer  broker  ackpartition  leader  ack follower  leader </li>\n<li>-1allproducer  broker  ackpartition  leader  follower  ack broker  ack leader </li>\n</ul>\n<p>  <img src=\"https://pic2.zhimg.com/80/v2-73974b936cd969c98eab1a088e680bd5_720w.jpg\" alt=\"img\"></p>\n</li>\n<li><p><br>  <img src=\"https://pic2.zhimg.com/v2-b417f990a4378583e76dfde8672bf4d1_r.jpg\" alt=\"preview\"></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* LEO offset </span><br><span class=\"line\">* HW offsetISR  LEO</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Follower   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">follower  ISR  follower follower   HW log  HW  HW  leader  follower  LEO  partition  HW follower  leader  ISR </span><br></pre></td></tr></table></figure></li>\n<li>Leader   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* leader  ISR  leader follower  log  HW  leader  </span><br><span class=\"line\"></span><br><span class=\"line\">* acks</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Exactly Once </p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  ACK -1 producer  server  At Least Once </span><br><span class=\"line\"></span><br><span class=\"line\">*  ACK 0At Most Once </span><br><span class=\"line\"></span><br><span class=\"line\">* At Least Once At Most Once </span><br><span class=\"line\"></span><br><span class=\"line\">*  Exactly Once </span><br><span class=\"line\"></span><br><span class=\"line\">* producer  server server At Least Once +  = Exactly Once</span><br><span class=\"line\"></span><br><span class=\"line\">*  producer  enable.idompotence  true </span><br><span class=\"line\"></span><br><span class=\"line\">*  producer  PID partition  Sequence Number borker  &lt;PID,Partition,SeqNumber&gt; broker  </span><br><span class=\"line\"></span><br><span class=\"line\">*  PID  partition  Exactly Once</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>ack: </li>\n<li>ISR: </li>\n<li>HWLEO</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p></p>\n<ul>\n<li><p>consumer  pull broker </p>\n</li>\n<li><p>brokerconsumer, consumer   pull  consumer </p>\n</li>\n<li><p>pull  Kafka  broker  Kafka  timeoutconsumer  timeout</p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p> consumer group  consumer topic  partition partition  partition  consumer </p>\n</li>\n<li><p>Kafka  RoundRobin Rangerange</p>\n</li>\n<li><p></p>\n</li>\n<li><p>RoundRobin</p>\n<p>  <img src=\"https://pic2.zhimg.com/v2-71b0b3eba72505d5658e94446bc159b9_r.jpg\" alt=\"preview\"></p>\n</li>\n<li><p>Range range </p>\n<p>  <img src=\"https://pic4.zhimg.com/80/v2-587357091d733d72a6fb62555ec0a247_720w.jpg\" alt=\"img\"></p>\n</li>\n</ul>\n</li>\n<li><p>offset</p>\n<ul>\n<li>consumer consumer  consumer  offset </li>\n<li>Kafka 0.9 consumer  offset  Zookeeper  0.9 consumer  offset  Kafka  topic  topic  __consumer_offsets&lt;--&gt;offset</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka  Partition  append Consumer  offset  offset </span><br></pre></td></tr></table></figure></li>\n<li><p><br>  <img src=\"https://pic1.zhimg.com/v2-023030c309ec9406c0a69763f451bcb0_r.jpg\" alt=\"preview\"></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- IO:</span><br><span class=\"line\">\t1</span><br><span class=\"line\">\t2copyapplicationbuffer</span><br><span class=\"line\">\t3applicationbuffercopysocket()</span><br><span class=\"line\">\t4socket buffercopy</span><br><span class=\"line\"></span><br><span class=\"line\">\t* copyIOIOCPU()DMACPUcopy </span><br></pre></td></tr></table></figure>\n<p>  <img src=\"https://pic3.zhimg.com/v2-798463e8afa943f27eec0c980f910f86_r.jpg\" alt=\"preview\"></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: </span><br><span class=\"line\">\t1.kernel buffer</span><br><span class=\"line\">\t2.socket bufferkernel buffer</span><br><span class=\"line\">\t3.socket bufferkernel buffercopy</span><br><span class=\"line\"></span><br><span class=\"line\">\t*  2copyZero-Copy(kernelkernelZero-Copy)</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p>Kafka</p>\n</li>\n<li><p>Kafka</p>\n<ul>\n<li></li>\n<li>read-process-write</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  Producer &lt;Topic, Partition&gt;Exactly Once</span><br><span class=\"line\"></span><br><span class=\"line\">* Exactly Once</span><br><span class=\"line\">\t-  Commit  Commit</span><br><span class=\"line\">\t-  Kafka Stream  Topic  Topic Topic  Topic </span><br><span class=\"line\"></span><br><span class=\"line\">*  IDTransaction IDTransactin IDPIDTransaction IDPID</span><br><span class=\"line\"></span><br><span class=\"line\">* KafkaTransaction Coordinatorpid</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>(fire-and-forget):  Kafka </li>\n<li>(ync): producer.send()Futureget()</li>\n<li>(async): Kafka producer.send()  </li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka:\"></a>Kafka:</h2><ul>\n<li>Kafka Kafka :<img src=\"https://pic4.zhimg.com/v2-1d7719726f1cdcc2bd608a8e9df2c71b_r.jpg\" alt=\"preview\" style=\"zoom:50%;\" /></li>\n<li> broker  broker  broker  kafka </li>\n</ul>\n<h2 id=\"Kafka-\"><a href=\"#Kafka-\" class=\"headerlink\" title=\"Kafka \"></a>Kafka </h2><ul>\n<li>broker :  topic  broker  broker  leader </li>\n<li>:  broker  leader  leader </li>\n<li>:  broker  leader  leader </li>\n<li>leader  broker  leader </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> kafka </li>\n<li>: ,</li>\n<li>:  broker  broker  broker </li>\n<li>broker </li>\n<li> </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> topic =</li>\n<li></li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li>Kafka broker kafka <ul>\n<li> leader  leader </li>\n<li>ISR broker </li>\n<li> topic </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li></li>\n<li>Page Cache: Kafka  Page Cache</li>\n<li>: Kafka socket  NIC </li>\n<li>+</li>\n<li></li>\n<li></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h1><ul>\n<li>Kafka/</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>:</p>\n<ul>\n<li>: </li>\n<li>: </li>\n<li>: ( &gt; )</li>\n<li>: </li>\n<li>: </li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>([  ])</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* queuequeue</span><br><span class=\"line\"></span><br><span class=\"line\">* queueQueue</span><br></pre></td></tr></table></figure>\n\n<p>  <img src=\"https://img-blog.csdnimg.cn/20200802210501168.png\" alt=\"\"></p>\n</li>\n<li><p>([  ], )</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* topic</span><br><span class=\"line\"></span><br><span class=\"line\">* topic</span><br></pre></td></tr></table></figure>\n\n<p>  <img src=\"https://pic2.zhimg.com/v2-08a36aa5e745285aebe8352d9f7fbebf_r.jpg\" alt=\"\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><p><img src=\"https://www.diguage.com/images/kafka/kafka-architecture.png\" alt=\"\"></p>\n<ul>\n<li><p>ProducerTopic Partition </p>\n</li>\n<li><p></p>\n</li>\n<li><p>Consumer </p>\n</li>\n<li><p>Kafka</p>\n<ul>\n<li>Producer  Kafka Broker </li>\n<li>Consumer  Kafka Broker </li>\n<li>Consumer Group CG</li>\n<li>Broker  Kafka  broker broker  broker  topic</li>\n<li>Topic topic  topic</li>\n<li>Partition  topic  broker  topic  partition partition  </li>\n<li>Replica  partition  Kafka Kafka  topic  leader  follower</li>\n<li>Leader  leader</li>\n<li>Follower  leader  leader leader  follower  leader</li>\n<li>offset</li>\n<li>Zookeeper Kafka  zookeeperzookeeper  Kafka </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p>Kafka</p>\n<ul>\n<li>zookeeper  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/zookeeper-server-start.sh  config/zookeeper.properties </span><br><span class=\"line\"><span class=\"comment\"># zookeeper</span></span><br><span class=\"line\">sudo bin/zookeeper-server-start.sh -daemon  config/zookeeper.properties </span><br></pre></td></tr></table></figure></li>\n<li>kafka  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bin/kafka-server-start.sh config/server.properties </span><br><span class=\"line\"><span class=\"comment\"># kafka</span></span><br><span class=\"line\">sudo bin/kafka-server-start.sh -daemon config/server.properties </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Kafka</p>\n<ul>\n<li>kafka<br><code>sudo bin/kafka-server-stop.sh</code></li>\n<li>zookeeper<br><code>sudo bin/zookeeper-server-stop.sh</code></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p>kafaka</p>\n</li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t- --replication-factor  </span><br><span class=\"line\">\t- --partitions  </span><br><span class=\"line\">\t- --topic topic</span><br></pre></td></tr></table></figure></li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#zookkeeper</span></span><br><span class=\"line\">bin/kafka-topics.sh --list --zookeeper localhost:2181  </span><br><span class=\"line\"><span class=\"comment\">#kafka</span></span><br><span class=\"line\">bin/kafka-topics.sh --list --bootstrap-server localhost:9092</span><br></pre></td></tr></table></figure></li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --delete --zookeeper localhost:2181 --topic <span class=\"built_in\">test</span> </span><br></pre></td></tr></table></figure></li>\n<li><p>Topic</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic <span class=\"built_in\">test</span> </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#kafka</span></span><br><span class=\"line\">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class=\"built_in\">test</span> </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic <span class=\"built_in\">test</span> --from-beginning</span><br><span class=\"line\"><span class=\"comment\">#kafka</span></span><br><span class=\"line\">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --from-beginning</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><p><code>Kafka</code></p>\n<p><img src=\"https://www.freesion.com/images/679/61ba1660d8ee0128987a3e012674cad7.png\" alt=\"\"></p>\n<ul>\n<li><p>Kafka  topic  topic</p>\n</li>\n<li><p>topic  partition  partition  log  log  Producer Producer  log  offset offset</p>\n</li>\n</ul>\n<p><code>Kafka</code></p>\n<p><img src=\"https://pic2.zhimg.com/v2-23dcdca68db7e5406e3f036297f68c4d_r.jpg\" alt=\"preview\"></p>\n<ul>\n<li> log  log Kafka  partition  segment segment .index  .log </li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p></p>\n<ul>\n<li> partition  topic  partition  partition </li>\n<li> partition </li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Producer  ProducerRecord </span><br><span class=\"line\">- topicstring NotNull</span><br><span class=\"line\">- partitionint </span><br><span class=\"line\">- timestamplong </span><br><span class=\"line\">- keystring</span><br><span class=\"line\">- valuestring </span><br><span class=\"line\">- headersarray Nullable</span><br></pre></td></tr></table></figure>\n<ul>\n<li> partition   partition </li>\n<li> partition  key  key  hash  partition </li>\n<li> partition  key  partition  round-robin </li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li> producer  topictopic  partition  producer  producer  ackacknowledge  producer  ack</li>\n</ul>\n<p>  <img src=\"https://pic3.zhimg.com/v2-2225e28f85f77380de5fcededf77249e_r.jpg\" alt=\"preview\"></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* ack?</span><br><span class=\"line\">\t- leader </span><br><span class=\"line\">\t- leaderfollower</span><br><span class=\"line\">* followerack?</span><br><span class=\"line\">\t- </span><br><span class=\"line\">\t- </span><br><span class=\"line\">* Kafkaack</span><br></pre></td></tr></table></figure>\n<p>  <img src=\"https://pic4.zhimg.com/v2-05f1d9b679c8db558d56dc9afcc8c4c3_r.jpg\" alt=\"preview\"></p>\n</li>\n<li><p>ISR</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  follower producer  follower  leader  </span><br><span class=\"line\"></span><br><span class=\"line\">* leader in-sync replica setISR),  leader  follower  ISR  follower leader  producer  ack follower  leader  follower  ISR  replica.lag.time.max.ms </span><br><span class=\"line\"></span><br><span class=\"line\">* leader  ISR  leader</span><br></pre></td></tr></table></figure></li>\n<li><p>acks </p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  ISR  follower  </span><br><span class=\"line\"></span><br><span class=\"line\">*  Kafka </span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>0producer  broker  ackbroker  broker </li>\n<li>1producer  broker  ackpartition  leader  ack follower  leader </li>\n<li>-1allproducer  broker  ackpartition  leader  follower  ack broker  ack leader </li>\n</ul>\n<p>  <img src=\"https://pic2.zhimg.com/80/v2-73974b936cd969c98eab1a088e680bd5_720w.jpg\" alt=\"img\"></p>\n</li>\n<li><p><br>  <img src=\"https://pic2.zhimg.com/v2-b417f990a4378583e76dfde8672bf4d1_r.jpg\" alt=\"preview\"></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* LEO offset </span><br><span class=\"line\">* HW offsetISR  LEO</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Follower   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">follower  ISR  follower follower   HW log  HW  HW  leader  follower  LEO  partition  HW follower  leader  ISR </span><br></pre></td></tr></table></figure></li>\n<li>Leader   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* leader  ISR  leader follower  log  HW  leader  </span><br><span class=\"line\"></span><br><span class=\"line\">* acks</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Exactly Once </p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  ACK -1 producer  server  At Least Once </span><br><span class=\"line\"></span><br><span class=\"line\">*  ACK 0At Most Once </span><br><span class=\"line\"></span><br><span class=\"line\">* At Least Once At Most Once </span><br><span class=\"line\"></span><br><span class=\"line\">*  Exactly Once </span><br><span class=\"line\"></span><br><span class=\"line\">* producer  server server At Least Once +  = Exactly Once</span><br><span class=\"line\"></span><br><span class=\"line\">*  producer  enable.idompotence  true </span><br><span class=\"line\"></span><br><span class=\"line\">*  producer  PID partition  Sequence Number borker  &lt;PID,Partition,SeqNumber&gt; broker  </span><br><span class=\"line\"></span><br><span class=\"line\">*  PID  partition  Exactly Once</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>ack: </li>\n<li>ISR: </li>\n<li>HWLEO</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p></p>\n<ul>\n<li><p>consumer  pull broker </p>\n</li>\n<li><p>brokerconsumer, consumer   pull  consumer </p>\n</li>\n<li><p>pull  Kafka  broker  Kafka  timeoutconsumer  timeout</p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p> consumer group  consumer topic  partition partition  partition  consumer </p>\n</li>\n<li><p>Kafka  RoundRobin Rangerange</p>\n</li>\n<li><p></p>\n</li>\n<li><p>RoundRobin</p>\n<p>  <img src=\"https://pic2.zhimg.com/v2-71b0b3eba72505d5658e94446bc159b9_r.jpg\" alt=\"preview\"></p>\n</li>\n<li><p>Range range </p>\n<p>  <img src=\"https://pic4.zhimg.com/80/v2-587357091d733d72a6fb62555ec0a247_720w.jpg\" alt=\"img\"></p>\n</li>\n</ul>\n</li>\n<li><p>offset</p>\n<ul>\n<li>consumer consumer  consumer  offset </li>\n<li>Kafka 0.9 consumer  offset  Zookeeper  0.9 consumer  offset  Kafka  topic  topic  __consumer_offsets&lt;--&gt;offset</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka  Partition  append Consumer  offset  offset </span><br></pre></td></tr></table></figure></li>\n<li><p><br>  <img src=\"https://pic1.zhimg.com/v2-023030c309ec9406c0a69763f451bcb0_r.jpg\" alt=\"preview\"></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- IO:</span><br><span class=\"line\">\t1</span><br><span class=\"line\">\t2copyapplicationbuffer</span><br><span class=\"line\">\t3applicationbuffercopysocket()</span><br><span class=\"line\">\t4socket buffercopy</span><br><span class=\"line\"></span><br><span class=\"line\">\t* copyIOIOCPU()DMACPUcopy </span><br></pre></td></tr></table></figure>\n<p>  <img src=\"https://pic3.zhimg.com/v2-798463e8afa943f27eec0c980f910f86_r.jpg\" alt=\"preview\"></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: </span><br><span class=\"line\">\t1.kernel buffer</span><br><span class=\"line\">\t2.socket bufferkernel buffer</span><br><span class=\"line\">\t3.socket bufferkernel buffercopy</span><br><span class=\"line\"></span><br><span class=\"line\">\t*  2copyZero-Copy(kernelkernelZero-Copy)</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li><p>Kafka</p>\n</li>\n<li><p>Kafka</p>\n<ul>\n<li></li>\n<li>read-process-write</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*  Producer &lt;Topic, Partition&gt;Exactly Once</span><br><span class=\"line\"></span><br><span class=\"line\">* Exactly Once</span><br><span class=\"line\">\t-  Commit  Commit</span><br><span class=\"line\">\t-  Kafka Stream  Topic  Topic Topic  Topic </span><br><span class=\"line\"></span><br><span class=\"line\">*  IDTransaction IDTransactin IDPIDTransaction IDPID</span><br><span class=\"line\"></span><br><span class=\"line\">* KafkaTransaction Coordinatorpid</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>(fire-and-forget):  Kafka </li>\n<li>(ync): producer.send()Futureget()</li>\n<li>(async): Kafka producer.send()  </li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka:\"></a>Kafka:</h2><ul>\n<li>Kafka Kafka :<img src=\"https://pic4.zhimg.com/v2-1d7719726f1cdcc2bd608a8e9df2c71b_r.jpg\" alt=\"preview\" style=\"zoom:50%;\" /></li>\n<li> broker  broker  broker  kafka </li>\n</ul>\n<h2 id=\"Kafka-\"><a href=\"#Kafka-\" class=\"headerlink\" title=\"Kafka \"></a>Kafka </h2><ul>\n<li>broker :  topic  broker  broker  leader </li>\n<li>:  broker  leader  leader </li>\n<li>:  broker  leader  leader </li>\n<li>leader  broker  leader </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> kafka </li>\n<li>: ,</li>\n<li>:  broker  broker  broker </li>\n<li>broker </li>\n<li> </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> topic =</li>\n<li></li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li>Kafka broker kafka <ul>\n<li> leader  leader </li>\n<li>ISR broker </li>\n<li> topic </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ul>\n<li></li>\n<li>Page Cache: Kafka  Page Cache</li>\n<li>: Kafka socket  NIC </li>\n<li>+</li>\n<li></li>\n<li></li>\n</ul>\n"},{"title":"Redis","_content":"\n## Redis\n\n* Redis(Remote Dictionary Server)C(key-value)\n* NoSQL: Not-Only SQL()\n* \n\t- \n\t- \n\t- \n\t- \n\t\t*  string\n\t\t*  list\n\t\t*  hash\n\t\t*  set\n\t\t*  sorted_set\n\t- \n* \n\t* \n\t* , \n\t* , \n\t* ,\n\t* \n\t* \n\t* \n\n##  \n\n* \n\n``` redis\nredis-server \nredis-server --port 6380\nredis-server conf/redis-6379.conf\n```\n\n* \n\n``` redis\nredis-cli \nredis-cli -p 6380\nredis-cli -h 127.0.0.1 -p 6380\n```\n\n\n\n## Redis\n\n* RedisMapkey:value,keystringvalue\n\n### string\n\n* \n* \n* \n\t- /\n\t\t``` redis \n\t\t# /\n\t\tset key val\n\t\t# /\n\t\tmset key1 val1 key2 val2\n\t\t```\n\t-   \n\t\t``` redis\n\t\t# \n\t\tget key\n\t\t# \n\t\tmget key1 key2\n\t\t``` \n\t- \n\t\t``` redis\n\t\tdel key\n\t\t```\n\t-   \n\t\t``` redis\n\t\tstrlen key\n\t\t```\n\t-   \n\t\t``` redis\n\t\tappend key value\n\t\t```\n* \n\t- redisid\n\t\t``` redis\n\t\tincr key\n\t\tdecr key\n\t\tincrby key increment\n\t\tdecrby key incrment\n\t\tincrbyfloat key increment \n\t\t```\n\n\t- , (4)\n\t\t``` redis\n\t\tsetex key seconds value\n\t\tpsetex key milliseconds value\n\n\t\t# :\n\t\tsetex 13879631902 60 1\n\t\t```\n\n* \n\t* ::: value\n\t    ``` redis\n\t    set user:id:00789:fans 1242526\n\t    set user:id:00789:blogs 789\n\t    ```\n\t* json\n\t\t``` redis\n\t\tuser:id:2506 '{\"name\"\":, \"fans\": 6143, \"focuns\"\":83}''\n\t\t```\n\n### hash\n\n* \n* : \n* \n\t- /  \n\t\t``` redis\n\t\t# /\n\t\thset key filed1 value1 filed2 value2  \n\t\t# /\n\t\thmset key1 filed1 value1 filed2 value2 key2 filed1 value1  \n\t\t```\n\t-    \n\t\t```  redis\n\t\t# key\n\t\thget key filed    \n\t\t# key\n\t\thgetall key\n\t\t# key\n\t\thmget key filed1 field2\n\t\t```\n\t-    \n\t\t``` redis\n\t\thdel key field\n\t\t```\n\t-   \n\t\t``` redis\n\t\thlen key\n\t\t```\n\t-   \n\t\t``` redis\n\t\thexists key field\n\t\t```\n\t- valueset  \n\t\t``` redis\n\t\thsetnx key fidld value\n\t\t```\n\n* \n\t*  \n\t\t``` redis\n\t\t# \n\t\thkeys key    \n\t\t# \n\t\thvals key\n\t\t```\n\t*  \n\t\t``` redis\n\t\thincrby key field increment  \n\t\thincrbyfloat key field incrment\n\t\t```\n\n* \n\t* hashvalue\n\t* hash\n\t* hgetallfield\n\n* \n\t- \n\t\t* idkeyhash\n\t\t* fieldvalue\n\t\t* : fileldvalue\n\t\t* : hash\n\t\t* : /, value\n\t\t* : field\n\t\t* : key\n\n\t\t``` redis\n\t\thset user:id:001 g01 300 g02 500\n\t\thset user:id:001 g03 30\n\t\thincrby user:id:001 g03 2\n\t\thlen user:id:001\n\t\thdel user:id:001 g02\n\t\t```\n\n\t- \n\t\t* filed\n\t\t\t* eg: id:nums \n\t\t\t\tid:info \n\t\t\t``` redis\n\t\t\thset 001 g01:nums 100 g01:info '{\"name\":\"\", \"price\":100}'\n\t\t\t```\n\t\t\t* hash\n\t- \n\t\t* idkey\n\t\t* idfield\n\t\t* value\n\t\t``` redis\n\t\thset p01 c30 100 c50 100 c100 100\n\t\thincrby p01 c30 -10\n\t\t```\n\n### list\n\n* \n* \n\t- /  \n\t\t``` redis\n\t\tlpush key value1 value2.... (push)\n\t\trpush key value1 value2.... (push)\n\t\t```\n\t- \n\t\t``` redis\n\t\tlrange key start stop  (-1,-2)\n\t\tlindex key index\n\t\tllen key\n\t\t```\n\t- \n\t\t``` redis\n\t\tlpop key\n\t\trpop key\n\t\t```\n\t- (lpoprpop(bblocking))()\n\t\t``` redis\n\t\tblpop key1 key2 ... timeout\n\t\tbrpop key2 key2 ... timeout\n\t\t```\n\t- \n\t\t``` redis\n\t\tlrem key count value\n\t\t```\n\n* list\n\t- \n\t- listlist\n\t- list()\n\t\n### set\n\n* \n* hash(nil),\n* \n\t- \n\t\t``` redis\n\t\tsadd key member1 member2 ...\n\t\t```\n\t- \n\t\t``` redis\n\t\tsmembers key\n\t\t```\n\t- \n\t\t``` redis\n\t\tsrem key member1 member2 ....\n\t\t```\n\t- \n\t\t``` redis\n\t\tscard key\n\t\t```\n\t- \n\t\t``` redis\n\t\tsismember key member\n\t\t```\n\t- \n\t\t``` redis\n\t\tsrandmember  key count\n\t\t```\n\t- \n\t\t``` redis\n\t\tspop key\n\t\t```\n\t- \n\t\t``` redis\n\t\tsinter key1 key2 \n\t\t```\n\t- \n\t\t``` redis\n\t\tsunion key1 key2\n\t\t```\n\t- \n\t\t``` redis\n\t\tsdiff key1 key2\n\t\t```\n\n\t- \n\t\t``` redis\n\t\tsinterstore destination key1 key2\n\t\tsunionstore destination key1 key2\n\t\tsdiffstore destination key1 key2\n\t\t```\n\n\t- \n\t\t``` redis\n\t\tsmove source destination member\n\t\t```\n* \n\t- \n\t\t* set\n\t\t* \n\t\t* \n\n\t- \n\t\n\t\t* \n\t\t* \n\n\t- \n\t\t* setsethash\n\t\t* id\n\t\t* set\n\t\t* set\n\n\t\tsadd rid:001 getall getById\n\t\tsadd rid:002 getall getCount insert\n\t\tsunionstore uid:007 rid:001 rid:002\n\t\tsmembers uid:007\n\n\t- PV() UV()IP(IP)\n\t\t* PV: \n\t\t* UV: cookieIPUV\n\t\t* IP: IPIPIPIP\n\n\t\t* set\n\t\t* setcookie(UV)\n\t\t* setIP\n\n\t- \n\n* \n\t* set\n\t* sethashhash\n\n### sort_set\n\n* \n* set\n* \n\t- \n\t\t``` redis\n\t\tzadd key score1 member1 score2 member2\n\t\t```\n\t- \n\t\t``` redis\n\t\tzrange key start stop [withscores]      ()\n\t\tzrevrange key start stop [withscores]   ()\n\t\t```\n\t- \n\t\t``` redis\n\t\tzrem key member \n\t\t```\n\t- \n\t\t``` redis\n\t\tzrangebyscore key min max [withscores] [limit]\n\t\tzrevrangebyscore key max min [withscores]\n\t\t```\n\t- \n\t\t``` redis\n\t\tzremrangebyrank key start stop\n\t\tzremrangebyscore key min max\n\t\t```\n\t- \n\t\t``` redis\n\t\tzcard key\n\t\tzcount key min max\n\t\t```\n\t- \n\t\t``` redis\n\t\tzinterstore destination numkeys key1 key2 ...\n\t\tzunionstore destination numkeys key1 key2 ...\n\t\t```\n\t- ()\n\t\t``` redis\n\t\tzrank key member\n\t\tzrevrank key member\n\t\t```\n\t- score\n\t\t``` redis\n\t\tzscore key member\n\t\tzincrby key increment member\n\t\t```\n\n* \n\t- minmax\n\t- startstop\n\t- offsetcount\n\n* \n\t- \n\t\t* \n\t\t* TOP10\n\t\t* \n\t\t* \n\n\t- ,\n\t\t* score\n\t\t* redis\n\t\t* \n\t\t* sort_setsorted_set\n\t``` redis\n\tzadd tasks 20210613 task1 20130620 task2 20130626 task3\n\tzrange tasks 0 -1 withscores\n\tzremrangbyrank tasks 0 0\n\t```\n\n\t* score\n* \n\t* (string)\n\n## \n\n* key \n\n\t- keykeyredis\n\t- key\n\t\t* key\n\t\t\t* key \t\t`del keyi`\n\t\t\t* key \t`exists key`\n\t\t\t* key \t`type key`\n\t\t* key \n\t\t\t* \n\t\t\t\t``` redis\n\t\t\t\texpire key seconds\n\t\t\t\tpexpire key milliseconds\n\t\t\t\texpireat key timestamp\n\t\t\t\tpexpireat key milliseconds-timestamp\n\t\t\t\t```\n\t\t\t* key\n\t\t\t\t``` redis\n\t\t\t\tttl key\n\t\t\t\tpttl key\n\t\t\t\t```\n\t\t\t* key\n\t\t\t\t``` redis\n\t\t\t\tpersist key\n\t\t\t\t```\n\t\t* key \n\t\t\t* key `keys pattern`\n\t\t* key\n\t\t\t``` redis\n\t\t\trename key newkey\n\t\t\trenamenx key newkey\n\t\t\t```\n\t\t* key\n\t\t\t``` redis\n\t\t\tsort\n\t\t\t```\n\t\t* key\n\t\t\t``` redis\n\t\t\thelp @generic\n\t\t\t```\n* \n\n\t- redis16, 0-15\n\t- \n\n\t-   `select index`\n\t- \n\t\t* quit\n\t\t* ping\n\t\t* echo message\n\t-  \tmove key db\n\t- \n\t\t* dbsize\n\t\t* flushdb\n\t\t* flushall\n\n\n## \n\n* \n* \n\n* \n\t- RDB\n\t\tsave \t\n\t\tbgsave  \n\t\tRDB:  `save second changes`  key\n\t\tredisRDBbgsavesave\n\t\t\n\t\t* RDB\n\t\t\t* RDB\n\t\t\t* RDBredis\n\t\t\t* RDBAOF\n\t\t\t* RDB\n\t\t* RDB\n\t\t\t* RDB\n\t\t\t* bgsavefork\n\t\t\t* RedisRDB\n\t- AOF\n\t\t* AOF\n\t\t* \n\n\t\t* AOF\n\t\t\t* always \tAOF\n\t\t\t* everysec  AOF()\n\t\t\t* no \t\tAOF\n\n\t\t* AOF\n\t\t\t* appendonly yes \t\t\tAOF\n\t\t\t* appendfsync erverysec  \tAOF(everysec)\n\t\t\t* appendfilename filename \tAOF\n\t\t* AOF\n\t\t\t* AOF\n\n\t\t\t* \n\t\t\t\t* \n\t\t\t\t* IO\n\t\t\t\t* \n\n\t\t\t* \n\t\t\t\t*       bgrewriteaof\n\t\t\t\t*  \t\t\n\t\t\t\t\t* auto-aof-rewrite-min-size size  \n\t\t\t\t\t* auto-aof-rewrite-percentage percentage\n\n## \n\n* redis(), \n* \n\t*  \tmulti   ()\n\t*   exec \t( multi)\n\t*   discard (multiexec)\n\t* :  exec\n\t* : \n\t* : \n\t* : \n\n## \n\n* \n\t-  \twatch key1 [key2...]   (execwatchkey)\n\t-     unwatch\n\t``` redis\n\t# 1\n\tset name 123\n\twatch name\n\tmulti\n\tset aaa bb\n\tget aaa\n\texec\n\n\t# 2 (21execname)\n\tset name 234\n\t```\n\n* \n\t- \t\tsetnx lock-key value  (setnxkey)\n\t- \t\t\tdel lock-key\n\t-  expire lock-key second\n\t```\n\tset num 123\n\n\t# num\n\tsetnx lock-num 1\n\t# \n\texpire lock-num 20\n\n\tset num 234\n\t# \n\tdel lock-num\n\t```\n\n## \n\n* \n\t* RedisTTL\n\t\t* TTL: \n\t\t* TTL = -1 : \n\t\t* TTL = -2 :     \n* (CPU)\n\t* \n\t\t* key\n\t\t* : \n\t\t* : CPUredis\n\t* \n\t\t*  \n\t\t\t* \n\t\t\t* \n\t\t* : CPU\n\t\t* : ,\n\t* \n\t\t* redis\n\t\t* ( )\n* \n\t* redisredis, \n\n\t* \n\t\t* \t\t\tmaxmemory  ( 0, 50%)\n\t\t*  \tmaxmemory-samples\n\t\t*  \t\t\t\t\tmaxmemory-policy ()\n\t\t\t* ()\n\t\t\t\t* volatile-lru \t\t\n\t\t\t\t* volatile-lfu  \t\n\t\t\t\t* volatile-ttl \t\t\n\t\t\t\t* volatile-random \t\n\t\t\t* \n\t\t\t\t* allkeys-lru\t\t\n\t\t\t\t* allkeys-lfu\t\t\n\t\t\t\t* allkeys-random \t\n\t\t\t* \n\t\t\t\t* noeviction\n\n## \n\n* Bitmaps\n\t* keybit \tgetbit key offset\n\t* keybit    setbit key offset value\n\t* keydestKey\n\t\tbitop op desKey key1 [key2...]\n\t\t\t* and \t\n\t\t\t* or \t\n\t\t\t* not   \n\t\t\t* xor   \n\t* key1\n\t\tbitcount key [start end]\n* HyperLogLog\n\t* \n\t* : \n\t* HyperLogLog\n\n\t* \n\t\t*  \tpfadd key element [element...]\n\t\t*   pfcount key [key...]\n\t\t*   pfmerge destkey sourcekey [sourcekey...]\n\t\t\t\n* GEO\n\t* \n\t\tgeoadd key longitude latitude member [longitude latitude member ...]\n\t* \n\t\tgeopos key member [member...]\n\t* \n\t\tgeodist key member1 member2 [unit]\n\t* \n\t\tgeoradius key longitude latitude radius \n\t* \n\t\tgeoradiusbymember key member radius\n\t* hash\n\t\tgeohash key member\n","source":"_posts/go/redis_basic.md","raw":"---\ntitle: Redis \ncategories: \n- GolangStudy\n---\n\n## Redis\n\n* Redis(Remote Dictionary Server)C(key-value)\n* NoSQL: Not-Only SQL()\n* \n\t- \n\t- \n\t- \n\t- \n\t\t*  string\n\t\t*  list\n\t\t*  hash\n\t\t*  set\n\t\t*  sorted_set\n\t- \n* \n\t* \n\t* , \n\t* , \n\t* ,\n\t* \n\t* \n\t* \n\n##  \n\n* \n\n``` redis\nredis-server \nredis-server --port 6380\nredis-server conf/redis-6379.conf\n```\n\n* \n\n``` redis\nredis-cli \nredis-cli -p 6380\nredis-cli -h 127.0.0.1 -p 6380\n```\n\n\n\n## Redis\n\n* RedisMapkey:value,keystringvalue\n\n### string\n\n* \n* \n* \n\t- /\n\t\t``` redis \n\t\t# /\n\t\tset key val\n\t\t# /\n\t\tmset key1 val1 key2 val2\n\t\t```\n\t-   \n\t\t``` redis\n\t\t# \n\t\tget key\n\t\t# \n\t\tmget key1 key2\n\t\t``` \n\t- \n\t\t``` redis\n\t\tdel key\n\t\t```\n\t-   \n\t\t``` redis\n\t\tstrlen key\n\t\t```\n\t-   \n\t\t``` redis\n\t\tappend key value\n\t\t```\n* \n\t- redisid\n\t\t``` redis\n\t\tincr key\n\t\tdecr key\n\t\tincrby key increment\n\t\tdecrby key incrment\n\t\tincrbyfloat key increment \n\t\t```\n\n\t- , (4)\n\t\t``` redis\n\t\tsetex key seconds value\n\t\tpsetex key milliseconds value\n\n\t\t# :\n\t\tsetex 13879631902 60 1\n\t\t```\n\n* \n\t* ::: value\n\t    ``` redis\n\t    set user:id:00789:fans 1242526\n\t    set user:id:00789:blogs 789\n\t    ```\n\t* json\n\t\t``` redis\n\t\tuser:id:2506 '{\"name\"\":, \"fans\": 6143, \"focuns\"\":83}''\n\t\t```\n\n### hash\n\n* \n* : \n* \n\t- /  \n\t\t``` redis\n\t\t# /\n\t\thset key filed1 value1 filed2 value2  \n\t\t# /\n\t\thmset key1 filed1 value1 filed2 value2 key2 filed1 value1  \n\t\t```\n\t-    \n\t\t```  redis\n\t\t# key\n\t\thget key filed    \n\t\t# key\n\t\thgetall key\n\t\t# key\n\t\thmget key filed1 field2\n\t\t```\n\t-    \n\t\t``` redis\n\t\thdel key field\n\t\t```\n\t-   \n\t\t``` redis\n\t\thlen key\n\t\t```\n\t-   \n\t\t``` redis\n\t\thexists key field\n\t\t```\n\t- valueset  \n\t\t``` redis\n\t\thsetnx key fidld value\n\t\t```\n\n* \n\t*  \n\t\t``` redis\n\t\t# \n\t\thkeys key    \n\t\t# \n\t\thvals key\n\t\t```\n\t*  \n\t\t``` redis\n\t\thincrby key field increment  \n\t\thincrbyfloat key field incrment\n\t\t```\n\n* \n\t* hashvalue\n\t* hash\n\t* hgetallfield\n\n* \n\t- \n\t\t* idkeyhash\n\t\t* fieldvalue\n\t\t* : fileldvalue\n\t\t* : hash\n\t\t* : /, value\n\t\t* : field\n\t\t* : key\n\n\t\t``` redis\n\t\thset user:id:001 g01 300 g02 500\n\t\thset user:id:001 g03 30\n\t\thincrby user:id:001 g03 2\n\t\thlen user:id:001\n\t\thdel user:id:001 g02\n\t\t```\n\n\t- \n\t\t* filed\n\t\t\t* eg: id:nums \n\t\t\t\tid:info \n\t\t\t``` redis\n\t\t\thset 001 g01:nums 100 g01:info '{\"name\":\"\", \"price\":100}'\n\t\t\t```\n\t\t\t* hash\n\t- \n\t\t* idkey\n\t\t* idfield\n\t\t* value\n\t\t``` redis\n\t\thset p01 c30 100 c50 100 c100 100\n\t\thincrby p01 c30 -10\n\t\t```\n\n### list\n\n* \n* \n\t- /  \n\t\t``` redis\n\t\tlpush key value1 value2.... (push)\n\t\trpush key value1 value2.... (push)\n\t\t```\n\t- \n\t\t``` redis\n\t\tlrange key start stop  (-1,-2)\n\t\tlindex key index\n\t\tllen key\n\t\t```\n\t- \n\t\t``` redis\n\t\tlpop key\n\t\trpop key\n\t\t```\n\t- (lpoprpop(bblocking))()\n\t\t``` redis\n\t\tblpop key1 key2 ... timeout\n\t\tbrpop key2 key2 ... timeout\n\t\t```\n\t- \n\t\t``` redis\n\t\tlrem key count value\n\t\t```\n\n* list\n\t- \n\t- listlist\n\t- list()\n\t\n### set\n\n* \n* hash(nil),\n* \n\t- \n\t\t``` redis\n\t\tsadd key member1 member2 ...\n\t\t```\n\t- \n\t\t``` redis\n\t\tsmembers key\n\t\t```\n\t- \n\t\t``` redis\n\t\tsrem key member1 member2 ....\n\t\t```\n\t- \n\t\t``` redis\n\t\tscard key\n\t\t```\n\t- \n\t\t``` redis\n\t\tsismember key member\n\t\t```\n\t- \n\t\t``` redis\n\t\tsrandmember  key count\n\t\t```\n\t- \n\t\t``` redis\n\t\tspop key\n\t\t```\n\t- \n\t\t``` redis\n\t\tsinter key1 key2 \n\t\t```\n\t- \n\t\t``` redis\n\t\tsunion key1 key2\n\t\t```\n\t- \n\t\t``` redis\n\t\tsdiff key1 key2\n\t\t```\n\n\t- \n\t\t``` redis\n\t\tsinterstore destination key1 key2\n\t\tsunionstore destination key1 key2\n\t\tsdiffstore destination key1 key2\n\t\t```\n\n\t- \n\t\t``` redis\n\t\tsmove source destination member\n\t\t```\n* \n\t- \n\t\t* set\n\t\t* \n\t\t* \n\n\t- \n\t\n\t\t* \n\t\t* \n\n\t- \n\t\t* setsethash\n\t\t* id\n\t\t* set\n\t\t* set\n\n\t\tsadd rid:001 getall getById\n\t\tsadd rid:002 getall getCount insert\n\t\tsunionstore uid:007 rid:001 rid:002\n\t\tsmembers uid:007\n\n\t- PV() UV()IP(IP)\n\t\t* PV: \n\t\t* UV: cookieIPUV\n\t\t* IP: IPIPIPIP\n\n\t\t* set\n\t\t* setcookie(UV)\n\t\t* setIP\n\n\t- \n\n* \n\t* set\n\t* sethashhash\n\n### sort_set\n\n* \n* set\n* \n\t- \n\t\t``` redis\n\t\tzadd key score1 member1 score2 member2\n\t\t```\n\t- \n\t\t``` redis\n\t\tzrange key start stop [withscores]      ()\n\t\tzrevrange key start stop [withscores]   ()\n\t\t```\n\t- \n\t\t``` redis\n\t\tzrem key member \n\t\t```\n\t- \n\t\t``` redis\n\t\tzrangebyscore key min max [withscores] [limit]\n\t\tzrevrangebyscore key max min [withscores]\n\t\t```\n\t- \n\t\t``` redis\n\t\tzremrangebyrank key start stop\n\t\tzremrangebyscore key min max\n\t\t```\n\t- \n\t\t``` redis\n\t\tzcard key\n\t\tzcount key min max\n\t\t```\n\t- \n\t\t``` redis\n\t\tzinterstore destination numkeys key1 key2 ...\n\t\tzunionstore destination numkeys key1 key2 ...\n\t\t```\n\t- ()\n\t\t``` redis\n\t\tzrank key member\n\t\tzrevrank key member\n\t\t```\n\t- score\n\t\t``` redis\n\t\tzscore key member\n\t\tzincrby key increment member\n\t\t```\n\n* \n\t- minmax\n\t- startstop\n\t- offsetcount\n\n* \n\t- \n\t\t* \n\t\t* TOP10\n\t\t* \n\t\t* \n\n\t- ,\n\t\t* score\n\t\t* redis\n\t\t* \n\t\t* sort_setsorted_set\n\t``` redis\n\tzadd tasks 20210613 task1 20130620 task2 20130626 task3\n\tzrange tasks 0 -1 withscores\n\tzremrangbyrank tasks 0 0\n\t```\n\n\t* score\n* \n\t* (string)\n\n## \n\n* key \n\n\t- keykeyredis\n\t- key\n\t\t* key\n\t\t\t* key \t\t`del keyi`\n\t\t\t* key \t`exists key`\n\t\t\t* key \t`type key`\n\t\t* key \n\t\t\t* \n\t\t\t\t``` redis\n\t\t\t\texpire key seconds\n\t\t\t\tpexpire key milliseconds\n\t\t\t\texpireat key timestamp\n\t\t\t\tpexpireat key milliseconds-timestamp\n\t\t\t\t```\n\t\t\t* key\n\t\t\t\t``` redis\n\t\t\t\tttl key\n\t\t\t\tpttl key\n\t\t\t\t```\n\t\t\t* key\n\t\t\t\t``` redis\n\t\t\t\tpersist key\n\t\t\t\t```\n\t\t* key \n\t\t\t* key `keys pattern`\n\t\t* key\n\t\t\t``` redis\n\t\t\trename key newkey\n\t\t\trenamenx key newkey\n\t\t\t```\n\t\t* key\n\t\t\t``` redis\n\t\t\tsort\n\t\t\t```\n\t\t* key\n\t\t\t``` redis\n\t\t\thelp @generic\n\t\t\t```\n* \n\n\t- redis16, 0-15\n\t- \n\n\t-   `select index`\n\t- \n\t\t* quit\n\t\t* ping\n\t\t* echo message\n\t-  \tmove key db\n\t- \n\t\t* dbsize\n\t\t* flushdb\n\t\t* flushall\n\n\n## \n\n* \n* \n\n* \n\t- RDB\n\t\tsave \t\n\t\tbgsave  \n\t\tRDB:  `save second changes`  key\n\t\tredisRDBbgsavesave\n\t\t\n\t\t* RDB\n\t\t\t* RDB\n\t\t\t* RDBredis\n\t\t\t* RDBAOF\n\t\t\t* RDB\n\t\t* RDB\n\t\t\t* RDB\n\t\t\t* bgsavefork\n\t\t\t* RedisRDB\n\t- AOF\n\t\t* AOF\n\t\t* \n\n\t\t* AOF\n\t\t\t* always \tAOF\n\t\t\t* everysec  AOF()\n\t\t\t* no \t\tAOF\n\n\t\t* AOF\n\t\t\t* appendonly yes \t\t\tAOF\n\t\t\t* appendfsync erverysec  \tAOF(everysec)\n\t\t\t* appendfilename filename \tAOF\n\t\t* AOF\n\t\t\t* AOF\n\n\t\t\t* \n\t\t\t\t* \n\t\t\t\t* IO\n\t\t\t\t* \n\n\t\t\t* \n\t\t\t\t*       bgrewriteaof\n\t\t\t\t*  \t\t\n\t\t\t\t\t* auto-aof-rewrite-min-size size  \n\t\t\t\t\t* auto-aof-rewrite-percentage percentage\n\n## \n\n* redis(), \n* \n\t*  \tmulti   ()\n\t*   exec \t( multi)\n\t*   discard (multiexec)\n\t* :  exec\n\t* : \n\t* : \n\t* : \n\n## \n\n* \n\t-  \twatch key1 [key2...]   (execwatchkey)\n\t-     unwatch\n\t``` redis\n\t# 1\n\tset name 123\n\twatch name\n\tmulti\n\tset aaa bb\n\tget aaa\n\texec\n\n\t# 2 (21execname)\n\tset name 234\n\t```\n\n* \n\t- \t\tsetnx lock-key value  (setnxkey)\n\t- \t\t\tdel lock-key\n\t-  expire lock-key second\n\t```\n\tset num 123\n\n\t# num\n\tsetnx lock-num 1\n\t# \n\texpire lock-num 20\n\n\tset num 234\n\t# \n\tdel lock-num\n\t```\n\n## \n\n* \n\t* RedisTTL\n\t\t* TTL: \n\t\t* TTL = -1 : \n\t\t* TTL = -2 :     \n* (CPU)\n\t* \n\t\t* key\n\t\t* : \n\t\t* : CPUredis\n\t* \n\t\t*  \n\t\t\t* \n\t\t\t* \n\t\t* : CPU\n\t\t* : ,\n\t* \n\t\t* redis\n\t\t* ( )\n* \n\t* redisredis, \n\n\t* \n\t\t* \t\t\tmaxmemory  ( 0, 50%)\n\t\t*  \tmaxmemory-samples\n\t\t*  \t\t\t\t\tmaxmemory-policy ()\n\t\t\t* ()\n\t\t\t\t* volatile-lru \t\t\n\t\t\t\t* volatile-lfu  \t\n\t\t\t\t* volatile-ttl \t\t\n\t\t\t\t* volatile-random \t\n\t\t\t* \n\t\t\t\t* allkeys-lru\t\t\n\t\t\t\t* allkeys-lfu\t\t\n\t\t\t\t* allkeys-random \t\n\t\t\t* \n\t\t\t\t* noeviction\n\n## \n\n* Bitmaps\n\t* keybit \tgetbit key offset\n\t* keybit    setbit key offset value\n\t* keydestKey\n\t\tbitop op desKey key1 [key2...]\n\t\t\t* and \t\n\t\t\t* or \t\n\t\t\t* not   \n\t\t\t* xor   \n\t* key1\n\t\tbitcount key [start end]\n* HyperLogLog\n\t* \n\t* : \n\t* HyperLogLog\n\n\t* \n\t\t*  \tpfadd key element [element...]\n\t\t*   pfcount key [key...]\n\t\t*   pfmerge destkey sourcekey [sourcekey...]\n\t\t\t\n* GEO\n\t* \n\t\tgeoadd key longitude latitude member [longitude latitude member ...]\n\t* \n\t\tgeopos key member [member...]\n\t* \n\t\tgeodist key member1 member2 [unit]\n\t* \n\t\tgeoradius key longitude latitude radius \n\t* \n\t\tgeoradiusbymember key member radius\n\t* hash\n\t\tgeohash key member\n","slug":"go/redis_basic","published":1,"date":"2022-05-31T09:51:28.595Z","updated":"2022-05-31T09:51:28.595Z","_id":"cl3tkt6eb000ef8wzd0qodmyo","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>Redis(Remote Dictionary Server)C(key-value)</li>\n<li>NoSQL: Not-Only SQL()</li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li><ul>\n<li> string</li>\n<li> list</li>\n<li> hash</li>\n<li> set</li>\n<li> sorted_set</li>\n</ul>\n</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li>, </li>\n<li>, </li>\n<li>,</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-server </span><br><span class=\"line\">redis-server --port 6380</span><br><span class=\"line\">redis-server conf/redis-6379.conf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli </span><br><span class=\"line\">redis-cli -p 6380</span><br><span class=\"line\">redis-cli -h 127.0.0.1 -p 6380</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>RedisMapkey:value,keystringvalue</li>\n</ul>\n<h3 id=\"string\"><a href=\"#string\" class=\"headerlink\" title=\"string\"></a>string</h3><ul>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>/  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># /</span><br><span class=\"line\">set key val</span><br><span class=\"line\"># /</span><br><span class=\"line\">mset key1 val1 key2 val2</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">get key</span><br><span class=\"line\"># </span><br><span class=\"line\">mget key1 key2</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">del key</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strlen key</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">append key value</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>redisid</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">incr key</span><br><span class=\"line\">decr key</span><br><span class=\"line\">incrby key increment</span><br><span class=\"line\">decrby key incrment</span><br><span class=\"line\">incrbyfloat key increment </span><br></pre></td></tr></table></figure></li>\n<li><p>, (4)</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setex key seconds value</span><br><span class=\"line\">psetex key milliseconds value</span><br><span class=\"line\"></span><br><span class=\"line\"># :</span><br><span class=\"line\">setex 13879631902 60 1</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>::: value  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set user:id:00789:fans 1242526</span><br><span class=\"line\">set user:id:00789:blogs 789</span><br></pre></td></tr></table></figure></li>\n<li>json  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user:id:2506 &#x27;&#123;&quot;name&quot;&quot;:, &quot;fans&quot;: 6143, &quot;focuns&quot;&quot;:83&#125;&#x27;&#x27;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"hash\"><a href=\"#hash\" class=\"headerlink\" title=\"hash\"></a>hash</h3><ul>\n<li><p></p>\n</li>\n<li><p>: </p>\n</li>\n<li><p></p>\n<ul>\n<li>/    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># /</span><br><span class=\"line\">hset key filed1 value1 filed2 value2  </span><br><span class=\"line\"># /</span><br><span class=\"line\">hmset key1 filed1 value1 filed2 value2 key2 filed1 value1  </span><br></pre></td></tr></table></figure></li>\n<li>     <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># key</span><br><span class=\"line\">hget key filed    </span><br><span class=\"line\"># key</span><br><span class=\"line\">hgetall key</span><br><span class=\"line\"># key</span><br><span class=\"line\">hmget key filed1 field2</span><br></pre></td></tr></table></figure></li>\n<li>     <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdel key field</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hlen key</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexists key field</span><br></pre></td></tr></table></figure></li>\n<li>valueset    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hsetnx key fidld value</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">hkeys key    </span><br><span class=\"line\"># </span><br><span class=\"line\">hvals key</span><br></pre></td></tr></table></figure></li>\n<li>   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hincrby key field increment  </span><br><span class=\"line\">hincrbyfloat key field incrment</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>hashvalue</li>\n<li>hash</li>\n<li>hgetallfield</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<ul>\n<li>idkeyhash</li>\n<li>fieldvalue</li>\n<li>: fileldvalue</li>\n<li>: hash</li>\n<li>: /, value</li>\n<li>: field</li>\n<li>: key</li>\n</ul>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hset user:id:001 g01 300 g02 500</span><br><span class=\"line\">hset user:id:001 g03 30</span><br><span class=\"line\">hincrby user:id:001 g03 2</span><br><span class=\"line\">hlen user:id:001</span><br><span class=\"line\">hdel user:id:001 g02</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<ul>\n<li>filed<ul>\n<li>eg: id:nums <br>  id:info <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hset 001 g01:nums 100 g01:info &#x27;&#123;&quot;name&quot;:&quot;&quot;, &quot;price&quot;:100&#125;&#x27;</span><br></pre></td></tr></table></figure></li>\n<li>hash</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>idkey</li>\n<li>idfield</li>\n<li>value<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hset p01 c30 100 c50 100 c100 100</span><br><span class=\"line\">hincrby p01 c30 -10</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"list\"><a href=\"#list\" class=\"headerlink\" title=\"list\"></a>list</h3><ul>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>/    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lpush key value1 value2.... (push)</span><br><span class=\"line\">rpush key value1 value2.... (push)</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lrange key start stop  (-1,-2)</span><br><span class=\"line\">lindex key index</span><br><span class=\"line\">llen key</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lpop key</span><br><span class=\"line\">rpop key</span><br></pre></td></tr></table></figure></li>\n<li>(lpoprpop(bblocking))()  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blpop key1 key2 ... timeout</span><br><span class=\"line\">brpop key2 key2 ... timeout</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lrem key count value</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>list</p>\n<ul>\n<li></li>\n<li>listlist</li>\n<li>list()</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"set\"><a href=\"#set\" class=\"headerlink\" title=\"set\"></a>set</h3><ul>\n<li><p></p>\n</li>\n<li><p>hash(nil),</p>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sadd key member1 member2 ...</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">smembers key</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">srem key member1 member2 ....</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scard key</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sismember key member</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">srandmember  key count</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spop key</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sinter key1 key2 </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sunion key1 key2</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sdiff key1 key2</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sinterstore destination key1 key2</span><br><span class=\"line\">sunionstore destination key1 key2</span><br><span class=\"line\">sdiffstore destination key1 key2</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">smove source destination member</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<ul>\n<li>set</li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>setsethash</li>\n<li>id</li>\n<li>set</li>\n<li>set</li>\n</ul>\n<p>  sadd rid:001 getall getById<br>  sadd rid:002 getall getCount insert<br>  sunionstore uid:007 rid:001 rid:002<br>  smembers uid:007</p>\n</li>\n<li><p>PV() UV()IP(IP)</p>\n<ul>\n<li><p>PV: </p>\n</li>\n<li><p>UV: cookieIPUV</p>\n</li>\n<li><p>IP: IPIPIPIP</p>\n</li>\n<li><p>set</p>\n</li>\n<li><p>setcookie(UV)</p>\n</li>\n<li><p>setIP</p>\n</li>\n</ul>\n</li>\n<li><p></p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>set</li>\n<li>sethashhash</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"sort-set\"><a href=\"#sort-set\" class=\"headerlink\" title=\"sort_set\"></a>sort_set</h3><ul>\n<li><p></p>\n</li>\n<li><p>set</p>\n</li>\n<li><p></p>\n<ul>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zadd key score1 member1 score2 member2</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrange key start stop [withscores]      ()</span><br><span class=\"line\">zrevrange key start stop [withscores]   ()</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrem key member </span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrangebyscore key min max [withscores] [limit]</span><br><span class=\"line\">zrevrangebyscore key max min [withscores]</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zremrangebyrank key start stop</span><br><span class=\"line\">zremrangebyscore key min max</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zcard key</span><br><span class=\"line\">zcount key min max</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zinterstore destination numkeys key1 key2 ...</span><br><span class=\"line\">zunionstore destination numkeys key1 key2 ...</span><br></pre></td></tr></table></figure></li>\n<li>()  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrank key member</span><br><span class=\"line\">zrevrank key member</span><br></pre></td></tr></table></figure></li>\n<li>score  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zscore key member</span><br><span class=\"line\">zincrby key increment member</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>minmax</li>\n<li>startstop</li>\n<li>offsetcount</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<ul>\n<li></li>\n<li>TOP10</li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p>,</p>\n<ul>\n<li>score</li>\n<li>redis</li>\n<li></li>\n<li>sort_setsorted_set<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zadd tasks 20210613 task1 20130620 task2 20130626 task3</span><br><span class=\"line\">zrange tasks 0 -1 withscores</span><br><span class=\"line\">zremrangbyrank tasks 0 0</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>score</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>(string)</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>key </p>\n<ul>\n<li>keykeyredis</li>\n<li>key<ul>\n<li>key<ul>\n<li>key         <code>del keyi</code></li>\n<li>key     <code>exists key</code></li>\n<li>key     <code>type key</code></li>\n</ul>\n</li>\n<li>key <ul>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">expire key seconds</span><br><span class=\"line\">pexpire key milliseconds</span><br><span class=\"line\">expireat key timestamp</span><br><span class=\"line\">pexpireat key milliseconds-timestamp</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ttl key</span><br><span class=\"line\">pttl key</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">persist key</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>key <ul>\n<li>key <code>keys pattern</code></li>\n</ul>\n</li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rename key newkey</span><br><span class=\"line\">renamenx key newkey</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sort</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">help @generic</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>redis16, 0-15</p>\n</li>\n<li><p></p>\n</li>\n<li><p>  <code>select index</code></p>\n</li>\n<li><p></p>\n<ul>\n<li>quit</li>\n<li>ping</li>\n<li>echo message</li>\n</ul>\n</li>\n<li><p>     move key db</p>\n</li>\n<li><p></p>\n<ul>\n<li>dbsize</li>\n<li>flushdb</li>\n<li>flushall</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li><p>RDB<br>  save     <br>  bgsave  <br>  RDB:  <code>save second changes</code>  key<br>  redisRDBbgsavesave</p>\n<ul>\n<li>RDB<ul>\n<li>RDB</li>\n<li>RDBredis</li>\n<li>RDBAOF</li>\n<li>RDB</li>\n</ul>\n</li>\n<li>RDB<ul>\n<li>RDB</li>\n<li>bgsavefork</li>\n<li>RedisRDB</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>AOF</p>\n<ul>\n<li><p>AOF</p>\n</li>\n<li><p></p>\n</li>\n<li><p>AOF</p>\n<ul>\n<li>always     AOF</li>\n<li>everysec  AOF()</li>\n<li>no         AOF</li>\n</ul>\n</li>\n<li><p>AOF</p>\n<ul>\n<li>appendonly yes             AOF</li>\n<li>appendfsync erverysec      AOF(everysec)</li>\n<li>appendfilename filename     AOF</li>\n</ul>\n</li>\n<li><p>AOF</p>\n<ul>\n<li><p>AOF</p>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li>IO</li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>      bgrewriteaof</li>\n<li>         <ul>\n<li>auto-aof-rewrite-min-size size  </li>\n<li>auto-aof-rewrite-percentage percentage</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>redis(), </li>\n<li><ul>\n<li>     multi   ()</li>\n<li>  exec     ( multi)</li>\n<li>  discard (multiexec)</li>\n<li>:  exec</li>\n<li>: </li>\n<li>: </li>\n<li>: </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n<ul>\n<li>     watch key1 [key2]   (execwatchkey)</li>\n<li>    unwatch<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1</span><br><span class=\"line\">set name 123</span><br><span class=\"line\">watch name</span><br><span class=\"line\">multi</span><br><span class=\"line\">set aaa bb</span><br><span class=\"line\">get aaa</span><br><span class=\"line\">exec</span><br><span class=\"line\"></span><br><span class=\"line\"># 2 (21execname)</span><br><span class=\"line\">set name 234</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>        setnx lock-key value  (setnxkey)</li>\n<li>            del lock-key</li>\n<li> expire lock-key second<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set num 123</span><br><span class=\"line\"></span><br><span class=\"line\"># num</span><br><span class=\"line\">setnx lock-num 1</span><br><span class=\"line\"># </span><br><span class=\"line\">expire lock-num 20</span><br><span class=\"line\"></span><br><span class=\"line\">set num 234</span><br><span class=\"line\"># </span><br><span class=\"line\">del lock-num</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n<ul>\n<li>RedisTTL<ul>\n<li>TTL: </li>\n<li>TTL = -1 : </li>\n<li>TTL = -2 :     </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>(CPU)</p>\n<ul>\n<li><ul>\n<li>key</li>\n<li>: </li>\n<li>: CPUredis</li>\n</ul>\n</li>\n<li><ul>\n<li> <ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>: CPU</li>\n<li>: ,</li>\n</ul>\n</li>\n<li><ul>\n<li>redis</li>\n<li>( )</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>redisredis, </p>\n</li>\n<li><p></p>\n<ul>\n<li>            maxmemory  ( 0, 50%)</li>\n<li>     maxmemory-samples</li>\n<li>                     maxmemory-policy ()<ul>\n<li>()<ul>\n<li>volatile-lru         </li>\n<li>volatile-lfu      </li>\n<li>volatile-ttl         </li>\n<li>volatile-random     </li>\n</ul>\n</li>\n<li><ul>\n<li>allkeys-lru        </li>\n<li>allkeys-lfu        </li>\n<li>allkeys-random     </li>\n</ul>\n</li>\n<li><ul>\n<li>noeviction</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>Bitmaps</p>\n<ul>\n<li>keybit     getbit key offset</li>\n<li>keybit    setbit key offset value</li>\n<li>keydestKey<br>  bitop op desKey key1 [key2]<pre><code>  * and     \n  * or     \n  * not   \n  * xor   \n</code></pre>\n</li>\n<li>key1<br>  bitcount key [start end]</li>\n</ul>\n</li>\n<li><p>HyperLogLog</p>\n<ul>\n<li><p></p>\n</li>\n<li><p>: </p>\n</li>\n<li><p>HyperLogLog</p>\n</li>\n<li><p></p>\n<ul>\n<li>     pfadd key element [element]</li>\n<li>  pfcount key [key]</li>\n<li>  pfmerge destkey sourcekey [sourcekey]</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>GEO</p>\n<ul>\n<li><br>  geoadd key longitude latitude member [longitude latitude member ]</li>\n<li><br>  geopos key member [member]</li>\n<li><br>  geodist key member1 member2 [unit]</li>\n<li><br>  georadius key longitude latitude radius </li>\n<li><br>  georadiusbymember key member radius</li>\n<li>hash<br>  geohash key member</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>Redis(Remote Dictionary Server)C(key-value)</li>\n<li>NoSQL: Not-Only SQL()</li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li><ul>\n<li> string</li>\n<li> list</li>\n<li> hash</li>\n<li> set</li>\n<li> sorted_set</li>\n</ul>\n</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li>, </li>\n<li>, </li>\n<li>,</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-server </span><br><span class=\"line\">redis-server --port 6380</span><br><span class=\"line\">redis-server conf/redis-6379.conf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli </span><br><span class=\"line\">redis-cli -p 6380</span><br><span class=\"line\">redis-cli -h 127.0.0.1 -p 6380</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>RedisMapkey:value,keystringvalue</li>\n</ul>\n<h3 id=\"string\"><a href=\"#string\" class=\"headerlink\" title=\"string\"></a>string</h3><ul>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>/  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># /</span><br><span class=\"line\">set key val</span><br><span class=\"line\"># /</span><br><span class=\"line\">mset key1 val1 key2 val2</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">get key</span><br><span class=\"line\"># </span><br><span class=\"line\">mget key1 key2</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">del key</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">strlen key</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">append key value</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>redisid</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">incr key</span><br><span class=\"line\">decr key</span><br><span class=\"line\">incrby key increment</span><br><span class=\"line\">decrby key incrment</span><br><span class=\"line\">incrbyfloat key increment </span><br></pre></td></tr></table></figure></li>\n<li><p>, (4)</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setex key seconds value</span><br><span class=\"line\">psetex key milliseconds value</span><br><span class=\"line\"></span><br><span class=\"line\"># :</span><br><span class=\"line\">setex 13879631902 60 1</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>::: value  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set user:id:00789:fans 1242526</span><br><span class=\"line\">set user:id:00789:blogs 789</span><br></pre></td></tr></table></figure></li>\n<li>json  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user:id:2506 &#x27;&#123;&quot;name&quot;&quot;:, &quot;fans&quot;: 6143, &quot;focuns&quot;&quot;:83&#125;&#x27;&#x27;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"hash\"><a href=\"#hash\" class=\"headerlink\" title=\"hash\"></a>hash</h3><ul>\n<li><p></p>\n</li>\n<li><p>: </p>\n</li>\n<li><p></p>\n<ul>\n<li>/    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># /</span><br><span class=\"line\">hset key filed1 value1 filed2 value2  </span><br><span class=\"line\"># /</span><br><span class=\"line\">hmset key1 filed1 value1 filed2 value2 key2 filed1 value1  </span><br></pre></td></tr></table></figure></li>\n<li>     <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># key</span><br><span class=\"line\">hget key filed    </span><br><span class=\"line\"># key</span><br><span class=\"line\">hgetall key</span><br><span class=\"line\"># key</span><br><span class=\"line\">hmget key filed1 field2</span><br></pre></td></tr></table></figure></li>\n<li>     <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdel key field</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hlen key</span><br></pre></td></tr></table></figure></li>\n<li>    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexists key field</span><br></pre></td></tr></table></figure></li>\n<li>valueset    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hsetnx key fidld value</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">hkeys key    </span><br><span class=\"line\"># </span><br><span class=\"line\">hvals key</span><br></pre></td></tr></table></figure></li>\n<li>   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hincrby key field increment  </span><br><span class=\"line\">hincrbyfloat key field incrment</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>hashvalue</li>\n<li>hash</li>\n<li>hgetallfield</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<ul>\n<li>idkeyhash</li>\n<li>fieldvalue</li>\n<li>: fileldvalue</li>\n<li>: hash</li>\n<li>: /, value</li>\n<li>: field</li>\n<li>: key</li>\n</ul>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hset user:id:001 g01 300 g02 500</span><br><span class=\"line\">hset user:id:001 g03 30</span><br><span class=\"line\">hincrby user:id:001 g03 2</span><br><span class=\"line\">hlen user:id:001</span><br><span class=\"line\">hdel user:id:001 g02</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<ul>\n<li>filed<ul>\n<li>eg: id:nums <br>  id:info <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hset 001 g01:nums 100 g01:info &#x27;&#123;&quot;name&quot;:&quot;&quot;, &quot;price&quot;:100&#125;&#x27;</span><br></pre></td></tr></table></figure></li>\n<li>hash</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>idkey</li>\n<li>idfield</li>\n<li>value<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hset p01 c30 100 c50 100 c100 100</span><br><span class=\"line\">hincrby p01 c30 -10</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"list\"><a href=\"#list\" class=\"headerlink\" title=\"list\"></a>list</h3><ul>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>/    <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lpush key value1 value2.... (push)</span><br><span class=\"line\">rpush key value1 value2.... (push)</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lrange key start stop  (-1,-2)</span><br><span class=\"line\">lindex key index</span><br><span class=\"line\">llen key</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lpop key</span><br><span class=\"line\">rpop key</span><br></pre></td></tr></table></figure></li>\n<li>(lpoprpop(bblocking))()  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">blpop key1 key2 ... timeout</span><br><span class=\"line\">brpop key2 key2 ... timeout</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lrem key count value</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>list</p>\n<ul>\n<li></li>\n<li>listlist</li>\n<li>list()</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"set\"><a href=\"#set\" class=\"headerlink\" title=\"set\"></a>set</h3><ul>\n<li><p></p>\n</li>\n<li><p>hash(nil),</p>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sadd key member1 member2 ...</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">smembers key</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">srem key member1 member2 ....</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scard key</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sismember key member</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">srandmember  key count</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spop key</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sinter key1 key2 </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sunion key1 key2</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sdiff key1 key2</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sinterstore destination key1 key2</span><br><span class=\"line\">sunionstore destination key1 key2</span><br><span class=\"line\">sdiffstore destination key1 key2</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">smove source destination member</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<ul>\n<li>set</li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>setsethash</li>\n<li>id</li>\n<li>set</li>\n<li>set</li>\n</ul>\n<p>  sadd rid:001 getall getById<br>  sadd rid:002 getall getCount insert<br>  sunionstore uid:007 rid:001 rid:002<br>  smembers uid:007</p>\n</li>\n<li><p>PV() UV()IP(IP)</p>\n<ul>\n<li><p>PV: </p>\n</li>\n<li><p>UV: cookieIPUV</p>\n</li>\n<li><p>IP: IPIPIPIP</p>\n</li>\n<li><p>set</p>\n</li>\n<li><p>setcookie(UV)</p>\n</li>\n<li><p>setIP</p>\n</li>\n</ul>\n</li>\n<li><p></p>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>set</li>\n<li>sethashhash</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"sort-set\"><a href=\"#sort-set\" class=\"headerlink\" title=\"sort_set\"></a>sort_set</h3><ul>\n<li><p></p>\n</li>\n<li><p>set</p>\n</li>\n<li><p></p>\n<ul>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zadd key score1 member1 score2 member2</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrange key start stop [withscores]      ()</span><br><span class=\"line\">zrevrange key start stop [withscores]   ()</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrem key member </span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrangebyscore key min max [withscores] [limit]</span><br><span class=\"line\">zrevrangebyscore key max min [withscores]</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zremrangebyrank key start stop</span><br><span class=\"line\">zremrangebyscore key min max</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zcard key</span><br><span class=\"line\">zcount key min max</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zinterstore destination numkeys key1 key2 ...</span><br><span class=\"line\">zunionstore destination numkeys key1 key2 ...</span><br></pre></td></tr></table></figure></li>\n<li>()  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zrank key member</span><br><span class=\"line\">zrevrank key member</span><br></pre></td></tr></table></figure></li>\n<li>score  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zscore key member</span><br><span class=\"line\">zincrby key increment member</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>minmax</li>\n<li>startstop</li>\n<li>offsetcount</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n<ul>\n<li></li>\n<li>TOP10</li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p>,</p>\n<ul>\n<li>score</li>\n<li>redis</li>\n<li></li>\n<li>sort_setsorted_set<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zadd tasks 20210613 task1 20130620 task2 20130626 task3</span><br><span class=\"line\">zrange tasks 0 -1 withscores</span><br><span class=\"line\">zremrangbyrank tasks 0 0</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>score</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>(string)</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>key </p>\n<ul>\n<li>keykeyredis</li>\n<li>key<ul>\n<li>key<ul>\n<li>key         <code>del keyi</code></li>\n<li>key     <code>exists key</code></li>\n<li>key     <code>type key</code></li>\n</ul>\n</li>\n<li>key <ul>\n<li>  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">expire key seconds</span><br><span class=\"line\">pexpire key milliseconds</span><br><span class=\"line\">expireat key timestamp</span><br><span class=\"line\">pexpireat key milliseconds-timestamp</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ttl key</span><br><span class=\"line\">pttl key</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">persist key</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>key <ul>\n<li>key <code>keys pattern</code></li>\n</ul>\n</li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rename key newkey</span><br><span class=\"line\">renamenx key newkey</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sort</span><br></pre></td></tr></table></figure></li>\n<li>key  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">help @generic</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>redis16, 0-15</p>\n</li>\n<li><p></p>\n</li>\n<li><p>  <code>select index</code></p>\n</li>\n<li><p></p>\n<ul>\n<li>quit</li>\n<li>ping</li>\n<li>echo message</li>\n</ul>\n</li>\n<li><p>     move key db</p>\n</li>\n<li><p></p>\n<ul>\n<li>dbsize</li>\n<li>flushdb</li>\n<li>flushall</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li><p>RDB<br>  save     <br>  bgsave  <br>  RDB:  <code>save second changes</code>  key<br>  redisRDBbgsavesave</p>\n<ul>\n<li>RDB<ul>\n<li>RDB</li>\n<li>RDBredis</li>\n<li>RDBAOF</li>\n<li>RDB</li>\n</ul>\n</li>\n<li>RDB<ul>\n<li>RDB</li>\n<li>bgsavefork</li>\n<li>RedisRDB</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>AOF</p>\n<ul>\n<li><p>AOF</p>\n</li>\n<li><p></p>\n</li>\n<li><p>AOF</p>\n<ul>\n<li>always     AOF</li>\n<li>everysec  AOF()</li>\n<li>no         AOF</li>\n</ul>\n</li>\n<li><p>AOF</p>\n<ul>\n<li>appendonly yes             AOF</li>\n<li>appendfsync erverysec      AOF(everysec)</li>\n<li>appendfilename filename     AOF</li>\n</ul>\n</li>\n<li><p>AOF</p>\n<ul>\n<li><p>AOF</p>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li>IO</li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>      bgrewriteaof</li>\n<li>         <ul>\n<li>auto-aof-rewrite-min-size size  </li>\n<li>auto-aof-rewrite-percentage percentage</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>redis(), </li>\n<li><ul>\n<li>     multi   ()</li>\n<li>  exec     ( multi)</li>\n<li>  discard (multiexec)</li>\n<li>:  exec</li>\n<li>: </li>\n<li>: </li>\n<li>: </li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n<ul>\n<li>     watch key1 [key2]   (execwatchkey)</li>\n<li>    unwatch<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1</span><br><span class=\"line\">set name 123</span><br><span class=\"line\">watch name</span><br><span class=\"line\">multi</span><br><span class=\"line\">set aaa bb</span><br><span class=\"line\">get aaa</span><br><span class=\"line\">exec</span><br><span class=\"line\"></span><br><span class=\"line\"># 2 (21execname)</span><br><span class=\"line\">set name 234</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>        setnx lock-key value  (setnxkey)</li>\n<li>            del lock-key</li>\n<li> expire lock-key second<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set num 123</span><br><span class=\"line\"></span><br><span class=\"line\"># num</span><br><span class=\"line\">setnx lock-num 1</span><br><span class=\"line\"># </span><br><span class=\"line\">expire lock-num 20</span><br><span class=\"line\"></span><br><span class=\"line\">set num 234</span><br><span class=\"line\"># </span><br><span class=\"line\">del lock-num</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p></p>\n<ul>\n<li>RedisTTL<ul>\n<li>TTL: </li>\n<li>TTL = -1 : </li>\n<li>TTL = -2 :     </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>(CPU)</p>\n<ul>\n<li><ul>\n<li>key</li>\n<li>: </li>\n<li>: CPUredis</li>\n</ul>\n</li>\n<li><ul>\n<li> <ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>: CPU</li>\n<li>: ,</li>\n</ul>\n</li>\n<li><ul>\n<li>redis</li>\n<li>( )</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>redisredis, </p>\n</li>\n<li><p></p>\n<ul>\n<li>            maxmemory  ( 0, 50%)</li>\n<li>     maxmemory-samples</li>\n<li>                     maxmemory-policy ()<ul>\n<li>()<ul>\n<li>volatile-lru         </li>\n<li>volatile-lfu      </li>\n<li>volatile-ttl         </li>\n<li>volatile-random     </li>\n</ul>\n</li>\n<li><ul>\n<li>allkeys-lru        </li>\n<li>allkeys-lfu        </li>\n<li>allkeys-random     </li>\n</ul>\n</li>\n<li><ul>\n<li>noeviction</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><p>Bitmaps</p>\n<ul>\n<li>keybit     getbit key offset</li>\n<li>keybit    setbit key offset value</li>\n<li>keydestKey<br>  bitop op desKey key1 [key2]<pre><code>  * and     \n  * or     \n  * not   \n  * xor   \n</code></pre>\n</li>\n<li>key1<br>  bitcount key [start end]</li>\n</ul>\n</li>\n<li><p>HyperLogLog</p>\n<ul>\n<li><p></p>\n</li>\n<li><p>: </p>\n</li>\n<li><p>HyperLogLog</p>\n</li>\n<li><p></p>\n<ul>\n<li>     pfadd key element [element]</li>\n<li>  pfcount key [key]</li>\n<li>  pfmerge destkey sourcekey [sourcekey]</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>GEO</p>\n<ul>\n<li><br>  geoadd key longitude latitude member [longitude latitude member ]</li>\n<li><br>  geopos key member [member]</li>\n<li><br>  geodist key member1 member2 [unit]</li>\n<li><br>  georadius key longitude latitude radius </li>\n<li><br>  georadiusbymember key member radius</li>\n<li>hash<br>  geohash key member</li>\n</ul>\n</li>\n</ul>\n"},{"title":"","_content":"## RTP\n\n* RTP(Real-time Transport Protocol)\n\n## RTCP\n\n* RTCP(Real-time Transport Control Protocol)\n\n## RTSP\n\n* RTSP(Real Time Streaming Protocol)\n\n## RTMP\n\n* RTMP(Real Time Messaging Protocol)\n\n## HLS\n\n* HLS(HTTP Live Streaming)HTTP1\n\n## HTTP-FLV\n\n* HTTP-FLVRTMPHTTP\n\n","source":"_posts/av/live_protocol.md","raw":"---\ntitle:  \ncategories: \n- av\n---\n## RTP\n\n* RTP(Real-time Transport Protocol)\n\n## RTCP\n\n* RTCP(Real-time Transport Control Protocol)\n\n## RTSP\n\n* RTSP(Real Time Streaming Protocol)\n\n## RTMP\n\n* RTMP(Real Time Messaging Protocol)\n\n## HLS\n\n* HLS(HTTP Live Streaming)HTTP1\n\n## HTTP-FLV\n\n* HTTP-FLVRTMPHTTP\n\n","slug":"av/live_protocol","published":1,"date":"2022-05-31T09:53:07.354Z","updated":"2022-05-31T09:53:07.354Z","_id":"cl3tyb7uo0006gewz50wkclwx","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"RTP\"><a href=\"#RTP\" class=\"headerlink\" title=\"RTP\"></a>RTP</h2><ul>\n<li>RTP(Real-time Transport Protocol)</li>\n</ul>\n<h2 id=\"RTCP\"><a href=\"#RTCP\" class=\"headerlink\" title=\"RTCP\"></a>RTCP</h2><ul>\n<li>RTCP(Real-time Transport Control Protocol)</li>\n</ul>\n<h2 id=\"RTSP\"><a href=\"#RTSP\" class=\"headerlink\" title=\"RTSP\"></a>RTSP</h2><ul>\n<li>RTSP(Real Time Streaming Protocol)</li>\n</ul>\n<h2 id=\"RTMP\"><a href=\"#RTMP\" class=\"headerlink\" title=\"RTMP\"></a>RTMP</h2><ul>\n<li>RTMP(Real Time Messaging Protocol)</li>\n</ul>\n<h2 id=\"HLS\"><a href=\"#HLS\" class=\"headerlink\" title=\"HLS\"></a>HLS</h2><ul>\n<li>HLS(HTTP Live Streaming)HTTP1</li>\n</ul>\n<h2 id=\"HTTP-FLV\"><a href=\"#HTTP-FLV\" class=\"headerlink\" title=\"HTTP-FLV\"></a>HTTP-FLV</h2><ul>\n<li>HTTP-FLVRTMPHTTP</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"RTP\"><a href=\"#RTP\" class=\"headerlink\" title=\"RTP\"></a>RTP</h2><ul>\n<li>RTP(Real-time Transport Protocol)</li>\n</ul>\n<h2 id=\"RTCP\"><a href=\"#RTCP\" class=\"headerlink\" title=\"RTCP\"></a>RTCP</h2><ul>\n<li>RTCP(Real-time Transport Control Protocol)</li>\n</ul>\n<h2 id=\"RTSP\"><a href=\"#RTSP\" class=\"headerlink\" title=\"RTSP\"></a>RTSP</h2><ul>\n<li>RTSP(Real Time Streaming Protocol)</li>\n</ul>\n<h2 id=\"RTMP\"><a href=\"#RTMP\" class=\"headerlink\" title=\"RTMP\"></a>RTMP</h2><ul>\n<li>RTMP(Real Time Messaging Protocol)</li>\n</ul>\n<h2 id=\"HLS\"><a href=\"#HLS\" class=\"headerlink\" title=\"HLS\"></a>HLS</h2><ul>\n<li>HLS(HTTP Live Streaming)HTTP1</li>\n</ul>\n<h2 id=\"HTTP-FLV\"><a href=\"#HTTP-FLV\" class=\"headerlink\" title=\"HTTP-FLV\"></a>HTTP-FLV</h2><ul>\n<li>HTTP-FLVRTMPHTTP</li>\n</ul>\n"},{"title":"","_content":"## nginx-rtmp\n\n* nginx  nginx-rtmp-module\n\t```\n\thttps://nginx.org/en/download.html\n\thttps://github.com/arut/nginx-rtmp-module.git\n\t```\n\n* \n\t``` bash\n\ttar xvf nginx-1.20.2.tar.gz\n\tunzip nginx-rtmp-module-master.zip\n\t```\n\n* build\n\t``` bash\n\tcd nginx-1.20.2\n\tmkdir build\n\t```\n* config & make & make install\n\t``` bash\n\t./configure --prefix=/home/lijiahao/code/av/nginx-1.20.2/build --add-module=/home/lijiahao/code/av/nginx-rtmp-module-master\n\tmake\n\tmake install\n\t```\n\n* config\n\t``` bash\n\terror : ./configure: error: the HTTP rewrite module requires the PCRE library.\n\terror :./configure: error: SSL modules require the OpenSSL library.\n\terror :./configure: error: the HTTP gzip module requires the zlib library.\n\n\tsudo apt-get update\n\tsudo apt-get install libpcre3 libpcre3-dev\n\tsudo apt-get install openssl libssl-dev\n\tsudo apt-get install zlib1g-dev\n\t```\n\n* rtmp`/home/lijiahao/code/av/nginx-1.20.2/build/conf/nginx.conf`\n\t``` \n\trtmp {\n\t\tserver {\n\t\t\tlisten 1935;\n\t\t\tchunk_size 4096;\n\n\t\t\t# live on ()\n\t\t\tapplication rtmp_live {\n\t\t\t\tlive on;\n\t\t\t\t# hls on; #\n\t\t\t\t# wait_key on; #\n\t\t\t\t# hls_path ./sbin/html; #\n\t\t\t\t# hls_fragment 10s;     #\n\t\t\t\t# hls_playlist_length 60s;  #1\n\t\t\t\t# hls_continuous on; #\n\t\t\t\t# hls_cleanup on;    #\n\t\t\t\t# hls_nested on;     #\n\t\t\t}\n\n\t\t\t# play videos ()\n\t\t\tapplication rtmp_play{\n\t\t\t\tplay ./videos;  #build directory\n\t\t\t}\n\t\t}\n\t}\n\t```\n\n*  nginx\n\t``` bash\n\t~/code/av/nginx-1.20.2/build$ sudo ./sbin/nginx\n\t```\n\n* ffmpeg\n\t``` bash\n\tffmpeg -i demo.flv -vcodec libx264 -acodec aac -f flv rtmp://localhost:1935/rtmp_live/mystream\n\t```\n\n\n* VLC\n\t``` \n\trtmp://localhost:1935/rtmp_live/mystream\n\trtmp://localhost:1935/rtmp_play/demo.flv\n\t```\n\n## srs\n\n* build srs from srouce\n\t``` bash\n\tgit clone -b develop https://gitee.com/ossrs/srs.git \n\tcd srs/trunk \n\t./configure \n\tmake \n\t./objs/srs -c conf/srs.conf\n\t```\n\n* `conf/my_hls.conf`\n\t``` \n\tlisten              1935;\n\tmax_connections     1000;\n\tdaemon              on;\n\tsrs_log_tank        file;\n\tsrs_log_level        error;\n\tsrs_log_file        ./objs/srs.log;\n\n\thttp_server {\n\t\tenabled         on;\n\t\tlisten          8081;\n\t\tdir             ./objs/nginx/html;\n\t}\n\n\tvhost __defaultVhost__ {\n\t\thls {\n\t\t\tenabled         on;\n\t\t\thls_fragment    10;\n\t\t\thls_window      60;\n\t\t\thls_path        ./objs/nginx/html;\n\t\t\thls_m3u8_file   [app]/[stream].m3u8;\n\t\t\thls_ts_file     [app]/[stream]-[seq].ts;\n\t\t\thls_cleanup     on;\n\t\t\thls_dispose     30;\n\t\t\thls_on_error    continue;\n\t\t\thls_storage     disk;\n\t\t\thls_wait_keyframe       on;\n\t\t\thls_acodec      aac;\n\t\t\thls_vcodec      h264;\n\t\t}\n\t}\n\t```\n\n* srs\n\t``` bash\n\t./objs/srs -c conf/my_hls.conf\n\t```\n\n* ffmpeg\n\t``` bash\n\tffmpeg -re -i demo.flv -c copy -f flv -y rtmp://localhost/live/livestream\n\t```\n\n*  m3u8  ts \n\t``` \n\t/home/lijiahao/code/av/srs/trunk/objs/nginx/html/live\n\t```\n\n* VLCrtmphttp\n\t```\n\trtmp://localhost:1935/live/livestream\n\thttp://localhost:8081/live/livestream.m3u8\n\t```\n\n## live555\n\n* live555\n\t``` \n\thttp://www.live555.com/liveMedia/public/\n\t```\n\n\n* \n\t``` bash\n\ttar vxf live.2021.08.24.tar.gz\n\tcd live\n\t```\n\n* \n\t``` bash\n\t./genMakefiles linux-64bit\n\tmake\n\t```\n\n* live555\n\t``` bash\n\tcd mediaServer\n\tsudo ./live555MediaServer\n\t```\n\n\n* \n\t``` \n\ttest.mkv live/mediaServer\n\t```\n\n* \n\t``` \n\t live555  url \n\tvlcrtsp://192.168.80.128/<filename>\n\t```\n\n","source":"_posts/av/live_server.md","raw":"---\ntitle:  \ncategories: \n- av\n---\n## nginx-rtmp\n\n* nginx  nginx-rtmp-module\n\t```\n\thttps://nginx.org/en/download.html\n\thttps://github.com/arut/nginx-rtmp-module.git\n\t```\n\n* \n\t``` bash\n\ttar xvf nginx-1.20.2.tar.gz\n\tunzip nginx-rtmp-module-master.zip\n\t```\n\n* build\n\t``` bash\n\tcd nginx-1.20.2\n\tmkdir build\n\t```\n* config & make & make install\n\t``` bash\n\t./configure --prefix=/home/lijiahao/code/av/nginx-1.20.2/build --add-module=/home/lijiahao/code/av/nginx-rtmp-module-master\n\tmake\n\tmake install\n\t```\n\n* config\n\t``` bash\n\terror : ./configure: error: the HTTP rewrite module requires the PCRE library.\n\terror :./configure: error: SSL modules require the OpenSSL library.\n\terror :./configure: error: the HTTP gzip module requires the zlib library.\n\n\tsudo apt-get update\n\tsudo apt-get install libpcre3 libpcre3-dev\n\tsudo apt-get install openssl libssl-dev\n\tsudo apt-get install zlib1g-dev\n\t```\n\n* rtmp`/home/lijiahao/code/av/nginx-1.20.2/build/conf/nginx.conf`\n\t``` \n\trtmp {\n\t\tserver {\n\t\t\tlisten 1935;\n\t\t\tchunk_size 4096;\n\n\t\t\t# live on ()\n\t\t\tapplication rtmp_live {\n\t\t\t\tlive on;\n\t\t\t\t# hls on; #\n\t\t\t\t# wait_key on; #\n\t\t\t\t# hls_path ./sbin/html; #\n\t\t\t\t# hls_fragment 10s;     #\n\t\t\t\t# hls_playlist_length 60s;  #1\n\t\t\t\t# hls_continuous on; #\n\t\t\t\t# hls_cleanup on;    #\n\t\t\t\t# hls_nested on;     #\n\t\t\t}\n\n\t\t\t# play videos ()\n\t\t\tapplication rtmp_play{\n\t\t\t\tplay ./videos;  #build directory\n\t\t\t}\n\t\t}\n\t}\n\t```\n\n*  nginx\n\t``` bash\n\t~/code/av/nginx-1.20.2/build$ sudo ./sbin/nginx\n\t```\n\n* ffmpeg\n\t``` bash\n\tffmpeg -i demo.flv -vcodec libx264 -acodec aac -f flv rtmp://localhost:1935/rtmp_live/mystream\n\t```\n\n\n* VLC\n\t``` \n\trtmp://localhost:1935/rtmp_live/mystream\n\trtmp://localhost:1935/rtmp_play/demo.flv\n\t```\n\n## srs\n\n* build srs from srouce\n\t``` bash\n\tgit clone -b develop https://gitee.com/ossrs/srs.git \n\tcd srs/trunk \n\t./configure \n\tmake \n\t./objs/srs -c conf/srs.conf\n\t```\n\n* `conf/my_hls.conf`\n\t``` \n\tlisten              1935;\n\tmax_connections     1000;\n\tdaemon              on;\n\tsrs_log_tank        file;\n\tsrs_log_level        error;\n\tsrs_log_file        ./objs/srs.log;\n\n\thttp_server {\n\t\tenabled         on;\n\t\tlisten          8081;\n\t\tdir             ./objs/nginx/html;\n\t}\n\n\tvhost __defaultVhost__ {\n\t\thls {\n\t\t\tenabled         on;\n\t\t\thls_fragment    10;\n\t\t\thls_window      60;\n\t\t\thls_path        ./objs/nginx/html;\n\t\t\thls_m3u8_file   [app]/[stream].m3u8;\n\t\t\thls_ts_file     [app]/[stream]-[seq].ts;\n\t\t\thls_cleanup     on;\n\t\t\thls_dispose     30;\n\t\t\thls_on_error    continue;\n\t\t\thls_storage     disk;\n\t\t\thls_wait_keyframe       on;\n\t\t\thls_acodec      aac;\n\t\t\thls_vcodec      h264;\n\t\t}\n\t}\n\t```\n\n* srs\n\t``` bash\n\t./objs/srs -c conf/my_hls.conf\n\t```\n\n* ffmpeg\n\t``` bash\n\tffmpeg -re -i demo.flv -c copy -f flv -y rtmp://localhost/live/livestream\n\t```\n\n*  m3u8  ts \n\t``` \n\t/home/lijiahao/code/av/srs/trunk/objs/nginx/html/live\n\t```\n\n* VLCrtmphttp\n\t```\n\trtmp://localhost:1935/live/livestream\n\thttp://localhost:8081/live/livestream.m3u8\n\t```\n\n## live555\n\n* live555\n\t``` \n\thttp://www.live555.com/liveMedia/public/\n\t```\n\n\n* \n\t``` bash\n\ttar vxf live.2021.08.24.tar.gz\n\tcd live\n\t```\n\n* \n\t``` bash\n\t./genMakefiles linux-64bit\n\tmake\n\t```\n\n* live555\n\t``` bash\n\tcd mediaServer\n\tsudo ./live555MediaServer\n\t```\n\n\n* \n\t``` \n\ttest.mkv live/mediaServer\n\t```\n\n* \n\t``` \n\t live555  url \n\tvlcrtsp://192.168.80.128/<filename>\n\t```\n\n","slug":"av/live_server","published":1,"date":"2022-05-31T09:52:51.310Z","updated":"2022-05-31T09:52:51.310Z","_id":"cl3tyb7uq0007gewzdlzn2kow","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"nginx-rtmp\"><a href=\"#nginx-rtmp\" class=\"headerlink\" title=\"nginx-rtmp\"></a>nginx-rtmp</h2><ul>\n<li><p>nginx  nginx-rtmp-module</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://nginx.org/en/download.html</span><br><span class=\"line\">https://github.com/arut/nginx-rtmp-module.git</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xvf nginx-1.20.2.tar.gz</span><br><span class=\"line\">unzip nginx-rtmp-module-master.zip</span><br></pre></td></tr></table></figure></li>\n<li><p>build</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> nginx-1.20.2</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> build</span><br></pre></td></tr></table></figure></li>\n<li><p>config &amp; make &amp; make install</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --prefix=/home/lijiahao/code/av/nginx-1.20.2/build --add-module=/home/lijiahao/code/av/nginx-rtmp-module-master</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure></li>\n<li><p>config</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">error : ./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class=\"line\">error :./configure: error: SSL modules require the OpenSSL library.</span><br><span class=\"line\">error :./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install libpcre3 libpcre3-dev</span><br><span class=\"line\">sudo apt-get install openssl libssl-dev</span><br><span class=\"line\">sudo apt-get install zlib1g-dev</span><br></pre></td></tr></table></figure></li>\n<li><p>rtmp<code>/home/lijiahao/code/av/nginx-1.20.2/build/conf/nginx.conf</code></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtmp &#123;</span><br><span class=\"line\">\tserver &#123;</span><br><span class=\"line\">\t\tlisten 1935;</span><br><span class=\"line\">\t\tchunk_size 4096;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# live on ()</span><br><span class=\"line\">\t\tapplication rtmp_live &#123;</span><br><span class=\"line\">\t\t\tlive on;</span><br><span class=\"line\">\t\t\t# hls on; #</span><br><span class=\"line\">\t\t\t# wait_key on; #</span><br><span class=\"line\">\t\t\t# hls_path ./sbin/html; #</span><br><span class=\"line\">\t\t\t# hls_fragment 10s;     #</span><br><span class=\"line\">\t\t\t# hls_playlist_length 60s;  #1</span><br><span class=\"line\">\t\t\t# hls_continuous on; #</span><br><span class=\"line\">\t\t\t# hls_cleanup on;    #</span><br><span class=\"line\">\t\t\t# hls_nested on;     #</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# play videos ()</span><br><span class=\"line\">\t\tapplication rtmp_play&#123;</span><br><span class=\"line\">\t\t\tplay ./videos;  #build directory</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p> nginx</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/code/av/nginx-1.20.2/build$ sudo ./sbin/nginx</span><br></pre></td></tr></table></figure></li>\n<li><p>ffmpeg</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i demo.flv -vcodec libx264 -acodec aac -f flv rtmp://localhost:1935/rtmp_live/mystream</span><br></pre></td></tr></table></figure></li>\n</ul>\n<ul>\n<li>VLC  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtmp://localhost:1935/rtmp_live/mystream</span><br><span class=\"line\">rtmp://localhost:1935/rtmp_play/demo.flv</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"srs\"><a href=\"#srs\" class=\"headerlink\" title=\"srs\"></a>srs</h2><ul>\n<li><p>build srs from srouce</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -b develop https://gitee.com/ossrs/srs.git </span><br><span class=\"line\"><span class=\"built_in\">cd</span> srs/trunk </span><br><span class=\"line\">./configure </span><br><span class=\"line\">make </span><br><span class=\"line\">./objs/srs -c conf/srs.conf</span><br></pre></td></tr></table></figure></li>\n<li><p><code>conf/my_hls.conf</code></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listen              1935;</span><br><span class=\"line\">max_connections     1000;</span><br><span class=\"line\">daemon              on;</span><br><span class=\"line\">srs_log_tank        file;</span><br><span class=\"line\">srs_log_level        error;</span><br><span class=\"line\">srs_log_file        ./objs/srs.log;</span><br><span class=\"line\"></span><br><span class=\"line\">http_server &#123;</span><br><span class=\"line\">\tenabled         on;</span><br><span class=\"line\">\tlisten          8081;</span><br><span class=\"line\">\tdir             ./objs/nginx/html;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vhost __defaultVhost__ &#123;</span><br><span class=\"line\">\thls &#123;</span><br><span class=\"line\">\t\tenabled         on;</span><br><span class=\"line\">\t\thls_fragment    10;</span><br><span class=\"line\">\t\thls_window      60;</span><br><span class=\"line\">\t\thls_path        ./objs/nginx/html;</span><br><span class=\"line\">\t\thls_m3u8_file   [app]/[stream].m3u8;</span><br><span class=\"line\">\t\thls_ts_file     [app]/[stream]-[seq].ts;</span><br><span class=\"line\">\t\thls_cleanup     on;</span><br><span class=\"line\">\t\thls_dispose     30;</span><br><span class=\"line\">\t\thls_on_error    continue;</span><br><span class=\"line\">\t\thls_storage     disk;</span><br><span class=\"line\">\t\thls_wait_keyframe       on;</span><br><span class=\"line\">\t\thls_acodec      aac;</span><br><span class=\"line\">\t\thls_vcodec      h264;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>srs</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./objs/srs -c conf/my_hls.conf</span><br></pre></td></tr></table></figure></li>\n<li><p>ffmpeg</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i demo.flv -c copy -f flv -y rtmp://localhost/live/livestream</span><br></pre></td></tr></table></figure></li>\n<li><p> m3u8  ts </p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/home/lijiahao/code/av/srs/trunk/objs/nginx/html/live</span><br></pre></td></tr></table></figure></li>\n<li><p>VLCrtmphttp</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtmp://localhost:1935/live/livestream</span><br><span class=\"line\">http://localhost:8081/live/livestream.m3u8</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"live555\"><a href=\"#live555\" class=\"headerlink\" title=\"live555\"></a>live555</h2><ul>\n<li>live555  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://www.live555.com/liveMedia/public/</span><br></pre></td></tr></table></figure></li>\n</ul>\n<ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar vxf live.2021.08.24.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> live</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./genMakefiles linux-64bit</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure></li>\n<li><p>live555</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> mediaServer</span><br><span class=\"line\">sudo ./live555MediaServer</span><br></pre></td></tr></table></figure></li>\n</ul>\n<ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test.mkv live/mediaServer</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> live555  url </span><br><span class=\"line\">vlcrtsp://192.168.80.128/&lt;filename&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"nginx-rtmp\"><a href=\"#nginx-rtmp\" class=\"headerlink\" title=\"nginx-rtmp\"></a>nginx-rtmp</h2><ul>\n<li><p>nginx  nginx-rtmp-module</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://nginx.org/en/download.html</span><br><span class=\"line\">https://github.com/arut/nginx-rtmp-module.git</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar xvf nginx-1.20.2.tar.gz</span><br><span class=\"line\">unzip nginx-rtmp-module-master.zip</span><br></pre></td></tr></table></figure></li>\n<li><p>build</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> nginx-1.20.2</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> build</span><br></pre></td></tr></table></figure></li>\n<li><p>config &amp; make &amp; make install</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --prefix=/home/lijiahao/code/av/nginx-1.20.2/build --add-module=/home/lijiahao/code/av/nginx-rtmp-module-master</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure></li>\n<li><p>config</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">error : ./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class=\"line\">error :./configure: error: SSL modules require the OpenSSL library.</span><br><span class=\"line\">error :./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install libpcre3 libpcre3-dev</span><br><span class=\"line\">sudo apt-get install openssl libssl-dev</span><br><span class=\"line\">sudo apt-get install zlib1g-dev</span><br></pre></td></tr></table></figure></li>\n<li><p>rtmp<code>/home/lijiahao/code/av/nginx-1.20.2/build/conf/nginx.conf</code></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtmp &#123;</span><br><span class=\"line\">\tserver &#123;</span><br><span class=\"line\">\t\tlisten 1935;</span><br><span class=\"line\">\t\tchunk_size 4096;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# live on ()</span><br><span class=\"line\">\t\tapplication rtmp_live &#123;</span><br><span class=\"line\">\t\t\tlive on;</span><br><span class=\"line\">\t\t\t# hls on; #</span><br><span class=\"line\">\t\t\t# wait_key on; #</span><br><span class=\"line\">\t\t\t# hls_path ./sbin/html; #</span><br><span class=\"line\">\t\t\t# hls_fragment 10s;     #</span><br><span class=\"line\">\t\t\t# hls_playlist_length 60s;  #1</span><br><span class=\"line\">\t\t\t# hls_continuous on; #</span><br><span class=\"line\">\t\t\t# hls_cleanup on;    #</span><br><span class=\"line\">\t\t\t# hls_nested on;     #</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t# play videos ()</span><br><span class=\"line\">\t\tapplication rtmp_play&#123;</span><br><span class=\"line\">\t\t\tplay ./videos;  #build directory</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p> nginx</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~/code/av/nginx-1.20.2/build$ sudo ./sbin/nginx</span><br></pre></td></tr></table></figure></li>\n<li><p>ffmpeg</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -i demo.flv -vcodec libx264 -acodec aac -f flv rtmp://localhost:1935/rtmp_live/mystream</span><br></pre></td></tr></table></figure></li>\n</ul>\n<ul>\n<li>VLC  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtmp://localhost:1935/rtmp_live/mystream</span><br><span class=\"line\">rtmp://localhost:1935/rtmp_play/demo.flv</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"srs\"><a href=\"#srs\" class=\"headerlink\" title=\"srs\"></a>srs</h2><ul>\n<li><p>build srs from srouce</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -b develop https://gitee.com/ossrs/srs.git </span><br><span class=\"line\"><span class=\"built_in\">cd</span> srs/trunk </span><br><span class=\"line\">./configure </span><br><span class=\"line\">make </span><br><span class=\"line\">./objs/srs -c conf/srs.conf</span><br></pre></td></tr></table></figure></li>\n<li><p><code>conf/my_hls.conf</code></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listen              1935;</span><br><span class=\"line\">max_connections     1000;</span><br><span class=\"line\">daemon              on;</span><br><span class=\"line\">srs_log_tank        file;</span><br><span class=\"line\">srs_log_level        error;</span><br><span class=\"line\">srs_log_file        ./objs/srs.log;</span><br><span class=\"line\"></span><br><span class=\"line\">http_server &#123;</span><br><span class=\"line\">\tenabled         on;</span><br><span class=\"line\">\tlisten          8081;</span><br><span class=\"line\">\tdir             ./objs/nginx/html;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">vhost __defaultVhost__ &#123;</span><br><span class=\"line\">\thls &#123;</span><br><span class=\"line\">\t\tenabled         on;</span><br><span class=\"line\">\t\thls_fragment    10;</span><br><span class=\"line\">\t\thls_window      60;</span><br><span class=\"line\">\t\thls_path        ./objs/nginx/html;</span><br><span class=\"line\">\t\thls_m3u8_file   [app]/[stream].m3u8;</span><br><span class=\"line\">\t\thls_ts_file     [app]/[stream]-[seq].ts;</span><br><span class=\"line\">\t\thls_cleanup     on;</span><br><span class=\"line\">\t\thls_dispose     30;</span><br><span class=\"line\">\t\thls_on_error    continue;</span><br><span class=\"line\">\t\thls_storage     disk;</span><br><span class=\"line\">\t\thls_wait_keyframe       on;</span><br><span class=\"line\">\t\thls_acodec      aac;</span><br><span class=\"line\">\t\thls_vcodec      h264;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>srs</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./objs/srs -c conf/my_hls.conf</span><br></pre></td></tr></table></figure></li>\n<li><p>ffmpeg</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ffmpeg -re -i demo.flv -c copy -f flv -y rtmp://localhost/live/livestream</span><br></pre></td></tr></table></figure></li>\n<li><p> m3u8  ts </p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/home/lijiahao/code/av/srs/trunk/objs/nginx/html/live</span><br></pre></td></tr></table></figure></li>\n<li><p>VLCrtmphttp</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rtmp://localhost:1935/live/livestream</span><br><span class=\"line\">http://localhost:8081/live/livestream.m3u8</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"live555\"><a href=\"#live555\" class=\"headerlink\" title=\"live555\"></a>live555</h2><ul>\n<li>live555  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://www.live555.com/liveMedia/public/</span><br></pre></td></tr></table></figure></li>\n</ul>\n<ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar vxf live.2021.08.24.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> live</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./genMakefiles linux-64bit</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure></li>\n<li><p>live555</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> mediaServer</span><br><span class=\"line\">sudo ./live555MediaServer</span><br></pre></td></tr></table></figure></li>\n</ul>\n<ul>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test.mkv live/mediaServer</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> live555  url </span><br><span class=\"line\">vlcrtsp://192.168.80.128/&lt;filename&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"git","_content":"\n## git\n* ---> \n* --->  `git add`\n* --->  `git commit`\n* --->  `git push`\n\n## git\n### \n* \n``` bash\ngit config --global user.name \ngit config --global user.email  \n```\n* \n``` bash\ngit init\n```\n* \n``` bash\ngit status\n# \ngit status -sb -uno --show-stash\n```\n* \n``` bash\ngit add \n```\n* \n``` bash\ngit rm --cached \n```\n* \n``` bash\ngit commit -m \"\" \n```\n* ()\n``` bash\ngit stash\n```\n* \n``` bash\ngit checkout -f\n```\n* \n``` bash\n# \ngit reflog \n# \ngit log --oneline --graph\n```\n* \n``` bash\ngit reset --hard \n```\n* \n``` bash\ngit tag \n```\n\n### \n* \n``` bash\n# \ngit branch -v\n# \ngit branch -f\n# \ngit branch -a\n```\n* \n``` bash\ngit branch \n```\n* \n``` bash\ngit branch -d \n```\n* \n``` bash\n# \ngit checkout \n\n# \ngit checkout -b \n```\n* \n``` bash\ngit merge   # \n```\n* \n``` bash\n# \n# \n# \ngit add \n#  : \ngit commit -m \"\"\n```\n\n### \n* \n``` bash\n# \ngit remote -v\n# \ngit remote add  \n# eg: \ngit remote add git-demo https://github.com/lijiahaohb/git-demo.git\n```\n\n* \n``` bash\ngit remote update origin\n# merge\ngit merge origin/develop \n```\n\n* \n``` bash\ngit push  : \n# eg:\ngit push git-demo master:master\n```\n\n* \n``` bash\ngit pull  :\n# eg: \ngit pull git-demo master:master\n```\n\n### git\n* master: \n* release: realsedeveloprelease\n* develop: developmaster\n* feature: developdevelop\n* hotfix: mastermasterreleaserelease\n\n### git\n1. git add\n2. git commit\n3. git pull\n4. \n5. git push\n\n\n","source":"_posts/tools/git_learning.md","raw":"---\ntitle: git \ncategories: \n- tools\n---\n\n## git\n* ---> \n* --->  `git add`\n* --->  `git commit`\n* --->  `git push`\n\n## git\n### \n* \n``` bash\ngit config --global user.name \ngit config --global user.email  \n```\n* \n``` bash\ngit init\n```\n* \n``` bash\ngit status\n# \ngit status -sb -uno --show-stash\n```\n* \n``` bash\ngit add \n```\n* \n``` bash\ngit rm --cached \n```\n* \n``` bash\ngit commit -m \"\" \n```\n* ()\n``` bash\ngit stash\n```\n* \n``` bash\ngit checkout -f\n```\n* \n``` bash\n# \ngit reflog \n# \ngit log --oneline --graph\n```\n* \n``` bash\ngit reset --hard \n```\n* \n``` bash\ngit tag \n```\n\n### \n* \n``` bash\n# \ngit branch -v\n# \ngit branch -f\n# \ngit branch -a\n```\n* \n``` bash\ngit branch \n```\n* \n``` bash\ngit branch -d \n```\n* \n``` bash\n# \ngit checkout \n\n# \ngit checkout -b \n```\n* \n``` bash\ngit merge   # \n```\n* \n``` bash\n# \n# \n# \ngit add \n#  : \ngit commit -m \"\"\n```\n\n### \n* \n``` bash\n# \ngit remote -v\n# \ngit remote add  \n# eg: \ngit remote add git-demo https://github.com/lijiahaohb/git-demo.git\n```\n\n* \n``` bash\ngit remote update origin\n# merge\ngit merge origin/develop \n```\n\n* \n``` bash\ngit push  : \n# eg:\ngit push git-demo master:master\n```\n\n* \n``` bash\ngit pull  :\n# eg: \ngit pull git-demo master:master\n```\n\n### git\n* master: \n* release: realsedeveloprelease\n* develop: developmaster\n* feature: developdevelop\n* hotfix: mastermasterreleaserelease\n\n### git\n1. git add\n2. git commit\n3. git pull\n4. \n5. git push\n\n\n","slug":"tools/git_learning","published":1,"date":"2022-07-10T14:47:09.927Z","updated":"2022-07-10T14:47:09.927Z","_id":"cl3tyev590009gewz054f6x2w","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h2><ul>\n<li>&gt; </li>\n<li>&gt;  <code>git add</code></li>\n<li>&gt;  <code>git commit</code></li>\n<li>&gt;  <code>git push</code></li>\n</ul>\n<h2 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name </span><br><span class=\"line\">git config --global user.email  </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git status -sb -uno --show-stash</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">rm</span> --cached </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m <span class=\"string\">&quot;&quot;</span> </span><br></pre></td></tr></table></figure></li>\n<li>()<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -f</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git reflog </span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git <span class=\"built_in\">log</span> --oneline --graph</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag </span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git branch -v</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git branch -f</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git branch -a</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git checkout </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git checkout -b </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge   <span class=\"comment\"># </span></span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git add </span><br><span class=\"line\"><span class=\"comment\">#  : </span></span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git remote -v</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git remote add  </span><br><span class=\"line\"><span class=\"comment\"># eg: </span></span><br><span class=\"line\">git remote add git-demo https://github.com/lijiahaohb/git-demo.git</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote update origin</span><br><span class=\"line\"><span class=\"comment\"># merge</span></span><br><span class=\"line\">git merge origin/develop </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push  : </span><br><span class=\"line\"><span class=\"comment\"># eg:</span></span><br><span class=\"line\">git push git-demo master:master</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull  :</span><br><span class=\"line\"><span class=\"comment\"># eg: </span></span><br><span class=\"line\">git pull git-demo master:master</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><ul>\n<li>master: </li>\n<li>release: realsedeveloprelease</li>\n<li>develop: developmaster</li>\n<li>feature: developdevelop</li>\n<li>hotfix: mastermasterreleaserelease</li>\n</ul>\n<h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><ol>\n<li>git add</li>\n<li>git commit</li>\n<li>git pull</li>\n<li></li>\n<li>git push</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h2><ul>\n<li>&gt; </li>\n<li>&gt;  <code>git add</code></li>\n<li>&gt;  <code>git commit</code></li>\n<li>&gt;  <code>git push</code></li>\n</ul>\n<h2 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name </span><br><span class=\"line\">git config --global user.email  </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git status -sb -uno --show-stash</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">rm</span> --cached </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m <span class=\"string\">&quot;&quot;</span> </span><br></pre></td></tr></table></figure></li>\n<li>()<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git stash</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -f</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git reflog </span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git <span class=\"built_in\">log</span> --oneline --graph</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git reset --hard </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag </span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git branch -v</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git branch -f</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git branch -a</span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git checkout </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git checkout -b </span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git merge   <span class=\"comment\"># </span></span><br></pre></td></tr></table></figure></li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git add </span><br><span class=\"line\"><span class=\"comment\">#  : </span></span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git remote -v</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git remote add  </span><br><span class=\"line\"><span class=\"comment\"># eg: </span></span><br><span class=\"line\">git remote add git-demo https://github.com/lijiahaohb/git-demo.git</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote update origin</span><br><span class=\"line\"><span class=\"comment\"># merge</span></span><br><span class=\"line\">git merge origin/develop </span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push  : </span><br><span class=\"line\"><span class=\"comment\"># eg:</span></span><br><span class=\"line\">git push git-demo master:master</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull  :</span><br><span class=\"line\"><span class=\"comment\"># eg: </span></span><br><span class=\"line\">git pull git-demo master:master</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><ul>\n<li>master: </li>\n<li>release: realsedeveloprelease</li>\n<li>develop: developmaster</li>\n<li>feature: developdevelop</li>\n<li>hotfix: mastermasterreleaserelease</li>\n</ul>\n<h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><ol>\n<li>git add</li>\n<li>git commit</li>\n<li>git pull</li>\n<li></li>\n<li>git push</li>\n</ol>\n"},{"title":"Linux ","_content":"\n## Linux\n\n### man\n* \n\t``` bash\n\tman ${command}\n\t```\n* \n\t``` bash\n\tman 5 ${filename}\n\t```\n\n### \n* useradd \n\t``` bash\n\tuseradd \n\t```\n\n* userdel \n\t``` bash\n\tuserdel \n\t```\n\n* passwd \n\t``` bash\n\t# \n\tpasswd\n\t# (root)\n\tpasswd \n\t```\n\n### chmod \n\n``` bash\n# \nchmod 750 filename\n\n# \nchmod -R 750 dirname\n```\n\n### chown \n\n``` bash\n# \nchown user:group filename\n\n# \nchown -R user:group dirname\n```\n\n## \n\n### tcpdump\n\n* <font color=red>note: tcpdump68</font>\n* \n\t- -i \n\t- -D \n\t- -C  -w \n\t- -s (0)\n\t- -w \n\t- -r \n\t- -v \n\t- -c \n\t- -A \n\t- -n (ip)\n\t- -nn \n\t- -t \n\n* \n\t- \n\t\t``` bash\n\t\t#  eth1 \n\t\ttcpdump -i eth1\n\n\t\t# \n\t\ttcpdump -i any\n\t\t```\n\n\t- \n\t\t``` bash\n\t\t#  IP \n\t\ttcpdump host 192.168.3.7\n\n\t\t#  IP \n\t\ttcpdump src 192.168.1.100\n\t\ttcpdump dst 192.168.1.100\n\t\t```\n\t\n\t- \n\t\t``` bash\n\t\ttcpdump -i eth1 net 192.168\n\t\ttcpdump -i eth1 src net 192.168\n\t\ttcpdump -i eth1 dst net 192.168\n\t\t```\n\t- \n\t\t``` bash\n\t\ttcpdump port 22\n\t\ttcpdump src port 22\n\t\ttcpdump dst port 22\n\t\t```\n\t- \n\t\t``` bash\n\t\ttcpdump portrange 22-125\n\t\t```\n\t- \n\t\t``` bash\n\t\ttcpdump -i eth1 arp\n\t\ttcpdump -i eth1 ip\n\t\ttcpdump -i eth1 tcp\n\t\ttcpdump -i eth1 udp\n\t\ttcpdump -i eth1 icmp\n\t\t```\n\n* \n\t``` bash\n\ttcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.cap\n\n\t\t- tcp:  ip icmp arp rarp  tcpudpicmp\n\t\t- -i eth1 : eth1\n\t\t- -t : \n\t\t- -s 0 : 68-S 0 \n\t\t- -c 100 : 100\n\t\t- dst port ! 22 : 22\n\t\t- src net 192.168.1.0/24 : 192.168.1.0/24\n\t\t- -w ./target.cap : capethereal(wireshark)\n\t```\n\n### netstat\n\n``` bash\nnetstat -anp | grep \n```\n\n### nc\n\n* \n\t- -l  nc\n\t- -p  \n\t- -s  IP\n\t- -u  ncUDPTCP\n\t- -v  \n\t- -w  \n\t- -z  zero\n* \n\t- \n\t\t``` bash\n\t    # tcp\n\t\tnc -l 127.0.0.1 8080\n\n\t\t# udp\n\t\tnc -l -u 1234\n\t\t```\n\t- \n\t\t``` bash\n\t\t# tcp\n\t\tnc 127.0.0.1 8080\n\n\t\t# udp\n\t\tnc -u 127.0.0.1 8080\n\n\t\t# ()\n\t\tnc -w 10 127.0.0.1 8080\n\t\t```\n\t- nc\n\t\t``` bash\n\t\t#  8080  192.168.1.200  80 \n\t\tncat -l 8080 | ncat 192.168.1.200 80\n\t\t```\n\t- nc\n\t\t``` bash\n\t\t# \n\t\tnc -l  8080 > file.txt\n\n\t\t# \n\t\tnc 192.168.1.100 8080 --send-only < data.txt\n\t\t```\n\t- \n\t\t``` bash\n\t\t#  -c  \n\t\t#  80  8080 \n\t\tnc -u -l 80 -c 'nc -u -l 8080'\n\t\t```\n\t\n\n### curl\n\n### telnet\n\n``` bash\n# \ntelnet 127.0.0.1 3389\n```\n\n## \n\n### ps\n\n``` bash\n# \nps aux | sort -k4nr | head -N\n\n# head: -N10\n# ps: \n\t- a \n\t- u id\n\t- x \n# sort:\n\t- k \n\t- 4 \n\t- n \n\t- r ()\n# ps aux \n\t- %MEM  4 -k4 \n\t- %CPU -k3 cpu\n```\n\n### perf\n\n``` bash\nsudo perf record -F 99 -p 13204 -g -- sleep 30\n\t\n\t* perf record \t\n\t* -F \t\t\t\n\t* -p \t\t\t\n\t* -g \t\t\t\n\t* --sleep \t\t30s\n```\n``` bash\nsudo perf report -n --stdio\n```\n\n\t\n## \n\n### wc\n\n* \n* -l \n\t``` grep\n\twc -l test.txt\n\t```\n* -c bytes\n* -w \n\n### \n\n#### \n* ^ ...\n\t``` bash\n\tgrep '^lijiahao' test.txt\n\tgrep '^li' test.txt\n\t```\n\n* $ ...\n\t``` bash\n\tgrep 'lijihao$' test.txt\n\tgrep 'm$' test.txt\n\t```\n\n* ^$ \n\t``` bash\n\tgrep -n '^$' test.txt\n\t```\n\n* . \n\t- note: . \n\t- \\. '.'\n\t``` bash\n\tgrep '\\.$' test.txt\n\t```\n\n* * 00\n\t``` bash\n\t# note: ii0\n\tgrep 'i*' test.txt\n\t```\n\n* .* \n\t- * : .*\n\t``` bash\n\tgrep '.*o' test.txt\n\t```\n\n* [] \n\t- [abc]  abc\n\t- [a-z]  a-z\n\t- [a-zA-Z0-9] \n\t- \n\t``` bash\n\tgrep 'li[abc]' test.txt\n\t```\n\n* [^] \n\t- [^abc] abc\n\n#### \n\n* <font color=red>note: egrepgrep-E</font>\n\n* \\+ 11\n\t``` bash\n\tegrep 'i+' test.txt\n\n\t# \n\tegrep '[0-9]+' test.txt\n\t```\n\n* | \n\t``` bash\n\tegrep 'li|lijiahao' test.txt\n\t```\n\n* () ()\n\t- sed\n\t``` bash\n\tegrep 'li(|jiahao)' test.txt\n\t```\n* {} \n\t- o{n,m} on-m\n\t- o{n} on\n\t``` bash\n\tegrep 'i{3,4}' test.txt\n\tegrep 'i{3}' test.txt\n\n\t#  1718X\n\tegrep '[0-9]{17}[0-9X]' id.txt\n\t```\n* ? 01\n\t``` bash\n\tegrep 'go?d' test.txt\n\t```\n\n### find\n* -name \n\t``` bash\n\tfind / -name filename\n\t```\n\n* -type \n\t``` bash\n\t# \n\tfind / -type d\n\t```\n\n\n### grep\n* grep\n* -n \n\t``` bash\n\tgrep -n 't[ae]st' test.txt\n\tgrep -n '^$' test.txt\n\t```\n* -rl\n\t``` bash\n\t# dirnameabc\n\tgrep -rl abc dirname\n\t```\n* -v \n\t``` bash\n\t# \n\tgrep -vn '^$' test.txt\n\n\t# \n\tegrep -v '^$|#' test.txt\n\t``` \n* -E \n\t``` bash\n\tgrep -E 'i+' test.txt\n\t```\n* -o \n\t``` bash\n\tgrep -o 'i{2,3}' test.txt\n\t```\n* c  wc -l\n\t```\n\tps -ef | grep -c sshd\n\t```\n* -i \n\t``` bash\n\t# \n\tgrep -i '[a-z]' test.txt\n\t```\n* -w \n\t``` bash\n\tnetstat -anp | grep -w ':80'\n\t```\n\n### sed\n* \n* :  sed  ' ' \n\t``` bash\n\t# test.txt \n\t# s    g \n\tsed -r 's#olgboy#oldgirl#g' test.txt\n\t```\n* ()\n\t- s \t\n\t\t``` bash\n\t\t# [0-9]  \n\t\tsed 's#[0-9]##g' test.txt\n\n\t\t#  g \n\t\tsed 's#[0-9]##' test.txt\n\n\t\t#  ()\n\t\t#  123456  <>\n\t\techo 123456 | sed -r 's#(.*)#<\\1>#'\n\n\t\t# \n\t\techo lijiahao_zhaozijin | sed -r 's#(^.*)_(.*)#\\2_\\1#' \n\n\t\t# ens32IP \n\t\tip a s ens32 | sed -n '4p' | sed -r 's#(^.*t )(.*)(/.*$)#\\2#g'\n\t\tip a s ens32 | sed -rn '3s#(^.*t )(.*)(/.*$)#\\2#gp'\n\t\t```\n\t- p \t\n\t\t``` bash\n\t\t# \n\t\tsed '1p' test.txt\n\n\t\t# \n\t\tsed '1,5p' test.txt\n\t\tsed '1,$p' test.txt\n\t\tsed '$p' test.txt\n\n\t\t# (//)\n\t\tsed '/lijiahao/p' test.txt\n\n\t\t# !  \n\t\tsed -nr '/^$|#/!p' /etc/ssh/sshd_config\n\n\t\t# \n\t\tsed '/10:00/,/11:00/p' test.txt\n\t\tsed -n '/li/,/lijiahao/p' test.txt\n\t\t```\n\t- d \t\n\t\t``` bash\n\t\t# \n\t\tsed '3d' test.txt\n\n\t\t# \n\t\tsed '2,3d' test.txt\n\n\t\t#  \n\t\tsed -r '/^$|#/d' /etc/ssh/sshd_config\n\t\t```\n\t- cai c/a/i\n\t\t``` bash\n\t\t# c \n\t\tsed '3c lijihaohaobang' test.txt\n\n\t\t# a \n\t\tsed '3a lijiahaohaohba' test.txt\n\t\tsed '$a lijiahao\\nzhaozijin\\nshengqiqi' test.txt\n\n\t\t# i \n\t\tsed '3i lijihaohaobang' test.txt\n\t\t```\n* \n\t- -n \n\t\t``` bash\n\t\t# ()\n\t\tsed '3p' test.txt\n\t\t# ()\n\t\tsed -n '3p' test.txt\n\t\t```\n\t- -r \n\t\t``` bash\n\t\tsed -nr '/[0-9]{3}/p' test.txt\n\t\t```\n\t- -i (-i)\n\n### awk\n* \n* \n\t-   '{}'\n\n* \n\t- : BEGIN{print \"name\"}\n\t- : {print $2}  note: {}\n\t- : END{print \"end of file\"}\n\t``` bash\n\tawk -F, 'BEGIN{print \"name\"}{print $2}END{print \"end of file\"}' test.txt\n\t# ens32IP \n\tip a s ens32 | awk -F \"[ /]+\" 'NR==3{print $3}' \n\t```\n\n* \n\t- NR \t\n\t\t* NR==1 \t\t\t\n\t\t* NR>=1 && NR<=5 \t15\n\t\t* /lijiahao/ \t\t\n\t\t* /li/,/lijiahao/ \t\n\t``` bash\n\t# \n\tawk 'NR==1' test.txt\n\n\t# 15\n\tawk 'NR>=1 && NR<=5' test.txt\n\t```\n* \n\t- $ \n\t- $0 \t\n\t- NF \t\n\t- $NF \t\n\t- FS  \t\n\t- OFS \t\n\t``` bash\n\t# \n\tawk '{print $2}' filename \n\n\t# \n\tawk '{print $NF}' filename \n\n\t# -F: : \n\t# :\n\tawk -F: '{print $1,$NF}' /etc/passwd | column -t\n\t```\n\n* \n\t- -F \t(' ')\n\t- -v    \n\t\t``` bash\n\t\tawk -F: -v OFS=: '{print $1,$NF}' /etc/passwd | column -t\n\t\t```\n\n## \n\n### df\n``` bash\n# \ndf -h\n```\n### du\n``` bash\n# \ndu -h\n```\n\t\n\n\n## Linux\n\n### \n* \n\t- \n\t- \n\n* \n\t- :  CPUSWAPIO\n\t- :\n\t- :  \n\t- :\n\n* \n\t```\n\t:\n\t\t- CPUCPUIOCPU\n\t```\n\t- CPU\n\t- \n\t- \n\t- \n\n* \n\t- \n\t- CPU: \n\t- : \n\t- : \n\t- /CPU\n\t- IOCPU\n\n### \n* vmstat\n\t- vmstatVirtual Memory Statistics()CPU\n\t- \n\t```\n\tvmstat [-V] [-n] [delay [count]]\n\t\t- -V \n\t\t- -n \n\t\t- delay \n\t\t- count 1\n\n\teg:\n\t\t- vmstat 3\n\t\t- vmstat 3 5\n\t```\n* iostat\n\t- IO\n\t- :\n\t```\n\tiostat \n\t\t- -c CPU\n\t\t- -d \n\t\t- -k k bytes\n\t\t- -x \n\t\t- interval \n\t\t- count \n\t\n\teg:\n\t\tiostat -c 5 3\n\t\tiostat -d 5 3\n\t```\n* sar\n\t- sarCPUIO()CPU\n\t- \n\t```\n\tsar \n\t\t- -a (CPU)\n\t\t- -u CPU\n\t\t- -p CPU\n\t\t- -d \n\t\t- -r \n\t\t- -b \n\t\t- -v inode\n\t\t- -n DEVEDEVSOCKFULL\n\t\t- interval \n\t\t- count \n\n\teg:\n\t\tsar -u 3 5\n\t\tsar -d 3 5\n\t\tsar -r 3 5\n\t\tsar -n 3 5\n\t```\n* top\n\t- top1CPU\n\t- topM\n\t- topkpid\n```\n: top \n\t* -n \n\t* -b top\neg:\n\ttop -b -n 1 | grep cpu\n```\n\n* iotop\n\n* free\n\t- free(swap)\n\t```\n\t: free\n\t\t- -h \n\t\t- -s \n\teg:\n\t\tfree -h -s 3\n\t```\n\n* ps\n```\n# CPU\nps aux --sort -pcpu | less\n\n# \nps aux --sort -pmem | less\n``` \n* /proc\n``` bash\n# CPU\ncat /proc/cpuinfo\n\n# \ncat /proc/meminfo\n\n# /proc/stat CPUCPU\ncat /proc/stat | grep ^cpu\n\n# \nwatch -d cat /proc/interrupts\n```\n\n### \n* CPU\n\t- user% + sys% < 70%\n\t- user% CPU\n\t- sys%  CPU\n* \n\t- swap in(si) = 0\n\t- swap out(so) = 0\n* \n\t- iowait% < 20%\n\n\n\n","source":"_posts/tools/linux_operation.md","raw":"---\ntitle: Linux \ncategories: \n- tools\n---\n\n## Linux\n\n### man\n* \n\t``` bash\n\tman ${command}\n\t```\n* \n\t``` bash\n\tman 5 ${filename}\n\t```\n\n### \n* useradd \n\t``` bash\n\tuseradd \n\t```\n\n* userdel \n\t``` bash\n\tuserdel \n\t```\n\n* passwd \n\t``` bash\n\t# \n\tpasswd\n\t# (root)\n\tpasswd \n\t```\n\n### chmod \n\n``` bash\n# \nchmod 750 filename\n\n# \nchmod -R 750 dirname\n```\n\n### chown \n\n``` bash\n# \nchown user:group filename\n\n# \nchown -R user:group dirname\n```\n\n## \n\n### tcpdump\n\n* <font color=red>note: tcpdump68</font>\n* \n\t- -i \n\t- -D \n\t- -C  -w \n\t- -s (0)\n\t- -w \n\t- -r \n\t- -v \n\t- -c \n\t- -A \n\t- -n (ip)\n\t- -nn \n\t- -t \n\n* \n\t- \n\t\t``` bash\n\t\t#  eth1 \n\t\ttcpdump -i eth1\n\n\t\t# \n\t\ttcpdump -i any\n\t\t```\n\n\t- \n\t\t``` bash\n\t\t#  IP \n\t\ttcpdump host 192.168.3.7\n\n\t\t#  IP \n\t\ttcpdump src 192.168.1.100\n\t\ttcpdump dst 192.168.1.100\n\t\t```\n\t\n\t- \n\t\t``` bash\n\t\ttcpdump -i eth1 net 192.168\n\t\ttcpdump -i eth1 src net 192.168\n\t\ttcpdump -i eth1 dst net 192.168\n\t\t```\n\t- \n\t\t``` bash\n\t\ttcpdump port 22\n\t\ttcpdump src port 22\n\t\ttcpdump dst port 22\n\t\t```\n\t- \n\t\t``` bash\n\t\ttcpdump portrange 22-125\n\t\t```\n\t- \n\t\t``` bash\n\t\ttcpdump -i eth1 arp\n\t\ttcpdump -i eth1 ip\n\t\ttcpdump -i eth1 tcp\n\t\ttcpdump -i eth1 udp\n\t\ttcpdump -i eth1 icmp\n\t\t```\n\n* \n\t``` bash\n\ttcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.cap\n\n\t\t- tcp:  ip icmp arp rarp  tcpudpicmp\n\t\t- -i eth1 : eth1\n\t\t- -t : \n\t\t- -s 0 : 68-S 0 \n\t\t- -c 100 : 100\n\t\t- dst port ! 22 : 22\n\t\t- src net 192.168.1.0/24 : 192.168.1.0/24\n\t\t- -w ./target.cap : capethereal(wireshark)\n\t```\n\n### netstat\n\n``` bash\nnetstat -anp | grep \n```\n\n### nc\n\n* \n\t- -l  nc\n\t- -p  \n\t- -s  IP\n\t- -u  ncUDPTCP\n\t- -v  \n\t- -w  \n\t- -z  zero\n* \n\t- \n\t\t``` bash\n\t    # tcp\n\t\tnc -l 127.0.0.1 8080\n\n\t\t# udp\n\t\tnc -l -u 1234\n\t\t```\n\t- \n\t\t``` bash\n\t\t# tcp\n\t\tnc 127.0.0.1 8080\n\n\t\t# udp\n\t\tnc -u 127.0.0.1 8080\n\n\t\t# ()\n\t\tnc -w 10 127.0.0.1 8080\n\t\t```\n\t- nc\n\t\t``` bash\n\t\t#  8080  192.168.1.200  80 \n\t\tncat -l 8080 | ncat 192.168.1.200 80\n\t\t```\n\t- nc\n\t\t``` bash\n\t\t# \n\t\tnc -l  8080 > file.txt\n\n\t\t# \n\t\tnc 192.168.1.100 8080 --send-only < data.txt\n\t\t```\n\t- \n\t\t``` bash\n\t\t#  -c  \n\t\t#  80  8080 \n\t\tnc -u -l 80 -c 'nc -u -l 8080'\n\t\t```\n\t\n\n### curl\n\n### telnet\n\n``` bash\n# \ntelnet 127.0.0.1 3389\n```\n\n## \n\n### ps\n\n``` bash\n# \nps aux | sort -k4nr | head -N\n\n# head: -N10\n# ps: \n\t- a \n\t- u id\n\t- x \n# sort:\n\t- k \n\t- 4 \n\t- n \n\t- r ()\n# ps aux \n\t- %MEM  4 -k4 \n\t- %CPU -k3 cpu\n```\n\n### perf\n\n``` bash\nsudo perf record -F 99 -p 13204 -g -- sleep 30\n\t\n\t* perf record \t\n\t* -F \t\t\t\n\t* -p \t\t\t\n\t* -g \t\t\t\n\t* --sleep \t\t30s\n```\n``` bash\nsudo perf report -n --stdio\n```\n\n\t\n## \n\n### wc\n\n* \n* -l \n\t``` grep\n\twc -l test.txt\n\t```\n* -c bytes\n* -w \n\n### \n\n#### \n* ^ ...\n\t``` bash\n\tgrep '^lijiahao' test.txt\n\tgrep '^li' test.txt\n\t```\n\n* $ ...\n\t``` bash\n\tgrep 'lijihao$' test.txt\n\tgrep 'm$' test.txt\n\t```\n\n* ^$ \n\t``` bash\n\tgrep -n '^$' test.txt\n\t```\n\n* . \n\t- note: . \n\t- \\. '.'\n\t``` bash\n\tgrep '\\.$' test.txt\n\t```\n\n* * 00\n\t``` bash\n\t# note: ii0\n\tgrep 'i*' test.txt\n\t```\n\n* .* \n\t- * : .*\n\t``` bash\n\tgrep '.*o' test.txt\n\t```\n\n* [] \n\t- [abc]  abc\n\t- [a-z]  a-z\n\t- [a-zA-Z0-9] \n\t- \n\t``` bash\n\tgrep 'li[abc]' test.txt\n\t```\n\n* [^] \n\t- [^abc] abc\n\n#### \n\n* <font color=red>note: egrepgrep-E</font>\n\n* \\+ 11\n\t``` bash\n\tegrep 'i+' test.txt\n\n\t# \n\tegrep '[0-9]+' test.txt\n\t```\n\n* | \n\t``` bash\n\tegrep 'li|lijiahao' test.txt\n\t```\n\n* () ()\n\t- sed\n\t``` bash\n\tegrep 'li(|jiahao)' test.txt\n\t```\n* {} \n\t- o{n,m} on-m\n\t- o{n} on\n\t``` bash\n\tegrep 'i{3,4}' test.txt\n\tegrep 'i{3}' test.txt\n\n\t#  1718X\n\tegrep '[0-9]{17}[0-9X]' id.txt\n\t```\n* ? 01\n\t``` bash\n\tegrep 'go?d' test.txt\n\t```\n\n### find\n* -name \n\t``` bash\n\tfind / -name filename\n\t```\n\n* -type \n\t``` bash\n\t# \n\tfind / -type d\n\t```\n\n\n### grep\n* grep\n* -n \n\t``` bash\n\tgrep -n 't[ae]st' test.txt\n\tgrep -n '^$' test.txt\n\t```\n* -rl\n\t``` bash\n\t# dirnameabc\n\tgrep -rl abc dirname\n\t```\n* -v \n\t``` bash\n\t# \n\tgrep -vn '^$' test.txt\n\n\t# \n\tegrep -v '^$|#' test.txt\n\t``` \n* -E \n\t``` bash\n\tgrep -E 'i+' test.txt\n\t```\n* -o \n\t``` bash\n\tgrep -o 'i{2,3}' test.txt\n\t```\n* c  wc -l\n\t```\n\tps -ef | grep -c sshd\n\t```\n* -i \n\t``` bash\n\t# \n\tgrep -i '[a-z]' test.txt\n\t```\n* -w \n\t``` bash\n\tnetstat -anp | grep -w ':80'\n\t```\n\n### sed\n* \n* :  sed  ' ' \n\t``` bash\n\t# test.txt \n\t# s    g \n\tsed -r 's#olgboy#oldgirl#g' test.txt\n\t```\n* ()\n\t- s \t\n\t\t``` bash\n\t\t# [0-9]  \n\t\tsed 's#[0-9]##g' test.txt\n\n\t\t#  g \n\t\tsed 's#[0-9]##' test.txt\n\n\t\t#  ()\n\t\t#  123456  <>\n\t\techo 123456 | sed -r 's#(.*)#<\\1>#'\n\n\t\t# \n\t\techo lijiahao_zhaozijin | sed -r 's#(^.*)_(.*)#\\2_\\1#' \n\n\t\t# ens32IP \n\t\tip a s ens32 | sed -n '4p' | sed -r 's#(^.*t )(.*)(/.*$)#\\2#g'\n\t\tip a s ens32 | sed -rn '3s#(^.*t )(.*)(/.*$)#\\2#gp'\n\t\t```\n\t- p \t\n\t\t``` bash\n\t\t# \n\t\tsed '1p' test.txt\n\n\t\t# \n\t\tsed '1,5p' test.txt\n\t\tsed '1,$p' test.txt\n\t\tsed '$p' test.txt\n\n\t\t# (//)\n\t\tsed '/lijiahao/p' test.txt\n\n\t\t# !  \n\t\tsed -nr '/^$|#/!p' /etc/ssh/sshd_config\n\n\t\t# \n\t\tsed '/10:00/,/11:00/p' test.txt\n\t\tsed -n '/li/,/lijiahao/p' test.txt\n\t\t```\n\t- d \t\n\t\t``` bash\n\t\t# \n\t\tsed '3d' test.txt\n\n\t\t# \n\t\tsed '2,3d' test.txt\n\n\t\t#  \n\t\tsed -r '/^$|#/d' /etc/ssh/sshd_config\n\t\t```\n\t- cai c/a/i\n\t\t``` bash\n\t\t# c \n\t\tsed '3c lijihaohaobang' test.txt\n\n\t\t# a \n\t\tsed '3a lijiahaohaohba' test.txt\n\t\tsed '$a lijiahao\\nzhaozijin\\nshengqiqi' test.txt\n\n\t\t# i \n\t\tsed '3i lijihaohaobang' test.txt\n\t\t```\n* \n\t- -n \n\t\t``` bash\n\t\t# ()\n\t\tsed '3p' test.txt\n\t\t# ()\n\t\tsed -n '3p' test.txt\n\t\t```\n\t- -r \n\t\t``` bash\n\t\tsed -nr '/[0-9]{3}/p' test.txt\n\t\t```\n\t- -i (-i)\n\n### awk\n* \n* \n\t-   '{}'\n\n* \n\t- : BEGIN{print \"name\"}\n\t- : {print $2}  note: {}\n\t- : END{print \"end of file\"}\n\t``` bash\n\tawk -F, 'BEGIN{print \"name\"}{print $2}END{print \"end of file\"}' test.txt\n\t# ens32IP \n\tip a s ens32 | awk -F \"[ /]+\" 'NR==3{print $3}' \n\t```\n\n* \n\t- NR \t\n\t\t* NR==1 \t\t\t\n\t\t* NR>=1 && NR<=5 \t15\n\t\t* /lijiahao/ \t\t\n\t\t* /li/,/lijiahao/ \t\n\t``` bash\n\t# \n\tawk 'NR==1' test.txt\n\n\t# 15\n\tawk 'NR>=1 && NR<=5' test.txt\n\t```\n* \n\t- $ \n\t- $0 \t\n\t- NF \t\n\t- $NF \t\n\t- FS  \t\n\t- OFS \t\n\t``` bash\n\t# \n\tawk '{print $2}' filename \n\n\t# \n\tawk '{print $NF}' filename \n\n\t# -F: : \n\t# :\n\tawk -F: '{print $1,$NF}' /etc/passwd | column -t\n\t```\n\n* \n\t- -F \t(' ')\n\t- -v    \n\t\t``` bash\n\t\tawk -F: -v OFS=: '{print $1,$NF}' /etc/passwd | column -t\n\t\t```\n\n## \n\n### df\n``` bash\n# \ndf -h\n```\n### du\n``` bash\n# \ndu -h\n```\n\t\n\n\n## Linux\n\n### \n* \n\t- \n\t- \n\n* \n\t- :  CPUSWAPIO\n\t- :\n\t- :  \n\t- :\n\n* \n\t```\n\t:\n\t\t- CPUCPUIOCPU\n\t```\n\t- CPU\n\t- \n\t- \n\t- \n\n* \n\t- \n\t- CPU: \n\t- : \n\t- : \n\t- /CPU\n\t- IOCPU\n\n### \n* vmstat\n\t- vmstatVirtual Memory Statistics()CPU\n\t- \n\t```\n\tvmstat [-V] [-n] [delay [count]]\n\t\t- -V \n\t\t- -n \n\t\t- delay \n\t\t- count 1\n\n\teg:\n\t\t- vmstat 3\n\t\t- vmstat 3 5\n\t```\n* iostat\n\t- IO\n\t- :\n\t```\n\tiostat \n\t\t- -c CPU\n\t\t- -d \n\t\t- -k k bytes\n\t\t- -x \n\t\t- interval \n\t\t- count \n\t\n\teg:\n\t\tiostat -c 5 3\n\t\tiostat -d 5 3\n\t```\n* sar\n\t- sarCPUIO()CPU\n\t- \n\t```\n\tsar \n\t\t- -a (CPU)\n\t\t- -u CPU\n\t\t- -p CPU\n\t\t- -d \n\t\t- -r \n\t\t- -b \n\t\t- -v inode\n\t\t- -n DEVEDEVSOCKFULL\n\t\t- interval \n\t\t- count \n\n\teg:\n\t\tsar -u 3 5\n\t\tsar -d 3 5\n\t\tsar -r 3 5\n\t\tsar -n 3 5\n\t```\n* top\n\t- top1CPU\n\t- topM\n\t- topkpid\n```\n: top \n\t* -n \n\t* -b top\neg:\n\ttop -b -n 1 | grep cpu\n```\n\n* iotop\n\n* free\n\t- free(swap)\n\t```\n\t: free\n\t\t- -h \n\t\t- -s \n\teg:\n\t\tfree -h -s 3\n\t```\n\n* ps\n```\n# CPU\nps aux --sort -pcpu | less\n\n# \nps aux --sort -pmem | less\n``` \n* /proc\n``` bash\n# CPU\ncat /proc/cpuinfo\n\n# \ncat /proc/meminfo\n\n# /proc/stat CPUCPU\ncat /proc/stat | grep ^cpu\n\n# \nwatch -d cat /proc/interrupts\n```\n\n### \n* CPU\n\t- user% + sys% < 70%\n\t- user% CPU\n\t- sys%  CPU\n* \n\t- swap in(si) = 0\n\t- swap out(so) = 0\n* \n\t- iowait% < 20%\n\n\n\n","slug":"tools/linux_operation","published":1,"date":"2022-07-10T05:35:05.722Z","updated":"2022-07-10T05:35:05.722Z","_id":"cl427l9wa00018owzhlly80ao","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><h3 id=\"man\"><a href=\"#man\" class=\"headerlink\" title=\"man\"></a>man</h3><ul>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man <span class=\"variable\">$&#123;command&#125;</span></span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man 5 <span class=\"variable\">$&#123;filename&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p>useradd </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd </span><br></pre></td></tr></table></figure></li>\n<li><p>userdel </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">userdel </span><br></pre></td></tr></table></figure></li>\n<li><p>passwd </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">passwd</span><br><span class=\"line\"><span class=\"comment\"># (root)</span></span><br><span class=\"line\">passwd </span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"chmod\"><a href=\"#chmod\" class=\"headerlink\" title=\"chmod\"></a>chmod</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 750 filename</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 750 <span class=\"built_in\">dirname</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"chown\"><a href=\"#chown\" class=\"headerlink\" title=\"chown\"></a>chown</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> user:group filename</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R user:group <span class=\"built_in\">dirname</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"tcpdump\"><a href=\"#tcpdump\" class=\"headerlink\" title=\"tcpdump\"></a>tcpdump</h3><ul>\n<li><p><font color=red>note: tcpdump68</font></p>\n</li>\n<li><p></p>\n<ul>\n<li>-i </li>\n<li>-D </li>\n<li>-C  -w </li>\n<li>-s (0)</li>\n<li>-w </li>\n<li>-r </li>\n<li>-v </li>\n<li>-c </li>\n<li>-A </li>\n<li>-n (ip)</li>\n<li>-nn </li>\n<li>-t </li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  eth1 </span></span><br><span class=\"line\">tcpdump -i eth1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">tcpdump -i any</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  IP </span></span><br><span class=\"line\">tcpdump host 192.168.3.7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  IP </span></span><br><span class=\"line\">tcpdump src 192.168.1.100</span><br><span class=\"line\">tcpdump dst 192.168.1.100</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump -i eth1 net 192.168</span><br><span class=\"line\">tcpdump -i eth1 src net 192.168</span><br><span class=\"line\">tcpdump -i eth1 dst net 192.168</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump port 22</span><br><span class=\"line\">tcpdump src port 22</span><br><span class=\"line\">tcpdump dst port 22</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump portrange 22-125</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump -i eth1 arp</span><br><span class=\"line\">tcpdump -i eth1 ip</span><br><span class=\"line\">tcpdump -i eth1 tcp</span><br><span class=\"line\">tcpdump -i eth1 udp</span><br><span class=\"line\">tcpdump -i eth1 icmp</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.cap</span><br><span class=\"line\"></span><br><span class=\"line\">\t- tcp:  ip icmp arp rarp  tcpudpicmp</span><br><span class=\"line\">\t- -i eth1 : eth1</span><br><span class=\"line\">\t- -t : </span><br><span class=\"line\">\t- -s 0 : 68-S 0 </span><br><span class=\"line\">\t- -c 100 : 100</span><br><span class=\"line\">\t- dst port ! 22 : 22</span><br><span class=\"line\">\t- src net 192.168.1.0/24 : 192.168.1.0/24</span><br><span class=\"line\">\t- -w ./target.cap : <span class=\"built_in\">cap</span>ethereal(wireshark)</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"netstat\"><a href=\"#netstat\" class=\"headerlink\" title=\"netstat\"></a>netstat</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anp | grep </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nc\"><a href=\"#nc\" class=\"headerlink\" title=\"nc\"></a>nc</h3><ul>\n<li><ul>\n<li>-l  nc</li>\n<li>-p  </li>\n<li>-s  IP</li>\n<li>-u  ncUDPTCP</li>\n<li>-v  </li>\n<li>-w  </li>\n<li>-z  zero</li>\n</ul>\n</li>\n<li><ul>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   <span class=\"comment\"># tcp</span></span><br><span class=\"line\">nc -l 127.0.0.1 8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># udp</span></span><br><span class=\"line\">nc -l -u 1234</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># tcp</span></span><br><span class=\"line\">nc 127.0.0.1 8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># udp</span></span><br><span class=\"line\">nc -u 127.0.0.1 8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">nc -w 10 127.0.0.1 8080</span><br></pre></td></tr></table></figure></li>\n<li>nc  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  8080  192.168.1.200  80 </span></span><br><span class=\"line\">ncat -l 8080 | ncat 192.168.1.200 80</span><br></pre></td></tr></table></figure></li>\n<li>nc  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">nc -l  8080 &gt; file.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">nc 192.168.1.100 8080 --send-only &lt; data.txt</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  -c  </span></span><br><span class=\"line\"><span class=\"comment\">#  80  8080 </span></span><br><span class=\"line\">nc -u -l 80 -c <span class=\"string\">&#x27;nc -u -l 8080&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"curl\"><a href=\"#curl\" class=\"headerlink\" title=\"curl\"></a>curl</h3><h3 id=\"telnet\"><a href=\"#telnet\" class=\"headerlink\" title=\"telnet\"></a>telnet</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">telnet 127.0.0.1 3389</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"ps\"><a href=\"#ps\" class=\"headerlink\" title=\"ps\"></a>ps</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">ps aux | <span class=\"built_in\">sort</span> -k4nr | <span class=\"built_in\">head</span> -N</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># head: -N10</span></span><br><span class=\"line\"><span class=\"comment\"># ps: </span></span><br><span class=\"line\">\t- a </span><br><span class=\"line\">\t- u <span class=\"built_in\">id</span></span><br><span class=\"line\">\t- x </span><br><span class=\"line\"><span class=\"comment\"># sort:</span></span><br><span class=\"line\">\t- k </span><br><span class=\"line\">\t- 4 </span><br><span class=\"line\">\t- n </span><br><span class=\"line\">\t- r ()</span><br><span class=\"line\"><span class=\"comment\"># ps aux </span></span><br><span class=\"line\">\t- %MEM  4 -k4 </span><br><span class=\"line\">\t- %CPU -k3 cpu</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"perf\"><a href=\"#perf\" class=\"headerlink\" title=\"perf\"></a>perf</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo perf record -F 99 -p 13204 -g -- <span class=\"built_in\">sleep</span> 30</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t* perf record \t</span><br><span class=\"line\">\t* -F \t\t\t</span><br><span class=\"line\">\t* -p \t\t\t</span><br><span class=\"line\">\t* -g \t\t\t</span><br><span class=\"line\">\t* --<span class=\"built_in\">sleep</span> \t\t30s</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo perf report -n --stdio</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"wc\"><a href=\"#wc\" class=\"headerlink\" title=\"wc\"></a>wc</h3><ul>\n<li></li>\n<li>-l   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wc -l test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-c bytes</li>\n<li>-w </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><p>^ </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;^lijiahao&#x27;</span> test.txt</span><br><span class=\"line\">grep <span class=\"string\">&#x27;^li&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>$ </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;lijihao$&#x27;</span> test.txt</span><br><span class=\"line\">grep <span class=\"string\">&#x27;m$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>^$ </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -n <span class=\"string\">&#x27;^$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>. </p>\n<ul>\n<li>note: . </li>\n<li>. .<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;\\.$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><ul>\n<li>00<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># note: ii0</span></span><br><span class=\"line\">grep <span class=\"string\">&#x27;i*&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>.* </p>\n<ul>\n<li><ul>\n<li>: .*<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;.*o&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>[] </p>\n<ul>\n<li>[abc]  abc</li>\n<li>[a-z]  a-z</li>\n<li>[a-zA-Z0-9] </li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;li[abc]&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>[^] </p>\n<ul>\n<li>[^abc] abc</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><p><font color=red>note: egrepgrep-E</font></p>\n</li>\n<li><p>+ 11</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;i+&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">egrep <span class=\"string\">&#x27;[0-9]+&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>| </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;li|lijiahao&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>() ()</p>\n<ul>\n<li>sed<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;li(|jiahao)&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>{} </p>\n<ul>\n<li>o{n,m} on-m</li>\n<li>o{n} on<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;i&#123;3,4&#125;&#x27;</span> test.txt</span><br><span class=\"line\">egrep <span class=\"string\">&#x27;i&#123;3&#125;&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  1718X</span></span><br><span class=\"line\">egrep <span class=\"string\">&#x27;[0-9]&#123;17&#125;[0-9X]&#x27;</span> id.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>? 01</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;go?d&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"find\"><a href=\"#find\" class=\"headerlink\" title=\"find\"></a>find</h3><ul>\n<li><p>-name </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -name filename</span><br></pre></td></tr></table></figure></li>\n<li><p>-type </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">find / -<span class=\"built_in\">type</span> d</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"grep\"><a href=\"#grep\" class=\"headerlink\" title=\"grep\"></a>grep</h3><ul>\n<li>grep</li>\n<li>-n   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -n <span class=\"string\">&#x27;t[ae]st&#x27;</span> test.txt</span><br><span class=\"line\">grep -n <span class=\"string\">&#x27;^$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-rl  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dirnameabc</span></span><br><span class=\"line\">grep -rl abc <span class=\"built_in\">dirname</span></span><br></pre></td></tr></table></figure></li>\n<li>-v   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">grep -vn <span class=\"string\">&#x27;^$&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">egrep -v <span class=\"string\">&#x27;^$|#&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-E   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -E <span class=\"string\">&#x27;i+&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-o   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -o <span class=\"string\">&#x27;i&#123;2,3&#125;&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>c  wc -l  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep -c sshd</span><br></pre></td></tr></table></figure></li>\n<li>-i   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">grep -i <span class=\"string\">&#x27;[a-z]&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-w   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anp | grep -w <span class=\"string\">&#x27;:80&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"sed\"><a href=\"#sed\" class=\"headerlink\" title=\"sed\"></a>sed</h3><ul>\n<li></li>\n<li>:  sed      <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># test.txt </span></span><br><span class=\"line\"><span class=\"comment\"># s    g </span></span><br><span class=\"line\">sed -r <span class=\"string\">&#x27;s#olgboy#oldgirl#g&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>()<ul>\n<li>s       <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># [0-9]  </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;s#[0-9]##g&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  g </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;s#[0-9]##&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  ()</span></span><br><span class=\"line\"><span class=\"comment\">#  123456  &lt;&gt;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> 123456 | sed -r <span class=\"string\">&#x27;s#(.*)#&lt;\\1&gt;#&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> lijiahao_zhaozijin | sed -r <span class=\"string\">&#x27;s#(^.*)_(.*)#\\2_\\1#&#x27;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ens32IP </span></span><br><span class=\"line\">ip a s ens32 | sed -n <span class=\"string\">&#x27;4p&#x27;</span> | sed -r <span class=\"string\">&#x27;s#(^.*t )(.*)(/.*$)#\\2#g&#x27;</span></span><br><span class=\"line\">ip a s ens32 | sed -rn <span class=\"string\">&#x27;3s#(^.*t )(.*)(/.*$)#\\2#gp&#x27;</span></span><br></pre></td></tr></table></figure></li>\n<li>p       <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;1p&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;1,5p&#x27;</span> test.txt</span><br><span class=\"line\">sed <span class=\"string\">&#x27;1,$p&#x27;</span> test.txt</span><br><span class=\"line\">sed <span class=\"string\">&#x27;$p&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (//)</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;/lijiahao/p&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># !  </span></span><br><span class=\"line\">sed -nr <span class=\"string\">&#x27;/^$|#/!p&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;/10:00/,/11:00/p&#x27;</span> test.txt</span><br><span class=\"line\">sed -n <span class=\"string\">&#x27;/li/,/lijiahao/p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>d       <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3d&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;2,3d&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\">sed -r <span class=\"string\">&#x27;/^$|#/d&#x27;</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></li>\n<li>cai c/a/i  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># c </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3c lijihaohaobang&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># a </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3a lijiahaohaohba&#x27;</span> test.txt</span><br><span class=\"line\">sed <span class=\"string\">&#x27;$a lijiahao\\nzhaozijin\\nshengqiqi&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># i </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3i lijihaohaobang&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><ul>\n<li>-n   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3p&#x27;</span> test.txt</span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sed -n <span class=\"string\">&#x27;3p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-r   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -nr <span class=\"string\">&#x27;/[0-9]&#123;3&#125;/p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-i (-i)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"awk\"><a href=\"#awk\" class=\"headerlink\" title=\"awk\"></a>awk</h3><ul>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>  {}</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>: BEGIN{print name}</li>\n<li>: {print $2}  note: {}</li>\n<li>: END{print end of file}<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -F, <span class=\"string\">&#x27;BEGIN&#123;print &quot;name&quot;&#125;&#123;print $2&#125;END&#123;print &quot;end of file&quot;&#125;&#x27;</span> test.txt</span><br><span class=\"line\"><span class=\"comment\"># ens32IP </span></span><br><span class=\"line\">ip a s ens32 | awk -F <span class=\"string\">&quot;[ /]+&quot;</span> <span class=\"string\">&#x27;NR==3&#123;print $3&#125;&#x27;</span> </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>NR     <ul>\n<li>NR==1             </li>\n<li>NR&gt;=1 &amp;&amp; NR&lt;=5     15</li>\n<li>/lijiahao/         </li>\n<li>/li/,/lijiahao/     <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;NR==1&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 15</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;NR&gt;=1 &amp;&amp; NR&lt;=5&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>$ </li>\n<li>$0     </li>\n<li>NF     </li>\n<li>$NF     </li>\n<li>FS      </li>\n<li>OFS     <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span> filename </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> filename </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -F: : </span></span><br><span class=\"line\"><span class=\"comment\"># :</span></span><br><span class=\"line\">awk -F: <span class=\"string\">&#x27;&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd | column -t</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>-F     ( )</li>\n<li>-v      <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -F: -v OFS=: <span class=\"string\">&#x27;&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd | column -t</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"df\"><a href=\"#df\" class=\"headerlink\" title=\"df\"></a>df</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -h</span><br></pre></td></tr></table></figure>\n<h3 id=\"du\"><a href=\"#du\" class=\"headerlink\" title=\"du\"></a>du</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">du</span> -h</span><br></pre></td></tr></table></figure>\n<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>:  CPUSWAPIO</li>\n<li>:</li>\n<li>:  </li>\n<li>:</li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:</span><br><span class=\"line\">\t- CPUCPUIOCPU</span><br></pre></td></tr></table></figure>\n<ul>\n<li>CPU</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li>CPU: </li>\n<li>: </li>\n<li>: </li>\n<li>/CPU</li>\n<li>IOCPU</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p>vmstat</p>\n<ul>\n<li>vmstatVirtual Memory Statistics()CPU</li>\n<li><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vmstat [-V] [-n] [delay [count]]</span><br><span class=\"line\">\t- -V </span><br><span class=\"line\">\t- -n </span><br><span class=\"line\">\t- delay </span><br><span class=\"line\">\t- count 1</span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">\t- vmstat 3</span><br><span class=\"line\">\t- vmstat 3 5</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>iostat</p>\n<ul>\n<li>IO</li>\n<li>:<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iostat </span><br><span class=\"line\">\t- -c CPU</span><br><span class=\"line\">\t- -d </span><br><span class=\"line\">\t- -k k bytes</span><br><span class=\"line\">\t- -x </span><br><span class=\"line\">\t- interval </span><br><span class=\"line\">\t- count </span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">\tiostat -c 5 3</span><br><span class=\"line\">\tiostat -d 5 3</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>sar</p>\n<ul>\n<li>sarCPUIO()CPU</li>\n<li><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sar </span><br><span class=\"line\">\t- -a (CPU)</span><br><span class=\"line\">\t- -u CPU</span><br><span class=\"line\">\t- -p CPU</span><br><span class=\"line\">\t- -d </span><br><span class=\"line\">\t- -r </span><br><span class=\"line\">\t- -b </span><br><span class=\"line\">\t- -v inode</span><br><span class=\"line\">\t- -n DEVEDEVSOCKFULL</span><br><span class=\"line\">\t- interval </span><br><span class=\"line\">\t- count </span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">\tsar -u 3 5</span><br><span class=\"line\">\tsar -d 3 5</span><br><span class=\"line\">\tsar -r 3 5</span><br><span class=\"line\">\tsar -n 3 5</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>top</p>\n<ul>\n<li>top1CPU</li>\n<li>topM</li>\n<li>topkpid<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: top </span><br><span class=\"line\">\t* -n </span><br><span class=\"line\">\t* -b top</span><br><span class=\"line\">eg:</span><br><span class=\"line\">\ttop -b -n 1 | grep cpu</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>iotop</p>\n</li>\n<li><p>free</p>\n<ul>\n<li>free(swap)<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: free</span><br><span class=\"line\">\t- -h </span><br><span class=\"line\">\t- -s </span><br><span class=\"line\">eg:</span><br><span class=\"line\">\tfree -h -s 3</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>ps</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CPU</span><br><span class=\"line\">ps aux --sort -pcpu | less</span><br><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">ps aux --sort -pmem | less</span><br></pre></td></tr></table></figure></li>\n<li><p>/proc</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CPU</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /proc/cpuinfo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /proc/meminfo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /proc/stat CPUCPU</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /proc/stat | grep ^cpu</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">watch -d <span class=\"built_in\">cat</span> /proc/interrupts</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li>CPU<ul>\n<li>user% + sys% &lt; 70%</li>\n<li>user% CPU</li>\n<li>sys%  CPU</li>\n</ul>\n</li>\n<li><ul>\n<li>swap in(si) = 0</li>\n<li>swap out(so) = 0</li>\n</ul>\n</li>\n<li><ul>\n<li>iowait% &lt; 20%</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><h3 id=\"man\"><a href=\"#man\" class=\"headerlink\" title=\"man\"></a>man</h3><ul>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man <span class=\"variable\">$&#123;command&#125;</span></span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man 5 <span class=\"variable\">$&#123;filename&#125;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p>useradd </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd </span><br></pre></td></tr></table></figure></li>\n<li><p>userdel </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">userdel </span><br></pre></td></tr></table></figure></li>\n<li><p>passwd </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">passwd</span><br><span class=\"line\"><span class=\"comment\"># (root)</span></span><br><span class=\"line\">passwd </span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"chmod\"><a href=\"#chmod\" class=\"headerlink\" title=\"chmod\"></a>chmod</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 750 filename</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 750 <span class=\"built_in\">dirname</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"chown\"><a href=\"#chown\" class=\"headerlink\" title=\"chown\"></a>chown</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> user:group filename</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R user:group <span class=\"built_in\">dirname</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"tcpdump\"><a href=\"#tcpdump\" class=\"headerlink\" title=\"tcpdump\"></a>tcpdump</h3><ul>\n<li><p><font color=red>note: tcpdump68</font></p>\n</li>\n<li><p></p>\n<ul>\n<li>-i </li>\n<li>-D </li>\n<li>-C  -w </li>\n<li>-s (0)</li>\n<li>-w </li>\n<li>-r </li>\n<li>-v </li>\n<li>-c </li>\n<li>-A </li>\n<li>-n (ip)</li>\n<li>-nn </li>\n<li>-t </li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  eth1 </span></span><br><span class=\"line\">tcpdump -i eth1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">tcpdump -i any</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  IP </span></span><br><span class=\"line\">tcpdump host 192.168.3.7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  IP </span></span><br><span class=\"line\">tcpdump src 192.168.1.100</span><br><span class=\"line\">tcpdump dst 192.168.1.100</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump -i eth1 net 192.168</span><br><span class=\"line\">tcpdump -i eth1 src net 192.168</span><br><span class=\"line\">tcpdump -i eth1 dst net 192.168</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump port 22</span><br><span class=\"line\">tcpdump src port 22</span><br><span class=\"line\">tcpdump dst port 22</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump portrange 22-125</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump -i eth1 arp</span><br><span class=\"line\">tcpdump -i eth1 ip</span><br><span class=\"line\">tcpdump -i eth1 tcp</span><br><span class=\"line\">tcpdump -i eth1 udp</span><br><span class=\"line\">tcpdump -i eth1 icmp</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.cap</span><br><span class=\"line\"></span><br><span class=\"line\">\t- tcp:  ip icmp arp rarp  tcpudpicmp</span><br><span class=\"line\">\t- -i eth1 : eth1</span><br><span class=\"line\">\t- -t : </span><br><span class=\"line\">\t- -s 0 : 68-S 0 </span><br><span class=\"line\">\t- -c 100 : 100</span><br><span class=\"line\">\t- dst port ! 22 : 22</span><br><span class=\"line\">\t- src net 192.168.1.0/24 : 192.168.1.0/24</span><br><span class=\"line\">\t- -w ./target.cap : <span class=\"built_in\">cap</span>ethereal(wireshark)</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"netstat\"><a href=\"#netstat\" class=\"headerlink\" title=\"netstat\"></a>netstat</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anp | grep </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nc\"><a href=\"#nc\" class=\"headerlink\" title=\"nc\"></a>nc</h3><ul>\n<li><ul>\n<li>-l  nc</li>\n<li>-p  </li>\n<li>-s  IP</li>\n<li>-u  ncUDPTCP</li>\n<li>-v  </li>\n<li>-w  </li>\n<li>-z  zero</li>\n</ul>\n</li>\n<li><ul>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   <span class=\"comment\"># tcp</span></span><br><span class=\"line\">nc -l 127.0.0.1 8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># udp</span></span><br><span class=\"line\">nc -l -u 1234</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># tcp</span></span><br><span class=\"line\">nc 127.0.0.1 8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># udp</span></span><br><span class=\"line\">nc -u 127.0.0.1 8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">nc -w 10 127.0.0.1 8080</span><br></pre></td></tr></table></figure></li>\n<li>nc  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  8080  192.168.1.200  80 </span></span><br><span class=\"line\">ncat -l 8080 | ncat 192.168.1.200 80</span><br></pre></td></tr></table></figure></li>\n<li>nc  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">nc -l  8080 &gt; file.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">nc 192.168.1.100 8080 --send-only &lt; data.txt</span><br></pre></td></tr></table></figure></li>\n<li>  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  -c  </span></span><br><span class=\"line\"><span class=\"comment\">#  80  8080 </span></span><br><span class=\"line\">nc -u -l 80 -c <span class=\"string\">&#x27;nc -u -l 8080&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"curl\"><a href=\"#curl\" class=\"headerlink\" title=\"curl\"></a>curl</h3><h3 id=\"telnet\"><a href=\"#telnet\" class=\"headerlink\" title=\"telnet\"></a>telnet</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">telnet 127.0.0.1 3389</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"ps\"><a href=\"#ps\" class=\"headerlink\" title=\"ps\"></a>ps</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">ps aux | <span class=\"built_in\">sort</span> -k4nr | <span class=\"built_in\">head</span> -N</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># head: -N10</span></span><br><span class=\"line\"><span class=\"comment\"># ps: </span></span><br><span class=\"line\">\t- a </span><br><span class=\"line\">\t- u <span class=\"built_in\">id</span></span><br><span class=\"line\">\t- x </span><br><span class=\"line\"><span class=\"comment\"># sort:</span></span><br><span class=\"line\">\t- k </span><br><span class=\"line\">\t- 4 </span><br><span class=\"line\">\t- n </span><br><span class=\"line\">\t- r ()</span><br><span class=\"line\"><span class=\"comment\"># ps aux </span></span><br><span class=\"line\">\t- %MEM  4 -k4 </span><br><span class=\"line\">\t- %CPU -k3 cpu</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"perf\"><a href=\"#perf\" class=\"headerlink\" title=\"perf\"></a>perf</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo perf record -F 99 -p 13204 -g -- <span class=\"built_in\">sleep</span> 30</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t* perf record \t</span><br><span class=\"line\">\t* -F \t\t\t</span><br><span class=\"line\">\t* -p \t\t\t</span><br><span class=\"line\">\t* -g \t\t\t</span><br><span class=\"line\">\t* --<span class=\"built_in\">sleep</span> \t\t30s</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo perf report -n --stdio</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"wc\"><a href=\"#wc\" class=\"headerlink\" title=\"wc\"></a>wc</h3><ul>\n<li></li>\n<li>-l   <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wc -l test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-c bytes</li>\n<li>-w </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><p>^ </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;^lijiahao&#x27;</span> test.txt</span><br><span class=\"line\">grep <span class=\"string\">&#x27;^li&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>$ </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;lijihao$&#x27;</span> test.txt</span><br><span class=\"line\">grep <span class=\"string\">&#x27;m$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>^$ </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -n <span class=\"string\">&#x27;^$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>. </p>\n<ul>\n<li>note: . </li>\n<li>. .<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;\\.$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><ul>\n<li>00<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># note: ii0</span></span><br><span class=\"line\">grep <span class=\"string\">&#x27;i*&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>.* </p>\n<ul>\n<li><ul>\n<li>: .*<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;.*o&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>[] </p>\n<ul>\n<li>[abc]  abc</li>\n<li>[a-z]  a-z</li>\n<li>[a-zA-Z0-9] </li>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">&#x27;li[abc]&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>[^] </p>\n<ul>\n<li>[^abc] abc</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><p><font color=red>note: egrepgrep-E</font></p>\n</li>\n<li><p>+ 11</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;i+&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">egrep <span class=\"string\">&#x27;[0-9]+&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>| </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;li|lijiahao&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li><p>() ()</p>\n<ul>\n<li>sed<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;li(|jiahao)&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>{} </p>\n<ul>\n<li>o{n,m} on-m</li>\n<li>o{n} on<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;i&#123;3,4&#125;&#x27;</span> test.txt</span><br><span class=\"line\">egrep <span class=\"string\">&#x27;i&#123;3&#125;&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  1718X</span></span><br><span class=\"line\">egrep <span class=\"string\">&#x27;[0-9]&#123;17&#125;[0-9X]&#x27;</span> id.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>? 01</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">egrep <span class=\"string\">&#x27;go?d&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"find\"><a href=\"#find\" class=\"headerlink\" title=\"find\"></a>find</h3><ul>\n<li><p>-name </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find / -name filename</span><br></pre></td></tr></table></figure></li>\n<li><p>-type </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">find / -<span class=\"built_in\">type</span> d</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"grep\"><a href=\"#grep\" class=\"headerlink\" title=\"grep\"></a>grep</h3><ul>\n<li>grep</li>\n<li>-n   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -n <span class=\"string\">&#x27;t[ae]st&#x27;</span> test.txt</span><br><span class=\"line\">grep -n <span class=\"string\">&#x27;^$&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-rl  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dirnameabc</span></span><br><span class=\"line\">grep -rl abc <span class=\"built_in\">dirname</span></span><br></pre></td></tr></table></figure></li>\n<li>-v   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">grep -vn <span class=\"string\">&#x27;^$&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">egrep -v <span class=\"string\">&#x27;^$|#&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-E   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -E <span class=\"string\">&#x27;i+&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-o   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -o <span class=\"string\">&#x27;i&#123;2,3&#125;&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>c  wc -l  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep -c sshd</span><br></pre></td></tr></table></figure></li>\n<li>-i   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">grep -i <span class=\"string\">&#x27;[a-z]&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-w   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">netstat -anp | grep -w <span class=\"string\">&#x27;:80&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"sed\"><a href=\"#sed\" class=\"headerlink\" title=\"sed\"></a>sed</h3><ul>\n<li></li>\n<li>:  sed      <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># test.txt </span></span><br><span class=\"line\"><span class=\"comment\"># s    g </span></span><br><span class=\"line\">sed -r <span class=\"string\">&#x27;s#olgboy#oldgirl#g&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>()<ul>\n<li>s       <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># [0-9]  </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;s#[0-9]##g&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  g </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;s#[0-9]##&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  ()</span></span><br><span class=\"line\"><span class=\"comment\">#  123456  &lt;&gt;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> 123456 | sed -r <span class=\"string\">&#x27;s#(.*)#&lt;\\1&gt;#&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> lijiahao_zhaozijin | sed -r <span class=\"string\">&#x27;s#(^.*)_(.*)#\\2_\\1#&#x27;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ens32IP </span></span><br><span class=\"line\">ip a s ens32 | sed -n <span class=\"string\">&#x27;4p&#x27;</span> | sed -r <span class=\"string\">&#x27;s#(^.*t )(.*)(/.*$)#\\2#g&#x27;</span></span><br><span class=\"line\">ip a s ens32 | sed -rn <span class=\"string\">&#x27;3s#(^.*t )(.*)(/.*$)#\\2#gp&#x27;</span></span><br></pre></td></tr></table></figure></li>\n<li>p       <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;1p&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;1,5p&#x27;</span> test.txt</span><br><span class=\"line\">sed <span class=\"string\">&#x27;1,$p&#x27;</span> test.txt</span><br><span class=\"line\">sed <span class=\"string\">&#x27;$p&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (//)</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;/lijiahao/p&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># !  </span></span><br><span class=\"line\">sed -nr <span class=\"string\">&#x27;/^$|#/!p&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;/10:00/,/11:00/p&#x27;</span> test.txt</span><br><span class=\"line\">sed -n <span class=\"string\">&#x27;/li/,/lijiahao/p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>d       <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3d&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;2,3d&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\">sed -r <span class=\"string\">&#x27;/^$|#/d&#x27;</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></li>\n<li>cai c/a/i  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># c </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3c lijihaohaobang&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># a </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3a lijiahaohaohba&#x27;</span> test.txt</span><br><span class=\"line\">sed <span class=\"string\">&#x27;$a lijiahao\\nzhaozijin\\nshengqiqi&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># i </span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3i lijihaohaobang&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><ul>\n<li>-n   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3p&#x27;</span> test.txt</span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">sed -n <span class=\"string\">&#x27;3p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-r   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -nr <span class=\"string\">&#x27;/[0-9]&#123;3&#125;/p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n<li>-i (-i)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"awk\"><a href=\"#awk\" class=\"headerlink\" title=\"awk\"></a>awk</h3><ul>\n<li><p></p>\n</li>\n<li><p></p>\n<ul>\n<li>  {}</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>: BEGIN{print name}</li>\n<li>: {print $2}  note: {}</li>\n<li>: END{print end of file}<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -F, <span class=\"string\">&#x27;BEGIN&#123;print &quot;name&quot;&#125;&#123;print $2&#125;END&#123;print &quot;end of file&quot;&#125;&#x27;</span> test.txt</span><br><span class=\"line\"><span class=\"comment\"># ens32IP </span></span><br><span class=\"line\">ip a s ens32 | awk -F <span class=\"string\">&quot;[ /]+&quot;</span> <span class=\"string\">&#x27;NR==3&#123;print $3&#125;&#x27;</span> </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>NR     <ul>\n<li>NR==1             </li>\n<li>NR&gt;=1 &amp;&amp; NR&lt;=5     15</li>\n<li>/lijiahao/         </li>\n<li>/li/,/lijiahao/     <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;NR==1&#x27;</span> test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 15</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;NR&gt;=1 &amp;&amp; NR&lt;=5&#x27;</span> test.txt</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>$ </li>\n<li>$0     </li>\n<li>NF     </li>\n<li>$NF     </li>\n<li>FS      </li>\n<li>OFS     <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span> filename </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> filename </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -F: : </span></span><br><span class=\"line\"><span class=\"comment\"># :</span></span><br><span class=\"line\">awk -F: <span class=\"string\">&#x27;&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd | column -t</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>-F     ( )</li>\n<li>-v      <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -F: -v OFS=: <span class=\"string\">&#x27;&#123;print $1,$NF&#125;&#x27;</span> /etc/passwd | column -t</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"df\"><a href=\"#df\" class=\"headerlink\" title=\"df\"></a>df</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">df</span> -h</span><br></pre></td></tr></table></figure>\n<h3 id=\"du\"><a href=\"#du\" class=\"headerlink\" title=\"du\"></a>du</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">du</span> -h</span><br></pre></td></tr></table></figure>\n<h2 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li>:  CPUSWAPIO</li>\n<li>:</li>\n<li>:  </li>\n<li>:</li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:</span><br><span class=\"line\">\t- CPUCPUIOCPU</span><br></pre></td></tr></table></figure>\n<ul>\n<li>CPU</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li></li>\n<li>CPU: </li>\n<li>: </li>\n<li>: </li>\n<li>/CPU</li>\n<li>IOCPU</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p>vmstat</p>\n<ul>\n<li>vmstatVirtual Memory Statistics()CPU</li>\n<li><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vmstat [-V] [-n] [delay [count]]</span><br><span class=\"line\">\t- -V </span><br><span class=\"line\">\t- -n </span><br><span class=\"line\">\t- delay </span><br><span class=\"line\">\t- count 1</span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">\t- vmstat 3</span><br><span class=\"line\">\t- vmstat 3 5</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>iostat</p>\n<ul>\n<li>IO</li>\n<li>:<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iostat </span><br><span class=\"line\">\t- -c CPU</span><br><span class=\"line\">\t- -d </span><br><span class=\"line\">\t- -k k bytes</span><br><span class=\"line\">\t- -x </span><br><span class=\"line\">\t- interval </span><br><span class=\"line\">\t- count </span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">\tiostat -c 5 3</span><br><span class=\"line\">\tiostat -d 5 3</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>sar</p>\n<ul>\n<li>sarCPUIO()CPU</li>\n<li><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sar </span><br><span class=\"line\">\t- -a (CPU)</span><br><span class=\"line\">\t- -u CPU</span><br><span class=\"line\">\t- -p CPU</span><br><span class=\"line\">\t- -d </span><br><span class=\"line\">\t- -r </span><br><span class=\"line\">\t- -b </span><br><span class=\"line\">\t- -v inode</span><br><span class=\"line\">\t- -n DEVEDEVSOCKFULL</span><br><span class=\"line\">\t- interval </span><br><span class=\"line\">\t- count </span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">\tsar -u 3 5</span><br><span class=\"line\">\tsar -d 3 5</span><br><span class=\"line\">\tsar -r 3 5</span><br><span class=\"line\">\tsar -n 3 5</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>top</p>\n<ul>\n<li>top1CPU</li>\n<li>topM</li>\n<li>topkpid<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: top </span><br><span class=\"line\">\t* -n </span><br><span class=\"line\">\t* -b top</span><br><span class=\"line\">eg:</span><br><span class=\"line\">\ttop -b -n 1 | grep cpu</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>iotop</p>\n</li>\n<li><p>free</p>\n<ul>\n<li>free(swap)<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">: free</span><br><span class=\"line\">\t- -h </span><br><span class=\"line\">\t- -s </span><br><span class=\"line\">eg:</span><br><span class=\"line\">\tfree -h -s 3</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>ps</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># CPU</span><br><span class=\"line\">ps aux --sort -pcpu | less</span><br><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">ps aux --sort -pmem | less</span><br></pre></td></tr></table></figure></li>\n<li><p>/proc</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CPU</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /proc/cpuinfo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /proc/meminfo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /proc/stat CPUCPU</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /proc/stat | grep ^cpu</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">watch -d <span class=\"built_in\">cat</span> /proc/interrupts</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li>CPU<ul>\n<li>user% + sys% &lt; 70%</li>\n<li>user% CPU</li>\n<li>sys%  CPU</li>\n</ul>\n</li>\n<li><ul>\n<li>swap in(si) = 0</li>\n<li>swap out(so) = 0</li>\n</ul>\n</li>\n<li><ul>\n<li>iowait% &lt; 20%</li>\n</ul>\n</li>\n</ul>\n"},{"title":"Golang ","_content":"\n## \n\n* :\n\t- \n\t- \n\t- \n\t- \n* :\n\t- \n\t- \n\t- \n\t- \n\t- \n\n## rpc\n\n* \n\t1. rpc\n\t\t``` go\n\t\trpc.RegisterName(\"\", )\n\n\t\t* :\n\t\t\t- \n\t\t\t- ()\n\t\t\t-  error \n\t\t```\n\t2. \n\t\t``` go\n\t\tlistener, err := net.Listen()\n\t\t```\n\t3. \n\t\t``` go\n\t\tconn, err := listener.Accept()\n\t\t```\n\t4. rpc\n\t\t``` go\n\t\trpc.ServeConn(conn)\n\t\t```\n\n*  \n\t1. rpc\n\t\t``` go\n\t\tconn, err := rpc.Dial()\n\t\t```\n\t2. \n\t\t``` go\n\t\tconn.Call(\".\", , )\n\t\t```\n\n## protobuf\n\n* protobuf\n\t``` bash\n\t# protobuf\n\tgit clone https://github.com/protocolbuffers/protobuf.git\n\t# \n\tsudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y\n\t# \n\tcd protobuf/\n\t# configure\n\t./autogen.sh\n\t# \n\t./configure\n\t# ()\n\tmake\n\t# \n\tsudo make install\n\t#  \n\tsudo ldconfig\n\t# \n\tprotoc -h\n\t```\n\n* go \n\t``` bash\n\tgo get -u github.com/golang/protobuf/protoc-gen-go\n\tgo get -u google.golang.org/protobuf/proto\n\t```\n\n## protobuf\n\n* .proto\n\n\t`pb/Person.proto: `\n\n\t``` protobuf\n\tsyntax = \"proto3\";\n\tpackage pb;\n\n\timport \"google/protobuf/timestamp.proto\";\n\n\toption go_package = \"./;pb\";\n\n\tmessage Person {\n\t\tstring name = 1;\n\t\tint32 id = 2;  // Unique ID number for this person.\n\t\tstring email = 3;\n\n\t\tenum PhoneType {\n\t\t  MOBILE = 0;\n\t\t  HOME = 1;\n\t\t  WORK = 2;\n\t\t}\n\n\t\tmessage PhoneNumber {\n\t\t  string number = 1;\n\t\t  PhoneType type = 2;\n\t\t}\n\n\t\trepeated PhoneNumber phones = 4;\n\n\t\tgoogle.protobuf.Timestamp last_updated = 5;\n\t  }\n\n\t  // Our address book file is just one of these.\n\t  message AddressBook {\n\t\trepeated Person people = 1;\n\t}\n\t```\n\n* .proto\n\t``` bash\n\tprotoc *.proto --go_out=.\n\t```\n\n* \n\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"exercise/rpc/net.rpc/pb\"\n\t\t\"fmt\"\n\n\t\t\"google.golang.org/protobuf/proto\"\n\t)\n\n\tfunc main() {\n\t\t// Person\n\t\tperson := &pb.Person{\n\t\t\tName:  \"lijiahao\",\n\t\t\tId:    0,\n\t\t\tEmail: \"18702748294@163.com\",\n\t\t\tPhones: []*pb.Person_PhoneNumber{\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"15136588270\",\n\t\t\t\t\tType: pb.Person_MOBILE,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"190019393\",\n\t\t\t\t\tType: pb.Person_HOME,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"17182920303\",\n\t\t\t\t\tType: pb.Person_WORK,\n\t\t\t\t},\n\t\t\t},\n\t\t}\n\n\t\t// Person\n\t\tdata, err := proto.Marshal(person)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"proto marshal error: \", err)\n\t\t}\n\n\t\t// \n\t\tnewData := &pb.Person{}\n\t\terr = proto.Unmarshal(data, newData)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"unmarshal error: \", err)\n\t\t}\n\t\tfmt.Println(newData)\n\t}\n\t```\n\n## rpc\n* \n\t- Rpc()\n\t``` go\n\trpc.RegisterName(\"\", )\n\t```\n\n\t- \n\t``` go\n\tlistener, err := net.Listen()\n\t```\n\n\t- \n\t``` go\n\tconn, err := listener.Accept()\n\t```\n\n\t- Rpc\n\t``` go\n\trpc.ServeConn(conn)\n\t```\n\n* \n\t- Rpc\n\t``` go\n\tconn, err := rpc.Dial()\n\t```\n\n\t- \n\t``` go\n\tconn.Call(\".\", , )\n\t```\n\n* \n\t``` go\n\tpackage design\n\n\timport (\n\t\t\"net/rpc\"\n\t\t\"net/rpc/jsonrpc\"\n\t)\n\n\t// \n\t/*\n\t\t* \n\t\t* \n\t*/\n\ttype MyInterface interface {\n\t\tHelloWorld(string, *string) error\n\t}\n\n\tfunc RegisterService(i MyInterface) error {\n\t\treturn rpc.RegisterName(\"hello\", i)\n\t}\n\n\t// \n\t/*\n\t\t* \n\t\t* ( rpc.Client) \n\t\t* InitClient\n\t*/\n\ttype MyClient struct {\n\t\tc *rpc.Client\n\t}\n\n\tfunc InitClient(addr string) *MyClient {\n\t\tconn, _ := jsonrpc.Dial(\"tcp\", addr)\n\n\t\treturn &MyClient{c:conn}\n\t}\n\n\tfunc (m *MyClient)HelloWorld(a string, b *string) error {\n\t\treturn m.c.Call(\"hello.HelloWorld\", a, b)\n\t}\n\t```\n\n\n## grpc \n\n* grpc go\n\t``` bash\n\tgo get -u -v google.golang.org/grpc\n\t```\n\n* .proto\n\n\t`pb/hello_grpc.proto`\n\n\t``` protobuf\n\t// protobuf\n\tsyntax = \"proto3\";\n\n\tpackage pb;\n\n\toption go_package = \"./;pb\";\n\n\t// \n\tservice Greeter {\n\t  rpc SayHello (HelloRequest) returns (HelloReply) {}\n\t}\n\n\tmessage HelloRequest {\n\t  string name = 1;\n\t}\n\n\tmessage HelloReply {\n\t  string message = 1;\n\t}\n\t```\n\n* .proto\n\t- go\n\t\t``` bash\n\t\tgo get -u github.com/golang/protobuf/protoc-gen-go\n\t\t```\n\t- .proto\n\t\t``` bash\n\t\tprotoc *.proto --go_out=plugins=grpc:./\n\t\t* --go_out=plugins=grpc: go\n\t\t```\n\n\n* \n\t`server/server.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"fmt\"\n\t\t\"exercise/rpc/net.rpc/pb\"\n\t\t\"google.golang.org/grpc\"\n\t\t\"google.golang.org/grpc/reflection\"\n\t\t\"net\"\n\t)\n\n\ttype server struct {}\n\n\t// \n\tfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) {\n\t\treturn &pb.HelloReply{Message: \"hello \" + in.Name}, nil\n\t}\n\n\tfunc main() {\n\t\t// \n\t\tlis, err := net.Listen(\"tcp\", \":8080\")\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\t// gRPC\n\t\ts := grpc.NewServer()\n\n\t\t// \n\t\tpb.RegisterGreeterServer(s, &server{})\n\n\t\treflection.Register(s)\n\n\t\t// \n\t\terr = s.Serve(lis)\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t}\n\t```\n\n* \n\t`client/client.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"exercise/rpc/net.rpc/pb\"\n\t\t\"fmt\"\n\t\t\"google.golang.org/grpc\"\n\t)\n\n\tfunc main(){\n\t\t// \n\t\tconn, err := grpc.Dial(\":8080\", grpc.WithInsecure())\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t\tdefer conn.Close()\n\n\t\t// \n\t\tc := pb.NewGreeterClient(conn)\n\n\t\t// \n\t\tr, err := c.SayHello(context.Background(), &pb.HelloRequest{Name: \"horika\"})\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\tfmt.Printf(\": %s\", r.Message)\n\t}\n\t```\n\n## rpcx\n\n* [rpcx](https://doc.rpcx.io/)\n\n* `rpcx`\n\n``` bash\ngo get -u -v -tags \"reuseport quic kcp zookeeper etcd consul ping\" github.com/smallnest/rpcx/...\n```\n\n`:`\n\n`server/server.go`\n\n``` go\npackage main\n\nimport (\n\t\"flag\"\n\t\"github.com/smallnest/rpcx/server\"\n\t\"github.com/smallnest/rpcx/serverplugin\"\n\t\"log\"\n\t\"time\"\n)\n\nvar (\n\taddr      = flag.String(\"addr\", \"localhost:8972\", \"server address\")\n\tetcdServers = []string{\"127.0.0.1:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main() {\n\tflag.Parse()\n\n\t//1newstruct\n\ts := server.NewServer()\n\t//2zookeeper\n\taddRegistryPlugin(s)\n\t//3\n\ts.RegisterName(\"Arith\", new(Arith), \"\")\n\t//4\n\ts.Serve(\"tcp\", *addr)\n}\n\nfunc addRegistryPlugin(s *server.Server) {\n\tr := &serverplugin.EtcdV3RegisterPlugin{\n\t\tServiceAddress: \"tcp@\" + *addr,\n\t\tEtcdServers:   etcdServers,\n\t\tBasePath:       basePath,\n\t\tUpdateInterval: time.Minute,\n\t}\n\terr := r.Start()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\ts.Plugins.Add(r)\n}\n```\n\n`server/rpc.go`\n\n``` go\npackage main \n\n// \ntype Arith int\n\nfunc (t *Arith) Mul(cxt context.Context, args *Args, reply *int) error {\n  fmt.Println(\"Mul on\", *addr)\n  *reply = args.A * args.B\n  return nil\n}\n\nfunc (t *Arith) Div(cxt context.Context, args *Args, quo *Quotient) error {\n  fmt.Println(\"Div on\", *addr)\n  if args.B == 0 {\n    return errors.New(\"divide by 0\")\n  }\n\n  quo.Quo = args.A / args.B\n  quo.Rem = args.A % args.B\n  return nil\n}\n```\n\n`proto/proto.go`\n\n``` go\npackage proto\n\ntype Args struct {\n\tA, B int\n}\n\ntype Quotient struct {\n\tQuo, Rem int\n}\n\n```\n\n* server\n* \n* \n* \n\n\n``\n\n`client.go`\n\n``` go\npackage main\n\nimport (\n\t\"github.com/smallnest/rpcx/client\"\n\t\"context\"\n\t\"flag\"\n\t\"log\"\n\t\"time\"\n\n\t\"exercise/rpcx_test/proto\"\n)\nvar (\n\tetcdServers = []string{\"localhost:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main()  {\n\tflag.Parse()\n\n\t//1ZookeeperDiscovery\n\td := client.NewEtcdV3Discovery(basePath,\"Arith\", etcdServers, nil)\n\t//2\n\txclient := client.NewXClient(\"Arith\", client.Failtry, client.RandomSelect, d, client.DefaultOption)\n\n\tdefer xclient.Close()\n\n\targs := &proto.Args{\n\t\tA: 25,\n\t\tB: 4,\n\t}\n\n\tquo := &proto.Quotient{}\n\n\tfor {\n\t\treply := new(int)\n\n\t\terr := xclient.Call(context.Background(), \"Mul\", args, reply)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\n\t\tlog.Printf(\"%d * %d = %d\", args.A, args.B, *reply)\n\n\t\terr = xclient.Call(context.Background(), \"Div\", args, quo)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\t\tlog.Printf(\"%d / %d = %d, %d\", args.A, args.B, quo.Quo, quo.Rem)\n\t\ttime.Sleep(3*time.Second)\n\t}\n}\n\n```\n\n* \n\n\n\t- \n\t- \n\n* \n* \n\n\n## go_micro\n\n### \n* : `zookeeper``eureka``consul``etcd`  \n\n* : v\n\n* : pullpush\n\n### consul\n\n* consul\n\t- \n\t- \n\t- \n\t- \n\n* consul\n\t``` bash\n\t## Consul\n\twget https://releases.hashicorp.com/consul/1.10.3/consul_1.10.3_linux_amd64.zip\n\t##unzip\n\tunzip consul_1.10.3_linux_amd64.zip\n\t##consul/usr/local/bin\n\tmv consul /usr/local/bin\n\t##\n\tconsul --version\n\t```\n\n* consul\n\t```  bash\n\tconsul agent\n\t\t* -bind=0.0.0.0consulIP\n\t\t* -http-port=8500: consulweb: 8500\n\t\t* -server server \n\t\t* -client = 127.0.0.1: consul127.0.0.10.0.0.0\n\t\t* -config-dir.json\n\t\t* -data-dir\n\t\t* -dev: consul\n\t\t* -node\n\t\t* -join\n\t\t* -ui: web\n\n\t# (127ipclient)\n\tconsul agent -dev -ui\n\n\t# ipclient\n\tconsul agent -dev  -client=0.0.0.0 -ui\n\t```\n\n* consul\n\t``` bash\n\t# server1(leader)\n\tconsul agent -server -bootstrap -bind=192.168.31.188 -client=0.0.0.0 -data-dir=./data/server1 -ui -node=server1\n\n\t# server2(follower)\n\tconsul agent -server -bind=192.168.31.187 -client=0.0.0.0 -data-dir=./data/server2 -ui -node=server2 -join=192.168.31.188 \n\n\t# server3(follower)\n\tconsul agent -server -bind=192.168.31.186 -client=0.0.0.0 -data-dir=./data/server3 -ui -node=server3 -join=192.168.31.188\n\n\t# client1\n\tconsul agent -ui -bind=192.168.31.185 -client=0.0.0.0 -data-dir=./data/client1 -ui -node=client1 -join=192.168.31.188\n\n\t# \n\tconsul members\n\n\t# \n\tconsul info\n\n\t# consul\n\tconsul leave\n\n\t# \n\tconsul reload\n\t```\n\n\n\n\n","source":"_posts/go/go_micro.md","raw":"---\ntitle: Golang  \ncategories: \n- GolangStudy\n---\n\n## \n\n* :\n\t- \n\t- \n\t- \n\t- \n* :\n\t- \n\t- \n\t- \n\t- \n\t- \n\n## rpc\n\n* \n\t1. rpc\n\t\t``` go\n\t\trpc.RegisterName(\"\", )\n\n\t\t* :\n\t\t\t- \n\t\t\t- ()\n\t\t\t-  error \n\t\t```\n\t2. \n\t\t``` go\n\t\tlistener, err := net.Listen()\n\t\t```\n\t3. \n\t\t``` go\n\t\tconn, err := listener.Accept()\n\t\t```\n\t4. rpc\n\t\t``` go\n\t\trpc.ServeConn(conn)\n\t\t```\n\n*  \n\t1. rpc\n\t\t``` go\n\t\tconn, err := rpc.Dial()\n\t\t```\n\t2. \n\t\t``` go\n\t\tconn.Call(\".\", , )\n\t\t```\n\n## protobuf\n\n* protobuf\n\t``` bash\n\t# protobuf\n\tgit clone https://github.com/protocolbuffers/protobuf.git\n\t# \n\tsudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y\n\t# \n\tcd protobuf/\n\t# configure\n\t./autogen.sh\n\t# \n\t./configure\n\t# ()\n\tmake\n\t# \n\tsudo make install\n\t#  \n\tsudo ldconfig\n\t# \n\tprotoc -h\n\t```\n\n* go \n\t``` bash\n\tgo get -u github.com/golang/protobuf/protoc-gen-go\n\tgo get -u google.golang.org/protobuf/proto\n\t```\n\n## protobuf\n\n* .proto\n\n\t`pb/Person.proto: `\n\n\t``` protobuf\n\tsyntax = \"proto3\";\n\tpackage pb;\n\n\timport \"google/protobuf/timestamp.proto\";\n\n\toption go_package = \"./;pb\";\n\n\tmessage Person {\n\t\tstring name = 1;\n\t\tint32 id = 2;  // Unique ID number for this person.\n\t\tstring email = 3;\n\n\t\tenum PhoneType {\n\t\t  MOBILE = 0;\n\t\t  HOME = 1;\n\t\t  WORK = 2;\n\t\t}\n\n\t\tmessage PhoneNumber {\n\t\t  string number = 1;\n\t\t  PhoneType type = 2;\n\t\t}\n\n\t\trepeated PhoneNumber phones = 4;\n\n\t\tgoogle.protobuf.Timestamp last_updated = 5;\n\t  }\n\n\t  // Our address book file is just one of these.\n\t  message AddressBook {\n\t\trepeated Person people = 1;\n\t}\n\t```\n\n* .proto\n\t``` bash\n\tprotoc *.proto --go_out=.\n\t```\n\n* \n\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"exercise/rpc/net.rpc/pb\"\n\t\t\"fmt\"\n\n\t\t\"google.golang.org/protobuf/proto\"\n\t)\n\n\tfunc main() {\n\t\t// Person\n\t\tperson := &pb.Person{\n\t\t\tName:  \"lijiahao\",\n\t\t\tId:    0,\n\t\t\tEmail: \"18702748294@163.com\",\n\t\t\tPhones: []*pb.Person_PhoneNumber{\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"15136588270\",\n\t\t\t\t\tType: pb.Person_MOBILE,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"190019393\",\n\t\t\t\t\tType: pb.Person_HOME,\n\t\t\t\t},\n\t\t\t\t&pb.Person_PhoneNumber{\n\t\t\t\t\tNumber: \"17182920303\",\n\t\t\t\t\tType: pb.Person_WORK,\n\t\t\t\t},\n\t\t\t},\n\t\t}\n\n\t\t// Person\n\t\tdata, err := proto.Marshal(person)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"proto marshal error: \", err)\n\t\t}\n\n\t\t// \n\t\tnewData := &pb.Person{}\n\t\terr = proto.Unmarshal(data, newData)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"unmarshal error: \", err)\n\t\t}\n\t\tfmt.Println(newData)\n\t}\n\t```\n\n## rpc\n* \n\t- Rpc()\n\t``` go\n\trpc.RegisterName(\"\", )\n\t```\n\n\t- \n\t``` go\n\tlistener, err := net.Listen()\n\t```\n\n\t- \n\t``` go\n\tconn, err := listener.Accept()\n\t```\n\n\t- Rpc\n\t``` go\n\trpc.ServeConn(conn)\n\t```\n\n* \n\t- Rpc\n\t``` go\n\tconn, err := rpc.Dial()\n\t```\n\n\t- \n\t``` go\n\tconn.Call(\".\", , )\n\t```\n\n* \n\t``` go\n\tpackage design\n\n\timport (\n\t\t\"net/rpc\"\n\t\t\"net/rpc/jsonrpc\"\n\t)\n\n\t// \n\t/*\n\t\t* \n\t\t* \n\t*/\n\ttype MyInterface interface {\n\t\tHelloWorld(string, *string) error\n\t}\n\n\tfunc RegisterService(i MyInterface) error {\n\t\treturn rpc.RegisterName(\"hello\", i)\n\t}\n\n\t// \n\t/*\n\t\t* \n\t\t* ( rpc.Client) \n\t\t* InitClient\n\t*/\n\ttype MyClient struct {\n\t\tc *rpc.Client\n\t}\n\n\tfunc InitClient(addr string) *MyClient {\n\t\tconn, _ := jsonrpc.Dial(\"tcp\", addr)\n\n\t\treturn &MyClient{c:conn}\n\t}\n\n\tfunc (m *MyClient)HelloWorld(a string, b *string) error {\n\t\treturn m.c.Call(\"hello.HelloWorld\", a, b)\n\t}\n\t```\n\n\n## grpc \n\n* grpc go\n\t``` bash\n\tgo get -u -v google.golang.org/grpc\n\t```\n\n* .proto\n\n\t`pb/hello_grpc.proto`\n\n\t``` protobuf\n\t// protobuf\n\tsyntax = \"proto3\";\n\n\tpackage pb;\n\n\toption go_package = \"./;pb\";\n\n\t// \n\tservice Greeter {\n\t  rpc SayHello (HelloRequest) returns (HelloReply) {}\n\t}\n\n\tmessage HelloRequest {\n\t  string name = 1;\n\t}\n\n\tmessage HelloReply {\n\t  string message = 1;\n\t}\n\t```\n\n* .proto\n\t- go\n\t\t``` bash\n\t\tgo get -u github.com/golang/protobuf/protoc-gen-go\n\t\t```\n\t- .proto\n\t\t``` bash\n\t\tprotoc *.proto --go_out=plugins=grpc:./\n\t\t* --go_out=plugins=grpc: go\n\t\t```\n\n\n* \n\t`server/server.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"fmt\"\n\t\t\"exercise/rpc/net.rpc/pb\"\n\t\t\"google.golang.org/grpc\"\n\t\t\"google.golang.org/grpc/reflection\"\n\t\t\"net\"\n\t)\n\n\ttype server struct {}\n\n\t// \n\tfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) {\n\t\treturn &pb.HelloReply{Message: \"hello \" + in.Name}, nil\n\t}\n\n\tfunc main() {\n\t\t// \n\t\tlis, err := net.Listen(\"tcp\", \":8080\")\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\t// gRPC\n\t\ts := grpc.NewServer()\n\n\t\t// \n\t\tpb.RegisterGreeterServer(s, &server{})\n\n\t\treflection.Register(s)\n\n\t\t// \n\t\terr = s.Serve(lis)\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t}\n\t```\n\n* \n\t`client/client.go`\n\t``` go\n\tpackage main\n\n\timport (\n\t\t\"context\"\n\t\t\"exercise/rpc/net.rpc/pb\"\n\t\t\"fmt\"\n\t\t\"google.golang.org/grpc\"\n\t)\n\n\tfunc main(){\n\t\t// \n\t\tconn, err := grpc.Dial(\":8080\", grpc.WithInsecure())\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\t\tdefer conn.Close()\n\n\t\t// \n\t\tc := pb.NewGreeterClient(conn)\n\n\t\t// \n\t\tr, err := c.SayHello(context.Background(), &pb.HelloRequest{Name: \"horika\"})\n\t\tif err != nil {\n\t\t\tfmt.Printf(\": %s\", err)\n\t\t\treturn\n\t\t}\n\n\t\tfmt.Printf(\": %s\", r.Message)\n\t}\n\t```\n\n## rpcx\n\n* [rpcx](https://doc.rpcx.io/)\n\n* `rpcx`\n\n``` bash\ngo get -u -v -tags \"reuseport quic kcp zookeeper etcd consul ping\" github.com/smallnest/rpcx/...\n```\n\n`:`\n\n`server/server.go`\n\n``` go\npackage main\n\nimport (\n\t\"flag\"\n\t\"github.com/smallnest/rpcx/server\"\n\t\"github.com/smallnest/rpcx/serverplugin\"\n\t\"log\"\n\t\"time\"\n)\n\nvar (\n\taddr      = flag.String(\"addr\", \"localhost:8972\", \"server address\")\n\tetcdServers = []string{\"127.0.0.1:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main() {\n\tflag.Parse()\n\n\t//1newstruct\n\ts := server.NewServer()\n\t//2zookeeper\n\taddRegistryPlugin(s)\n\t//3\n\ts.RegisterName(\"Arith\", new(Arith), \"\")\n\t//4\n\ts.Serve(\"tcp\", *addr)\n}\n\nfunc addRegistryPlugin(s *server.Server) {\n\tr := &serverplugin.EtcdV3RegisterPlugin{\n\t\tServiceAddress: \"tcp@\" + *addr,\n\t\tEtcdServers:   etcdServers,\n\t\tBasePath:       basePath,\n\t\tUpdateInterval: time.Minute,\n\t}\n\terr := r.Start()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\ts.Plugins.Add(r)\n}\n```\n\n`server/rpc.go`\n\n``` go\npackage main \n\n// \ntype Arith int\n\nfunc (t *Arith) Mul(cxt context.Context, args *Args, reply *int) error {\n  fmt.Println(\"Mul on\", *addr)\n  *reply = args.A * args.B\n  return nil\n}\n\nfunc (t *Arith) Div(cxt context.Context, args *Args, quo *Quotient) error {\n  fmt.Println(\"Div on\", *addr)\n  if args.B == 0 {\n    return errors.New(\"divide by 0\")\n  }\n\n  quo.Quo = args.A / args.B\n  quo.Rem = args.A % args.B\n  return nil\n}\n```\n\n`proto/proto.go`\n\n``` go\npackage proto\n\ntype Args struct {\n\tA, B int\n}\n\ntype Quotient struct {\n\tQuo, Rem int\n}\n\n```\n\n* server\n* \n* \n* \n\n\n``\n\n`client.go`\n\n``` go\npackage main\n\nimport (\n\t\"github.com/smallnest/rpcx/client\"\n\t\"context\"\n\t\"flag\"\n\t\"log\"\n\t\"time\"\n\n\t\"exercise/rpcx_test/proto\"\n)\nvar (\n\tetcdServers = []string{\"localhost:2379\"}\n\tbasePath  = \"/rpcx/test\"\n)\n\nfunc main()  {\n\tflag.Parse()\n\n\t//1ZookeeperDiscovery\n\td := client.NewEtcdV3Discovery(basePath,\"Arith\", etcdServers, nil)\n\t//2\n\txclient := client.NewXClient(\"Arith\", client.Failtry, client.RandomSelect, d, client.DefaultOption)\n\n\tdefer xclient.Close()\n\n\targs := &proto.Args{\n\t\tA: 25,\n\t\tB: 4,\n\t}\n\n\tquo := &proto.Quotient{}\n\n\tfor {\n\t\treply := new(int)\n\n\t\terr := xclient.Call(context.Background(), \"Mul\", args, reply)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\n\t\tlog.Printf(\"%d * %d = %d\", args.A, args.B, *reply)\n\n\t\terr = xclient.Call(context.Background(), \"Div\", args, quo)\n\t\tif err != nil {\n\t\t\tlog.Printf(\"failed to call: %v\\n\", err)\n\t\t}\n\t\tlog.Printf(\"%d / %d = %d, %d\", args.A, args.B, quo.Quo, quo.Rem)\n\t\ttime.Sleep(3*time.Second)\n\t}\n}\n\n```\n\n* \n\n\n\t- \n\t- \n\n* \n* \n\n\n## go_micro\n\n### \n* : `zookeeper``eureka``consul``etcd`  \n\n* : v\n\n* : pullpush\n\n### consul\n\n* consul\n\t- \n\t- \n\t- \n\t- \n\n* consul\n\t``` bash\n\t## Consul\n\twget https://releases.hashicorp.com/consul/1.10.3/consul_1.10.3_linux_amd64.zip\n\t##unzip\n\tunzip consul_1.10.3_linux_amd64.zip\n\t##consul/usr/local/bin\n\tmv consul /usr/local/bin\n\t##\n\tconsul --version\n\t```\n\n* consul\n\t```  bash\n\tconsul agent\n\t\t* -bind=0.0.0.0consulIP\n\t\t* -http-port=8500: consulweb: 8500\n\t\t* -server server \n\t\t* -client = 127.0.0.1: consul127.0.0.10.0.0.0\n\t\t* -config-dir.json\n\t\t* -data-dir\n\t\t* -dev: consul\n\t\t* -node\n\t\t* -join\n\t\t* -ui: web\n\n\t# (127ipclient)\n\tconsul agent -dev -ui\n\n\t# ipclient\n\tconsul agent -dev  -client=0.0.0.0 -ui\n\t```\n\n* consul\n\t``` bash\n\t# server1(leader)\n\tconsul agent -server -bootstrap -bind=192.168.31.188 -client=0.0.0.0 -data-dir=./data/server1 -ui -node=server1\n\n\t# server2(follower)\n\tconsul agent -server -bind=192.168.31.187 -client=0.0.0.0 -data-dir=./data/server2 -ui -node=server2 -join=192.168.31.188 \n\n\t# server3(follower)\n\tconsul agent -server -bind=192.168.31.186 -client=0.0.0.0 -data-dir=./data/server3 -ui -node=server3 -join=192.168.31.188\n\n\t# client1\n\tconsul agent -ui -bind=192.168.31.185 -client=0.0.0.0 -data-dir=./data/client1 -ui -node=client1 -join=192.168.31.188\n\n\t# \n\tconsul members\n\n\t# \n\tconsul info\n\n\t# consul\n\tconsul leave\n\n\t# \n\tconsul reload\n\t```\n\n\n\n\n","slug":"go/go_micro","published":1,"date":"2022-07-03T02:10:25.593Z","updated":"2022-07-03T02:10:25.593Z","_id":"cl444xpwg00048owzas51d4ka","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>:<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>:<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"rpc\"><a href=\"#rpc\" class=\"headerlink\" title=\"rpc\"></a>rpc</h2><ul>\n<li><p></p>\n<ol>\n<li>rpc <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.RegisterName(<span class=\"string\">&quot;&quot;</span>, )</span><br><span class=\"line\"></span><br><span class=\"line\">* :</span><br><span class=\"line\">\t- </span><br><span class=\"line\">\t- ()</span><br><span class=\"line\">\t-  <span class=\"type\">error</span> </span><br></pre></td></tr></table></figure></li>\n<li> <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listener, err := net.Listen()</span><br></pre></td></tr></table></figure></li>\n<li> <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := listener.Accept()</span><br></pre></td></tr></table></figure></li>\n<li>rpc <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><p> </p>\n<ol>\n<li>rpc <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := rpc.Dial()</span><br></pre></td></tr></table></figure></li>\n<li> <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn.Call(<span class=\"string\">&quot;.&quot;</span>, , )</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>protobuf</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># protobuf</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/protocolbuffers/protobuf.git</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> protobuf/</span><br><span class=\"line\"><span class=\"comment\"># configure</span></span><br><span class=\"line\">./autogen.sh</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">./configure</span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\">sudo ldconfig</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">protoc -h</span><br></pre></td></tr></table></figure></li>\n<li><p>go </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class=\"line\">go get -u google.golang.org/protobuf/proto</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>.proto</p>\n<p>  <code>pb/Person.proto: </code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;google/protobuf/timestamp.proto&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;pb&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"type\">int32</span> id = <span class=\"number\">2</span>;  <span class=\"comment\">// Unique ID number for this person.</span></span><br><span class=\"line\">\t<span class=\"type\">string</span> email = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">enum </span><span class=\"title class_\">PhoneType</span> &#123;</span><br><span class=\"line\">\t  MOBILE = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t  HOME = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  WORK = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">message </span><span class=\"title class_\">PhoneNumber</span> &#123;</span><br><span class=\"line\">\t  <span class=\"type\">string</span> number = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  PhoneType type = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> PhoneNumber phones = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tgoogle.protobuf.Timestamp last_updated = <span class=\"number\">5</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Our address book file is just one of these.</span></span><br><span class=\"line\">  <span class=\"keyword\">message </span><span class=\"title class_\">AddressBook</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> Person people = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc *.proto --go_out=.</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpc/net.rpc/pb&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/protobuf/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tperson := &amp;pb.Person&#123;</span><br><span class=\"line\">\t\tName:  <span class=\"string\">&quot;lijiahao&quot;</span>,</span><br><span class=\"line\">\t\tId:    <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\tEmail: <span class=\"string\">&quot;18702748294@163.com&quot;</span>,</span><br><span class=\"line\">\t\tPhones: []*pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;15136588270&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_MOBILE,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;190019393&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_HOME,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;17182920303&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_WORK,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tdata, err := proto.Marshal(person)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;proto marshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tnewData := &amp;pb.Person&#123;&#125;</span><br><span class=\"line\">\terr = proto.Unmarshal(data, newData)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;unmarshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Println(newData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"rpc\"><a href=\"#rpc\" class=\"headerlink\" title=\"rpc\"></a>rpc</h2><ul>\n<li><p></p>\n<ul>\n<li><p>Rpc()</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.RegisterName(<span class=\"string\">&quot;&quot;</span>, )</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listener, err := net.Listen()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := listener.Accept()</span><br></pre></td></tr></table></figure></li>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := rpc.Dial()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn.Call(<span class=\"string\">&quot;.&quot;</span>, , )</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> design</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc/jsonrpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyInterface <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tHelloWorld(<span class=\"type\">string</span>, *<span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">RegisterService</span><span class=\"params\">(i MyInterface)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> rpc.RegisterName(<span class=\"string\">&quot;hello&quot;</span>, i)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* ( rpc.Client) </span></span><br><span class=\"line\"><span class=\"comment\">\t* InitClient</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyClient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tc *rpc.Client</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">InitClient</span><span class=\"params\">(addr <span class=\"type\">string</span>)</span></span> *MyClient &#123;</span><br><span class=\"line\">\tconn, _ := jsonrpc.Dial(<span class=\"string\">&quot;tcp&quot;</span>, addr)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MyClient&#123;c:conn&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *MyClient)</span></span>HelloWorld(a <span class=\"type\">string</span>, b *<span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> m.c.Call(<span class=\"string\">&quot;hello.HelloWorld&quot;</span>, a, b)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"grpc-\"><a href=\"#grpc-\" class=\"headerlink\" title=\"grpc \"></a>grpc </h2><ul>\n<li><p>grpc go</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v google.golang.org/grpc</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<p>  <code>pb/hello_grpc.proto</code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// protobuf</span></span><br><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;pb&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">service </span><span class=\"title class_\">Greeter</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">rpc</span> SayHello (HelloRequest) <span class=\"keyword\">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloReply</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> message = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<ul>\n<li>go  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br></pre></td></tr></table></figure></li>\n<li>.proto  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc *.proto --go_out=plugins=grpc:./</span><br><span class=\"line\">* --go_out=plugins=grpc: go</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p><br>  <code>server/server.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpc/net.rpc/pb&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc/reflection&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> server <span class=\"keyword\">struct</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *server)</span></span> SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;pb.HelloReply&#123;Message: <span class=\"string\">&quot;hello &quot;</span> + in.Name&#125;, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tlis, err := net.Listen(<span class=\"string\">&quot;tcp&quot;</span>, <span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// gRPC</span></span><br><span class=\"line\">\ts := grpc.NewServer()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tpb.RegisterGreeterServer(s, &amp;server&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\treflection.Register(s)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\terr = s.Serve(lis)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><br>  <code>client/client.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpc/net.rpc/pb&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tconn, err := grpc.Dial(<span class=\"string\">&quot;:8080&quot;</span>, grpc.WithInsecure())</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tc := pb.NewGreeterClient(conn)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr, err := c.SayHello(context.Background(), &amp;pb.HelloRequest&#123;Name: <span class=\"string\">&quot;horika&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, r.Message)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"rpcx\"><a href=\"#rpcx\" class=\"headerlink\" title=\"rpcx\"></a>rpcx</h2><ul>\n<li><p><a href=\"https://doc.rpcx.io/\">rpcx</a></p>\n</li>\n<li><p><code>rpcx</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v -tags <span class=\"string\">&quot;reuseport quic kcp zookeeper etcd consul ping&quot;</span> github.com/smallnest/rpcx/...</span><br></pre></td></tr></table></figure>\n\n<p><code>:</code></p>\n<p><code>server/server.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/server&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/serverplugin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\taddr      = flag.String(<span class=\"string\">&quot;addr&quot;</span>, <span class=\"string\">&quot;localhost:8972&quot;</span>, <span class=\"string\">&quot;server address&quot;</span>)</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;127.0.0.1:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1newstruct</span></span><br><span class=\"line\">\ts := server.NewServer()</span><br><span class=\"line\">\t<span class=\"comment\">//2zookeeper</span></span><br><span class=\"line\">\taddRegistryPlugin(s)</span><br><span class=\"line\">\t<span class=\"comment\">//3</span></span><br><span class=\"line\">\ts.RegisterName(<span class=\"string\">&quot;Arith&quot;</span>, <span class=\"built_in\">new</span>(Arith), <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//4</span></span><br><span class=\"line\">\ts.Serve(<span class=\"string\">&quot;tcp&quot;</span>, *addr)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addRegistryPlugin</span><span class=\"params\">(s *server.Server)</span></span> &#123;</span><br><span class=\"line\">\tr := &amp;serverplugin.EtcdV3RegisterPlugin&#123;</span><br><span class=\"line\">\t\tServiceAddress: <span class=\"string\">&quot;tcp@&quot;</span> + *addr,</span><br><span class=\"line\">\t\tEtcdServers:   etcdServers,</span><br><span class=\"line\">\t\tBasePath:       basePath,</span><br><span class=\"line\">\t\tUpdateInterval: time.Minute,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr := r.Start()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Fatal(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ts.Plugins.Add(r)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>server/rpc.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Arith <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Mul(cxt context.Context, args *Args, reply *<span class=\"type\">int</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Mul on&quot;</span>, *addr)</span><br><span class=\"line\">  *reply = args.A * args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Div(cxt context.Context, args *Args, quo *Quotient) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Div on&quot;</span>, *addr)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> args.B == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;divide by 0&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  quo.Quo = args.A / args.B</span><br><span class=\"line\">  quo.Rem = args.A % args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>proto/proto.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> proto</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Args <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tA, B <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Quotient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tQuo, Rem <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>server</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><code></code></p>\n<p><code>client.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/client&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpcx_test/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1ZookeeperDiscovery</span></span><br><span class=\"line\">\td := client.NewEtcdV3Discovery(basePath,<span class=\"string\">&quot;Arith&quot;</span>, etcdServers, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//2</span></span><br><span class=\"line\">\txclient := client.NewXClient(<span class=\"string\">&quot;Arith&quot;</span>, client.Failtry, client.RandomSelect, d, client.DefaultOption)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> xclient.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\targs := &amp;proto.Args&#123;</span><br><span class=\"line\">\t\tA: <span class=\"number\">25</span>,</span><br><span class=\"line\">\t\tB: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tquo := &amp;proto.Quotient&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\treply := <span class=\"built_in\">new</span>(<span class=\"type\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr := xclient.Call(context.Background(), <span class=\"string\">&quot;Mul&quot;</span>, args, reply)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d * %d = %d&quot;</span>, args.A, args.B, *reply)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr = xclient.Call(context.Background(), <span class=\"string\">&quot;Div&quot;</span>, args, quo)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d / %d = %d, %d&quot;</span>, args.A, args.B, quo.Quo, quo.Rem)</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">3</span>*time.Second)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p><br>    - <br>    - </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"go-micro\"><a href=\"#go-micro\" class=\"headerlink\" title=\"go_micro\"></a>go_micro</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p>: <code>zookeeper</code><code>eureka</code><code>consul</code><code>etcd</code>  </p>\n</li>\n<li><p>: v</p>\n</li>\n<li><p>: pullpush</p>\n</li>\n</ul>\n<h3 id=\"consul\"><a href=\"#consul\" class=\"headerlink\" title=\"consul\"></a>consul</h3><ul>\n<li><p>consul</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p>consul</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Consul</span></span><br><span class=\"line\">wget https://releases.hashicorp.com/consul/1.10.3/consul_1.10.3_linux_amd64.zip</span><br><span class=\"line\"><span class=\"comment\">##unzip</span></span><br><span class=\"line\">unzip consul_1.10.3_linux_amd64.zip</span><br><span class=\"line\"><span class=\"comment\">##consul/usr/local/bin</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> consul /usr/local/bin</span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\">consul --version</span><br></pre></td></tr></table></figure></li>\n<li><p>consul</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">consul agent</span><br><span class=\"line\">\t* -<span class=\"built_in\">bind</span>=0.0.0.0consulIP</span><br><span class=\"line\">\t* -http-port=8500: consulweb: 8500</span><br><span class=\"line\">\t* -server server </span><br><span class=\"line\">\t* -client = 127.0.0.1: consul127.0.0.10.0.0.0</span><br><span class=\"line\">\t* -config-dir.json</span><br><span class=\"line\">\t* -data-dir</span><br><span class=\"line\">\t* -dev: consul</span><br><span class=\"line\">\t* -node</span><br><span class=\"line\">\t* -<span class=\"built_in\">join</span></span><br><span class=\"line\">\t* -ui: web</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (127ipclient)</span></span><br><span class=\"line\">consul agent -dev -ui</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ipclient</span></span><br><span class=\"line\">consul agent -dev  -client=0.0.0.0 -ui</span><br></pre></td></tr></table></figure></li>\n<li><p>consul</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># server1(leader)</span></span><br><span class=\"line\">consul agent -server -bootstrap -<span class=\"built_in\">bind</span>=192.168.31.188 -client=0.0.0.0 -data-dir=./data/server1 -ui -node=server1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># server2(follower)</span></span><br><span class=\"line\">consul agent -server -<span class=\"built_in\">bind</span>=192.168.31.187 -client=0.0.0.0 -data-dir=./data/server2 -ui -node=server2 -<span class=\"built_in\">join</span>=192.168.31.188 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># server3(follower)</span></span><br><span class=\"line\">consul agent -server -<span class=\"built_in\">bind</span>=192.168.31.186 -client=0.0.0.0 -data-dir=./data/server3 -ui -node=server3 -<span class=\"built_in\">join</span>=192.168.31.188</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># client1</span></span><br><span class=\"line\">consul agent -ui -<span class=\"built_in\">bind</span>=192.168.31.185 -client=0.0.0.0 -data-dir=./data/client1 -ui -node=client1 -<span class=\"built_in\">join</span>=192.168.31.188</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">consul members</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">consul info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># consul</span></span><br><span class=\"line\">consul leave</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">consul reload</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>:<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>:<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"rpc\"><a href=\"#rpc\" class=\"headerlink\" title=\"rpc\"></a>rpc</h2><ul>\n<li><p></p>\n<ol>\n<li>rpc <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.RegisterName(<span class=\"string\">&quot;&quot;</span>, )</span><br><span class=\"line\"></span><br><span class=\"line\">* :</span><br><span class=\"line\">\t- </span><br><span class=\"line\">\t- ()</span><br><span class=\"line\">\t-  <span class=\"type\">error</span> </span><br></pre></td></tr></table></figure></li>\n<li> <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listener, err := net.Listen()</span><br></pre></td></tr></table></figure></li>\n<li> <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := listener.Accept()</span><br></pre></td></tr></table></figure></li>\n<li>rpc <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><p> </p>\n<ol>\n<li>rpc <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := rpc.Dial()</span><br></pre></td></tr></table></figure></li>\n<li> <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn.Call(<span class=\"string\">&quot;.&quot;</span>, , )</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>protobuf</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># protobuf</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/protocolbuffers/protobuf.git</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo apt-get install autoconf  automake  libtool curl make  g++  unzip libffi-dev -y</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> protobuf/</span><br><span class=\"line\"><span class=\"comment\"># configure</span></span><br><span class=\"line\">./autogen.sh</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">./configure</span><br><span class=\"line\"><span class=\"comment\"># ()</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"><span class=\"comment\">#  </span></span><br><span class=\"line\">sudo ldconfig</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">protoc -h</span><br></pre></td></tr></table></figure></li>\n<li><p>go </p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br><span class=\"line\">go get -u google.golang.org/protobuf/proto</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"protobuf\"><a href=\"#protobuf\" class=\"headerlink\" title=\"protobuf\"></a>protobuf</h2><ul>\n<li><p>.proto</p>\n<p>  <code>pb/Person.proto: </code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;google/protobuf/timestamp.proto&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;pb&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">Person</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"type\">int32</span> id = <span class=\"number\">2</span>;  <span class=\"comment\">// Unique ID number for this person.</span></span><br><span class=\"line\">\t<span class=\"type\">string</span> email = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">enum </span><span class=\"title class_\">PhoneType</span> &#123;</span><br><span class=\"line\">\t  MOBILE = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t  HOME = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  WORK = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">message </span><span class=\"title class_\">PhoneNumber</span> &#123;</span><br><span class=\"line\">\t  <span class=\"type\">string</span> number = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t  PhoneType type = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> PhoneNumber phones = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tgoogle.protobuf.Timestamp last_updated = <span class=\"number\">5</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Our address book file is just one of these.</span></span><br><span class=\"line\">  <span class=\"keyword\">message </span><span class=\"title class_\">AddressBook</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">repeated</span> Person people = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc *.proto --go_out=.</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpc/net.rpc/pb&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/protobuf/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tperson := &amp;pb.Person&#123;</span><br><span class=\"line\">\t\tName:  <span class=\"string\">&quot;lijiahao&quot;</span>,</span><br><span class=\"line\">\t\tId:    <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\tEmail: <span class=\"string\">&quot;18702748294@163.com&quot;</span>,</span><br><span class=\"line\">\t\tPhones: []*pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;15136588270&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_MOBILE,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;190019393&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_HOME,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&amp;pb.Person_PhoneNumber&#123;</span><br><span class=\"line\">\t\t\t\tNumber: <span class=\"string\">&quot;17182920303&quot;</span>,</span><br><span class=\"line\">\t\t\t\tType: pb.Person_WORK,</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Person</span></span><br><span class=\"line\">\tdata, err := proto.Marshal(person)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;proto marshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tnewData := &amp;pb.Person&#123;&#125;</span><br><span class=\"line\">\terr = proto.Unmarshal(data, newData)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;unmarshal error: &quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Println(newData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"rpc\"><a href=\"#rpc\" class=\"headerlink\" title=\"rpc\"></a>rpc</h2><ul>\n<li><p></p>\n<ul>\n<li><p>Rpc()</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.RegisterName(<span class=\"string\">&quot;&quot;</span>, )</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listener, err := net.Listen()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := listener.Accept()</span><br></pre></td></tr></table></figure></li>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n<ul>\n<li><p>Rpc</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn, err := rpc.Dial()</span><br></pre></td></tr></table></figure></li>\n<li><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">conn.Call(<span class=\"string\">&quot;.&quot;</span>, , )</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> design</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/rpc/jsonrpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyInterface <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tHelloWorld(<span class=\"type\">string</span>, *<span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">RegisterService</span><span class=\"params\">(i MyInterface)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> rpc.RegisterName(<span class=\"string\">&quot;hello&quot;</span>, i)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t* </span></span><br><span class=\"line\"><span class=\"comment\">\t* ( rpc.Client) </span></span><br><span class=\"line\"><span class=\"comment\">\t* InitClient</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyClient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tc *rpc.Client</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">InitClient</span><span class=\"params\">(addr <span class=\"type\">string</span>)</span></span> *MyClient &#123;</span><br><span class=\"line\">\tconn, _ := jsonrpc.Dial(<span class=\"string\">&quot;tcp&quot;</span>, addr)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MyClient&#123;c:conn&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *MyClient)</span></span>HelloWorld(a <span class=\"type\">string</span>, b *<span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> m.c.Call(<span class=\"string\">&quot;hello.HelloWorld&quot;</span>, a, b)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"grpc-\"><a href=\"#grpc-\" class=\"headerlink\" title=\"grpc \"></a>grpc </h2><ul>\n<li><p>grpc go</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v google.golang.org/grpc</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<p>  <code>pb/hello_grpc.proto</code></p>\n  <figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// protobuf</span></span><br><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> pb;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> go_package = <span class=\"string\">&quot;./;pb&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">service </span><span class=\"title class_\">Greeter</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">rpc</span> SayHello (HelloRequest) <span class=\"keyword\">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloReply</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> message = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>.proto</p>\n<ul>\n<li>go  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/golang/protobuf/protoc-gen-go</span><br></pre></td></tr></table></figure></li>\n<li>.proto  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc *.proto --go_out=plugins=grpc:./</span><br><span class=\"line\">* --go_out=plugins=grpc: go</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p><br>  <code>server/server.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpc/net.rpc/pb&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc/reflection&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> server <span class=\"keyword\">struct</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *server)</span></span> SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;pb.HelloReply&#123;Message: <span class=\"string\">&quot;hello &quot;</span> + in.Name&#125;, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tlis, err := net.Listen(<span class=\"string\">&quot;tcp&quot;</span>, <span class=\"string\">&quot;:8080&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// gRPC</span></span><br><span class=\"line\">\ts := grpc.NewServer()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tpb.RegisterGreeterServer(s, &amp;server&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\treflection.Register(s)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\terr = s.Serve(lis)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><br>  <code>client/client.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpc/net.rpc/pb&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;google.golang.org/grpc&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tconn, err := grpc.Dial(<span class=\"string\">&quot;:8080&quot;</span>, grpc.WithInsecure())</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tc := pb.NewGreeterClient(conn)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tr, err := c.SayHello(context.Background(), &amp;pb.HelloRequest&#123;Name: <span class=\"string\">&quot;horika&quot;</span>&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, err)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;: %s&quot;</span>, r.Message)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"rpcx\"><a href=\"#rpcx\" class=\"headerlink\" title=\"rpcx\"></a>rpcx</h2><ul>\n<li><p><a href=\"https://doc.rpcx.io/\">rpcx</a></p>\n</li>\n<li><p><code>rpcx</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u -v -tags <span class=\"string\">&quot;reuseport quic kcp zookeeper etcd consul ping&quot;</span> github.com/smallnest/rpcx/...</span><br></pre></td></tr></table></figure>\n\n<p><code>:</code></p>\n<p><code>server/server.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/server&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/serverplugin&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\taddr      = flag.String(<span class=\"string\">&quot;addr&quot;</span>, <span class=\"string\">&quot;localhost:8972&quot;</span>, <span class=\"string\">&quot;server address&quot;</span>)</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;127.0.0.1:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1newstruct</span></span><br><span class=\"line\">\ts := server.NewServer()</span><br><span class=\"line\">\t<span class=\"comment\">//2zookeeper</span></span><br><span class=\"line\">\taddRegistryPlugin(s)</span><br><span class=\"line\">\t<span class=\"comment\">//3</span></span><br><span class=\"line\">\ts.RegisterName(<span class=\"string\">&quot;Arith&quot;</span>, <span class=\"built_in\">new</span>(Arith), <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//4</span></span><br><span class=\"line\">\ts.Serve(<span class=\"string\">&quot;tcp&quot;</span>, *addr)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addRegistryPlugin</span><span class=\"params\">(s *server.Server)</span></span> &#123;</span><br><span class=\"line\">\tr := &amp;serverplugin.EtcdV3RegisterPlugin&#123;</span><br><span class=\"line\">\t\tServiceAddress: <span class=\"string\">&quot;tcp@&quot;</span> + *addr,</span><br><span class=\"line\">\t\tEtcdServers:   etcdServers,</span><br><span class=\"line\">\t\tBasePath:       basePath,</span><br><span class=\"line\">\t\tUpdateInterval: time.Minute,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\terr := r.Start()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlog.Fatal(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ts.Plugins.Add(r)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>server/rpc.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Arith <span class=\"type\">int</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Mul(cxt context.Context, args *Args, reply *<span class=\"type\">int</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Mul on&quot;</span>, *addr)</span><br><span class=\"line\">  *reply = args.A * args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(t *Arith)</span></span> Div(cxt context.Context, args *Args, quo *Quotient) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">&quot;Div on&quot;</span>, *addr)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> args.B == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;divide by 0&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  quo.Quo = args.A / args.B</span><br><span class=\"line\">  quo.Rem = args.A % args.B</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>proto/proto.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> proto</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Args <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tA, B <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Quotient <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tQuo, Rem <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>server</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><code></code></p>\n<p><code>client.go</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/smallnest/rpcx/client&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;context&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;flag&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;exercise/rpcx_test/proto&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tetcdServers = []<span class=\"type\">string</span>&#123;<span class=\"string\">&quot;localhost:2379&quot;</span>&#125;</span><br><span class=\"line\">\tbasePath  = <span class=\"string\">&quot;/rpcx/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>  &#123;</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//1ZookeeperDiscovery</span></span><br><span class=\"line\">\td := client.NewEtcdV3Discovery(basePath,<span class=\"string\">&quot;Arith&quot;</span>, etcdServers, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//2</span></span><br><span class=\"line\">\txclient := client.NewXClient(<span class=\"string\">&quot;Arith&quot;</span>, client.Failtry, client.RandomSelect, d, client.DefaultOption)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> xclient.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\targs := &amp;proto.Args&#123;</span><br><span class=\"line\">\t\tA: <span class=\"number\">25</span>,</span><br><span class=\"line\">\t\tB: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tquo := &amp;proto.Quotient&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\treply := <span class=\"built_in\">new</span>(<span class=\"type\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr := xclient.Call(context.Background(), <span class=\"string\">&quot;Mul&quot;</span>, args, reply)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d * %d = %d&quot;</span>, args.A, args.B, *reply)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\terr = xclient.Call(context.Background(), <span class=\"string\">&quot;Div&quot;</span>, args, quo)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tlog.Printf(<span class=\"string\">&quot;failed to call: %v\\n&quot;</span>, err)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlog.Printf(<span class=\"string\">&quot;%d / %d = %d, %d&quot;</span>, args.A, args.B, quo.Quo, quo.Rem)</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">3</span>*time.Second)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li></li>\n</ul>\n<p><br>    - <br>    - </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"go-micro\"><a href=\"#go-micro\" class=\"headerlink\" title=\"go_micro\"></a>go_micro</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><p>: <code>zookeeper</code><code>eureka</code><code>consul</code><code>etcd</code>  </p>\n</li>\n<li><p>: v</p>\n</li>\n<li><p>: pullpush</p>\n</li>\n</ul>\n<h3 id=\"consul\"><a href=\"#consul\" class=\"headerlink\" title=\"consul\"></a>consul</h3><ul>\n<li><p>consul</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><p>consul</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Consul</span></span><br><span class=\"line\">wget https://releases.hashicorp.com/consul/1.10.3/consul_1.10.3_linux_amd64.zip</span><br><span class=\"line\"><span class=\"comment\">##unzip</span></span><br><span class=\"line\">unzip consul_1.10.3_linux_amd64.zip</span><br><span class=\"line\"><span class=\"comment\">##consul/usr/local/bin</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> consul /usr/local/bin</span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\">consul --version</span><br></pre></td></tr></table></figure></li>\n<li><p>consul</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">consul agent</span><br><span class=\"line\">\t* -<span class=\"built_in\">bind</span>=0.0.0.0consulIP</span><br><span class=\"line\">\t* -http-port=8500: consulweb: 8500</span><br><span class=\"line\">\t* -server server </span><br><span class=\"line\">\t* -client = 127.0.0.1: consul127.0.0.10.0.0.0</span><br><span class=\"line\">\t* -config-dir.json</span><br><span class=\"line\">\t* -data-dir</span><br><span class=\"line\">\t* -dev: consul</span><br><span class=\"line\">\t* -node</span><br><span class=\"line\">\t* -<span class=\"built_in\">join</span></span><br><span class=\"line\">\t* -ui: web</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (127ipclient)</span></span><br><span class=\"line\">consul agent -dev -ui</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ipclient</span></span><br><span class=\"line\">consul agent -dev  -client=0.0.0.0 -ui</span><br></pre></td></tr></table></figure></li>\n<li><p>consul</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># server1(leader)</span></span><br><span class=\"line\">consul agent -server -bootstrap -<span class=\"built_in\">bind</span>=192.168.31.188 -client=0.0.0.0 -data-dir=./data/server1 -ui -node=server1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># server2(follower)</span></span><br><span class=\"line\">consul agent -server -<span class=\"built_in\">bind</span>=192.168.31.187 -client=0.0.0.0 -data-dir=./data/server2 -ui -node=server2 -<span class=\"built_in\">join</span>=192.168.31.188 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># server3(follower)</span></span><br><span class=\"line\">consul agent -server -<span class=\"built_in\">bind</span>=192.168.31.186 -client=0.0.0.0 -data-dir=./data/server3 -ui -node=server3 -<span class=\"built_in\">join</span>=192.168.31.188</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># client1</span></span><br><span class=\"line\">consul agent -ui -<span class=\"built_in\">bind</span>=192.168.31.185 -client=0.0.0.0 -data-dir=./data/client1 -ui -node=client1 -<span class=\"built_in\">join</span>=192.168.31.188</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">consul members</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">consul info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># consul</span></span><br><span class=\"line\">consul leave</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">consul reload</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"Golang ","_content":"\n## viper\n* \n\t``` bash\n\tgo get -u github.com/spf13/viper\n\t```\n\n* quickStart() \n\t`config.go`\n\t``` go\n\ttype Config struct {\n\t\tMySQL MySQLConfig\n\t\tRedis RedisConfig\n\t\tLog LogConfig\n\t\tMsgChannelType MsgChannelType\n\t}\n\n\t// MySQL\n\ttype MySQLConfig struct {\n\t\tHost string\n\t\tPort int\n\t\tUser string\n\t\tPassword string\n\t\tDbName string\n\t\tTablePrefix string\n\t}\n\n\ttype RedisConfig struct {\n\t\tAddr string\n\t\tPassword string\n\t\tDB int\n\t\tPoolSize int\n\t\tMinIdleConns int\n\t}\n\n\n\t// \n\ttype LogConfig struct {\n\t\tPath string\n\t\tLevel string\n\t}\n\n\ttype MsgChannelType struct {\n\t\tChannelType string\n\t\tKafkaHosts string\n\t\tKafkaTopic string\n\t}\n\n\tvar c Config \n\n\tfunc init() {\n\t\t// \n\t\tviper.SetConfigName(\"config\")\n\t\t// \n\t\tviper.SetConfigType(\"toml\")\n\t\t// viper\n\t\tviper.AddConfigPath(\".\")\n\t\tviper.AutomaticEnv()\n\t\terr := viper.ReadInConfig()\n\t\tif err != nil {\n\t\t\tpanic(fmt.Errorf(\"fatal error config file: %s\", err))\n\t\t}\n\n\t\tviper.Unmarshal(&c)\n\t}\n\n\tfunc GetConfig() Config {\n\t\treturn c\n\t}\n\t```\n\n\t`config.toml`\n\t``` toml\n\t[mysql]\n\tHost=\"127.0.0.1\"\n\tPort=3306\n\tUser=\"root\"\n\tPassword=\"cv11010216\"\n\tDbName=\"chat\"\n\tTablePrefix=\"\"\n\n\t[redis]\n\tAddr=\"localhost:6379\"\n\tPassword=\"\"\n\tDB=0\n\tPoolSize=30\n\tMinIdleConns=30\n\t```\n\n\t`config_test.go`\n\t``` go\n\tfunc TestGetConfig(t *testing.T) {\n\t\tmySQLConfig := GetConfig().MySQL\n\t\tif mySQLConfig.Host != \"127.0.0.1\" {\n\t\t\tt.Errorf(\"get mySQLConfig error, expect %s, get %s\", \"127.0.0.1\", mySQLConfig.Host)\n\t\t}\n\t\tif mySQLConfig.DbName != \"chat\" {\n\t\t\tt.Errorf(\"get mySQLConfig error, expect %s, get %s\", \"chat\", mySQLConfig.DbName)\n\t\t}\n\t\tif mySQLConfig.TablePrefix != \"\" {\n\t\t\tt.Errorf(\"get mySQLConfig error, expect %s, get %s\", \"chat\", mySQLConfig.TablePrefix)\n\t\t}\n\t}\n\t```\n\n\t\n\n## ini\n\n","source":"_posts/go/go_config.md","raw":"---\ntitle: Golang  \ncategories: \n- GolangStudy\n---\n\n## viper\n* \n\t``` bash\n\tgo get -u github.com/spf13/viper\n\t```\n\n* quickStart() \n\t`config.go`\n\t``` go\n\ttype Config struct {\n\t\tMySQL MySQLConfig\n\t\tRedis RedisConfig\n\t\tLog LogConfig\n\t\tMsgChannelType MsgChannelType\n\t}\n\n\t// MySQL\n\ttype MySQLConfig struct {\n\t\tHost string\n\t\tPort int\n\t\tUser string\n\t\tPassword string\n\t\tDbName string\n\t\tTablePrefix string\n\t}\n\n\ttype RedisConfig struct {\n\t\tAddr string\n\t\tPassword string\n\t\tDB int\n\t\tPoolSize int\n\t\tMinIdleConns int\n\t}\n\n\n\t// \n\ttype LogConfig struct {\n\t\tPath string\n\t\tLevel string\n\t}\n\n\ttype MsgChannelType struct {\n\t\tChannelType string\n\t\tKafkaHosts string\n\t\tKafkaTopic string\n\t}\n\n\tvar c Config \n\n\tfunc init() {\n\t\t// \n\t\tviper.SetConfigName(\"config\")\n\t\t// \n\t\tviper.SetConfigType(\"toml\")\n\t\t// viper\n\t\tviper.AddConfigPath(\".\")\n\t\tviper.AutomaticEnv()\n\t\terr := viper.ReadInConfig()\n\t\tif err != nil {\n\t\t\tpanic(fmt.Errorf(\"fatal error config file: %s\", err))\n\t\t}\n\n\t\tviper.Unmarshal(&c)\n\t}\n\n\tfunc GetConfig() Config {\n\t\treturn c\n\t}\n\t```\n\n\t`config.toml`\n\t``` toml\n\t[mysql]\n\tHost=\"127.0.0.1\"\n\tPort=3306\n\tUser=\"root\"\n\tPassword=\"cv11010216\"\n\tDbName=\"chat\"\n\tTablePrefix=\"\"\n\n\t[redis]\n\tAddr=\"localhost:6379\"\n\tPassword=\"\"\n\tDB=0\n\tPoolSize=30\n\tMinIdleConns=30\n\t```\n\n\t`config_test.go`\n\t``` go\n\tfunc TestGetConfig(t *testing.T) {\n\t\tmySQLConfig := GetConfig().MySQL\n\t\tif mySQLConfig.Host != \"127.0.0.1\" {\n\t\t\tt.Errorf(\"get mySQLConfig error, expect %s, get %s\", \"127.0.0.1\", mySQLConfig.Host)\n\t\t}\n\t\tif mySQLConfig.DbName != \"chat\" {\n\t\t\tt.Errorf(\"get mySQLConfig error, expect %s, get %s\", \"chat\", mySQLConfig.DbName)\n\t\t}\n\t\tif mySQLConfig.TablePrefix != \"\" {\n\t\t\tt.Errorf(\"get mySQLConfig error, expect %s, get %s\", \"chat\", mySQLConfig.TablePrefix)\n\t\t}\n\t}\n\t```\n\n\t\n\n## ini\n\n","slug":"go/go_config","published":1,"date":"2022-07-07T02:57:46.133Z","updated":"2022-07-07T02:57:46.133Z","_id":"cl54p5wlz0000oawzg1sw3774","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"viper\"><a href=\"#viper\" class=\"headerlink\" title=\"viper\"></a>viper</h2><ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/spf13/viper</span><br></pre></td></tr></table></figure></li>\n<li><p>quickStart()<br>  <code>config.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tMySQL MySQLConfig</span><br><span class=\"line\">\tRedis RedisConfig</span><br><span class=\"line\">\tLog LogConfig</span><br><span class=\"line\">\tMsgChannelType MsgChannelType</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// MySQL</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MySQLConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tHost <span class=\"type\">string</span></span><br><span class=\"line\">\tPort <span class=\"type\">int</span></span><br><span class=\"line\">\tUser <span class=\"type\">string</span></span><br><span class=\"line\">\tPassword <span class=\"type\">string</span></span><br><span class=\"line\">\tDbName <span class=\"type\">string</span></span><br><span class=\"line\">\tTablePrefix <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> RedisConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tAddr <span class=\"type\">string</span></span><br><span class=\"line\">\tPassword <span class=\"type\">string</span></span><br><span class=\"line\">\tDB <span class=\"type\">int</span></span><br><span class=\"line\">\tPoolSize <span class=\"type\">int</span></span><br><span class=\"line\">\tMinIdleConns <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> LogConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tPath <span class=\"type\">string</span></span><br><span class=\"line\">\tLevel <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> MsgChannelType <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tChannelType <span class=\"type\">string</span></span><br><span class=\"line\">\tKafkaHosts <span class=\"type\">string</span></span><br><span class=\"line\">\tKafkaTopic <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c Config </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tviper.SetConfigName(<span class=\"string\">&quot;config&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tviper.SetConfigType(<span class=\"string\">&quot;toml&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// viper</span></span><br><span class=\"line\">\tviper.AddConfigPath(<span class=\"string\">&quot;.&quot;</span>)</span><br><span class=\"line\">\tviper.AutomaticEnv()</span><br><span class=\"line\">\terr := viper.ReadInConfig()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(fmt.Errorf(<span class=\"string\">&quot;fatal error config file: %s&quot;</span>, err))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tviper.Unmarshal(&amp;c)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetConfig</span><span class=\"params\">()</span></span> Config &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> c</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>config.toml</code></p>\n  <figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[mysql]</span></span><br><span class=\"line\"><span class=\"attr\">Host</span>=<span class=\"string\">&quot;127.0.0.1&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Port</span>=<span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">User</span>=<span class=\"string\">&quot;root&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Password</span>=<span class=\"string\">&quot;cv11010216&quot;</span></span><br><span class=\"line\"><span class=\"attr\">DbName</span>=<span class=\"string\">&quot;chat&quot;</span></span><br><span class=\"line\"><span class=\"attr\">TablePrefix</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[redis]</span></span><br><span class=\"line\"><span class=\"attr\">Addr</span>=<span class=\"string\">&quot;localhost:6379&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Password</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"attr\">DB</span>=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">PoolSize</span>=<span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">MinIdleConns</span>=<span class=\"number\">30</span></span><br></pre></td></tr></table></figure>\n\n<p>  <code>config_test.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestGetConfig</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tmySQLConfig := GetConfig().MySQL</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> mySQLConfig.Host != <span class=\"string\">&quot;127.0.0.1&quot;</span> &#123;</span><br><span class=\"line\">\t\tt.Errorf(<span class=\"string\">&quot;get mySQLConfig error, expect %s, get %s&quot;</span>, <span class=\"string\">&quot;127.0.0.1&quot;</span>, mySQLConfig.Host)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> mySQLConfig.DbName != <span class=\"string\">&quot;chat&quot;</span> &#123;</span><br><span class=\"line\">\t\tt.Errorf(<span class=\"string\">&quot;get mySQLConfig error, expect %s, get %s&quot;</span>, <span class=\"string\">&quot;chat&quot;</span>, mySQLConfig.DbName)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> mySQLConfig.TablePrefix != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\tt.Errorf(<span class=\"string\">&quot;get mySQLConfig error, expect %s, get %s&quot;</span>, <span class=\"string\">&quot;chat&quot;</span>, mySQLConfig.TablePrefix)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"ini\"><a href=\"#ini\" class=\"headerlink\" title=\"ini\"></a>ini</h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"viper\"><a href=\"#viper\" class=\"headerlink\" title=\"viper\"></a>viper</h2><ul>\n<li><p></p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get -u github.com/spf13/viper</span><br></pre></td></tr></table></figure></li>\n<li><p>quickStart()<br>  <code>config.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Config <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tMySQL MySQLConfig</span><br><span class=\"line\">\tRedis RedisConfig</span><br><span class=\"line\">\tLog LogConfig</span><br><span class=\"line\">\tMsgChannelType MsgChannelType</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// MySQL</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MySQLConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tHost <span class=\"type\">string</span></span><br><span class=\"line\">\tPort <span class=\"type\">int</span></span><br><span class=\"line\">\tUser <span class=\"type\">string</span></span><br><span class=\"line\">\tPassword <span class=\"type\">string</span></span><br><span class=\"line\">\tDbName <span class=\"type\">string</span></span><br><span class=\"line\">\tTablePrefix <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> RedisConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tAddr <span class=\"type\">string</span></span><br><span class=\"line\">\tPassword <span class=\"type\">string</span></span><br><span class=\"line\">\tDB <span class=\"type\">int</span></span><br><span class=\"line\">\tPoolSize <span class=\"type\">int</span></span><br><span class=\"line\">\tMinIdleConns <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> LogConfig <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tPath <span class=\"type\">string</span></span><br><span class=\"line\">\tLevel <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> MsgChannelType <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tChannelType <span class=\"type\">string</span></span><br><span class=\"line\">\tKafkaHosts <span class=\"type\">string</span></span><br><span class=\"line\">\tKafkaTopic <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> c Config </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tviper.SetConfigName(<span class=\"string\">&quot;config&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// </span></span><br><span class=\"line\">\tviper.SetConfigType(<span class=\"string\">&quot;toml&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">// viper</span></span><br><span class=\"line\">\tviper.AddConfigPath(<span class=\"string\">&quot;.&quot;</span>)</span><br><span class=\"line\">\tviper.AutomaticEnv()</span><br><span class=\"line\">\terr := viper.ReadInConfig()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(fmt.Errorf(<span class=\"string\">&quot;fatal error config file: %s&quot;</span>, err))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tviper.Unmarshal(&amp;c)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetConfig</span><span class=\"params\">()</span></span> Config &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> c</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>config.toml</code></p>\n  <figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[mysql]</span></span><br><span class=\"line\"><span class=\"attr\">Host</span>=<span class=\"string\">&quot;127.0.0.1&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Port</span>=<span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">User</span>=<span class=\"string\">&quot;root&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Password</span>=<span class=\"string\">&quot;cv11010216&quot;</span></span><br><span class=\"line\"><span class=\"attr\">DbName</span>=<span class=\"string\">&quot;chat&quot;</span></span><br><span class=\"line\"><span class=\"attr\">TablePrefix</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[redis]</span></span><br><span class=\"line\"><span class=\"attr\">Addr</span>=<span class=\"string\">&quot;localhost:6379&quot;</span></span><br><span class=\"line\"><span class=\"attr\">Password</span>=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"attr\">DB</span>=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">PoolSize</span>=<span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">MinIdleConns</span>=<span class=\"number\">30</span></span><br></pre></td></tr></table></figure>\n\n<p>  <code>config_test.go</code></p>\n  <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestGetConfig</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\tmySQLConfig := GetConfig().MySQL</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> mySQLConfig.Host != <span class=\"string\">&quot;127.0.0.1&quot;</span> &#123;</span><br><span class=\"line\">\t\tt.Errorf(<span class=\"string\">&quot;get mySQLConfig error, expect %s, get %s&quot;</span>, <span class=\"string\">&quot;127.0.0.1&quot;</span>, mySQLConfig.Host)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> mySQLConfig.DbName != <span class=\"string\">&quot;chat&quot;</span> &#123;</span><br><span class=\"line\">\t\tt.Errorf(<span class=\"string\">&quot;get mySQLConfig error, expect %s, get %s&quot;</span>, <span class=\"string\">&quot;chat&quot;</span>, mySQLConfig.DbName)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> mySQLConfig.TablePrefix != <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\tt.Errorf(<span class=\"string\">&quot;get mySQLConfig error, expect %s, get %s&quot;</span>, <span class=\"string\">&quot;chat&quot;</span>, mySQLConfig.TablePrefix)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"ini\"><a href=\"#ini\" class=\"headerlink\" title=\"ini\"></a>ini</h2>"}],"PostAsset":[],"PostCategory":[{"post_id":"cl3tkt6ck0001f8wz6oyg6a13","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncp000hgewzdwkear0y"},{"post_id":"cl3tkt6cn0002f8wzfxc7537q","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncp000igewz37zp35lq"},{"post_id":"cl3tkt6cp0003f8wzf0p7ehx9","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncq000jgewzcnhdg51h"},{"post_id":"cl3tkt6cr0004f8wz0zdzersq","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncr000kgewzbjc8ezxz"},{"post_id":"cl3tkt6cw0007f8wz1p7406ey","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncr000lgewzdhs3an4p"},{"post_id":"cl3tkt6ct0005f8wzakd609vx","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncs000mgewzat7g5iqc"},{"post_id":"cl3tkt6cu0006f8wzf1peaaq7","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncs000ngewzgv56agvb"},{"post_id":"cl3tkt6cy0008f8wz0t3ihje3","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncs000ogewzcmwrdjc3"},{"post_id":"cl3tkt6cz0009f8wz7fk3cy63","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncs000pgewz2c6d37ty"},{"post_id":"cl3tkt6e4000cf8wzhrmw9i2t","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncv000qgewzf4h1fnbl"},{"post_id":"cl3tkt6d0000af8wz30luhxsw","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncv000rgewz9lovcuje"},{"post_id":"cl3tkt6d1000bf8wz7g729joi","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcncz000sgewzatoth1rh"},{"post_id":"cl3tkt6e8000df8wz93wk0xks","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcnd0000tgewzhhme52wm"},{"post_id":"cl3tkt6eb000ef8wzd0qodmyo","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl3tzcnd0000ugewzeja37j5t"},{"post_id":"cl3tyb7uo0006gewz50wkclwx","category_id":"cl3tzef5q000vgewzh2mu1rqw","_id":"cl3tzef5t000wgewzg5wy3gu7"},{"post_id":"cl3tyb7uq0007gewzdlzn2kow","category_id":"cl3tzef5q000vgewzh2mu1rqw","_id":"cl3tzef5w000xgewzbcglclyk"},{"post_id":"cl3tyev590009gewz054f6x2w","category_id":"cl3tzf800000ygewzg2escnh0","_id":"cl3tzf803000zgewzhc7b4yah"},{"post_id":"cl427l9wa00018owzhlly80ao","category_id":"cl3tzf800000ygewzg2escnh0","_id":"cl427l9we00038owzhsdp8ccn"},{"post_id":"cl444xpwg00048owzas51d4ka","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl444xpwx00058owz9ic3eyud"},{"post_id":"cl54p5wlz0000oawzg1sw3774","category_id":"cl3tyugyr000dgewz98idcdpx","_id":"cl54p5wn20001oawzetgz2sbe"}],"PostTag":[],"Tag":[]}}